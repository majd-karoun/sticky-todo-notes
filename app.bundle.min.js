(()=>{var We=Object.defineProperty;var oe=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var se=(t,e,n)=>e in t?We(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ht=(t,e)=>{for(var n in e||(e={}))Ke.call(e,n)&&se(t,n,e[n]);if(oe)for(var n of oe(e))Ze.call(e,n)&&se(t,n,e[n]);return t};const at=new Map,ie=()=>{Object.entries({trashBin:".trash-bin",statusBar:".status-bar",noteInput:".note-input",selectionBox:".selection-box"}).forEach(([e,n])=>{const i=document.querySelector(n);i&&at.set(e,i)})};window.$=t=>{if(at.has(t)){const e=at.get(t);return e.isConnected?e:(at.delete(t),document.querySelector(t))}return document.querySelector(t)};window.$$=(t,e=!1)=>{if(e&&at.has(t)){const n=at.get(t);return n.every(i=>i.isConnected)?n:(at.delete(t),Array.from(document.querySelectorAll(t)))}return Array.from(document.querySelectorAll(t))};window.$within=(t,e)=>t?t.querySelector(e):null;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie):ie();const Lt=new Map;let pt=null;const fe=()=>{Lt.forEach(({element:t,styles:e})=>{t.isConnected&&Object.entries(e).forEach(([n,i])=>{n.startsWith("--")?t.style.setProperty(n,i):t.style[n]=i})}),Lt.clear(),pt=null},Ve=()=>{pt||(pt=requestAnimationFrame(fe))};window.AnimationUtils={updateStyles(t,e,n="normal"){var o;if(!t||!e)return;const i=t._batchId||(t._batchId=Math.random().toString(36));Lt.set(i,{element:t,styles:Ht(Ht({},(o=Lt.get(i))==null?void 0:o.styles),e)}),Ve()},updatePosition(t,e,n){this.updateStyles(t,{left:`${e}px`,top:`${n}px`})},updateSize(t,e,n){this.updateStyles(t,{width:`${e}px`,height:`${n}px`})},flush(){pt&&(cancelAnimationFrame(pt),fe())}};const ut=new Map,xt=new Map,jt=t=>{if(ut.has(t))try{const e=ut.get(t);localStorage.setItem(t,typeof e=="string"?e:JSON.stringify(e)),ut.delete(t),xt.delete(t)}catch(e){console.warn("Storage save failed:",e)}};window.DebouncedStorage={save(t,e,n="normal"){xt.has(t)&&clearTimeout(xt.get(t)),ut.set(t,e);const i=n==="high"?50:n==="low"?1e3:300;xt.set(t,setTimeout(()=>jt(t),i))},saveHigh(t,e){this.save(t,e,"high")},saveLow(t,e){this.save(t,e,"low")},flush(t){jt(t)},flushAll(){ut.forEach((t,e)=>jt(e))}};window.addEventListener("beforeunload",()=>window.DebouncedStorage.flushAll());const ht=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],N={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let I=[];let pe=null,he=null;let V=null;let L=[],Je=!1;let Q=[];const et={},nt={},Y={};let it=1e3;et[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};nt[1]=ht[0];let m=1,k=1;const gt=9,T="stickyNotes_active",bt="stickyNotes_deleted",ge="stickyNotes_boardCount",ye="stickyNotes_zIndexes",y=t=>parseInt(String(t).replace("px",""))||0,Ot=(t,e,n=150)=>{const i=$(`.board[data-board-id="${m}"]`);if(!i)return!1;const o=Array.from(i.querySelectorAll(".sticky-note")),s=20;for(const a of o){const r=y(a.style.left),l=y(a.style.top),d=y(a.style.width)||200,c=t<r+d+s&&t+200>r-s,h=e+n,u=l+30,p=e<u&&h>l-s;if(c&&p)return!0}return!1},ae=(t,e)=>{const n=Math.random()*10-5;let i=t+n,o=e+70;const s=5,a=window.innerWidth-200,r=window.innerHeight-300,l=20;let d=0;for(;d<l&&Ot(i,o);)o+=40,d++,d>10&&(i=t+250,o=50,d=0);if(o>r){for(o=50,i=t+250;d<l&&Ot(i,o);)o+=40,d++;if(i>a)for(i=s+50,o=50,d=0;d<l&&Ot(i,o);)o+=40,d++}const c=Math.min(Math.max(i,s),a),h=Math.min(Math.max(o,s),window.innerHeight-100);return{x:c,y:h}},Ge=t=>{if(t.startsWith("rgba")){const n=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return n?{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,i,o,s)=>i+i+o+o+s+s);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};const mt=(t=!1)=>{t?(window.DebouncedStorage.flush(`${T}_board_${m}`),window.DebouncedStorage.save(`${T}_board_${m}`,z())):window.DebouncedStorage.save(`${T}_board_${m}`,z()),typeof F=="function"&&F()},z=()=>{const t=$(`.board[data-board-id="${m}"]`);if(!t)return[];const e=Array.from(t.querySelectorAll(".sticky-note"));return Array.from(e).map(n=>({content:$within(n,".sticky-content").innerHTML,x:y(n.style.left),y:y(n.style.top),color:n.style.backgroundColor||"#ffeb3b",width:n.style.width||"200px",height:n.style.height||"150px",isBold:$within(n,".sticky-content").classList.contains("bold"),noteId:n.dataset.noteId,zIndex:n.style.zIndex||1}))};const we=()=>{window.DebouncedStorage.save(ge,k.toString())},ve=()=>{const t={color:N.colors.current,pattern:N.patterns.current};window.DebouncedStorage.saveLow(`boardStyles_board_${m}`,t)},be=()=>{const t=$("#shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},Se=()=>{const t=$(".note-input textarea");if(!t)return;const e=$("#shortcutIcon"),n=()=>{if(!e)return;const i=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",o=t.value.trim();e.innerHTML=o?`${i}+\u21B5`:i,e.classList.toggle("focus-hint",!o),e.classList.toggle("enter-hint",o)};t.addEventListener("focus",()=>{n(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"50px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"200px"})})):(t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px")),t.addEventListener("input",n)}),t.addEventListener("blur",()=>{be(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"200px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"50px"})})):(t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px")),t.removeEventListener("input",n)}),document.addEventListener("mousedown",i=>{!i.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},re=(t,e=null)=>{try{return JSON.parse(t)}catch(n){return console.error("Failed to parse JSON data:",n),e}},Qe=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{const e=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&(i.startsWith("stickyNotes_deleted")||i.startsWith("stickyNotes_zIndexes")||i.startsWith("boardColor_")||i.startsWith("boardPattern_")||i.startsWith("boardStyles_")||i.startsWith("emojiStickers_")||i.startsWith("daysPatternStartDate_")||i.startsWith("emojiUsageOrder"))&&e.push(i)}e.forEach(n=>{localStorage.removeItem(n)}),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},$e=()=>{try{if(typeof kt!="function"){setTimeout($e,50);return}window.DebouncedStorage.flush(),Qe(),typeof le=="function"&&le();const t=localStorage.getItem(ge);if(t){const n=parseInt(t);if(!isNaN(n)&&n>0){k=Math.min(n,gt);for(let i=2;i<=k;i++)typeof qt=="function"&&qt(i)}}typeof Tt=="function"&&Tt();for(let n=1;n<=k;n++){const i=localStorage.getItem(`${T}_board_${n}`);if(i){const o=re(i,[]);Array.isArray(o)&&o.forEach(s=>{if(s&&typeof s=="object"&&(s.text||s.content)){et[n]={x:y(s.x),y:y(s.y)},nt[n]=s.color||ht[0];const a=s.text||s.content,r=kt(a,s.color||ht[0],y(s.x),y(s.y),!0,s.width||"200px",s.height||"150px",s.isBold||!1,n);r&&s.noteId&&(r.dataset.noteId=s.noteId,Y[s.noteId]?(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:Y[s.noteId].toString()}):r.style.zIndex=Y[s.noteId],Y[s.noteId]>it&&(it=Y[s.noteId])):s.zIndex&&!isNaN(parseInt(s.zIndex))&&(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:s.zIndex.toString()}):r.style.zIndex=s.zIndex,Y[s.noteId]=parseInt(s.zIndex),parseInt(s.zIndex)>it&&(it=parseInt(s.zIndex))))}})}typeof vt=="function"&&vt(n)}typeof q=="function"&&q(1);const e=localStorage.getItem(bt);if(e){const n=re(e,[]);Array.isArray(n)&&(I=n,typeof ct=="function"&&ct())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(n=>{typeof window[n]=="function"&&window[n]()}),be(),Se()}catch(t){console.error("Critical error loading saved data:",t)}},tt=()=>++it,tn=t=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{zIndex:tt().toString()}):t.style.zIndex=tt();const e=t.dataset.noteId;e&&(Y[e]=it,Ee())},Ee=()=>{try{window.DebouncedStorage.saveLow(ye,Y)}catch(t){console.error("Error saving note z-indexes:",t)}},en=()=>{try{const t=localStorage.getItem(ye);t&&(Object.assign(Y,JSON.parse(t)),it=Math.max(1e3,...Object.values(Y)))}catch(t){console.error("Error loading note z-indexes:",t)}};const le=()=>{V=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(V.style,{display:"none"}),document.body.appendChild(V)};function nn(){const t=$(".boards-container"),e=n=>{n.target.closest(".board")&&!n.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&n.preventDefault()};document.addEventListener("mousedown",e),t.addEventListener("mousedown",on),document.addEventListener("mousemove",sn),document.addEventListener("mouseup",an)}function on(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=$(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&Mt(),window.isSelecting=!0,window.selectionStartX=t.clientX,window.selectionStartY=t.clientY,document.body.classList.add("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(V,{left:`${window.selectionStartX}px`,top:`${window.selectionStartY}px`,width:"0",height:"0",display:"block"}):V.style.cssText=`left:${window.selectionStartX}px; top:${window.selectionStartY}px; width:0; height:0; display:block;`}function sn(t){if(!window.isSelecting)return;t.preventDefault();const e=window.selectionStartX,n=window.selectionStartY,i=t.clientX,o=t.clientY;AnimationUtils.updateStyles(V,{left:`${Math.min(e,i)}px`,top:`${Math.min(n,o)}px`,width:`${Math.abs(i-e)}px`,height:`${Math.abs(o-n)}px`},"high"),rn()}const an=t=>{window.isSelecting&&(window.isSelecting=!1,document.body.classList.remove("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(V,{display:"none"}):V.style.display="none")};function rn(){const t=V.getBoundingClientRect(),e=$(`.board[data-board-id="${m}"]`);if(!e)return;const n=(i,o,s)=>{const a=i.getBoundingClientRect(),r=!(a.right<t.left||a.left>t.right||a.bottom<t.top||a.top>t.bottom),l=o.indexOf(i);r?l===-1&&(o.push(i),i.classList.add(s)):!Je&&l!==-1&&(o.splice(l,1),i.classList.remove(s))};Array.from(e.querySelectorAll(".sticky-note")).forEach(i=>n(i,L,"selected"))}const Mt=()=>{L.forEach(t=>t.classList.remove("selected")),L=[]};function ln(t){window.isMovingSelection=!0,window.selectionMoveStartX=t.clientX,window.selectionMoveStartY=t.clientY,document.body.classList.add("selecting"),Q=L.map(e=>({element:e,x:y(e.style.left),y:y(e.style.top),type:"note"})),document.addEventListener("mousemove",xe),document.addEventListener("mouseup",Le)}function xe(t){if(!window.isMovingSelection)return;const[e,n]=[t.clientX-window.selectionMoveStartX,t.clientY-window.selectionMoveStartY],[i,o,s]=[5,-5,-5],[a,r]=[window.innerWidth-i,window.innerHeight-i];(d=>d.forEach(c=>{const[h,u]=[Math.min(Math.max(c.x+e,o),a-c.element.offsetWidth/4),Math.min(Math.max(c.y+n,s),r-c.element.offsetHeight/4)];AnimationUtils.updatePosition(c.element,h,u)}))(Q),L.length>0&&(Ne(t.clientX,t.clientY),L.length>1&&Ie())}function Le(t){if(!window.isMovingSelection)return;if(window.isMovingSelection=!1,document.body.classList.remove("selecting"),document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",Le),Bt(),!De().moved){mt();for(let n=L.length-1;n>=0;n--)ke(L[n])&&L.splice(n,1)}Be()}let ft=[];const cn=100,ce=50,dn="#ffd700",un=()=>{const[t,e]=[$("#trashModal"),$(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>It())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},Ft=t=>{L.includes(t)&&L.length>1?(L.forEach((e,n)=>setTimeout(()=>Yt(e),n*100)),Mt()):Yt(t)},Yt=t=>{if(I.length>=cn){!ft.includes(t)&&ft.push(t),un();return}t._eventCleanup&&t._eventCleanup();const e=$within(t,".sticky-content"),n={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};mn(t),I.unshift(n),window.DebouncedStorage.saveLow(bt,I),ct(),fn(t)},mn=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[n,i]=[e.getBoundingClientRect(),t.getBoundingClientRect()],o=Math.min(5,Math.max(0,Math.floor((i.left+i.width/2-n.left)/(n.width/6))));window.noteColumns[o]&&(window.noteColumns[o]=window.noteColumns[o].filter(s=>Math.abs(s.x-y(t.style.left))>1||Math.abs(s.y-y(t.style.top))>1))},fn=t=>{const e=$(".trash-bin"),n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),o=n.left-i.left+n.width/2-i.width/2,s=n.top-i.top;window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{"--throwX":`${o}px`,"--throwY":`${s}px`,animation:"paperCrumble 0.6s ease-in forwards"},"high"),window.AnimationUtils.updateStyles(e,{animation:"binShake 0.6s ease-in-out"},"high")):(t.style.setProperty("--throwX",`${o}px`),t.style.setProperty("--throwY",`${s}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out"),setTimeout(()=>{t.remove(),window.AnimationUtils?window.AnimationUtils.updateStyles(e,{animation:""},"normal"):e.style.animation="",mt(),F()},600)},ke=t=>{const[e,n]=[$(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return n.right>e.left&&n.left<e.right&&n.bottom>e.top&&n.top<e.bottom?(Ft(t),!0):!1},yt=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>It())):setTimeout(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{display:"none"},"normal"):t.style.display="none"},300)},It=()=>{const t=$(".deleted-notes-container");window.AnimationUtils?window.AnimationUtils.updateStyles(t,{minHeight:"200px"},"normal"):t.style.minHeight="200px",t.innerHTML=I.length?I.map((e,n)=>`
            <div class="deleted-note" style="background-color: ${e.color||dn}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${n})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},pn=t=>{const e=$$(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[n]=I.splice(t,1),i=kt(n.text,n.color,y(n.x),y(n.y),!0,n.width,n.height,n.isBold);window.DebouncedStorage.saveLow(bt,I),ct(),It(),requestAnimationFrame(()=>{window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z())}),F()},300)},Ae=()=>{if(I.length===0){yt();return}const t=[...$$(".deleted-note")].slice(0,6);t.forEach((e,n)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${n*ce}ms`}),setTimeout(()=>{I=[],window.DebouncedStorage.saveLow(bt,I),ct(),It(),setTimeout(()=>{if(yt(),ft.length){const e=[...ft];ft=[],setTimeout(()=>{e.forEach(n=>{n!=null&&n.parentNode&&Yt(n)})},300)}},200)},(t.length?(t.length-1)*ce+300:0)+100)},ct=()=>{$(".trash-count").textContent=I.length};document.addEventListener("click",t=>{const e=$("#trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&yt()});let Wt=new Set;const Kt=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,hn=()=>Math.random()*40-20,gn=(t=Dt())=>t.getDay()===0?0:t.getDay()-1;function Pt(t){const e=document.getElementById("noteLimitMessage"),n=e==null?void 0:e.querySelector(".transfer-text");n&&(n.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function Zt(){const t=$(".note-input textarea"),e=t.value.trim();if(!e)return;const n=$(`.board[data-board-id="${m}"]`),i=Array.from(n.querySelectorAll(".sticky-note")),[o,s,a]=[n.classList.contains("board-pattern-weekdays"),n.classList.contains("board-pattern-days"),i.filter(g=>!g.dataset.transferred).length===0];if(!o&&!s&&i.length>=30){Pt("Maximum notes space reached.");return}const r=i.filter(g=>!g.dataset.transferred),l=r[r.length-1];let{x:d,y:c}=et[m]||{x:0,y:0},h=nt[m]||getRandomColor(),u,p;const v=(g,b,j=null)=>{const A=n.offsetWidth/b,D=g*A+10,W=(g+1)*A-210,K=Math.max(D,Math.min(W,D+hn())),U=Array.from(n.querySelectorAll(".sticky-note")).filter(M=>M.style.display!=="none"&&M!==j),[_,J]=[g*A,(g+1)*A],H=U.filter(M=>{const[P,G]=[y(M.style.left),y(M.style.left)+200],[ot,rt]=[Math.max(P,_),Math.min(G,J)];return Math.max(0,rt-ot)/200>.5});return{positionX:K,columnNotes:H}},E=(g,b)=>{const j=window.innerHeight-300;for(let A=0;A<b;A++){const D=(g+A)%b,{positionX:W,columnNotes:K}=v(D,b);let U=0,_=null;K.forEach(H=>{const M=y(H.style.top);M>U&&(U=M,_=H)});const J=_?U+70:60;if(J<=j)return u=W,p=J,_&&(h=_.style.backgroundColor),!0}return Pt("Maximum notes space reached."),!1},O=g=>{let b;const j=g?6:5;if(l){const A=y(l.style.left),D=n.offsetWidth/j;b=Math.floor(A/D),b=Math.max(0,Math.min(b,j-1))}else b=g?gn():Jt(m)||0;return E(b,j)};if(a)if(o||s){if(O(o)===!1)return}else{const g=Math.max(150,window.innerWidth/4);({x:u,y:p}=ae(g,50-70))}else if(o||s){if(O(o)===!1)return}else if(l&&([d,c,h]=[y(l.style.left),y(l.style.top),l.style.backgroundColor]),{x:u,y:p}=ae(d,c),p<=50){const g=i.filter(b=>Math.abs(y(b.style.left)-u)<150);if(g.length>0){const b=g.map(U=>y(U.style.top)),[j,A]=[Math.max(...b),Math.min(...b)],D=window.innerHeight-300,[W,K]=[j+200,A-200];if(W<=D)p=W;else if(K>=50)p=K;else{const U=(J,H)=>{const M=window.innerWidth-200;for(let P=J;H>0?P<=M:P>=55;P+=H*250){const G=i.filter(st=>Math.abs(y(st.style.left)-P)<150);if(G.length===0)return{x:P,y:50};const ot=G.map(st=>y(st.style.top)),[rt,St]=[Math.max(...ot),Math.min(...ot)],[dt,$t]=[rt+200,St-200];if(dt<=D)return{x:P,y:dt};if($t>=50)return{x:P,y:$t}}return null},_=U(u+250,1)||U(u-250,-1);if(_)[u,p]=[_.x,_.y];else{Pt("Maximum notes space reached.");return}}}}kt(e.replace(/\n/g,"<br>"),h,u,p,!1,"200px","150px",!1,m),[et[m],nt[m],t.value]=[{x:u,y:p},h,""],n.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(g=>{delete g.dataset.transferred}),window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z()),F()}function kt(t,e,n,i,o=!1,s="200px",a="150px",r=!1,l=m,d=!1){const[c,h]=[document.createElement("div"),Kt()];Object.assign(c,{className:"sticky-note",innerHTML:`<div class="sticky-content ${r?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${ht.map(g=>`<div class="color-option" style="background-color: ${g}" onclick="changeNoteColor(this, '${g}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${r?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let u;const p=$(`.board[data-board-id="${l}"]`),v=p&&(p.classList.contains("board-pattern-weekdays")||p.classList.contains("board-pattern-days"));u=tt(),window.AnimationUtils?window.AnimationUtils.updateStyles(c,{backgroundColor:e,left:`${n}px`,top:`${i}px`,width:s,height:a,zIndex:u.toString()},"high"):c.style.cssText=`background-color:${e}; left:${n}px; top:${i}px; width:${s}; height:${a}; z-index:${u};`,c.dataset.noteId=h,d&&(c.dataset.repositioned="true",Wt.add(h)),Y[h]=u,Ee();const E=g=>{g.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||tn(c)};c.addEventListener("click",E),c._eventCleanup=()=>{c.removeEventListener("click",E)},Sn(c);const O=$(`.board[data-board-id="${l}"]`);return O?(O.appendChild(c),window.AnimationUtils?window.AnimationUtils.updateStyles(c,{animation:"paperPop 0.3s ease-out forwards"},"high"):c.style.animation="paperPop 0.3s ease-out forwards",o||window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z()),c):(console.error(`Board element with ID ${l} not found.`),null)}function yn(t,e){event.stopPropagation();const n=t.closest(".sticky-note");(n.classList.contains("selected")?$$(".sticky-note.selected"):[n]).forEach(o=>{const s=o.querySelector(".color-button");[o,s].forEach(a=>a.classList.add("color-transition")),[o.style.backgroundColor,s.style.backgroundColor]=[e,e],setTimeout(()=>[o,s].forEach(a=>a.classList.remove("color-transition")),300)}),nt[m]=e,window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z())}const Ce=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),window.DebouncedStorage.saveLow(`${T}_board_${m}`,z())},wn=$("#shortcutIcon")||$(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),Te=()=>{wn.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};Te();$(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Zt())});let C=null,wt=!1,Xt=!1;let de=!1;const vn=t=>{window.activeNote&&window.activeNote._moveHandler&&window.activeNote._moveHandler(t)},bn=t=>{window.activeNote&&window.activeNote._endHandler&&(window.activeNote._endHandler(t),window.activeNote=null)};de||(document.addEventListener("mousemove",vn),document.addEventListener("mouseup",bn),de=!0);function Sn(t){let e=!1,n=!1,i=!1,o,s,a,r,l,d,c;const[h,u,p]=[".color-button",".color-palette",".sticky-content"].map(f=>t.querySelector(f)),v=()=>mt(),E=[],O=()=>mt(),g=()=>mt();p.addEventListener("blur",O),p.addEventListener("input",g),E.push({element:p,event:"blur",handler:O},{element:p,event:"input",handler:g});const b=f=>{i&&!p.contains(f.target)&&([i,p.contentEditable]=[!1,"false"],p.blur(),document.removeEventListener("click",b))},j=f=>{[i,p.contentEditable]=[!0,"true"],setTimeout(()=>{const[S,w]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const x=document.caretRangeFromPoint(f.clientX,f.clientY);x&&(w.removeAllRanges(),w.addRange(x))}else if(document.caretPositionFromPoint){const x=document.caretPositionFromPoint(f.clientX,f.clientY);x&&(S.setStart(x.offsetNode,x.offset),S.collapse(!0),w.removeAllRanges(),w.addRange(S))}p.focus()},0),setTimeout(()=>{document.addEventListener("click",b)},0),f.stopPropagation()};p.addEventListener("dblclick",j),E.push({element:p,event:"dblclick",handler:j});let A=null,D=!1;const W=()=>{!e&&!n&&(D=!0,A=t.style.zIndex||"1",AnimationUtils.updateZIndex(t,tt()))},K=()=>{!e&&!n&&A!==null&&(D=!1,AnimationUtils.updateZIndex(t,tt()),A=null)};t.addEventListener("mouseenter",W),t.addEventListener("mouseleave",K),E.push({element:t,event:"mouseenter",handler:W},{element:t,event:"mouseleave",handler:K});const U=()=>p.contentEditable="false",_=f=>{if(f.key==="Enter")if(f.preventDefault(),f.shiftKey)p.contentEditable="false",v();else{const[S,w]=[window.getSelection(),window.getSelection().getRangeAt(0)],x=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});w.deleteContents(),w.insertNode(x),w.setStartAfter(x),w.collapse(!0),S.removeAllRanges(),S.addRange(w)}};p.addEventListener("blur",U),p.addEventListener("keydown",_),E.push({element:p,event:"blur",handler:U},{element:p,event:"keydown",handler:_});const J=()=>{const f=t.getBoundingClientRect();et[m]={x:f.left,y:f.top}};let H=null;const M=f=>{const[S,w]=[f.clientX,f.clientY];if(!u.classList.contains("visible"))return;const[x,Z]=[u.getBoundingClientRect(),h.getBoundingClientRect()],[lt,_t]=[S>=x.left-20&&S<=x.right+20&&w>=x.top-20&&w<=x.bottom+20,S>=Z.left&&S<=Z.right&&w>=Z.top&&w<=Z.bottom];lt||_t?clearTimeout(H):G()};document.addEventListener("mousemove",M);const P=()=>{clearTimeout(H),u.classList.remove("closing"),u.classList.add("visible"),$$(".color-palette").forEach(f=>{f!==u&&(f.classList.add("closing"),setTimeout(()=>f.classList.remove("visible","closing"),180))})},G=()=>{clearTimeout(H),H=setTimeout(()=>{u.classList.add("closing"),setTimeout(()=>u.classList.contains("closing")&&u.classList.remove("visible","closing"),180)},50)},ot=f=>{f.stopPropagation(),u.classList.contains("visible")?G():P()},rt=f=>{f.target.classList.contains("color-option")&&f.stopPropagation()};h.addEventListener("click",ot),u.addEventListener("click",rt),E.push({element:h,event:"click",handler:ot},{element:u,event:"click",handler:rt});const St=()=>clearTimeout(H),dt=()=>G();u.addEventListener("mouseenter",St),u.addEventListener("mouseleave",dt),E.push({element:u,event:"mouseenter",handler:St},{element:u,event:"mouseleave",handler:dt});const $t=(f,S,w)=>{if(!f.target.closest(".color-palette, .done-button")){if(L.includes(t)&&L.length>1){ln(f);return}f.shiftKey?L.includes(t)||(L.push(t),t.classList.add("selected")):Mt(),f.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],D?A=tt():AnimationUtils.updateZIndex(t,tt()),[o,s]=[S,w],f.target.closest(".resize-handle")?[n,l,d]=[!0,t.offsetWidth,t.offsetHeight]:([a,r]=[y(t.style.left),y(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[a,r],c=setTimeout(()=>e=!0,150)),window.activeNote=t}},st=f=>{if(!window.activeNote||window.activeNote!==t)return;const[S,w]=[f.clientX,f.clientY];if((Math.abs(S-o)>5||Math.abs(w-s)>5)&&(clearTimeout(c),!e&&!n&&(e=!0)),e){window.isDragInProgress||(window.isDragInProgress=!0,document.body.classList.add("drag-in-progress"));const x=5;let[Z,lt]=[Math.min(Math.max(a+S-o,-x),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(r+w-s,-x),window.innerHeight-t.offsetHeight/4)];window.AnimationUtils?window.AnimationUtils.updatePosition(t,Z,lt):[t.style.left,t.style.top]=[`${Z}px`,`${lt}px`],Ne(S,w)}if(n){const[x,Z]=[150,150],[lt,_t]=[window.innerWidth-y(t.style.left)+50,window.innerHeight-y(t.style.top)+50],ee=Math.min(Math.max(l+S-o,x),lt),ne=Math.min(Math.max(d+w-s,Z),_t);window.AnimationUtils?window.AnimationUtils.updateSize(t,ee,ne):(t.style.width=`${ee}px`,t.style.height=`${ne}px`)}},Ut=f=>{if(clearTimeout(c),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],e||n){if(e&&(Bt(),!De().moved)){J(),ke(t),xn(t);const w=t.dataset.noteId||Kt();[t.dataset.noteId,t.dataset.repositioned]=[w,"true"],Wt.add(w),et[m]={x:y(t.style.left),y:y(t.style.top)},nt[m]=t.style.backgroundColor}window.DebouncedStorage.save(`${T}_board_${m}`,z()),window.isDragInProgress=!1,document.body.classList.remove("drag-in-progress")}e=!1,n=!1},te=f=>$t(f,f.clientX,f.clientY);if(t.addEventListener("mousedown",te),t._moveHandler=st,t._endHandler=Ut,E.push({element:t,event:"mousedown",handler:te}),t._eventCleanup){const f=t._eventCleanup;t._eventCleanup=()=>{f(),E.forEach(({element:S,event:w,handler:x})=>{S.removeEventListener(w,x)}),document.removeEventListener("mousemove",st),document.removeEventListener("mouseup",Ut),document.removeEventListener("mousemove",M)}}else t._eventCleanup=()=>{E.forEach(({element:f,event:S,handler:w})=>{f.removeEventListener(S,w)}),document.removeEventListener("mousemove",st),document.removeEventListener("mouseup",Ut),document.removeEventListener("mousemove",M)}}function $n(){$$(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),he=null}const En=t=>{he&&!t.target.closest(".color-button")&&$n()};document.addEventListener("click",En);function xn(t){if(!t)return;const[e,n,i,o]=[t.getBoundingClientRect(),window.innerHeight,250,150],s=n-o,[a,r]=[e.bottom>s,e.left<i&&e.bottom>s];if(r){const[l,d,c]=[e.bottom-s+20,y(t.style.top),Math.max(60,y(t.style.top)-(e.bottom-s+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${c}px`,setTimeout(()=>t.style.transition="",300)}}function Ne(t,e){var u,p;if(Xt)return;const n=$(".status-bar");if(!n)return;const i=n.getBoundingClientRect(),[o,s]=[Math.max(0,Math.max(i.left-t,t-i.right)),Math.max(0,Math.max(i.top-e,e-i.bottom))],[a,r,l,d]=[Math.sqrt(o*o+s*s),120,80,C!==null],c=d?a<=r:a<=l,h=()=>{let[v,E]=[null,1/0];return $$(".board-button:not(.disabled)",!0).forEach(O=>{const g=O.getBoundingClientRect(),b=Math.sqrt(Math.pow(t-(g.left+g.width/2),2)+Math.pow(e-(g.top+g.height/2),2));b<E&&([v,E]=[O,b])}),v};if(c!==d)if(c){const v=$$(".board-button:not(.disabled)");C=h(),v.forEach(E=>E.classList.add("drag-active","drag-proximity")),C&&C.classList.add("drag-hover"),Ln()}else $$(".board-button",!0).forEach(v=>{v.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>v.classList.remove("drag-active"),200)}),C=null,Me();else if(c&&C){const v=h();v!==C&&(C==null||C.classList.remove("drag-hover"),C=v,v?(v.classList.add("drag-hover"),Bt(),(u=$(".shortcut-hint"))==null||u.classList.add("hidden-during-drag")):(Ie(),wt||(p=$(".shortcut-hint"))==null||p.classList.remove("hidden-during-drag")))}}function Ln(){if(!C)return;const t=window.activeNote||pe,[e,n]=[C.getBoundingClientRect(),L.length>0?L:t?[t]:[]];n.forEach(i=>{if(i&&!i.classList.contains("reverse-animating")&&!i.classList.contains("hover-animating")){i.querySelectorAll("textarea, [contenteditable]").forEach(l=>{window.AnimationUtils?window.AnimationUtils.updateStyles(l,{userSelect:"none",pointerEvents:"none"}):[l.style.userSelect,l.style.pointerEvents]=["none","none"]});const[o,s]=[i.getBoundingClientRect(),i.closest(".board").getBoundingClientRect()],[a,r]=[e.left-s.left+e.width/2-(o.left-s.left)-o.width/2,e.top-s.top+e.height/2-(o.top-s.top)-o.height/2];window.AnimationUtils?window.AnimationUtils.updateStyles(i,{"--suckX":`${a}px`,"--suckY":`${r}px`,animation:"noteSuckHover 0.3s ease-out forwards"}):(i.style.setProperty("--suckX",`${a}px`),i.style.setProperty("--suckY",`${r}px`),i.style.animation="noteSuckHover 0.3s ease-out forwards"),i.classList.add("hover-animating")}})}function Me(){$$(".hover-animating",!0).forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{window.AnimationUtils?window.AnimationUtils.updateStyles(e,{userSelect:"",pointerEvents:""}):(e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events"))}),window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckReverse 0.3s ease-out forwards"}):t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"none","--suckX":"","--suckY":""}):([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY")),t.classList.remove("reverse-animating"))},300)})}function Ie(){var t;if(k>1&&!wt&&!C){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),wt=!0),(t=$(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function Bt(){var t;if(wt){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),wt=!1),(t=$(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Be(){$$(".board-button",!0).forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[C]=[null],Me(),Bt()}function De(){if(!C)return{moved:!1};const t=window.activeNote||pe,[e,n]=[parseInt(C.dataset.boardId),L.length>0?[...L]:[t]];if(e===m)return n.forEach(o=>{if(o){const s=Q==null?void 0:Q.find(a=>a.element===o);if(s)window.AnimationUtils?window.AnimationUtils.updatePosition(o,s.x,Math.max(60,s.y)):(o.style.left=`${s.x}px`,o.style.top=`${Math.max(60,s.y)}px`);else{const a=parseInt(o.style.top||0)-250;window.AnimationUtils?window.AnimationUtils.updateStyles(o,{top:`${a}px`}):o.style.top=`${a}px`}}}),{moved:!1};let i=new Map;return n.length>1&&typeof Q!="undefined"&&Q.length>0&&Q.forEach(o=>{o&&n.includes(o.element)&&i.set(o.element,{originalX:o.x,originalY:o.y})}),n.forEach(o=>{o&&kn(o,e,i.size>0?i.get(o):null)}),L.length>0&&Mt(),{moved:!0}}function kn(t,e,n=null){const i=t.style.left;if(t.classList.contains("hover-animating"))window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const o=$(`.board-button[data-board-id="${e}"]`);if(!o)return;const[s,a,r]=[o.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,d]=[s.left-r.left+s.width/2-(a.left-r.left)-a.width/2,s.top-r.top+s.height/2-(a.top-r.top)-a.height/2];window.AnimationUtils?window.AnimationUtils.updateStyles(t,{"--suckX":`${l}px`,"--suckY":`${d}px`,animation:"noteSuckHover 0.3s ease-out forwards"}):(t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${d}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards"),t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(s=>{window.AnimationUtils?window.AnimationUtils.updateStyles(s,{userSelect:"",pointerEvents:""}):(s.style.removeProperty("user-select"),s.style.removeProperty("pointer-events"))}),t.remove();const o=$(`.board[data-board-id="${e}"]`);if(o){if(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"","--suckX":"","--suckY":""}):(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY")),n)if(n.originalX!==void 0&&n.originalY!==void 0)window.AnimationUtils?window.AnimationUtils.updatePosition(t,n.originalX,Math.max(60,n.originalY)):[t.style.left,t.style.top]=[`${n.originalX}px`,`${Math.max(60,n.originalY)}px`];else{const[r,l]=[100,80],d=r+(n.offsetX||0),c=Math.max(60,l+(n.offsetY||0));window.AnimationUtils?window.AnimationUtils.updatePosition(t,d,c):[t.style.left,t.style.top]=[`${d}px`,`${c}px`]}else{const[r,l]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];if(!isNaN(r)&&!isNaN(l))window.AnimationUtils?window.AnimationUtils.updatePosition(t,r,Math.max(60,l)):[t.style.left,t.style.top]=[`${r}px`,`${Math.max(60,l)}px`];else{const d=parseFloat(i)||100;window.AnimationUtils?window.AnimationUtils.updatePosition(t,d,80):[t.style.left,t.style.top]=[i,"80px"]}}const s=t.dataset.noteId||Kt();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[s,"true","true"],Wt.add(s),o.appendChild(t),window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"paperPop 0.3s ease-out forwards"}):t.style.animation="paperPop 0.3s ease-out forwards",F(),Be(),Xt=!0,setTimeout(()=>Xt=!1,500);const a=m;[m]=[e],window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z()),[m]=[a],window.DebouncedStorage.saveHigh(`${T}_board_${m}`,z())}},600)}let B={},R=null,Et={x:0,y:0},X=[];function Ue(){Nn(),Re(),Cn(),$$(".emoji-item").forEach(t=>{t.addEventListener("click",_e)})}const _e=t=>{const e=t.target.dataset.emoji;e&&(Tn(e),An(e))};function An(t){const e=$(".board.active");if(!e)return;const n=e.dataset.boardId;if(In(n)>=10)return Bn();const i=Un(),o=e.getBoundingClientRect(),[s,a,r]=[o.width-120,o.height*.8-120,20],[l,d]=[Math.random()*s,Math.max(r,Math.random()*a)],c=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});c.dataset.stickerId=i,Object.assign(c.style,{left:l+"px",top:d+"px"});const h=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});h.addEventListener("click",u=>[u.stopPropagation(),je(i,n)]),c.appendChild(h),He(c),e.appendChild(c),(B[n]=B[n]||{})[i]={emoji:t,x:l,y:d,id:i},Vt(n),setTimeout(()=>c.classList.remove("new"),400)}function He(t){let e=!1;t.addEventListener("mousedown",n);function n(s){if(s.target.classList.contains("delete-button"))return;s.preventDefault(),s.stopPropagation(),[e,R]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[a,r]=[s.clientX,s.clientY],l=t.getBoundingClientRect();[Et.x,Et.y]=[a-l.left,r-l.top],t.classList.add("dragging"),document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}function i(s){if(!e||!R)return;s.preventDefault(),s.stopPropagation();const[a,r]=[s.clientX,s.clientY],l=$(".board.active").getBoundingClientRect(),[d,c]=[Math.max(0,Math.min(a-l.left-Et.x,l.width-120)),Math.max(0,Math.min(r-l.top-Et.y,l.height-120))];window.AnimationUtils?window.AnimationUtils.updatePosition(R,d,c):Object.assign(R.style,{left:d+"px",top:c+"px"})}function o(){var r;if(!e||!R)return;R.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],Dn(R);const[s,a]=[$(".board.active").dataset.boardId,R.dataset.stickerId];(r=B[s])!=null&&r[a]&&(Object.assign(B[s][a],{x:parseInt(R.style.left),y:parseInt(R.style.top)}),Vt(s)),R=null,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)}}const je=(t,e)=>{const n=$(`[data-sticker-id="${t}"]`);n&&(n.classList.add("deleting"),setTimeout(()=>n.remove(),500)),B[e]&&(delete B[e][t],Vt(e))},Vt=t=>{window.DebouncedStorage.save(`emojiStickers_board_${t}`,B[t]||{})};function Oe(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{B[t]=e?JSON.parse(e):{},e&&Pe(t)}catch(n){console.error("Error loading emoji stickers:",n),B[t]={}}}const Cn=()=>Array.from({length:k},(t,e)=>Oe(e+1));function Pe(t){const e=$(`.board[data-board-id="${t}"]`);!e||!B[t]||(Array.from(e.querySelectorAll(".emoji-sticker")).forEach(n=>n.remove()),Object.values(B[t]).forEach(({id:n,emoji:i,x:o,y:s})=>{const a=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:i});a.dataset.stickerId=n,window.AnimationUtils?window.AnimationUtils.updatePosition(a,o,s):Object.assign(a.style,{left:o+"px",top:s+"px"});const r=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});r.addEventListener("click",l=>[l.stopPropagation(),je(n,t)]),a.appendChild(r),He(a),e.appendChild(a)}))}function Tn(t){const e=X.indexOf(t);(e<0||e>=12)&&(e>-1&&X.splice(e,1),X.unshift(t),X.length>16&&(X=X.slice(0,16)),Mn(),Re())}function Nn(){const t=localStorage.getItem("emojiUsageOrder");try{X=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),X=[]}}const Mn=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(X));function Re(){const t=$(".emoji-picker");t&&(Array.from(t.querySelectorAll(".recent-emoji")).forEach(e=>e.remove()),X.length>0&&X.slice(0,12).reverse().forEach(e=>{const n=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});n.dataset.emoji=e,n.addEventListener("click",_e),t.insertBefore(n,t.firstChild)}))}const In=t=>B[t]?Object.keys(B[t]).length:0,Bn=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function Dn(t){if(!t)return;const[e,n]=[t.getBoundingClientRect(),window.innerHeight],[i,o,s]=[250,150,n-150];if(e.left<i&&e.bottom>s){const r=Math.max(60,parseInt(t.style.top)-(e.bottom-s+20));t.style.top=`${r}px`}}const Un=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),_n=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete B[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Ue,100));window.emojiStickers={loadEmojiStickers:Oe,renderEmojiStickers:Pe,cleanupEmojiStickers:_n,initializeEmojiPicker:Ue};const Dt=()=>new Date,Ye=t=>{const e=Dt().getDay(),n=e===0?6:e-1;return t===n},Hn=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,Dt().toISOString().split("T")[0])},Jt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((Dt()-new Date(e))/(1e3*60*60*24))%5:-1},Xe=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),ue=()=>{if(k>=gt){alert(`Maximum number of boards (${gt}) reached.`);return}qt(++k),we(),Tt()};function qt(t){const e=$(".boards-container"),n=Object.assign(document.createElement("div"),{className:"board"});n.dataset.boardId=t,e.appendChild(n);const i=Object.assign(document.createElement("div"),{className:"board-title-circle"}),o=[],s=()=>{var u;(u=$within(i,".board-title-input"))==null||u.focus()};i.addEventListener("click",s),o.push({element:i,event:"click",handler:s});const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let r;const l=()=>{const u=a.value.trim();if(!u){a.value=a.dataset.originalTitle||"";return}Gt(t,u),Nt(a)},d=()=>{clearTimeout(r),r=setTimeout(l,500)};a.addEventListener("input",d),o.push({element:a,event:"input",handler:d}),Nt(a),i.appendChild(a),n.appendChild(i);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});c.dataset.boardId=t;const h=()=>q(t);if(c.addEventListener("click",h),o.push({element:c,event:"click",handler:h}),t>1){const u=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),p=v=>{v.stopPropagation(),At(t)};u.addEventListener("click",p),o.push({element:u,event:"click",handler:p}),c.appendChild(u)}n._eventCleanup=()=>{o.forEach(({element:u,event:p,handler:v})=>{u.removeEventListener(p,v)}),clearTimeout(r)},$(".boards-navigation").insertBefore(c,$(".add-board-button")),setTimeout(()=>[c.classList.remove("new-button"),c.classList.add("transitions-ready")],500),vt(t),Qt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function At(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=$(`.board[data-board-id="${t}"]`);if(!e){Rt(t);return}const[n,i]=[Array.from(e.querySelectorAll(".sticky-note")),Array.from(e.querySelectorAll(".emoji-sticker"))];if(n.length||i.length){const o=$(".trash-bin"),s=o.getBoundingClientRect();window.AnimationUtils?window.AnimationUtils.updateStyles(o,{animation:"binShake 0.5s ease-in-out"},"high"):o.style.animation="binShake 0.5s ease-in-out",n.forEach(a=>{const r=$within(a,".sticky-content");I.unshift({text:r.innerHTML,color:a.style.backgroundColor,x:a.style.left,y:a.style.top,width:a.style.width,height:a.style.height,timestamp:new Date().toLocaleString(),isBold:r.classList.contains("bold")});const l=a.getBoundingClientRect(),[d,c]=[s.left-l.left+s.width/2-l.width/2,s.top-l.top];window.AnimationUtils?window.AnimationUtils.updateStyles(a,{"--throwX":`${d}px`,"--throwY":`${c}px`,animation:"paperCrumble 0.5s ease-in forwards"},"high"):(a.style.setProperty("--throwX",`${d}px`),a.style.setProperty("--throwY",`${c}px`),a.style.animation="paperCrumble 0.5s ease-in forwards")}),i.forEach(a=>a.classList.add("deleting")),window.DebouncedStorage.saveLow(bt,I),ct(),console.log("Setting timeout for continueWithBoardDeletion, boardId:",t),setTimeout(()=>{console.log("Timeout fired, calling continueWithBoardDeletion"),Rt(t)},600)}else Rt(t)}function Rt(t){console.log("continueWithBoardDeletion called with boardId:",t);const[e,n]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];console.log("Found elements:",{boardElement:e,buttonElement:n}),e!=null&&e._eventCleanup&&e._eventCleanup(),e&&e.remove(),n&&n.classList.add("removing");const i=[];for(let o=t+1;o<=k;o++){const s=$(`.board-button[data-board-id="${o}"]`);s&&(s.classList.add("removing"),i.push(o))}[`${T}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(o=>localStorage.removeItem(o)),Xe(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let o=t+1;o<=k;o++)["boardColor","boardPattern","boardStyles_board"].forEach(s=>{const[a,r,l]=[`${s}_${o}`,`${s}_${o-1}`,localStorage.getItem(`${s}_${o}`)];l&&localStorage.setItem(r,l),localStorage.removeItem(a)});setTimeout(()=>{n&&n.remove();const[o,s]=[$(".boards-navigation"),$(".add-board-button")];i.forEach(a=>{const[r,l,d]=[$(`.board-button[data-board-id="${a}"]`),$(`.board[data-board-id="${a}"]`),a-1];r&&r.remove(),l&&(l.dataset.boardId=d);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:d});if([c.dataset.boardId,c.dataset.originalNumber]=[d,d],c.addEventListener("click",()=>q(d)),d>1){const h=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});h.addEventListener("click",u=>{u.stopPropagation(),At(d)}),c.appendChild(h)}o.insertBefore(c,s),["","Title","Color","Pattern"].forEach(h=>{const[u,p,v]=[h?`stickyNotes_board${h}`:T,`${h?`stickyNotes_board${h}`:T}_board_${a}`,`${h?`stickyNotes_board${h}`:T}_board_${d}`],E=localStorage.getItem(p);E&&(localStorage.setItem(v,E),localStorage.removeItem(p))}),vt(d)}),setTimeout(()=>$$(".board-button.new-button").forEach(a=>[a.classList.remove("new-button"),a.classList.add("transitions-ready")]),500),k--,we(),Tt(),m===t?q(t>1?t-1:k>=1?1:null):m>t&&(m--,q(m)),window.AnimationUtils?window.AnimationUtils.updateStyles($(".trash-bin"),{animation:""},"normal"):$(".trash-bin").style.animation=""},350)}function q(t){const e=parseInt(t);e===m||e===null||(Rn(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),m=e,et[t]||(et[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),nt[t]||(nt[t]=ht[0]),$$(".board").forEach(n=>{const i=parseInt(n.dataset.boardId);if(n.classList.remove("active","prev","next"),window.AnimationUtils?window.AnimationUtils.updateStyles(n,{visibility:"hidden"},"high"):n.style.visibility="hidden",i===m){if(n.classList.add("active"),window.AnimationUtils?window.AnimationUtils.updateStyles(n,{visibility:"visible"},"high"):n.style.visibility="visible",Array.from(n.querySelectorAll(".sticky-note")).forEach((o,s)=>window.AnimationUtils?window.AnimationUtils.updateStyles(o,{"--note-index":s.toString()},"low"):o.style.setProperty("--note-index",s)),Array.from(n.querySelectorAll(".emoji-sticker")).forEach((o,s)=>window.AnimationUtils?window.AnimationUtils.updateStyles(o,{"--sticker-index":s.toString()},"low"):o.style.setProperty("--sticker-index",s)),!$within(n,".board-title-circle")){const o=Object.assign(document.createElement("div"),{className:"board-title-circle"});o.setAttribute("onclick","$within(this, '.board-title-input').focus()");const s=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),a=()=>Gt(i,s.value);["change","blur"].forEach(r=>s.addEventListener(r,a)),o.appendChild(s),n.appendChild(o),Qt(i)}}else n.classList.add(i<m?"prev":"next")}),$$(".board-button").forEach(n=>n.classList.toggle("active",parseInt(n.dataset.boardId)===m)),vt(m),ze(),$$(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=N.colors.current),F(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(m),setTimeout(()=>Fe(m),300))}let Ct=[];function jn(){On();const t=ue;$(".add-board-button").addEventListener("click",t),Ct.push({element:$(".add-board-button"),event:"click",handler:t}),$$(".board-button").forEach(n=>{const[i,o]=[parseInt(n.dataset.boardId),n.cloneNode(!0)],s=()=>q(i);o.addEventListener("click",s);const a=$within(o,".delete-board");if(a){const r=l=>{l.stopPropagation(),At(i)};a.addEventListener("click",r)}n.parentNode.replaceChild(o,n)});const e=n=>{const[i,o]=[n.target.tagName,n.target.getAttribute("contenteditable")==="true"];if((n.key==="Control"||n.key==="Meta")&&!n.altKey&&!n.shiftKey&&i!=="TEXTAREA"&&!o){n.preventDefault(),$(".note-input textarea").focus();return}if(i==="TEXTAREA"||o){(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),Zt());return}n.key==="ArrowLeft"&&m>1?q(m-1):n.key==="ArrowRight"&&m<k?q(m+1):n.key==="n"&&n.ctrlKey?(n.preventDefault(),ue()):n.key==="d"&&n.ctrlKey&&m>1&&(n.preventDefault(),At(m));const s=parseInt(n.key);!isNaN(s)&&s>=1&&s<=9&&s<=k&&q(s)};document.addEventListener("keydown",e),Ct.push({element:document,event:"keydown",handler:e})}function On(){Ct.forEach(({element:t,event:e,handler:n})=>{t.removeEventListener(e,n)}),Ct=[]}function Tt(){const t=$(".add-board-button"),e=k>=gt;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${gt}) reached`:"Add new board",Pn()}function Pn(){const t=$(".shortcut-hint");t&&(t.style.display=k>=2?"block":"none")}let me=!1;function Rn(){if(me||k<2)return;const t=$(".shortcut-hint");t&&(me=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function Yn(){const t=$(".board-style-menu"),e=t.classList.contains("visible");e||(ze(),qe(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=N.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function qe(){$(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",n=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?Xn(n):zn(n),document.querySelectorAll(`.board-${e}-option`).forEach(i=>i.classList.remove("active")),t.classList.add("active")})})}function ze(){["color","pattern"].forEach(t=>{$$(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===N[`${t}s`].current)})})}function zt(){return $(".board.active")}function Xn(t){N.colors.current=t;const e=zt();e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(n=>{n.style.backgroundColor=t,n.classList.contains("board-pattern-option")&&(n.style.opacity="0.8")}),ve(),F(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function qn(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; transition:opacity 0.3s ease-out; opacity:0;"}),n=$(`.board[data-board-id="${m}"]`);if(t!=="none"){const i={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(i[t])e.style.cssText+=i[t];else if(t==="weekdays"||t==="days"){const o=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((a,r)=>{const l=Object.assign(document.createElement("span"),{textContent:a});(t==="weekdays"&&Ye(r)||t==="days"&&Jt(m)===r)&&l.classList.add("current-day"),o.appendChild(l)}),e.appendChild(o),n==null||n.classList.add("has-header")}}else n==null||n.classList.remove("has-header");return e}function zn(t){const[e,n,i]=[zt(),zt().dataset.boardId,N.patterns.current];i==="days"&&t!=="days"&&Xe(n),N.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay, .weekday-header, .day-header").forEach(a=>a.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),Array.from(e.children).forEach(a=>{a.tagName==="DIV"&&a.style.position==="absolute"&&a.style.pointerEvents==="none"&&(a.style.zIndex==="0"||a.style.zIndex==="1"||a.style.top==="0px"||a.style.left==="0px")&&a.remove()}),t==="days"&&Hn(n);const o=qn(t);e.appendChild(o);let s=null;(t==="weekdays"||t==="days")&&(s=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.3s ease;"}),e.appendChild(s)),o.offsetWidth,requestAnimationFrame(()=>{o.style.opacity="1",s&&(s.style.opacity="1")}),o.addEventListener("transitionend",()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),o.classList.add("pattern-overlay"),s&&s.classList.add("pattern-overlay")):t!=="none"&&e.classList.add(`board-pattern-${t}`),F()},{once:!0}),ve()}function Fn(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(n=>n.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const n=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(s,a)=>`Day ${a+1}`)).forEach((s,a)=>{const r=Object.assign(document.createElement("span"),{textContent:s});(e.pattern==="weekdays"&&Ye(a)||e.pattern==="days"&&Jt(parseInt(t.dataset.boardId))===a)&&r.classList.add("current-day"),n.appendChild(r)}),t.appendChild(n);const o=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(o)}}function vt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),n=$(`.board[data-board-id="${t}"]`);if(!n)return;let i;e?(i=JSON.parse(e),t===m&&(N.colors.current=i.color,N.patterns.current=i.pattern)):(i={color:N.colors.default,pattern:N.patterns.default},t===m&&(N.colors.current=i.color,N.patterns.current=i.pattern)),Fn(n,i),F()}Wn();document.addEventListener("click",function(t){const e=$(".board-style-menu"),n=$(".board-style-button");e&&e.classList.contains("visible")&&n&&!n.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function Wn(){document.querySelectorAll(".board").forEach(t=>Qt(t.dataset.boardId))}function Gt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const n=$(`.board-button[data-board-id="${t}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function Nt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function Qt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),n=$(`.board[data-board-id="${t}"]`);if(n){const o=n.querySelector(".board-title-input");o&&e&&(o.value=e)}const i=$(`.board-button[data-board-id="${t}"]`);i&&!i.dataset.originalNumber&&(i.dataset.originalNumber=i.textContent)}function Fe(t){const e=$(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function Kn(){$$(".board-title-circle").forEach(t=>{let e;const[n,i]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((o,s)=>{t.addEventListener(o,()=>{s===0?(n&&n.focus(),clearTimeout(e),t.classList.add("delayed-close")):s===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),n&&n.blur()):n&&n.focus()})}),n){let o;const s=()=>{const a=n.value.trim();if(!a){n.dataset.originalTitle="";return}Gt(i,a),Nt(n)};n.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(s,500)}),Nt(n)}})}const F=()=>{for(let t=1;t<=k;t++){const[e,n]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];if(!e||!n)continue;const i=e.style.backgroundColor||N.colors.default;n.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),n.style.backgroundColor=i;const o=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],s=o.find(r=>e.classList.contains(r));o.forEach(r=>n.classList.remove(r.replace("board-pattern","button-pattern"))),s&&n.classList.add(s.replace("board-pattern","button-pattern"));const a=Ge(i)||{r:26,g:26,b:26};n.style.color=(a.r*299+a.g*587+a.b*114)/1e3>128?"#000":"#fff"}};function Zn(t){t.forEach(({selector:e,event:n,handler:i})=>{const o=$(e);o&&o.addEventListener(n,i)})}const Vn=function(){en(),$e(),Se(),jn(),qe(),nn(),Te(),Kn(),Jn(),setTimeout(()=>Fe(m),500),Gn(),Zn([{selector:".board-style-button",event:"click",handler:Yn},{selector:".trash-bin",event:"click",handler:yt},{selector:"#trashModal .close-modal-btn",event:"click",handler:yt},{selector:"#trashModal .clear-trash-btn",event:"click",handler:Ae}])};document.addEventListener("DOMContentLoaded",Vn);function Jn(){const t=o=>{const s=o.selectionStart,a=o.value;if(a.length>0){const r=a.charAt(0).toUpperCase()+a.slice(1);r!==a&&(o.value=r,o.setSelectionRange(s,s))}},e=o=>{["input","keyup"].forEach(a=>{o.addEventListener(a,r=>t(r.target))});const s=a=>setTimeout(()=>t(a.target),0);o.addEventListener("paste",s)};$$(".board-title-input, .note-input textarea").forEach(e);const n=new MutationObserver(o=>{o.forEach(s=>{s.addedNodes.forEach(a=>{var r;a.nodeType===1&&((a.querySelectorAll?Array.from(a.querySelectorAll(".board-title-input")):[]).forEach(e),(r=a.classList)!=null&&r.contains("board-title-input")&&e(a))})})}),i=$(".boards-container");i&&n.observe(i,{childList:!0,subtree:!0})}function Gn(){setTimeout(()=>{$$(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{transform:"scale(1)"},"normal"):t.style.transform="scale(1)"})})},100)}window.toggleBold=Ce;window.markAsDone=Ft;window.addNote=Zt;window.restoreNote=pn;window.changeNoteColor=yn;window.markAsDone=Ft;window.toggleBold=Ce;window.clearTrash=Ae;})();
