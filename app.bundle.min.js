(()=>{var on=Object.defineProperty;var vt=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var yt=(e,t,n)=>t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bt=(e,t)=>{for(var n in t||(t={}))sn.call(t,n)&&yt(e,n,t[n]);if(vt)for(var n of vt(t))an.call(t,n)&&yt(e,n,t[n]);return e};const D=new Map;typeof window!="undefined"&&(window.domCache=D);const c=(e,t=!1)=>{const n=[".board.active",".board[data-board-id=",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".board-button"],s=[`.board[data-board-id="${u||1}"]`,".board.active"],r=n.some(a=>e.includes(a)),o=s.some(a=>e===a);if(r||o||t){const a=document.querySelector(e);return o&&!r&&D.set(e,a),a}if(!D.has(e)){const a=document.querySelector(e);return D.set(e,a),a}return D.get(e)},x=(e,t=!1)=>{if([".board",".board-button",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".emoji-item",".sticky-note.selected",".board.active",".board-pattern-option",".board-color-option",".color-option"].some(a=>e.includes(a))||t)return Array.from(document.querySelectorAll(e));const r=`all:${e}`;if(!D.has(r)){const a=Array.from(document.querySelectorAll(e));return D.set(r,a),a}const o=D.get(r);return Array.isArray(o)?[...o]:Array.from(document.querySelectorAll(e))},rn=(e,t)=>{if(!e)return null;const n=`${e.className||"element"}:${t}`;if(!D.has(n)){const s=e.querySelector(t);return D.set(n,s),s}return D.get(n)},cn={get boardsContainer(){return c(".boards-container")},get activeBoard(){return c(".board.active")},get currentBoard(){const e=typeof window!="undefined"&&window.currentBoardId||1;return c(`.board[data-board-id="${e}"]`)},get boardsNavigation(){return c(".boards-navigation")},get addBoardButton(){return c(".add-board-button")},get noteInput(){return c(".note-input textarea")},get textareaContainer(){return c(".textarea-container")},get boardStyleMenu(){return c(".board-style-menu")},get boardStyleButton(){return c(".board-style-button")},get shortcutHint(){return c(".shortcut-hint")},get shortcutIcon(){return c("#shortcutIcon")},get trashBin(){return c(".trash-bin")},get trashModal(){return c("#trashModal")},get trashCount(){return c(".trash-count")},get deletedNotesContainer(){return c(".deleted-notes-container")},get clearTrashBtn(){return c(".clear-trash-btn")},get dragTransferMessage(){return c("#dragTransferMessage")},get noteLimitMessage(){return c("#noteLimitMessage")},get statusBar(){return c(".status-bar")},get emojiPicker(){return c(".emoji-picker")},get allBoards(){return x(".board",!0)},get allBoardButtons(){return x(".board-button",!0)},get activeBoardNotes(){const e=this.currentBoard;return e?Array.from(e.querySelectorAll(".sticky-note")):[]},get selectedNotes(){return x(".sticky-note.selected",!0)},get colorPalettes(){return x(".color-palette",!0)}},ln=(e=null)=>{if(!e){D.clear();return}(Array.isArray(e)?e:[e]).forEach(n=>{D.delete(n),D.delete(`all:${n}`)})},Dt=()=>{[".board",".board-button",".sticky-note",".color-palette",".board-title-input",".board.active"].forEach(t=>{D.delete(t),D.delete(`all:${t}`)});for(let t=1;t<=9;t++)D.delete(`.board[data-board-id="${t}"]`)};typeof window!="undefined"&&(window.$=c,window.$$=x,window.$within=rn,window.DOM=cn,window.clearCache=ln,window.refreshDynamicCache=Dt);let Xe=null;const wt=()=>{if(Xe)return;Xe=new MutationObserver(t=>{let n=!1;t.forEach(s=>{var r,o,a;s.type==="childList"&&((r=s.target.classList)!=null&&r.contains("boards-container")||(o=s.target.classList)!=null&&o.contains("board")||(a=s.target.classList)!=null&&a.contains("boards-navigation"))&&(n=!0)}),n&&Dt()});const e=c(".boards-container");e&&Xe.observe(e,{childList:!0,subtree:!0})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",wt):setTimeout(wt,0);const K={mouseX:0,mouseY:0,isDragging:!1,isResizing:!1,isSelecting:!1,isMovingSelection:!1,isDragInProgress:!1,activeNote:null,hoveredBoardButton:null,selectionStartX:0,selectionStartY:0,selectionMoveStartX:0,selectionMoveStartY:0,hoverTimeout:null,holdTimer:null},I={mousemove:new Set,mouseup:new Set,mousedown:new Set,keydown:new Set,click:new Set},dn=(e,t,n="default")=>{I[e]||(I[e]=new Set),t._moduleId=n,I[e].add(t)},un=e=>{Object.values(I).forEach(t=>{t.forEach(n=>{n._moduleId===e&&t.delete(n)})})},Fe=e=>{K.mouseX=e.clientX,K.mouseY=e.clientY,I.mousemove&&I.mousemove.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mousemove handler:",n)}})},We=e=>{I.mouseup&&I.mouseup.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mouseup handler:",n)}}),K.isDragging=!1,K.isResizing=!1,K.activeNote=null},Ke=e=>{I.mousedown&&I.mousedown.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mousedown handler:",n)}})},Je=e=>{I.keydown&&I.keydown.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in keydown handler:",n)}})},Ze=e=>{I.click&&I.click.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in click handler:",n)}})},Ie=()=>{document.removeEventListener("mousemove",Fe),document.removeEventListener("mouseup",We),document.removeEventListener("mousedown",Ke),document.removeEventListener("keydown",Je),document.removeEventListener("click",Ze),document.addEventListener("mousemove",Fe,{passive:!0}),document.addEventListener("mouseup",We),document.addEventListener("mousedown",Ke),document.addEventListener("keydown",Je),document.addEventListener("click",Ze)},mn=()=>{document.removeEventListener("mousemove",Fe),document.removeEventListener("mouseup",We),document.removeEventListener("mousedown",Ke),document.removeEventListener("keydown",Je),document.removeEventListener("click",Ze),Object.keys(I).forEach(e=>{I[e].clear()})};typeof window!="undefined"&&(window.eventManager={registerHandler:dn,unregisterModule:un,initializeEventManager:Ie,cleanupEventManager:mn,eventState:K,handlerRegistry:I});Ie();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ie):setTimeout(Ie,0);class gn{constructor(){this.pendingUpdates=new Map,this.rafId=null,this.isProcessing=!1}batchUpdate(t,n,s="normal"){if(!t||!n)return;const r=this.getElementId(t);this.pendingUpdates.has(r)||this.pendingUpdates.set(r,{element:t,styles:{},priority:s,transforms:{}});const o=this.pendingUpdates.get(r);Object.entries(n).forEach(([a,i])=>{a==="transform"||a.startsWith("transform")?o.transforms[a]=i:o.styles[a]=i}),this.getPriorityLevel(s)>this.getPriorityLevel(o.priority)&&(o.priority=s),this.scheduleFlush()}batchTransform(t,n,s,r={}){const o=bt({transform:`translate(${n}px, ${s}px)`},r);this.batchUpdate(t,o,"high")}batchMultiple(t){t.forEach(({element:n,styles:s,priority:r})=>{this.batchUpdate(n,s,r)})}scheduleFlush(){this.rafId||this.isProcessing||(this.rafId=requestAnimationFrame(()=>{this.flush()}))}flush(){if(!this.isProcessing){this.isProcessing=!0,this.rafId=null;try{Array.from(this.pendingUpdates.values()).sort((n,s)=>this.getPriorityLevel(s.priority)-this.getPriorityLevel(n.priority)).forEach(({element:n,styles:s,transforms:r})=>{n.isConnected&&(Object.entries(s).forEach(([o,a])=>{n.style[o]=a}),Object.entries(r).forEach(([o,a])=>{n.style[o]=a}))}),this.pendingUpdates.clear()}catch(t){console.warn("Animation batch flush error:",t)}finally{this.isProcessing=!1}}}forceFlush(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.flush()}clearElement(t){const n=this.getElementId(t);this.pendingUpdates.delete(n)}clearAll(){this.pendingUpdates.clear(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}getElementId(t){return t._batcherId||(t._batcherId=`element_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),t._batcherId}getPriorityLevel(t){switch(t){case"high":return 3;case"normal":return 2;case"low":return 1;default:return 2}}getStats(){return{pendingUpdates:this.pendingUpdates.size,isProcessing:this.isProcessing,hasScheduledFlush:!!this.rafId}}}window.animationBatcher=new gn;const he={updatePosition(e,t,n){window.animationBatcher.batchUpdate(e,{left:`${t}px`,top:`${n}px`},"high")},updateSize(e,t,n){window.animationBatcher.batchUpdate(e,{width:`${t}px`,height:`${n}px`},"high")},updateOpacity(e,t){window.animationBatcher.batchUpdate(e,{opacity:t.toString()},"normal")},updateZIndex(e,t){window.animationBatcher.batchUpdate(e,{zIndex:t.toString()},"low")},updateStyles(e,t,n="normal"){window.animationBatcher.batchUpdate(e,t,n)}};window.AnimationUtils=he;class fn{constructor(){this.pendingSaves=new Map,this.debounceTimers=new Map,this.defaultDelay=300,this.isProcessing=!1}debounceSave(t,n,s=this.defaultDelay,r="normal"){if(r==="immediate"){this.saveImmediately(t,n);return}this.pendingSaves.set(t,{data:n,priority:r,timestamp:Date.now()}),this.debounceTimers.has(t)&&clearTimeout(this.debounceTimers.get(t));const o=setTimeout(()=>{this.executeSave(t)},s);this.debounceTimers.set(t,o)}saveImmediately(t,n){try{const s=typeof n=="string"?n:JSON.stringify(n);localStorage.setItem(t,s),this.pendingSaves.delete(t),this.debounceTimers.has(t)&&(clearTimeout(this.debounceTimers.get(t)),this.debounceTimers.delete(t))}catch(s){console.warn(`Failed to save to localStorage (key: ${t}):`,s)}}executeSave(t){if(!this.pendingSaves.has(t))return;const{data:n}=this.pendingSaves.get(t);this.saveImmediately(t,n)}flushAll(){this.debounceTimers.forEach(t=>clearTimeout(t)),this.debounceTimers.clear(),this.pendingSaves.forEach(({data:t},n)=>{try{const s=typeof t=="string"?t:JSON.stringify(t);localStorage.setItem(n,s)}catch(s){console.warn(`Failed to flush localStorage (key: ${n}):`,s)}}),this.pendingSaves.clear()}cancelSave(t){this.debounceTimers.has(t)&&(clearTimeout(this.debounceTimers.get(t)),this.debounceTimers.delete(t)),this.pendingSaves.delete(t)}getStatus(){return{pendingSaves:Array.from(this.pendingSaves.keys()),activeTimers:this.debounceTimers.size,isProcessing:this.isProcessing}}clear(){this.debounceTimers.forEach(t=>clearTimeout(t)),this.debounceTimers.clear(),this.pendingSaves.clear()}}window.storageDebouncer=new fn;const hn={save(e,t,n=300){window.storageDebouncer.debounceSave(e,t,n,"normal")},saveImmediate(e,t){window.storageDebouncer.saveImmediately(e,t)},saveHigh(e,t){window.storageDebouncer.debounceSave(e,t,100,"high")},saveLow(e,t){window.storageDebouncer.debounceSave(e,t,1e3,"low")},load(e,t=null){try{const n=localStorage.getItem(e);if(n===null)return t;try{return JSON.parse(n)}catch(s){return n}}catch(n){return console.warn(`Failed to load from localStorage (key: ${e}):`,n),t}},remove(e){window.storageDebouncer.cancelSave(e);try{localStorage.removeItem(e)}catch(t){console.warn(`Failed to remove from localStorage (key: ${e}):`,t)}},flush(){window.storageDebouncer.flushAll()}};window.DebouncedStorage=hn;window.addEventListener("beforeunload",()=>{window.storageDebouncer.flushAll()});document.addEventListener("visibilitychange",()=>{document.hidden&&window.storageDebouncer.flushAll()});const we=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],A={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let B=[];let It=null,Nt=null;let me=null;let M=[],pn=!1;let ae=[];const re={},ie={},W={};let de=1e3;re[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};ie[1]=we[0];let u=1,C=1;const Se=9,N="stickyNotes_active",ge="stickyNotes_deleted",Ve="stickyNotes_boardCount",Ge="stickyNotes_zIndexes",y=e=>parseInt(String(e).replace("px",""))||0,qe=(e,t,n=150)=>{const s=c(`.board[data-board-id="${u}"]`);if(!s)return!1;const r=s.querySelectorAll(".sticky-note"),o=20;for(const a of r){const i=y(a.style.left),l=y(a.style.top),f=y(a.style.width)||200,d=e<i+f+o&&e+200>i-o,p=t+n,m=l+30,g=t<m&&p>l-o;if(d&&g)return!0}return!1},St=(e,t)=>{const n=Math.random()*10-5;let s=e+n,r=t+70;const o=5,a=window.innerWidth-200,i=window.innerHeight-300,l=20;let f=0;for(;f<l&&qe(s,r);)r+=40,f++,f>10&&(s=e+250,r=50,f=0);if(r>i){for(r=50,s=e+250;f<l&&qe(s,r);)r+=40,f++;if(s>a)for(s=o+50,r=50,f=0;f<l&&qe(s,r);)r+=40,f++}const d=Math.min(Math.max(s,o),a),p=Math.min(Math.max(r,o),window.innerHeight-100);return{x:d,y:p}},vn=e=>{if(e.startsWith("rgba")){const n=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return n?{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])}:null}e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,s,r,o)=>s+s+r+r+o+o);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},st=(e,t,n=!1)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`Failed to save to localStorage (${e}):`,s)}},Y=(e=!1)=>{const t=ee();window.DebouncedStorage?e?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,t):window.DebouncedStorage.saveLow(`${N}_board_${u}`,t):st(`${N}_board_${u}`,t,e),typeof J=="function"&&J()},ee=()=>{const e=c(`.board[data-board-id="${u}"]`);if(!e)return[];const t=e.querySelectorAll(".sticky-note");return Array.from(t).map(n=>({content:n.querySelector(".sticky-content").textContent,x:y(n.style.left),y:y(n.style.top),color:n.style.backgroundColor||"#ffeb3b",width:n.style.width||"200px",height:n.style.height||"150px",isBold:n.querySelector(".sticky-content").classList.contains("bold"),noteId:n.dataset.noteId,zIndex:n.style.zIndex||1}))},je=()=>{window.DebouncedStorage?window.DebouncedStorage.saveLow(ge,B):st(ge,B)},Bt=()=>{window.DebouncedStorage?window.DebouncedStorage.save(Ve,C.toString()):localStorage.setItem(Ve,C.toString())},At=()=>{const e={color:A.colors.current,pattern:A.patterns.current};window.DebouncedStorage?window.DebouncedStorage.saveLow(`boardStyles_board_${u}`,e):st(`boardStyles_board_${u}`,e)},Ht=()=>{const e=c("#shortcutIcon");if(!e)return;const t=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";e.innerHTML=t,e.className="shortcut-icon focus-hint"},_t=()=>{const e=c(".note-input textarea");if(!e)return;const t=c("#shortcutIcon"),n=()=>{if(!t)return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",r=e.value.trim();t.innerHTML=r?`${s}+\u21B5`:s,t.classList.toggle("focus-hint",!r),t.classList.toggle("enter-hint",r)};e.addEventListener("focus",()=>{n(),e.style.height="50px",requestAnimationFrame(()=>e.style.height="200px"),e.addEventListener("input",n)}),e.addEventListener("blur",()=>{Ht(),e.style.height="200px",requestAnimationFrame(()=>e.style.height="50px"),e.removeEventListener("input",n)}),document.addEventListener("mousedown",s=>{!s.target.closest(".note-input")&&document.activeElement===e&&e.blur()})},Et=(e,t=null)=>{try{return JSON.parse(e)}catch(n){return console.error("Failed to parse JSON data:",n),t}},yn=()=>{const e="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(e))try{const t=[];for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);s&&(s.startsWith("stickyNotes_deleted")||s.startsWith("stickyNotes_zIndexes")||s.startsWith("boardColor_")||s.startsWith("boardPattern_")||s.startsWith("boardStyles_")||s.startsWith("emojiStickers_")||s.startsWith("daysPatternStartDate_")||s.startsWith("emojiUsageOrder"))&&t.push(s)}t.forEach(n=>{localStorage.removeItem(n)}),localStorage.setItem(e,"true")}catch(t){console.error("Error during localStorage cleanup:",t),localStorage.setItem(e,"true")}},jt=()=>{try{if(typeof Ne!="function"){setTimeout(jt,50);return}window.DebouncedStorage&&window.DebouncedStorage.flush(),yn(),typeof Lt=="function"&&Lt();const e=localStorage.getItem(Ve);if(e){const n=parseInt(e);if(!isNaN(n)&&n>0){C=Math.min(n,Se);for(let s=2;s<=C;s++)typeof nt=="function"&&nt(s)}}typeof He=="function"&&He();for(let n=1;n<=C;n++){const s=localStorage.getItem(`${N}_board_${n}`);if(s){const r=Et(s,[]);Array.isArray(r)&&r.forEach(o=>{if(o&&typeof o=="object"&&(o.text||o.content)){re[n]={x:y(o.x),y:y(o.y)},ie[n]=o.color||we[0];const a=o.text||o.content,i=Ne(a,o.color||we[0],y(o.x),y(o.y),!0,o.width||"200px",o.height||"150px",o.isBold||!1,n);i&&o.noteId&&(i.dataset.noteId=o.noteId,W[o.noteId]?(i.style.zIndex=W[o.noteId],W[o.noteId]>de&&(de=W[o.noteId])):o.zIndex&&!isNaN(parseInt(o.zIndex))&&(i.style.zIndex=o.zIndex,W[o.noteId]=parseInt(o.zIndex),parseInt(o.zIndex)>de&&(de=parseInt(o.zIndex))))}})}typeof ke=="function"&&ke(n)}typeof G=="function"&&G(1);const t=localStorage.getItem(ge);if(t){const n=Et(t,[]);Array.isArray(n)&&(B=n,typeof pe=="function"&&pe())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(n=>{typeof window[n]=="function"&&window[n]()}),Ht(),_t()}catch(e){console.error("Critical error loading saved data:",e)}},ue=()=>++de,bn=e=>{e.style.zIndex=ue();const t=e.dataset.noteId;t&&(W[t]=de,Ot())},Ot=()=>{try{window.DebouncedStorage?window.DebouncedStorage.saveLow(Ge,W):localStorage.setItem(Ge,JSON.stringify(W))}catch(e){console.error("Error saving note z-indexes:",e)}},wn=()=>{try{const e=localStorage.getItem(Ge);e&&(Object.assign(W,JSON.parse(e)),de=Math.max(1e3,...Object.values(W)))}catch(e){console.error("Error loading note z-indexes:",e)}};const Lt=()=>{me=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(me.style,{display:"none"}),document.body.appendChild(me)};function Sn(){const e=c(".boards-container"),t=n=>{n.target.closest(".board")&&!n.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&n.preventDefault()};window.EventManager?window.EventManager.registerHandler("mousedown",t):document.addEventListener("mousedown",t),window.EventManager?window.EventManager.registerHandler("mousedown",xt,e):e.addEventListener("mousedown",xt),window.eventManager&&(window.eventManager.registerHandler("mousemove",En,"selection"),window.eventManager.registerHandler("mouseup",Ln,"selection"))}function xt(e){if(e.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;e.preventDefault();const t=c(".note-input textarea");t&&document.activeElement===t&&t.blur(),!e.shiftKey&&Oe();const n=window.eventManager?window.eventManager.eventState:{};[n.isSelecting,n.selectionStartX,n.selectionStartY]=[!0,e.clientX,e.clientY],document.body.classList.add("selecting"),me.style.cssText=`left:${n.selectionStartX}px; top:${n.selectionStartY}px; width:0; height:0; display:block;`}function En(e,t){if(!t.isSelecting)return;e.preventDefault();const n=t.selectionStartX,s=t.selectionStartY,r=e.clientX,o=e.clientY;he.updateStyles(me,{left:`${Math.min(n,r)}px`,top:`${Math.min(s,o)}px`,width:`${Math.abs(r-n)}px`,height:`${Math.abs(o-s)}px`},"high"),xn()}const Ln=(e,t)=>{t.isSelecting&&(t.isSelecting=!1,document.body.classList.remove("selecting"),me.style.display="none")};function xn(){const e=me.getBoundingClientRect(),t=c(`.board[data-board-id="${u}"]`);if(!t)return;const n=(s,r,o)=>{const a=s.getBoundingClientRect(),i=!(a.right<e.left||a.left>e.right||a.bottom<e.top||a.top>e.bottom),l=r.indexOf(s);i?l===-1&&(r.push(s),s.classList.add(o)):!pn&&l!==-1&&(r.splice(l,1),s.classList.remove(o))};t.querySelectorAll(".sticky-note").forEach(s=>n(s,M,"selected"))}const Oe=()=>{M.forEach(e=>e.classList.remove("selected")),M=[]};function kn(e){const t=window.eventManager?window.eventManager.eventState:{};[t.isMovingSelection,t.selectionMoveStartX,t.selectionMoveStartY]=[!0,e.clientX,e.clientY],document.body.classList.add("selecting"),ae=M.map(n=>({element:n,x:y(n.style.left),y:y(n.style.top),type:"note"})),window.eventManager&&(window.eventManager.registerHandler("mousemove",Mn,"selection-move"),window.eventManager.registerHandler("mouseup",Cn,"selection-move"))}function Mn(e,t){if(!t.isMovingSelection)return;const[n,s]=[e.clientX-t.selectionMoveStartX,e.clientY-t.selectionMoveStartY],[r,o,a]=[5,-5,-5],[i,l]=[window.innerWidth-r,window.innerHeight-r];(d=>d.forEach(p=>{const[m,g]=[Math.min(Math.max(p.x+n,o),i-p.element.offsetWidth/4),Math.min(Math.max(p.y+s,a),l-p.element.offsetHeight/4)];he.updatePosition(p.element,m,g)}))(ae),M.length>0&&(qt(e.clientX,e.clientY),M.length>1&&lt())}function Cn(e,t){if(!t.isMovingSelection)return;if(t.isMovingSelection=!1,document.body.classList.remove("selecting"),window.eventManager&&window.eventManager.unregisterModule("selection-move"),xe(),!zt().moved){Y();for(let s=M.length-1;s>=0;s--)Pt(M[s])&&M.splice(s,1)}dt()}let be=[];const $n=100,kt=50,Tn="#ffd700",Dn=()=>{const[e,t]=[c("#trashModal"),c(".clear-trash-btn")];e&&!e.classList.contains("visible")&&(e.style.display="block",e.classList.add("visible"),requestAnimationFrame(()=>Pe())),t&&(t.classList.add("shake-animation"),setTimeout(()=>t.classList.remove("shake-animation"),1e3))},at=e=>{M.includes(e)&&M.length>1?(M.forEach((t,n)=>setTimeout(()=>Qe(t),n*100)),Oe()):Qe(e)},Qe=e=>{if(B.length>=$n){!be.includes(e)&&be.push(e),Dn();return}e._eventCleanup&&e._eventCleanup();const t=e.querySelector(".sticky-content"),n={text:t.innerHTML,color:e.style.backgroundColor,x:e.style.left,y:e.style.top,width:e.style.width,height:e.style.height,timestamp:new Date().toLocaleString(),isBold:t.classList.contains("bold")};In(e),B.unshift(n),window.DebouncedStorage?window.DebouncedStorage.saveLow(ge,B):je(),pe(),Nn(e)},In=e=>{if(!window.noteColumns)return;const t=e.closest(".board");if(!t||!t.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[n,s]=[t.getBoundingClientRect(),e.getBoundingClientRect()],r=Math.min(5,Math.max(0,Math.floor((s.left+s.width/2-n.left)/(n.width/6))));window.noteColumns[r]&&(window.noteColumns[r]=window.noteColumns[r].filter(o=>Math.abs(o.x-y(e.style.left))>1||Math.abs(o.y-y(e.style.top))>1))},Nn=e=>{const t=c(".trash-bin"),n=t.getBoundingClientRect(),s=e.getBoundingClientRect(),r=n.left-s.left+n.width/2-s.width/2,o=n.top-s.top;e.style.setProperty("--throwX",`${r}px`),e.style.setProperty("--throwY",`${o}px`),e.style.animation="paperCrumble 0.6s ease-in forwards",t.style.animation="binShake 0.6s ease-in-out",setTimeout(()=>{e.remove(),t.style.animation="",Y(),J()},600)},Pt=e=>{const[t,n]=[c(".trash-bin").getBoundingClientRect(),e.getBoundingClientRect()];return n.right>t.left&&n.left<t.right&&n.bottom>t.top&&n.top<t.bottom?(at(e),!0):!1},Ee=()=>{const e=document.getElementById("trashModal");e.classList.toggle("visible")?(e.style.display="block",requestAnimationFrame(()=>Pe())):setTimeout(()=>e.style.display="none",300)},Pe=()=>{const e=c(".deleted-notes-container");e.style.minHeight="200px",e.innerHTML=B.length?B.map((t,n)=>`
            <div class="deleted-note" style="background-color: ${t.color||Tn}">
                <div class="deleted-note-content ${t.isBold?"bold":""}">${t.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${n})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},Bn=e=>{const t=x(".deleted-note")[e];t==null||t.classList.add("shrinking"),setTimeout(()=>{const[n]=B.splice(e,1);Ne(n.text,n.color,y(n.x),y(n.y),!0,n.width,n.height,n.isBold),window.DebouncedStorage?window.DebouncedStorage.saveLow(ge,B):je(),pe(),Pe(),window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(),J()},300)},Rt=()=>{if(B.length===0){Ee();return}const e=[...x(".deleted-note")].slice(0,6);e.forEach((t,n)=>{t.classList.add("note-deleting"),t.style.animationDelay=`${n*kt}ms`}),setTimeout(()=>{B=[],window.DebouncedStorage?window.DebouncedStorage.saveLow(ge,B):je(),pe(),Pe(),setTimeout(()=>{if(Ee(),be.length){const t=[...be];be=[],setTimeout(()=>{t.forEach(n=>{n!=null&&n.parentNode&&Qe(n)})},300)}},200)},(e.length?(e.length-1)*kt+300:0)+100)},pe=()=>{c(".trash-count").textContent=B.length};document.addEventListener("click",e=>{const t=c("#trashModal");t!=null&&t.classList.contains("visible")&&e.target===t&&Ee()});let rt=new Set;const it=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,An=()=>Math.random()*40-20,Hn=(e=Re())=>e.getDay()===0?0:e.getDay()-1;function Ue(e){const t=document.getElementById("noteLimitMessage"),n=t==null?void 0:t.querySelector(".transfer-text");n&&(n.textContent=e),t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),3e3))}function ct(){const e=c(".note-input textarea"),t=e.value.trim();if(!t)return;const n=c(`.board[data-board-id="${u}"]`),s=Array.from(n.querySelectorAll(".sticky-note")),[r,o,a]=[n.classList.contains("board-pattern-weekdays"),n.classList.contains("board-pattern-days"),s.filter(v=>!v.dataset.transferred).length===0];if(!r&&!o&&s.length>=30){Ue("Maximum notes space reached.");return}const i=s.filter(v=>!v.dataset.transferred),l=i[i.length-1];let{x:f,y:d}=re[u]||{x:0,y:0},p=ie[u]||getRandomColor(),m,g;const L=(v,E,O=null)=>{const $=n.offsetWidth/E,P=v*$+10,Z=(v+1)*$-210,V=Math.max(P,Math.min(Z,P+An())),_=Array.from(n.querySelectorAll(".sticky-note")).filter(q=>q.style.display!=="none"&&q!==O),[j,te]=[v*$,(v+1)*$],R=_.filter(q=>{const[U,ne]=[y(q.style.left),y(q.style.left)+200],[oe,ce]=[Math.max(U,j),Math.min(ne,te)];return Math.max(0,ce-oe)/200>.5});return{positionX:V,columnNotes:R}},k=(v,E)=>{const O=window.innerHeight-300;for(let $=0;$<E;$++){const P=(v+$)%E,{positionX:Z,columnNotes:V}=L(P,E);let _=0,j=null;V.forEach(R=>{const q=y(R.style.top);q>_&&(_=q,j=R)});const te=j?_+70:60;if(te<=O)return m=Z,g=te,j&&(p=j.style.backgroundColor),!0}return Ue("Maximum notes space reached."),!1},X=v=>{let E;const O=v?6:5;if(l){const $=y(l.style.left),P=n.offsetWidth/O;E=Math.floor($/P),E=Math.max(0,Math.min(E,O-1))}else E=v?Hn():mt(u)||0;return k(E,O)};if(a)if(r||o){if(X(r)===!1)return}else{const v=Math.max(150,window.innerWidth/4);({x:m,y:g}=St(v,50-70))}else if(r||o){if(X(r)===!1)return}else if(l&&([f,d,p]=[y(l.style.left),y(l.style.top),l.style.backgroundColor]),{x:m,y:g}=St(f,d),g<=50){const v=s.filter(E=>Math.abs(y(E.style.left)-m)<150);if(v.length>0){const E=v.map(_=>y(_.style.top)),[O,$]=[Math.max(...E),Math.min(...E)],P=window.innerHeight-300,[Z,V]=[O+200,$-200];if(Z<=P)g=Z;else if(V>=50)g=V;else{const _=(te,R)=>{const q=window.innerWidth-200;for(let U=te;R>0?U<=q:U>=55;U+=R*250){const ne=s.filter(ye=>Math.abs(y(ye.style.left)-U)<150);if(ne.length===0)return{x:U,y:50};const oe=ne.map(ye=>y(ye.style.top)),[ce,ve]=[Math.max(...oe),Math.min(...oe)],[Me,Ce]=[ce+200,ve-200];if(Me<=P)return{x:U,y:Me};if(Ce>=50)return{x:U,y:Ce}}return null},j=_(m+250,1)||_(m-250,-1);if(j)[m,g]=[j.x,j.y];else{Ue("Maximum notes space reached.");return}}}}Ne(t.replace(/\n/g,"<br>"),p,m,g,!1,"200px","150px",!1,u),[re[u],ie[u],e.value]=[{x:m,y:g},p,""],n.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(v=>{delete v.dataset.transferred}),window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(!0),J()}function Ne(e,t,n,s,r=!1,o="200px",a="150px",i=!1,l=u,f=!1){const[d,p]=[document.createElement("div"),it()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${i?"bold":""}" contenteditable="true">${e}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${t}">
                <div class="color-palette">${we.map(v=>`<div class="color-option" style="background-color: ${v}" onclick="changeNoteColor(this, '${v}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${i?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let m;const g=c(`.board[data-board-id="${l}"]`),L=g&&(g.classList.contains("board-pattern-weekdays")||g.classList.contains("board-pattern-days"));m=ue(),d.style.cssText=`background-color:${t}; left:${n}px; top:${s}px; width:${o}; height:${a}; z-index:${m};`,d.dataset.noteId=p,f&&(d.dataset.repositioned="true",rt.add(p)),W[p]=m,Ot();const k=v=>{v.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||bn(d)};d.addEventListener("click",k),d._eventCleanup=()=>{d.removeEventListener("click",k)},On(d);const X=c(`.board[data-board-id="${l}"]`);return X?(X.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",r||(window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(!0)),d):(console.error(`Board element with ID ${l} not found.`),null)}function _n(e,t){const n=e.closest(".sticky-note");(n.classList.contains("selected")?x(".sticky-note.selected"):[n]).forEach(r=>{const o=r.querySelector(".color-button");[r,o].forEach(a=>a.classList.add("color-transition")),[r.style.backgroundColor,o.style.backgroundColor]=[t,t],setTimeout(()=>[r,o].forEach(a=>a.classList.remove("color-transition")),300)}),ie[u]=t,window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(!0)}const Yt=e=>{e.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),e.classList.toggle("active"),window.DebouncedStorage?window.DebouncedStorage.saveLow(`${N}_board_${u}`,ee()):Y()},jn=c("#shortcutIcon")||c(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),Xt=()=>{jn.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};Xt();c(".note-input textarea").addEventListener("keydown",e=>{e.key==="Enter"&&(e.shiftKey||e.metaKey||e.ctrlKey)&&(e.preventDefault(),ct())});let T=null,Le=!1,et=!1;function On(e){let t=!1,n=!1,s=!1,r,o,a,i,l,f,d;const[p,m,g]=[".color-button",".color-palette",".sticky-content"].map(h=>e.querySelector(h)),L=()=>Y(),k=[],X=()=>Y(),v=()=>Y();window.EventManager?(window.EventManager.registerHandler("blur",X,g),window.EventManager.registerHandler("input",v,g)):(g.addEventListener("blur",X),g.addEventListener("input",v)),k.push({element:g,event:"blur",handler:X},{element:g,event:"input",handler:v});const E=h=>{s&&!g.contains(h.target)&&([s,g.contentEditable]=[!1,"false"],g.blur(),window.EventManager?window.EventManager.unregisterHandler("click",E):document.removeEventListener("click",E))},O=h=>{[s,g.contentEditable]=[!0,"true"],setTimeout(()=>{const[w,b]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const S=document.caretRangeFromPoint(h.clientX,h.clientY);S&&(b.removeAllRanges(),b.addRange(S))}else if(document.caretPositionFromPoint){const S=document.caretPositionFromPoint(h.clientX,h.clientY);S&&(w.setStart(S.offsetNode,S.offset),w.collapse(!0),b.removeAllRanges(),b.addRange(w))}g.focus()},0),setTimeout(()=>{window.EventManager?window.EventManager.registerHandler("click",E):document.addEventListener("click",E)},0),h.stopPropagation()};window.EventManager?window.EventManager.registerHandler("dblclick",O,g):g.addEventListener("dblclick",O),k.push({element:g,event:"dblclick",handler:O});let $=null,P=!1;const Z=()=>{!t&&!n&&(P=!0,$=e.style.zIndex||"1",he.updateZIndex(e,ue()))},V=()=>{!t&&!n&&$!==null&&(P=!1,he.updateZIndex(e,ue()),$=null)};window.EventManager?(window.EventManager.registerHandler("mouseenter",Z,e),window.EventManager.registerHandler("mouseleave",V,e)):(e.addEventListener("mouseenter",Z),e.addEventListener("mouseleave",V)),k.push({element:e,event:"mouseenter",handler:Z},{element:e,event:"mouseleave",handler:V});const _=()=>g.contentEditable="false",j=h=>{if(h.key==="Enter")if(h.preventDefault(),h.shiftKey)g.contentEditable="false",L();else{const[w,b]=[window.getSelection(),window.getSelection().getRangeAt(0)],S=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});b.deleteContents(),b.insertNode(S),b.setStartAfter(S),b.collapse(!0),w.removeAllRanges(),w.addRange(b)}};window.EventManager?(window.EventManager.registerHandler("blur",_,g),window.EventManager.registerHandler("keydown",j,g)):(g.addEventListener("blur",_),g.addEventListener("keydown",j)),k.push({element:g,event:"blur",handler:_},{element:g,event:"keydown",handler:j});const te=()=>{const h=e.getBoundingClientRect();re[u]={x:h.left,y:h.top}};let R=null;const q=(h,w)=>{const[b,S]=[w.mouseX,w.mouseY];x(".color-palette.visible").forEach(se=>{var pt;const[Q,le]=[se.getBoundingClientRect(),(pt=se.closest(".note-controls"))==null?void 0:pt.querySelector(".color-button")];if(!le)return;const fe=le.getBoundingClientRect(),[$e,Te]=[b>=Q.left-10&&b<=Q.right+10&&S>=Q.top-10&&S<=Q.bottom+10,b>=fe.left&&b<=fe.right&&S>=fe.top&&S<=fe.bottom];$e||Te?clearTimeout(R):se.classList.contains("visible")&&ne()})};window.eventManager&&window.eventManager.registerHandler("mousemove",q,"note-interaction");const U=()=>{clearTimeout(R),m.classList.remove("closing"),m.classList.add("visible"),x(".color-palette").forEach(h=>{h!==m&&(h.classList.add("closing"),setTimeout(()=>h.classList.remove("visible","closing"),180))})},ne=()=>{clearTimeout(R),R=setTimeout(()=>{const[h,w]=[m.getBoundingClientRect(),p.getBoundingClientRect()],[b,S]=[mouseX<h.left-10||mouseX>h.right+10||mouseY<h.top-10||mouseY>h.bottom+10,mouseX>=w.left&&mouseX<=w.right&&mouseY>=w.top&&mouseY<=w.bottom];b&&!S&&(m.classList.add("closing"),setTimeout(()=>m.classList.contains("closing")&&m.classList.remove("visible","closing"),180))},50)},oe=h=>{h.stopPropagation(),m.classList.contains("visible")?ne():U()};window.EventManager?window.EventManager.registerHandler("click",oe,p):p.addEventListener("click",oe),k.push({element:p,event:"click",handler:oe});const ce=()=>clearTimeout(R),ve=()=>ne();window.EventManager?(window.EventManager.registerHandler("mouseenter",ce,m),window.EventManager.registerHandler("mouseleave",ve,m)):(m.addEventListener("mouseenter",ce),m.addEventListener("mouseleave",ve)),k.push({element:m,event:"mouseenter",handler:ce},{element:m,event:"mouseleave",handler:ve});const Me=(h,w,b)=>{if(!h.target.closest(".color-palette, .done-button")){if(M.includes(e)&&M.length>1){kn(h);return}h.shiftKey?M.includes(e)||(M.push(e),e.classList.add("selected")):Oe(),h.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],P?$=ue():he.updateZIndex(e,ue()),[r,o]=[w,b],h.target.closest(".resize-handle")?[n,l,f]=[!0,e.offsetWidth,e.offsetHeight]:([a,i]=[y(e.style.left),y(e.style.top)],[e.dataset.originalX,e.dataset.originalY]=[a,i],d=setTimeout(()=>t=!0,150)),window.eventManager?window.eventManager.eventState.activeNote=e:window.activeNote=e}},Ce=(h,w)=>{if(!w.activeNote||w.activeNote!==e)return;const[b,S]=[h.clientX,h.clientY];if((Math.abs(b-r)>5||Math.abs(S-o)>5)&&(clearTimeout(d),!t&&!n&&(t=!0)),t){w.isDragInProgress||(w.isDragInProgress=!0,document.body.classList.add("drag-in-progress"));const se=5;let[Q,le]=[Math.min(Math.max(a+b-r,-se),window.innerWidth-e.offsetWidth/4),Math.min(Math.max(i+S-o,-se),window.innerHeight-e.offsetHeight/4)];window.AnimationBatcher?window.AnimationBatcher.batchStyleUpdate(e,{left:`${Q}px`,top:`${le}px`}):(e.style.left=`${Q}px`,e.style.top=`${le}px`),lt(),qt(b,S)}if(n){const[se,Q]=[150,150],[le,fe]=[window.innerWidth-y(e.style.left)+50,window.innerHeight-y(e.style.top)+50],$e=Math.min(Math.max(l+b-r,se),le),Te=Math.min(Math.max(f+S-o,Q),fe);window.AnimationBatcher?window.AnimationBatcher.batchStyleUpdate(e,{width:`${$e}px`,height:`${Te}px`}):(e.style.width=`${$e}px`,e.style.height=`${Te}px`)}},ye=(h,w)=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(t||n)&&t){if(xe(),!zt().moved){te(),Pt(e),Rn(e);const S=e.dataset.noteId||it();[e.dataset.noteId,e.dataset.repositioned]=[S,"true"],rt.add(S),re[u]={x:y(e.style.left),y:y(e.style.top)},ie[u]=e.style.backgroundColor,J(),dt(),w.activeNote=null,window.activeNote&&(window.activeNote=null)}window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(),[w.isDragInProgress,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[t,n]=[!1,!1],xe()},Ye=h=>Me(h,h.clientX,h.clientY);window.EventManager?window.EventManager.registerHandler("mousedown",Ye,e):e.addEventListener("mousedown",Ye),window.eventManager&&(window.eventManager.registerHandler("mousemove",Ce,`note-${e.dataset.noteId||Date.now()}`),window.eventManager.registerHandler("mouseup",ye,`note-${e.dataset.noteId||Date.now()}`)),k.push({element:e,event:"mousedown",handler:Ye});const ht=`note-${e.dataset.noteId||Date.now()}`;if(e._eventCleanup){const h=e._eventCleanup;e._eventCleanup=()=>{h(),k.forEach(({element:w,event:b,handler:S})=>{w.removeEventListener(b,S)}),window.eventManager&&window.eventManager.unregisterModule(ht)}}else e._eventCleanup=()=>{k.forEach(({element:h,event:w,handler:b})=>{h.removeEventListener(w,b)}),window.eventManager&&window.eventManager.unregisterModule(ht)}}function Pn(){x(".color-palette").forEach(e=>{e.style.display!=="none"&&(e.classList.add("closing"),setTimeout(()=>{e.style.display="none",e.classList.remove("closing")},200))}),Nt=null}const Mt=e=>{Nt&&!e.target.closest(".color-button")&&Pn()};window.EventManager?window.EventManager.registerHandler("click",Mt):document.addEventListener("click",Mt);function Rn(e){if(!e)return;const[t,n,s,r]=[e.getBoundingClientRect(),window.innerHeight,250,150],o=n-r,[a,i]=[t.bottom>o,t.left<s&&t.bottom>o];if(i){const[l,f,d]=[t.bottom-o+20,y(e.style.top),Math.max(60,y(e.style.top)-(t.bottom-o+20))];e.style.transition="top 0.3s ease-out",e.style.top=`${d}px`,setTimeout(()=>e.style.transition="",300)}}function qt(e,t){var m,g;if(et)return;const n=c(".status-bar");if(!n)return;const s=n.getBoundingClientRect(),[r,o]=[Math.max(0,Math.max(s.left-e,e-s.right)),Math.max(0,Math.max(s.top-t,t-s.bottom))],[a,i,l,f]=[Math.sqrt(r*r+o*o),120,80,T!==null],d=f?a<=i:a<=l,p=()=>{let[L,k]=[null,1/0];return x(".board-button:not(.disabled)",!0).forEach(X=>{const v=X.getBoundingClientRect(),E=Math.sqrt(Math.pow(e-(v.left+v.width/2),2)+Math.pow(t-(v.top+v.height/2),2));E<k&&([L,k]=[X,E])}),L};if(d!==f)if(d){const L=x(".board-button:not(.disabled)");T=p(),L.forEach(k=>k.classList.add("drag-active","drag-proximity")),T&&T.classList.add("drag-hover"),Yn()}else x(".board-button",!0).forEach(L=>{L.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>L.classList.remove("drag-active"),200)}),T=null,Ut();else if(d&&T){const L=p();L!==T&&(T==null||T.classList.remove("drag-hover"),T=L,L?(L.classList.add("drag-hover"),xe(),(m=c(".shortcut-hint"))==null||m.classList.add("hidden-during-drag")):(lt(),Le||(g=c(".shortcut-hint"))==null||g.classList.remove("hidden-during-drag")))}}function Yn(){var s,r;if(!T)return;const e=((r=(s=window.eventManager)==null?void 0:s.eventState)==null?void 0:r.activeNote)||window.activeNote||It,[t,n]=[T.getBoundingClientRect(),M.length>0?M:e?[e]:[]];n.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(d=>{[d.style.userSelect,d.style.pointerEvents]=["none","none"]});const[a,i]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[l,f]=[t.left-i.left+t.width/2-(a.left-i.left)-a.width/2,t.top-i.top+t.height/2-(a.top-i.top)-a.height/2];o.style.setProperty("--suckX",`${l}px`),o.style.setProperty("--suckY",`${f}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function Ut(){x(".hover-animating",!0).forEach(e=>{e.querySelectorAll("textarea, [contenteditable]").forEach(t=>{t.style.removeProperty("user-select"),t.style.removeProperty("pointer-events")}),e.style.animation="noteSuckReverse 0.3s ease-out forwards",e.classList.remove("hover-animating"),e.classList.add("reverse-animating"),setTimeout(()=>{e.classList.contains("reverse-animating")&&([e.style.animation]=["none"],e.style.removeProperty("--suckX"),e.style.removeProperty("--suckY"),e.classList.remove("reverse-animating"))},300)})}function lt(){var e;if(C>1&&!Le&&!T){const t=document.getElementById("dragTransferMessage");t&&(t.classList.add("visible"),Le=!0),(e=c(".shortcut-hint"))==null||e.classList.add("hidden-during-drag")}}function xe(){var e;if(Le){const t=document.getElementById("dragTransferMessage");t&&(t.classList.remove("visible"),Le=!1),(e=c(".shortcut-hint"))==null||e.classList.remove("hidden-during-drag")}}function dt(){x(".board-button",!0).forEach(e=>e.classList.remove("drag-hover","drag-proximity")),[T]=[null],Ut(),xe()}function zt(){var r,o;if(!T)return{moved:!1};const e=((o=(r=window.eventManager)==null?void 0:r.eventState)==null?void 0:o.activeNote)||window.activeNote||It,[t,n]=[parseInt(T.dataset.boardId),M.length>0?[...M]:[e]];if(t===u)return n.forEach(a=>{if(a){const i=ae==null?void 0:ae.find(l=>l.element===a);i?(a.style.left=`${i.x}px`,a.style.top=`${Math.max(60,i.y)}px`):a.style.top=`${parseInt(a.style.top||0)-250}px`}}),{moved:!1};let s=new Map;return n.length>1&&typeof ae!="undefined"&&ae.length>0&&ae.forEach(a=>{a&&n.includes(a.element)&&s.set(a.element,{originalX:a.x,originalY:a.y})}),n.forEach(a=>{a&&Xn(a,t,s.size>0?s.get(a):null)}),M.length>0&&Oe(),{moved:!0}}function Xn(e,t,n=null){const s=e.style.left;if(e.classList.contains("hover-animating"))e.style.animation="noteSuckComplete 0.3s ease-in forwards",e.classList.remove("hover-animating");else{const r=c(`.board-button[data-board-id="${t}"]`);if(!r)return;const[o,a,i]=[r.getBoundingClientRect(),e.getBoundingClientRect(),e.closest(".board").getBoundingClientRect()],[l,f]=[o.left-i.left+o.width/2-(a.left-i.left)-a.width/2,o.top-i.top+o.height/2-(a.top-i.top)-a.height/2];e.style.setProperty("--suckX",`${l}px`),e.style.setProperty("--suckY",`${f}px`),e.style.animation="noteSuckHover 0.3s ease-out forwards",e.classList.add("hover-animating")}setTimeout(()=>{e.classList.contains("hover-animating")&&(e.style.animation="noteSuckComplete 0.3s ease-in forwards",e.classList.remove("hover-animating"))},300),setTimeout(()=>{e.querySelectorAll("textarea, [contenteditable]").forEach(o=>{o.style.removeProperty("user-select"),o.style.removeProperty("pointer-events")}),e.remove();const r=c(`.board[data-board-id="${t}"]`);if(r){if(e.style.animation="",e.style.removeProperty("--suckX"),e.style.removeProperty("--suckY"),n)if(n.originalX!==void 0&&n.originalY!==void 0)[e.style.left,e.style.top]=[`${n.originalX}px`,`${Math.max(60,n.originalY)}px`];else{const[i,l]=[100,80];[e.style.left,e.style.top]=[`${i+(n.offsetX||0)}px`,`${Math.max(60,l+(n.offsetY||0))}px`]}else{const[i,l]=[parseFloat(e.dataset.originalX),parseFloat(e.dataset.originalY)];!isNaN(i)&&!isNaN(l)?[e.style.left,e.style.top]=[`${i}px`,`${Math.max(60,l)}px`]:[e.style.left,e.style.top]=[s,"80px"]}const o=e.dataset.noteId||it();[e.dataset.noteId,e.dataset.repositioned,e.dataset.transferred]=[o,"true","true"],rt.add(o),r.appendChild(e),e.style.animation="paperPop 0.3s ease-out forwards",J(),dt(),et=!0,setTimeout(()=>et=!1,500);const a=u;[u]=[t],window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y(),[u]=[a],window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${u}`,ee()):Y()}},600)}let H={},z=null,De={x:0,y:0},F=[];function Ft(){Fn(),Vt(),Un(),x(".emoji-item").forEach(e=>{window.EventManager?window.EventManager.registerHandler("click",tt,e):e.addEventListener("click",tt)})}const tt=e=>{const t=e.target.dataset.emoji;t&&(zn(t),qn(t))};function qn(e){const t=c(".board.active");if(!t)return;const n=t.dataset.boardId;if(Kn(n)>=1e3)return Jn();const s=Vn(),r=t.getBoundingClientRect(),[o,a,i]=[r.width-120,r.height*.8-120,20],[l,f]=[Math.random()*o,Math.max(i,Math.random()*a)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:e});d.dataset.stickerId=s,Object.assign(d.style,{left:l+"px",top:f+"px"});const p=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});p.addEventListener("click",m=>[m.stopPropagation(),Kt(s,n)]),d.appendChild(p),Wt(d),t.appendChild(d),(H[n]=H[n]||{})[s]={emoji:e,x:l,y:f,id:s},ut(n),setTimeout(()=>d.classList.remove("new"),400)}function Wt(e){let t=!1;e.addEventListener("mousedown",n);function n(o){if(o.target.classList.contains("delete-button"))return;o.preventDefault(),o.stopPropagation(),[t,z]=[!0,e],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[a,i]=[o.clientX,o.clientY],l=e.getBoundingClientRect();[De.x,De.y]=[a-l.left,i-l.top],e.classList.add("dragging"),window.eventManager?(window.eventManager.registerHandler("mousemove",s,"emoji-drag"),window.eventManager.registerHandler("mouseup",r,"emoji-drag")):(document.addEventListener("mousemove",s),document.addEventListener("mouseup",r))}function s(o){if(!t||!z)return;o.preventDefault(),o.stopPropagation();const[a,i]=[o.clientX,o.clientY],l=c(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(a-l.left-De.x,l.width-120)),Math.max(0,Math.min(i-l.top-De.y,l.height-120))];window.AnimationUtils?window.AnimationUtils.updatePosition(z,f,d):Object.assign(z.style,{left:f+"px",top:d+"px"})}function r(){var i;if(!t||!z)return;z.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],Zn(z);const[o,a]=[c(".board.active").dataset.boardId,z.dataset.stickerId];(i=H[o])!=null&&i[a]&&(Object.assign(H[o][a],{x:parseInt(z.style.left),y:parseInt(z.style.top)}),ut(o)),z=null,window.eventManager?(window.eventManager.unregisterHandler("mousemove","emoji-drag"),window.eventManager.unregisterHandler("mouseup","emoji-drag")):(document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r))}}const Kt=(e,t)=>{const n=c(`[data-sticker-id="${e}"]`);n&&(n.classList.add("deleting"),setTimeout(()=>n.remove(),500)),H[t]&&(delete H[t][e],ut(t))},ut=e=>{window.DebouncedStorage?window.DebouncedStorage.save(`emojiStickers_board_${e}`,H[e]||{}):localStorage.setItem(`emojiStickers_board_${e}`,JSON.stringify(H[e]||{}))};function Jt(e){const t=localStorage.getItem(`emojiStickers_board_${e}`);try{H[e]=t?JSON.parse(t):{},t&&Zt(e)}catch(n){console.error("Error loading emoji stickers:",n),H[e]={}}}const Un=()=>Array.from({length:C},(e,t)=>Jt(t+1));function Zt(e){const t=c(`.board[data-board-id="${e}"]`);!t||!H[e]||(t.querySelectorAll(".emoji-sticker").forEach(n=>n.remove()),Object.values(H[e]).forEach(({id:n,emoji:s,x:r,y:o})=>{const a=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:s});a.dataset.stickerId=n,Object.assign(a.style,{left:r+"px",top:o+"px"});const i=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});i.addEventListener("click",l=>[l.stopPropagation(),Kt(n,e)]),a.appendChild(i),Wt(a),t.appendChild(a)}))}function zn(e){const t=F.indexOf(e);(t<0||t>=12)&&(t>-1&&F.splice(t,1),F.unshift(e),F.length>16&&(F=F.slice(0,16)),Wn(),Vt())}function Fn(){const e=localStorage.getItem("emojiUsageOrder");try{F=e?JSON.parse(e):[]}catch(t){console.error("Error loading emoji usage order:",t),F=[]}}const Wn=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(F));function Vt(){const e=c(".emoji-picker");e&&(e.querySelectorAll(".recent-emoji").forEach(t=>t.remove()),F.length>0&&F.slice(0,12).reverse().forEach(t=>{const n=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:t});n.dataset.emoji=t,n.addEventListener("click",tt),e.insertBefore(n,e.firstChild)}))}const Kn=e=>H[e]?Object.keys(H[e]).length:0,Jn=()=>{const e=document.getElementById("emojiLimitMessage");e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),1e3))};function Zn(e){if(!e)return;const[t,n]=[e.getBoundingClientRect(),window.innerHeight],[s,r,o]=[250,150,n-150];if(t.left<s&&t.bottom>o){const i=Math.max(60,parseInt(e.style.top)-(t.bottom-o+20));e.style.top=`${i}px`}}const Vn=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),Gn=e=>[localStorage.removeItem(`emojiStickers_board_${e}`),delete H[e]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Ft,100));window.emojiStickers={loadEmojiStickers:Jt,renderEmojiStickers:Zt,cleanupEmojiStickers:Gn,initializeEmojiPicker:Ft};const Re=()=>new Date,Gt=e=>{const t=Re().getDay(),n=t===0?6:t-1;return e===n},Qn=e=>{const t=`daysPatternStartDate_${e}`;localStorage.getItem(t)||localStorage.setItem(t,Re().toISOString().split("T")[0])},mt=e=>{const t=localStorage.getItem(`daysPatternStartDate_${e}`);return t?Math.floor((Re()-new Date(t))/(1e3*60*60*24))%5:-1},Qt=e=>localStorage.removeItem(`daysPatternStartDate_${e}`),Ct=()=>{if(C>=Se){alert(`Maximum number of boards (${Se}) reached.`);return}nt(++C),Bt(),He()};function nt(e){const t=c(".boards-container"),n=Object.assign(document.createElement("div"),{className:"board"});n.dataset.boardId=e,t.appendChild(n);const s=Object.assign(document.createElement("div"),{className:"board-title-circle"}),r=[],o=()=>{var m;(m=s.querySelector(".board-title-input"))==null||m.focus()};s.addEventListener("click",o),r.push({element:s,event:"click",handler:o});const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let i;const l=()=>{const m=a.value.trim();if(!m){a.value=a.dataset.originalTitle||"";return}gt(e,m),_e(a)},f=()=>{clearTimeout(i),i=setTimeout(l,500)};a.addEventListener("input",f),r.push({element:a,event:"input",handler:f}),_e(a),s.appendChild(a),n.appendChild(s);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:e});d.dataset.boardId=e;const p=()=>G(e);if(d.addEventListener("click",p),r.push({element:d,event:"click",handler:p}),e>1){const m=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),g=L=>{L.stopPropagation(),Be(e)};m.addEventListener("click",g),r.push({element:m,event:"click",handler:g}),d.appendChild(m)}n._eventCleanup=()=>{r.forEach(({element:m,event:g,handler:L})=>{m.removeEventListener(g,L)}),clearTimeout(i)},c(".boards-navigation").insertBefore(d,c(".add-board-button")),setTimeout(()=>[d.classList.remove("new-button"),d.classList.add("transitions-ready")],500),ke(e),ft(e),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(e)}function Be(e){if(!confirm(`Are you sure you want to delete board ${e}?`))return;const t=c(`.board[data-board-id="${e}"]`);if(!t){ze(e);return}const[n,s]=[t.querySelectorAll(".sticky-note"),t.querySelectorAll(".emoji-sticker")];if(n.length||s.length){const r=c(".trash-bin"),o=r.getBoundingClientRect();r.style.animation="binShake 0.5s ease-in-out",n.forEach(a=>{const i=a.querySelector(".sticky-content");B.unshift({text:i.innerHTML,color:a.style.backgroundColor,x:a.style.left,y:a.style.top,width:a.style.width,height:a.style.height,timestamp:new Date().toLocaleString(),isBold:i.classList.contains("bold")});const l=a.getBoundingClientRect(),[f,d]=[o.left-l.left+o.width/2-l.width/2,o.top-l.top];a.style.setProperty("--throwX",`${f}px`),a.style.setProperty("--throwY",`${d}px`),a.style.animation="paperCrumble 0.5s ease-in forwards"}),s.forEach(a=>a.classList.add("deleting")),window.DebouncedStorage?window.DebouncedStorage.saveLow(ge,B):je(),pe(),console.log("Setting timeout for continueWithBoardDeletion, boardId:",e),setTimeout(()=>{console.log("Timeout fired, calling continueWithBoardDeletion"),ze(e)},600)}else ze(e)}function ze(e){console.log("continueWithBoardDeletion called with boardId:",e);const[t,n]=[c(`.board[data-board-id="${e}"]`),c(`.board-button[data-board-id="${e}"]`)];console.log("Found elements:",{boardElement:t,buttonElement:n}),t!=null&&t._eventCleanup&&t._eventCleanup(),t&&t.remove(),n&&n.classList.add("removing");const s=[];for(let r=e+1;r<=C;r++){const o=c(`.board-button[data-board-id="${r}"]`);o&&(o.classList.add("removing"),s.push(r))}[`${N}_board_${e}`,`stickyNotes_boardTitle_${e}`,`boardColor_${e}`,`boardPattern_${e}`,`boardStyles_board_${e}`].forEach(r=>localStorage.removeItem(r)),Qt(e),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(e);for(let r=e+1;r<=C;r++)["boardColor","boardPattern","boardStyles_board"].forEach(o=>{const[a,i,l]=[`${o}_${r}`,`${o}_${r-1}`,localStorage.getItem(`${o}_${r}`)];l&&localStorage.setItem(i,l),localStorage.removeItem(a)});setTimeout(()=>{n&&n.remove();const[r,o]=[c(".boards-navigation"),c(".add-board-button")];s.forEach(a=>{const[i,l,f]=[c(`.board-button[data-board-id="${a}"]`),c(`.board[data-board-id="${a}"]`),a-1];i&&i.remove(),l&&(l.dataset.boardId=f);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:f});if([d.dataset.boardId,d.dataset.originalNumber]=[f,f],d.addEventListener("click",()=>G(f)),f>1){const p=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});p.addEventListener("click",m=>{m.stopPropagation(),Be(f)}),d.appendChild(p)}r.insertBefore(d,o),["","Title","Color","Pattern"].forEach(p=>{const[m,g,L]=[p?`stickyNotes_board${p}`:N,`${p?`stickyNotes_board${p}`:N}_board_${a}`,`${p?`stickyNotes_board${p}`:N}_board_${f}`],k=localStorage.getItem(g);k&&(localStorage.setItem(L,k),localStorage.removeItem(g))}),ke(f)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(a=>[a.classList.remove("new-button"),a.classList.add("transitions-ready")]),500),C--,Bt(),He(),u===e?G(e>1?e-1:C>=1?1:null):u>e&&(u--,G(u)),c(".trash-bin").style.animation=""},350)}function G(e){const t=parseInt(e);t===u||t===null||(oo(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),u=t,re[e]||(re[e]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),ie[e]||(ie[e]=we[0]),x(".board").forEach(n=>{const s=parseInt(n.dataset.boardId);if(n.classList.remove("active","prev","next"),n.style.visibility="hidden",s===u){if(n.classList.add("active"),n.style.visibility="visible",n.querySelectorAll(".sticky-note").forEach((r,o)=>r.style.setProperty("--note-index",o)),n.querySelectorAll(".emoji-sticker").forEach((r,o)=>r.style.setProperty("--sticker-index",o)),!n.querySelector(".board-title-circle")){const r=Object.assign(document.createElement("div"),{className:"board-title-circle"});r.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const o=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),a=()=>gt(s,o.value);["change","blur"].forEach(i=>o.addEventListener(i,a)),r.appendChild(o),n.appendChild(r),ft(s)}}else n.classList.add(s<u?"prev":"next")}),document.querySelectorAll(".board-button").forEach(n=>n.classList.toggle("active",parseInt(n.dataset.boardId)===u)),ke(u),tn(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),J(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(u),setTimeout(()=>nn(u),300))}let Ae=[];function eo(){to();const e=Ct;c(".add-board-button").addEventListener("click",e),Ae.push({element:c(".add-board-button"),event:"click",handler:e}),x(".board-button").forEach(n=>{const[s,r]=[parseInt(n.dataset.boardId),n.cloneNode(!0)],o=()=>G(s);r.addEventListener("click",o);const a=r.querySelector(".delete-board");if(a){const i=l=>{l.stopPropagation(),Be(s)};a.addEventListener("click",i)}n.parentNode.replaceChild(r,n)});const t=(n,s)=>{const[r,o]=[n.target.tagName,n.target.getAttribute("contenteditable")==="true"];if((n.key==="Control"||n.key==="Meta")&&!n.altKey&&!n.shiftKey&&r!=="TEXTAREA"&&!o){n.preventDefault(),c(".note-input textarea").focus();return}if(r==="TEXTAREA"||o){(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),ct());return}n.key==="ArrowLeft"&&u>1?G(u-1):n.key==="ArrowRight"&&u<C?G(u+1):n.key==="n"&&n.ctrlKey?(n.preventDefault(),Ct()):n.key==="d"&&n.ctrlKey&&u>1&&(n.preventDefault(),Be(u));const a=parseInt(n.key);!isNaN(a)&&a>=1&&a<=9&&a<=C&&G(a)};window.eventManager&&window.eventManager.registerHandler("keydown",t,"board-navigation"),Ae.push({element:document,event:"keydown",handler:t})}function to(){Ae.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),Ae=[]}function He(){const e=c(".add-board-button"),t=C>=Se;e.classList.toggle("disabled",t),e.title=t?`Maximum number of boards (${Se}) reached`:"Add new board",no()}function no(){const e=c(".shortcut-hint");e&&(e.style.display=C>=2?"block":"none")}let $t=!1;function oo(){if($t||C<2)return;const e=c(".shortcut-hint");e&&($t=!0,e.classList.add("auto-show"),setTimeout(()=>{e.classList.remove("auto-show")},4e3))}function so(){const e=c(".board-style-menu"),t=e.classList.contains("visible");t||(tn(),en(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),e.offsetWidth),e.classList.toggle("visible",!t),e.classList.toggle("closing",t),t&&setTimeout(()=>e.classList.remove("closing"),300)}function en(){c(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(e=>{e.classList.add("initialized");const t=e.classList.contains("board-color-option")?"color":"pattern",n=e.getAttribute(`data-${t}`);e.addEventListener("click",()=>{t==="color"?ao(n):io(n),document.querySelectorAll(`.board-${t}-option`).forEach(s=>s.classList.remove("active")),e.classList.add("active")})})}function tn(){["color","pattern"].forEach(e=>{x(`.board-${e}-option`).forEach(t=>{t.classList.toggle("active",t.getAttribute(`data-${e}`)===A[`${e}s`].current)})})}function ot(){return c(".board.active")}function ao(e){A.colors.current=e;const t=ot();t.style.backgroundColor=e,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(n=>{n.style.backgroundColor=e,n.classList.contains("board-pattern-option")&&(n.style.opacity="0.8")}),At(),J(),t.style.transition="background-color 0.5s ease",setTimeout(()=>t.style.transition="",500)}function ro(e){const t=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; transition:opacity 0.3s ease-out; opacity:0;"}),n=c(`.board[data-board-id="${u}"]`);if(e!=="none"){const s={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(s[e])t.style.cssText+=s[e];else if(e==="weekdays"||e==="days"){const r=Object.assign(document.createElement("div"),{className:e==="weekdays"?"weekday-header":"day-header"});(e==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((a,i)=>{const l=Object.assign(document.createElement("span"),{textContent:a});(e==="weekdays"&&Gt(i)||e==="days"&&mt(u)===i)&&l.classList.add("current-day"),r.appendChild(l)}),t.appendChild(r),n==null||n.classList.add("has-header")}}else n==null||n.classList.remove("has-header");return t}function io(e){const[t,n,s]=[ot(),ot().dataset.boardId,A.patterns.current];s==="days"&&e!=="days"&&Qt(n),A.patterns.current=e,t.querySelectorAll(".pattern-overlay, .lines-overlay, .weekday-header, .day-header").forEach(a=>a.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),Array.from(t.children).forEach(a=>{a.tagName==="DIV"&&a.style.position==="absolute"&&a.style.pointerEvents==="none"&&(a.style.zIndex==="0"||a.style.zIndex==="1"||a.style.top==="0px"||a.style.left==="0px")&&a.remove()}),e==="days"&&Qn(n);const r=ro(e);t.appendChild(r);let o=null;(e==="weekdays"||e==="days")&&(o=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${e}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.3s ease;"}),t.appendChild(o)),r.offsetWidth,requestAnimationFrame(()=>{r.style.opacity="1",o&&(o.style.opacity="1")}),r.addEventListener("transitionend",()=>{e==="weekdays"||e==="days"?(t.classList.add(`board-pattern-${e}`),r.classList.add("pattern-overlay"),o&&o.classList.add("pattern-overlay")):e!=="none"&&t.classList.add(`board-pattern-${e}`),J()},{once:!0}),At()}function co(e,t){if(e.style.backgroundColor=t.color,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(n=>n.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t.pattern!=="none"&&(e.classList.add(`board-pattern-${t.pattern}`),t.pattern==="weekdays"||t.pattern==="days")){const n=Object.assign(document.createElement("div"),{className:`pattern-overlay ${t.pattern==="weekdays"?"weekday-header":"day-header"}`});(t.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(o,a)=>`Day ${a+1}`)).forEach((o,a)=>{const i=Object.assign(document.createElement("span"),{textContent:o});(t.pattern==="weekdays"&&Gt(a)||t.pattern==="days"&&mt(parseInt(e.dataset.boardId))===a)&&i.classList.add("current-day"),n.appendChild(i)}),e.appendChild(n);const r=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${t.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});e.appendChild(r)}}function ke(e){const t=localStorage.getItem(`boardStyles_board_${e}`),n=c(`.board[data-board-id="${e}"]`);if(!n)return;let s;t?(s=JSON.parse(t),e===u&&(A.colors.current=s.color,A.patterns.current=s.pattern)):(s={color:A.colors.default,pattern:A.patterns.default},e===u&&(A.colors.current=s.color,A.patterns.current=s.pattern)),co(n,s),J()}lo();document.addEventListener("click",function(e){const t=c(".board-style-menu"),n=c(".board-style-button");t&&t.classList.contains("visible")&&n&&!n.contains(e.target)&&!t.contains(e.target)&&(t.classList.add("closing"),t.classList.remove("visible"),setTimeout(()=>t.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",e=>e.stopPropagation());function lo(){document.querySelectorAll(".board").forEach(e=>ft(e.dataset.boardId))}function gt(e,t){localStorage.setItem(`stickyNotes_boardTitle_${e}`,t);const n=document.querySelector(`.board-button[data-board-id="${e}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function _e(e){e.setAttribute("data-counter",`${e.value.length}/${e.maxLength}`)}function ft(e){const t=localStorage.getItem(`stickyNotes_boardTitle_${e}`),n=document.querySelector(`.board[data-board-id="${e}"]`);if(n){const r=n.querySelector(".board-title-input");r&&t&&(r.value=t)}const s=document.querySelector(`.board-button[data-board-id="${e}"]`);s&&!s.dataset.originalNumber&&(s.dataset.originalNumber=s.textContent)}function nn(e){const t=c(`.board[data-board-id="${e}"] .board-title-circle`);t&&(t.classList.add("show-temporary"),setTimeout(()=>t.classList.remove("show-temporary"),3e3))}function uo(){x(".board-title-circle").forEach(e=>{let t;const[n,s]=[e.querySelector(".board-title-input"),e.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((r,o)=>{e.addEventListener(r,()=>{o===0?(n&&n.focus(),clearTimeout(t),e.classList.add("delayed-close")):o===1?(t=setTimeout(()=>e.classList.remove("delayed-close"),2e3),n&&n.blur()):n&&n.focus()})}),n){let r;const o=()=>{const a=n.value.trim();if(!a){n.dataset.originalTitle="";return}gt(s,a),_e(n)};n.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(o,500)}),_e(n)}})}const J=()=>{for(let e=1;e<=C;e++){const[t,n]=[c(`.board[data-board-id="${e}"]`),c(`.board-button[data-board-id="${e}"]`)];if(!t||!n)continue;const s=t.style.backgroundColor||A.colors.default;n.classList.toggle("has-notes",t.querySelectorAll(".sticky-note").length>0),n.style.backgroundColor=s;const r=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],o=r.find(i=>t.classList.contains(i));r.forEach(i=>n.classList.remove(i.replace("board-pattern","button-pattern"))),o&&n.classList.add(o.replace("board-pattern","button-pattern"));const a=vn(s)||{r:26,g:26,b:26};n.style.color=(a.r*299+a.g*587+a.b*114)/1e3>128?"#000":"#fff"}};function mo(e){e.forEach(({selector:t,event:n,handler:s})=>{const r=c(t);r&&(window.EventManager?window.EventManager.registerHandler(n,s,r):r.addEventListener(n,s))})}const Tt=function(){wn(),jt(),_t(),eo(),en(),Sn(),Xt(),uo(),go(),setTimeout(()=>nn(u),500),fo(),mo([{selector:".board-style-button",event:"click",handler:so},{selector:".trash-bin",event:"click",handler:Ee},{selector:"#trashModal .close-modal-btn",event:"click",handler:Ee},{selector:"#trashModal .clear-trash-btn",event:"click",handler:Rt}])};window.EventManager?window.EventManager.registerHandler("DOMContentLoaded",Tt):document.addEventListener("DOMContentLoaded",Tt);function go(){const e=r=>{const o=r.selectionStart,a=r.value;if(a.length>0){const i=a.charAt(0).toUpperCase()+a.slice(1);i!==a&&(r.value=i,r.setSelectionRange(o,o))}},t=r=>{["input","keyup"].forEach(a=>{window.EventManager?window.EventManager.registerHandler(a,i=>e(i.target),r):r.addEventListener(a,i=>e(i.target))});const o=a=>setTimeout(()=>e(a.target),0);window.EventManager?window.EventManager.registerHandler("paste",o,r):r.addEventListener("paste",o)};x(".board-title-input, .note-input textarea").forEach(t);const n=new MutationObserver(r=>{r.forEach(o=>{o.addedNodes.forEach(a=>{var i;a.nodeType===1&&((a.querySelectorAll?a.querySelectorAll(".board-title-input"):[]).forEach(t),(i=a.classList)!=null&&i.contains("board-title-input")&&t(a))})})}),s=c(".boards-container");s&&n.observe(s,{childList:!0,subtree:!0})}function fo(){setTimeout(()=>{x(".board-button").forEach(e=>{e.classList.add("transitions-ready"),e.offsetHeight,requestAnimationFrame(()=>e.style.transform="scale(1)")})},100)}window.toggleBold=Yt;window.markAsDone=at;window.addNote=ct;window.restoreNote=Bn;window.changeNoteColor=_n;window.markAsDone=at;window.toggleBold=Yt;window.clearTrash=Rt;})();
