(()=>{const I=new Map;typeof window!="undefined"&&(window.domCache=I);const i=(t,e=!1)=>{const o=[".board.active",".board[data-board-id=",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".board-button"],s=[`.board[data-board-id="${g||1}"]`,".board.active"],a=o.some(r=>t.includes(r)),n=s.some(r=>t===r);if(a||n||e){const r=document.querySelector(t);return n&&!a&&I.set(t,r),r}if(!I.has(t)){const r=document.querySelector(t);return I.set(t,r),r}return I.get(t)},k=(t,e=!1)=>{if([".board",".board-button",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".emoji-item",".sticky-note.selected",".board.active",".board-pattern-option",".board-color-option",".color-option"].some(r=>t.includes(r))||e)return Array.from(document.querySelectorAll(t));const a=`all:${t}`;if(!I.has(a)){const r=Array.from(document.querySelectorAll(t));return I.set(a,r),r}const n=I.get(a);return Array.isArray(n)?[...n]:Array.from(document.querySelectorAll(t))},Ke=(t,e)=>{if(!t)return null;const o=`${t.className||"element"}:${e}`;if(!I.has(o)){const s=t.querySelector(e);return I.set(o,s),s}return I.get(o)},Ue={get boardsContainer(){return i(".boards-container")},get activeBoard(){return i(".board.active")},get currentBoard(){const t=typeof window!="undefined"&&window.currentBoardId||1;return i(`.board[data-board-id="${t}"]`)},get boardsNavigation(){return i(".boards-navigation")},get addBoardButton(){return i(".add-board-button")},get noteInput(){return i(".note-input textarea")},get textareaContainer(){return i(".textarea-container")},get boardStyleMenu(){return i(".board-style-menu")},get boardStyleButton(){return i(".board-style-button")},get shortcutHint(){return i(".shortcut-hint")},get shortcutIcon(){return i("#shortcutIcon")},get trashBin(){return i(".trash-bin")},get trashModal(){return i("#trashModal")},get trashCount(){return i(".trash-count")},get deletedNotesContainer(){return i(".deleted-notes-container")},get clearTrashBtn(){return i(".clear-trash-btn")},get dragTransferMessage(){return i("#dragTransferMessage")},get noteLimitMessage(){return i("#noteLimitMessage")},get statusBar(){return i(".status-bar")},get emojiPicker(){return i(".emoji-picker")},get allBoards(){return k(".board",!0)},get allBoardButtons(){return k(".board-button",!0)},get activeBoardNotes(){const t=this.currentBoard;return t?Array.from(t.querySelectorAll(".sticky-note")):[]},get selectedNotes(){return k(".sticky-note.selected",!0)},get colorPalettes(){return k(".color-palette",!0)}},Je=(t=null)=>{if(!t){I.clear();return}(Array.isArray(t)?t:[t]).forEach(o=>{I.delete(o),I.delete(`all:${o}`)})},me=()=>{[".board",".board-button",".sticky-note",".color-palette",".board-title-input",".board.active"].forEach(e=>{I.delete(e),I.delete(`all:${e}`)});for(let e=1;e<=9;e++)I.delete(`.board[data-board-id="${e}"]`)};typeof window!="undefined"&&(window.$=i,window.$$=k,window.$within=Ke,window.DOM=Ue,window.clearCache=Je,window.refreshDynamicCache=me);let jt=null;const ae=()=>{if(jt)return;jt=new MutationObserver(e=>{let o=!1;e.forEach(s=>{var a,n,r;s.type==="childList"&&((a=s.target.classList)!=null&&a.contains("boards-container")||(n=s.target.classList)!=null&&n.contains("board")||(r=s.target.classList)!=null&&r.contains("boards-navigation"))&&(o=!0)}),o&&me()});const t=i(".boards-container");t&&jt.observe(t,{childList:!0,subtree:!0})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae):setTimeout(ae,0);const mt=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],D={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let z=[];let nt=null,fe=null,Lt=!1,st=null,kt=0,xt=0,S=[],ft=!1,ge=0,he=0,tt=[];const et={},ot={},K={};let X=1e3;et[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};ot[1]=mt[0];let g=1,M=1;const gt=9,it="stickyNotes_active",pe="stickyNotes_deleted",ye="stickyNotes_boardCount",be="stickyNotes_zIndexes",b=t=>parseInt(String(t).replace("px",""))||0,Ot=(t,e,o=150)=>{const s=i(`.board[data-board-id="${g}"]`);if(!s)return!1;const a=s.querySelectorAll(".sticky-note"),n=20;for(const r of a){const l=b(r.style.left),c=b(r.style.top),f=b(r.style.width)||200,d=t<l+f+n&&t+200>l-n,p=e+o,m=c+30,h=e<m&&p>c-n;if(d&&h)return!0}return!1},re=(t,e)=>{const o=Math.random()*10-5;let s=t+o,a=e+70;const n=5,r=window.innerWidth-200,l=window.innerHeight-300,c=20;let f=0;for(;f<c&&Ot(s,a);)a+=40,f++,f>10&&(s=t+250,a=50,f=0);if(a>l){for(a=50,s=t+250;f<c&&Ot(s,a);)a+=40,f++;if(s>r)for(s=n+50,a=50,f=0;f<c&&Ot(s,a);)a+=40,f++}const d=Math.min(Math.max(s,n),r),p=Math.min(Math.max(a,n),window.innerHeight-100);return{x:d,y:p}},Ve=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,s,a,n)=>s+s+a+a+n+n);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},zt=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(o){console.error(`Failed to save to localStorage (${t}):`,o)}},H=()=>{const t=i(`.board[data-board-id="${g}"]`);if(!t)return;const e=Array.from(t.querySelectorAll(".sticky-note")).map(o=>({text:o.querySelector(".sticky-content").innerHTML,color:o.style.backgroundColor,x:o.style.left,y:o.style.top,width:o.style.width||"200px",height:o.style.height||"150px",isBold:o.querySelector(".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}));zt(`${it}_board_${g}`,e),typeof W=="function"&&W()},Bt=()=>zt(pe,z),ve=()=>localStorage.setItem(ye,M.toString()),we=()=>zt(`boardStyles_board_${g}`,{color:D.colors.current,pattern:D.patterns.current}),Ee=()=>{const t=i("#shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},Le=()=>{const t=i(".note-input textarea");if(!t)return;const e=i("#shortcutIcon"),o=()=>{if(!e)return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",a=t.value.trim();e.innerHTML=a?`${s}+\u21B5`:s,e.classList.toggle("focus-hint",!a),e.classList.toggle("enter-hint",a)};t.addEventListener("focus",()=>{o(),t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px"),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{Ee(),t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px"),t.removeEventListener("input",o)}),document.addEventListener("mousedown",s=>{!s.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},ie=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},Ze=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{console.log("Performing one-time localStorage cleanup...");const e=[];for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&(s.startsWith("stickyNotes_")||s.startsWith("boardColor_")||s.startsWith("boardPattern_")||s.startsWith("boardStyles_")||s.startsWith("emojiStickers_")||s.startsWith("daysPatternStartDate_")||s.startsWith("emojiUsageOrder"))&&e.push(s)}e.forEach(o=>{localStorage.removeItem(o)}),console.log(`Cleaned up ${e.length} localStorage items`),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},Ge=()=>{try{Ze(),typeof le=="function"&&le();const t=localStorage.getItem(ye);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){M=Math.min(o,gt);for(let s=2;s<=M;s++)typeof Yt=="function"&&Yt(s)}}typeof $t=="function"&&$t();for(let o=1;o<=M;o++){const s=localStorage.getItem(`${it}_board_${o}`);if(s){const a=ie(s,[]);Array.isArray(a)&&a.forEach(n=>{if(n&&typeof n=="object"&&n.text&&(et[o]={x:b(n.x),y:b(n.y)},ot[o]=n.color||mt[0],typeof St=="function")){const r=St(n.text,n.color||mt[0],b(n.x),b(n.y),!0,n.width||"200px",n.height||"150px",n.isBold||!1,o);r&&n.noteId&&(r.dataset.noteId=n.noteId,K[n.noteId]?(r.style.zIndex=K[n.noteId],K[n.noteId]>X&&(X=K[n.noteId])):n.zIndex&&!isNaN(parseInt(n.zIndex))&&(r.style.zIndex=n.zIndex,K[n.noteId]=parseInt(n.zIndex),parseInt(n.zIndex)>X&&(X=parseInt(n.zIndex))))}})}typeof bt=="function"&&bt(o)}typeof U=="function"&&U(1);const e=localStorage.getItem(pe);if(e){const o=ie(e,[]);Array.isArray(o)&&(z=o,typeof lt=="function"&&lt())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),Ee(),Le()}catch(t){console.error("Critical error loading saved data:",t)}},Qe=t=>{t.style.zIndex=++X;const e=t.dataset.noteId;e&&(K[e]=X,ke())},ke=()=>{try{localStorage.setItem(be,JSON.stringify(K))}catch(t){console.error("Error saving note z-indexes:",t)}},to=()=>{try{const t=localStorage.getItem(be);t&&(Object.assign(K,JSON.parse(t)),X=Math.max(1e3,...Object.values(K)))}catch(t){console.error("Error loading note z-indexes:",t)}};const le=()=>{st=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(st.style,{display:"none"}),document.body.appendChild(st)};function eo(){const t=i(".boards-container");document.addEventListener("mousedown",e=>{e.target.closest(".board")&&!e.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&e.preventDefault()}),[["mousedown",oo],["mousemove",no],["mouseup",so]].forEach(([e,o])=>(e==="mousedown"?t:document).addEventListener(e,o))}function oo(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=i(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&Nt(),[Lt,kt,xt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),st.style.cssText=`left:${kt}px; top:${xt}px; width:0; height:0; display:block;`}function no(t){if(!Lt)return;t.preventDefault();const[e,o]=[Math.abs(t.clientX-kt),Math.abs(t.clientY-xt)],[s,a]=[Math.min(t.clientX,kt),Math.min(t.clientY,xt)];st.style.cssText=`left:${s}px; top:${a}px; width:${e}px; height:${o}px; display:block;`,ao()}const so=()=>{Lt&&(Lt=!1,document.body.classList.remove("selecting"),st.style.display="none")};function ao(){const t=st.getBoundingClientRect(),e=i(`.board[data-board-id="${g}"]`);if(!e)return;const o=(s,a,n)=>{const r=s.getBoundingClientRect(),l=!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom),c=a.indexOf(s);l?c===-1&&(a.push(s),s.classList.add(n)):!ft&&c!==-1&&(a.splice(c,1),s.classList.remove(n))};e.querySelectorAll(".sticky-note").forEach(s=>o(s,S,"selected"))}const Nt=()=>{S.forEach(t=>t.classList.remove("selected")),S=[]};function ro(t){[ft,ge,he]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),tt=S.map(e=>({element:e,x:b(e.style.left),y:b(e.style.top),type:"note"})),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,e==="mousemove"?xe:Se))}function xe(t){if(!ft)return;const[e,o]=[t.clientX-ge,t.clientY-he],[s,a,n]=[5,-5,-5],[r,l]=[window.innerWidth-s,window.innerHeight-s];(f=>f.forEach(d=>{const[p,m]=[Math.min(Math.max(d.x+e,a),r-d.element.offsetWidth/4),Math.min(Math.max(d.y+o,n),l-d.element.offsetHeight/4)];Object.assign(d.element.style,{left:`${p}px`,top:`${m}px`})}))(tt),S.length>0&&(Be(t.clientX,t.clientY),S.length>1&&Jt())}function Se(){if(!ft)return;if(ft=!1,document.body.classList.remove("selecting"),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,e==="mousemove"?xe:Se)),yt(),!Ie().moved){H();for(let e=S.length-1;e>=0;e--)Ce(S[e])&&S.splice(e,1)}Vt()}let ut=[];const io=100,ce=50,lo="#ffd700",co=()=>{const[t,e]=[i("#trashModal"),i(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>It())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},Wt=t=>{S.includes(t)&&S.length>1?(S.forEach((e,o)=>setTimeout(()=>Pt(e),o*100)),Nt()):Pt(t)},Pt=t=>{if(z.length>=io){!ut.includes(t)&&ut.push(t),co();return}t._eventCleanup&&t._eventCleanup();const e=t.querySelector(".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};uo(t),z.unshift(o),Bt(),lt(),mo(t)},uo=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,s]=[e.getBoundingClientRect(),t.getBoundingClientRect()],a=Math.min(5,Math.max(0,Math.floor((s.left+s.width/2-o.left)/(o.width/6))));window.noteColumns[a]&&(window.noteColumns[a]=window.noteColumns[a].filter(n=>Math.abs(n.x-b(t.style.left))>1||Math.abs(n.y-b(t.style.top))>1))},mo=t=>{const e=i(".trash-bin"),o=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=o.left-s.left+o.width/2-s.width/2,n=o.top-s.top;t.style.setProperty("--throwX",`${a}px`),t.style.setProperty("--throwY",`${n}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out",setTimeout(()=>{t.remove(),e.style.animation="",H(),W()},600)},Ce=t=>{const[e,o]=[i(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(Wt(t),!0):!1},ht=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>It())):setTimeout(()=>t.style.display="none",300)},It=()=>{const t=i(".deleted-notes-container");t.style.minHeight="200px",t.innerHTML=z.length?z.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||lo}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},fo=t=>{const e=k(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[o]=z.splice(t,1);St(o.text,o.color,b(o.x),b(o.y),!0,o.width,o.height,o.isBold),Bt(),lt(),It(),H(),W()},300)},Te=()=>{if(z.length===0){ht();return}const t=[...k(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*ce}ms`}),setTimeout(()=>{z=[],Bt(),lt(),It(),setTimeout(()=>{if(ht(),ut.length){const e=[...ut];ut=[],setTimeout(()=>{e.forEach(o=>{o!=null&&o.parentNode&&Pt(o)})},300)}},200)},(t.length?(t.length-1)*ce+300:0)+100)},lt=()=>{i(".trash-count").textContent=z.length};document.addEventListener("click",t=>{const e=i("#trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&ht()});let Ft=new Set;const Kt=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,go=()=>Math.random()*40-20,ho=(t=At())=>t.getDay()===0?0:t.getDay()-1;function Rt(t){const e=document.getElementById("noteLimitMessage"),o=e==null?void 0:e.querySelector(".transfer-text");o&&(o.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function Ut(){const t=i(".note-input textarea"),e=t.value.trim();if(!e)return;const o=i(`.board[data-board-id="${g}"]`),s=Array.from(o.querySelectorAll(".sticky-note")),[a,n,r]=[o.classList.contains("board-pattern-weekdays"),o.classList.contains("board-pattern-days"),s.filter(y=>!y.dataset.transferred).length===0];if(!a&&!n&&s.length>=30){Rt("Maximum notes space reached.");return}const l=s.filter(y=>!y.dataset.transferred),c=l[l.length-1];let{x:f,y:d}=et[g]||{x:0,y:0},p=ot[g]||getRandomColor(),m,h;const E=(y,L,P=null)=>{const $=o.offsetWidth/L,O=y*$+10,J=(y+1)*$-210,V=Math.max(O,Math.min(J,O+go())),R=Array.from(o.querySelectorAll(".sticky-note")).filter(C=>C.style.display!=="none"&&C!==P),[_,Z]=[y*$,(y+1)*$],B=R.filter(C=>{const[A,at]=[b(C.style.left),b(C.style.left)+200],[G,rt]=[Math.max(A,_),Math.min(at,Z)];return Math.max(0,rt-G)/200>.5});return{positionX:V,columnNotes:B}},x=(y,L)=>{const P=window.innerHeight-300;for(let $=0;$<L;$++){const O=(y+$)%L,{positionX:J,columnNotes:V}=E(O,L);let R=60,_=null;V.forEach(B=>{const C=b(B.style.top);C>=R&&(R=C,_=B)});const Z=_?R+70:60;if(Z<=P)return m=J,h=Z,_&&(p=_.style.backgroundColor),!0}return Rt("Maximum notes space reached."),!1},q=y=>{let L;const P=y?6:5;if(c){const $=b(c.style.left),O=o.offsetWidth/P;L=Math.floor($/O),L=Math.max(0,Math.min(L,P-1))}else L=y?ho():Gt(g)||0;return x(L,P)};if(r)if(a||n){if(q(a)===!1)return}else{const y=Math.max(150,window.innerWidth/4);({x:m,y:h}=re(y,50-70))}else if(a||n){if(q(a)===!1)return}else if(c&&([f,d,p]=[b(c.style.left),b(c.style.top),c.style.backgroundColor]),{x:m,y:h}=re(f,d),h<=50){const y=s.filter(L=>Math.abs(b(L.style.left)-m)<150);if(y.length>0){const L=y.map(R=>b(R.style.top)),[P,$]=[Math.max(...L),Math.min(...L)],O=window.innerHeight-300,[J,V]=[P+200,$-200];if(J<=O)h=J;else if(V>=50)h=V;else{const R=(Z,B)=>{const C=window.innerWidth-200;for(let A=Z;B>0?A<=C:A>=55;A+=B*250){const at=s.filter(dt=>Math.abs(b(dt.style.left)-A)<150);if(at.length===0)return{x:A,y:50};const G=at.map(dt=>b(dt.style.top)),[rt,vt]=[Math.max(...G),Math.min(...G)],[ct,wt]=[rt+200,vt-200];if(ct<=O)return{x:A,y:ct};if(wt>=50)return{x:A,y:wt}}return null},_=R(m+250,1)||R(m-250,-1);if(_)[m,h]=[_.x,_.y];else{Rt("Maximum notes space reached.");return}}}}St(e.replace(/\n/g,"<br>"),p,m,h,!1,"200px","150px",!1,g),[et[g],ot[g],t.value]=[{x:m,y:h},p,""],o.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(y=>{delete y.dataset.transferred}),H(),W()}function St(t,e,o,s,a=!1,n="200px",r="150px",l=!1,c=g,f=!1){const[d,p]=[document.createElement("div"),Kt()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${l?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${mt.map(y=>`<div class="color-option" style="background-color: ${y}" onclick="changeNoteColor(this, '${y}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${l?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let m;const h=i(`.board[data-board-id="${c}"]`),E=h&&(h.classList.contains("board-pattern-weekdays")||h.classList.contains("board-pattern-days"));m=++X,d.style.cssText=`background-color:${e}; left:${o}px; top:${s}px; width:${n}; height:${r}; z-index:${m};`,d.dataset.noteId=p,f&&(d.dataset.repositioned="true",Ft.add(p)),K[p]=m,ke();const x=y=>{y.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||Qe(d)};d.addEventListener("click",x),d._eventCleanup=()=>{d.removeEventListener("click",x)},bo(d);const q=i(`.board[data-board-id="${c}"]`);return q?(q.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",a||H(),d):(console.error(`Board element with ID ${c} not found.`),null)}function po(t,e){const o=t.closest(".sticky-note");(o.classList.contains("selected")?k(".sticky-note.selected"):[o]).forEach(a=>{const n=a.querySelector(".color-button");[a,n].forEach(r=>r.classList.add("color-transition")),[a.style.backgroundColor,n.style.backgroundColor]=[e,e],setTimeout(()=>[a,n].forEach(r=>r.classList.remove("color-transition")),300)}),ot[g]=e,H()}const $e=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),H()},yo=i("#shortcutIcon")||i(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),Me=()=>{yo.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};Me();i(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Ut())});let N=null,pt=!1,qt=!1,_t=!1;function bo(t){let e=!1,o=!1,s=!1,a,n,r,l,c,f,d;const[p,m,h]=[".color-button",".color-palette",".sticky-content"].map(u=>t.querySelector(u)),E=()=>H(),x=[],q=()=>H(),y=()=>H();h.addEventListener("blur",q),h.addEventListener("input",y),x.push({element:h,event:"blur",handler:q},{element:h,event:"input",handler:y});const L=u=>{s&&!h.contains(u.target)&&([s,h.contentEditable]=[!1,"false"],h.blur(),document.removeEventListener("click",L))},P=u=>{[s,h.contentEditable]=[!0,"true"],setTimeout(()=>{const[v,w]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const T=document.caretRangeFromPoint(u.clientX,u.clientY);T&&(w.removeAllRanges(),w.addRange(T))}else if(document.caretPositionFromPoint){const T=document.caretPositionFromPoint(u.clientX,u.clientY);T&&(v.setStart(T.offsetNode,T.offset),v.collapse(!0),w.removeAllRanges(),w.addRange(v))}h.focus()},0),setTimeout(()=>document.addEventListener("click",L),0),u.stopPropagation()};h.addEventListener("dblclick",P),x.push({element:h,event:"dblclick",handler:P});let $=null,O=!1;const J=()=>{!e&&!o&&(O=!0,$=t.style.zIndex||"1",t.style.zIndex="9999")},V=()=>{!e&&!o&&$!==null&&(O=!1,t.style.zIndex=$,$=null)};t.addEventListener("mouseenter",J),t.addEventListener("mouseleave",V),x.push({element:t,event:"mouseenter",handler:J},{element:t,event:"mouseleave",handler:V});const R=()=>h.contentEditable="false",_=u=>{if(u.key==="Enter")if(u.preventDefault(),u.shiftKey)h.contentEditable="false",E();else{const[v,w]=[window.getSelection(),window.getSelection().getRangeAt(0)],T=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});w.deleteContents(),w.insertNode(T),w.setStartAfter(T),w.collapse(!0),v.removeAllRanges(),v.addRange(w)}};h.addEventListener("blur",R),h.addEventListener("keydown",_),x.push({element:h,event:"blur",handler:R},{element:h,event:"keydown",handler:_});const Z=()=>{const u=t.getBoundingClientRect();et[g]={x:u.left,y:u.top}};let B=0,C=0,A=null;document.addEventListener("mousemove",u=>{[B,C]=[u.clientX,u.clientY],k(".color-palette.visible").forEach(v=>{var se;const[w,T]=[v.getBoundingClientRect(),(se=v.closest(".note-controls"))==null?void 0:se.querySelector(".color-button")];if(!T)return;const Q=T.getBoundingClientRect(),[Dt,Fe]=[B>=w.left-10&&B<=w.right+10&&C>=w.top-10&&C<=w.bottom+10,B>=Q.left&&B<=Q.right&&C>=Q.top&&C<=Q.bottom];Dt||Fe?clearTimeout(A):v.classList.contains("visible")&&G()})});const at=()=>{clearTimeout(A),m.classList.remove("closing"),m.classList.add("visible"),k(".color-palette").forEach(u=>{u!==m&&(u.classList.add("closing"),setTimeout(()=>u.classList.remove("visible","closing"),180))})},G=()=>{clearTimeout(A),A=setTimeout(()=>{const[u,v]=[m.getBoundingClientRect(),p.getBoundingClientRect()],[w,T]=[B<u.left-10||B>u.right+10||C<u.top-10||C>u.bottom+10,B>=v.left&&B<=v.right&&C>=v.top&&C<=v.bottom];w&&!T&&(m.classList.add("closing"),setTimeout(()=>m.classList.contains("closing")&&m.classList.remove("visible","closing"),180))},50)},rt=u=>{u.stopPropagation(),m.classList.contains("visible")?G():at()};p.addEventListener("click",rt),x.push({element:p,event:"click",handler:rt});const vt=()=>clearTimeout(A),ct=()=>G();m.addEventListener("mouseenter",vt),m.addEventListener("mouseleave",ct),x.push({element:m,event:"mouseenter",handler:vt},{element:m,event:"mouseleave",handler:ct});const wt=(u,v,w)=>{if(!u.target.closest(".color-palette, .done-button")){if(S.includes(t)&&S.length>1){ro(u);return}u.shiftKey?S.includes(t)||(S.push(t),t.classList.add("selected")):Nt(),u.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],O?$=++X:t.style.zIndex=++X,[a,n]=[v,w],u.target.closest(".resize-handle")?[o,c,f]=[!0,t.offsetWidth,t.offsetHeight]:([r,l]=[b(t.style.left),b(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[r,l],d=setTimeout(()=>e=!0,150)),nt=t}},dt=(u,v)=>{if(!(!nt||nt!==t)){if((Math.abs(u-a)>5||Math.abs(v-n)>5)&&clearTimeout(d),e){_t||(_t=!0,document.body.classList.add("drag-in-progress"));const w=5;let[T,Q]=[Math.min(Math.max(r+u-a,-w),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(l+v-n,-w),window.innerHeight-t.offsetHeight/4)];[t.style.left,t.style.top]=[`${T}px`,`${Q}px`],Jt(),Be(u,v)}if(o){const[w,T]=[150,150],[Q,Dt]=[window.innerWidth-b(t.style.left)+50,window.innerHeight-b(t.style.top)+50];t.style.width=`${Math.min(Math.max(c+u-a,w),Q)}px`,t.style.height=`${Math.min(Math.max(f+v-n,T),Dt)}px`}}},We=()=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(e||o)&&e){if(yt(),!Ie().moved){Z(),Ce(t),wo(t);const v=t.dataset.noteId||Kt();[t.dataset.noteId,t.dataset.repositioned]=[v,"true"],Ft.add(v),et[g]={x:b(t.style.left),y:b(t.style.top)},ot[g]=t.style.backgroundColor,W(),Vt(),nt=null}H(),[_t,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[e,o]=[!1,!1],yt()},ee=u=>wt(u,u.clientX,u.clientY),oe=u=>dt(u.clientX,u.clientY),ne=We;if(t.addEventListener("mousedown",ee),document.addEventListener("mousemove",oe),document.addEventListener("mouseup",ne),x.push({element:t,event:"mousedown",handler:ee},{element:document,event:"mousemove",handler:oe},{element:document,event:"mouseup",handler:ne}),t._eventCleanup){const u=t._eventCleanup;t._eventCleanup=()=>{u(),x.forEach(({element:v,event:w,handler:T})=>{v.removeEventListener(w,T)})}}else t._eventCleanup=()=>{x.forEach(({element:u,event:v,handler:w})=>{u.removeEventListener(v,w)})}}function vo(){k(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),fe=null}document.addEventListener("click",t=>{fe&&!t.target.closest(".color-button")&&vo()});function wo(t){if(!t)return;const[e,o,s,a]=[t.getBoundingClientRect(),window.innerHeight,250,150],n=o-a,[r,l]=[e.bottom>n,e.left<s&&e.bottom>n];if(l){const[c,f,d]=[e.bottom-n+20,b(t.style.top),Math.max(60,b(t.style.top)-(e.bottom-n+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${d}px`,setTimeout(()=>t.style.transition="",300)}}function Be(t,e){var m,h;if(qt)return;const o=i(".status-bar");if(!o)return;const s=o.getBoundingClientRect(),[a,n]=[Math.max(0,Math.max(s.left-t,t-s.right)),Math.max(0,Math.max(s.top-e,e-s.bottom))],[r,l,c,f]=[Math.sqrt(a*a+n*n),120,80,N!==null],d=f?r<=l:r<=c,p=()=>{let[E,x]=[null,1/0];return k(".board-button:not(.disabled)",!0).forEach(q=>{const y=q.getBoundingClientRect(),L=Math.sqrt(Math.pow(t-(y.left+y.width/2),2)+Math.pow(e-(y.top+y.height/2),2));L<x&&([E,x]=[q,L])}),E};if(d!==f)if(d){const E=k(".board-button:not(.disabled)");N=p(),E.forEach(x=>x.classList.add("drag-active","drag-proximity")),N&&N.classList.add("drag-hover"),Eo()}else k(".board-button",!0).forEach(E=>{E.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>E.classList.remove("drag-active"),200)}),N=null,Ne();else if(d&&N){const E=p();E!==N&&(N==null||N.classList.remove("drag-hover"),N=E,E?(E.classList.add("drag-hover"),yt(),(m=i(".shortcut-hint"))==null||m.classList.add("hidden-during-drag")):(Jt(),pt||(h=i(".shortcut-hint"))==null||h.classList.remove("hidden-during-drag")))}}function Eo(){if(!N)return;const[t,e]=[N.getBoundingClientRect(),S.length>0?S:nt?[nt]:[]];e.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(l=>{[l.style.userSelect,l.style.pointerEvents]=["none","none"]});const[s,a]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[n,r]=[t.left-a.left+t.width/2-(s.left-a.left)-s.width/2,t.top-a.top+t.height/2-(s.top-a.top)-s.height/2];o.style.setProperty("--suckX",`${n}px`),o.style.setProperty("--suckY",`${r}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function Ne(){k(".hover-animating",!0).forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events")}),t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),t.classList.remove("reverse-animating"))},300)})}function Jt(){var t;if(M>1&&!pt&&!N){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),pt=!0),(t=i(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function yt(){var t;if(pt){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),pt=!1),(t=i(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Vt(){k(".board-button",!0).forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[N]=[null],Ne(),yt()}function Ie(){if(!N)return{moved:!1};const[t,e]=[parseInt(N.dataset.boardId),S.length>0?[...S]:[nt]];if(t===g)return e.forEach(s=>{if(s){const a=tt==null?void 0:tt.find(n=>n.element===s);a?(s.style.left=`${a.x}px`,s.style.top=`${Math.max(60,a.y)}px`):s.style.top=`${parseInt(s.style.top||0)-250}px`}}),{moved:!1};let o=new Map;return e.length>1&&typeof tt!="undefined"&&tt.length>0&&tt.forEach(s=>{s&&e.includes(s.element)&&o.set(s.element,{originalX:s.x,originalY:s.y})}),e.forEach(s=>{s&&Lo(s,t,o.size>0?o.get(s):null)}),S.length>0&&Nt(),{moved:!0}}function Lo(t,e,o=null){const s=t.style.left;if(t.classList.contains("hover-animating"))t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const a=i(`.board-button[data-board-id="${e}"]`);if(!a)return;const[n,r,l]=[a.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[c,f]=[n.left-l.left+n.width/2-(r.left-l.left)-r.width/2,n.top-l.top+n.height/2-(r.top-l.top)-r.height/2];t.style.setProperty("--suckX",`${c}px`),t.style.setProperty("--suckY",`${f}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards",t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(n=>{n.style.removeProperty("user-select"),n.style.removeProperty("pointer-events")}),t.remove();const a=i(`.board[data-board-id="${e}"]`);if(a){if(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),o)if(o.originalX!==void 0&&o.originalY!==void 0)[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[l,c]=[100,80];[t.style.left,t.style.top]=[`${l+(o.offsetX||0)}px`,`${Math.max(60,c+(o.offsetY||0))}px`]}else{const[l,c]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];!isNaN(l)&&!isNaN(c)?[t.style.left,t.style.top]=[`${l}px`,`${Math.max(60,c)}px`]:[t.style.left,t.style.top]=[s,"80px"]}const n=t.dataset.noteId||Kt();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[n,"true","true"],Ft.add(n),a.appendChild(t),t.style.animation="paperPop 0.3s ease-out forwards",W(),Vt(),qt=!0,setTimeout(()=>qt=!1,500);const r=g;[g]=[e],H(),[g]=[r],H()}},600)}let j={},F=null,Et={x:0,y:0},Y=[];function Ae(){Co(),He(),xo(),k(".emoji-item").forEach(t=>t.addEventListener("click",De))}const De=t=>{const e=t.target.dataset.emoji;e&&(So(e),ko(e))};function ko(t){const e=i(".board.active");if(!e)return;const o=e.dataset.boardId;if($o(o)>=10)return Mo();const s=No(),a=e.getBoundingClientRect(),[n,r,l]=[a.width-120,a.height*.8-120,20],[c,f]=[Math.random()*n,Math.max(l,Math.random()*r)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});d.dataset.stickerId=s,Object.assign(d.style,{left:c+"px",top:f+"px"});const p=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});p.addEventListener("click",m=>[m.stopPropagation(),Oe(s,o)]),d.appendChild(p),je(d),e.appendChild(d),(j[o]=j[o]||{})[s]={emoji:t,x:c,y:f,id:s},Zt(o),setTimeout(()=>d.classList.remove("new"),400)}function je(t){let e=!1;t.addEventListener("mousedown",o);function o(n){if(n.target.classList.contains("delete-button"))return;n.preventDefault(),n.stopPropagation(),[e,F]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[r,l]=[n.clientX,n.clientY],c=t.getBoundingClientRect();[Et.x,Et.y]=[r-c.left,l-c.top],t.classList.add("dragging"),document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)}function s(n){if(!e||!F)return;n.preventDefault(),n.stopPropagation();const[r,l]=[n.clientX,n.clientY],c=i(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(r-c.left-Et.x,c.width-120)),Math.max(0,Math.min(l-c.top-Et.y,c.height-120))];Object.assign(F.style,{left:f+"px",top:d+"px"})}function a(){var l;if(!e||!F)return;F.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],Bo(F);const[n,r]=[i(".board.active").dataset.boardId,F.dataset.stickerId];(l=j[n])!=null&&l[r]&&(Object.assign(j[n][r],{x:parseInt(F.style.left),y:parseInt(F.style.top)}),Zt(n)),F=null,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a)}}const Oe=(t,e)=>{const o=i(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),j[e]&&(delete j[e][t],Zt(e))},Zt=t=>localStorage.setItem(`emojiStickers_board_${t}`,JSON.stringify(j[t]||{}));function Re(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{j[t]=e?JSON.parse(e):{},e&&_e(t)}catch(o){console.error("Error loading emoji stickers:",o),j[t]={}}}const xo=()=>Array.from({length:M},(t,e)=>Re(e+1));function _e(t){const e=i(`.board[data-board-id="${t}"]`);!e||!j[t]||(e.querySelectorAll(".emoji-sticker").forEach(o=>o.remove()),Object.values(j[t]).forEach(({id:o,emoji:s,x:a,y:n})=>{const r=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:s});r.dataset.stickerId=o,Object.assign(r.style,{left:a+"px",top:n+"px"});const l=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});l.addEventListener("click",c=>[c.stopPropagation(),Oe(o,t)]),r.appendChild(l),je(r),e.appendChild(r)}))}function So(t){const e=Y.indexOf(t);(e<0||e>=12)&&(e>-1&&Y.splice(e,1),Y.unshift(t),Y.length>16&&(Y=Y.slice(0,16)),To(),He())}function Co(){const t=localStorage.getItem("emojiUsageOrder");try{Y=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),Y=[]}}const To=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(Y));function He(){const t=i(".emoji-picker");t&&(t.querySelectorAll(".recent-emoji").forEach(e=>e.remove()),Y.length>0&&Y.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",De),t.insertBefore(o,t.firstChild)}))}const $o=t=>j[t]?Object.keys(j[t]).length:0,Mo=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function Bo(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[s,a,n]=[250,150,o-150];if(e.left<s&&e.bottom>n){const l=Math.max(60,parseInt(t.style.top)-(e.bottom-n+20));t.style.top=`${l}px`}}const No=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),Io=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete j[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Ae,100));window.emojiStickers={loadEmojiStickers:Re,renderEmojiStickers:_e,cleanupEmojiStickers:Io,initializeEmojiPicker:Ae};const At=()=>new Date,Pe=t=>{const e=At().getDay(),o=e===0?6:e-1;return t===o},Ao=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,At().toISOString().split("T")[0])},Gt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((At()-new Date(e))/(1e3*60*60*24))%5:-1},qe=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),de=()=>{if(M>=gt){alert(`Maximum number of boards (${gt}) reached.`);return}Yt(++M),ve(),$t()};function Yt(t){const e=i(".boards-container"),o=Object.assign(document.createElement("div"),{className:"board"});o.dataset.boardId=t,e.appendChild(o);const s=Object.assign(document.createElement("div"),{className:"board-title-circle"}),a=[],n=()=>{var m;(m=s.querySelector(".board-title-input"))==null||m.focus()};s.addEventListener("click",n),a.push({element:s,event:"click",handler:n});const r=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let l;const c=()=>{const m=r.value.trim();if(!m){r.value=r.dataset.originalTitle||"";return}Qt(t,m),Mt(r)},f=()=>{clearTimeout(l),l=setTimeout(c,500)};r.addEventListener("input",f),a.push({element:r,event:"input",handler:f}),Mt(r),s.appendChild(r),o.appendChild(s);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});d.dataset.boardId=t;const p=()=>U(t);if(d.addEventListener("click",p),a.push({element:d,event:"click",handler:p}),t>1){const m=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),h=E=>{E.stopPropagation(),Ct(t)};m.addEventListener("click",h),a.push({element:m,event:"click",handler:h}),d.appendChild(m)}o._eventCleanup=()=>{a.forEach(({element:m,event:h,handler:E})=>{m.removeEventListener(h,E)}),clearTimeout(l)},i(".boards-navigation").insertBefore(d,i(".add-board-button")),setTimeout(()=>[d.classList.remove("new-button"),d.classList.add("transitions-ready")],500),bt(t),te(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function Ct(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=i(`.board[data-board-id="${t}"]`);if(!e){Ht(t);return}const[o,s]=[e.querySelectorAll(".sticky-note"),e.querySelectorAll(".emoji-sticker")];if(o.length||s.length){const a=i(".trash-bin"),n=a.getBoundingClientRect();a.style.animation="binShake 0.5s ease-in-out",o.forEach(r=>{const l=r.querySelector(".sticky-content");z.unshift({text:l.innerHTML,color:r.style.backgroundColor,x:r.style.left,y:r.style.top,width:r.style.width,height:r.style.height,timestamp:new Date().toLocaleString(),isBold:l.classList.contains("bold")});const c=r.getBoundingClientRect(),[f,d]=[n.left-c.left+n.width/2-c.width/2,n.top-c.top];r.style.setProperty("--throwX",`${f}px`),r.style.setProperty("--throwY",`${d}px`),r.style.animation="paperCrumble 0.5s ease-in forwards"}),s.forEach(r=>r.classList.add("deleting")),Bt(),lt(),console.log("Setting timeout for continueWithBoardDeletion, boardId:",t),setTimeout(()=>{console.log("Timeout fired, calling continueWithBoardDeletion"),Ht(t)},600)}else Ht(t)}function Ht(t){console.log("continueWithBoardDeletion called with boardId:",t);const[e,o]=[i(`.board[data-board-id="${t}"]`),i(`.board-button[data-board-id="${t}"]`)];console.log("Found elements:",{boardElement:e,buttonElement:o}),e!=null&&e._eventCleanup&&e._eventCleanup(),e&&e.remove(),o&&o.classList.add("removing");const s=[];for(let a=t+1;a<=M;a++){const n=i(`.board-button[data-board-id="${a}"]`);n&&(n.classList.add("removing"),s.push(a))}[`${it}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(a=>localStorage.removeItem(a)),qe(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let a=t+1;a<=M;a++)["boardColor","boardPattern","boardStyles_board"].forEach(n=>{const[r,l,c]=[`${n}_${a}`,`${n}_${a-1}`,localStorage.getItem(`${n}_${a}`)];c&&localStorage.setItem(l,c),localStorage.removeItem(r)});setTimeout(()=>{o&&o.remove();const[a,n]=[i(".boards-navigation"),i(".add-board-button")];s.forEach(r=>{const[l,c,f]=[i(`.board-button[data-board-id="${r}"]`),i(`.board[data-board-id="${r}"]`),r-1];l&&l.remove(),c&&(c.dataset.boardId=f);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:f});if([d.dataset.boardId,d.dataset.originalNumber]=[f,f],d.addEventListener("click",()=>U(f)),f>1){const p=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});p.addEventListener("click",m=>{m.stopPropagation(),Ct(f)}),d.appendChild(p)}a.insertBefore(d,n),["","Title","Color","Pattern"].forEach(p=>{const[m,h,E]=[p?`stickyNotes_board${p}`:it,`${p?`stickyNotes_board${p}`:it}_board_${r}`,`${p?`stickyNotes_board${p}`:it}_board_${f}`],x=localStorage.getItem(h);x&&(localStorage.setItem(E,x),localStorage.removeItem(h))}),bt(f)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(r=>[r.classList.remove("new-button"),r.classList.add("transitions-ready")]),500),M--,ve(),$t(),g===t?U(t>1?t-1:M>=1?1:null):g>t&&(g--,U(g)),i(".trash-bin").style.animation=""},350)}function U(t){const e=parseInt(t);e===g||e===null||(Ro(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),g=e,et[t]||(et[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),ot[t]||(ot[t]=mt[0]),k(".board").forEach(o=>{const s=parseInt(o.dataset.boardId);if(o.classList.remove("active","prev","next"),o.style.visibility="hidden",s===g){if(o.classList.add("active"),o.style.visibility="visible",o.querySelectorAll(".sticky-note").forEach((a,n)=>a.style.setProperty("--note-index",n)),o.querySelectorAll(".emoji-sticker").forEach((a,n)=>a.style.setProperty("--sticker-index",n)),!o.querySelector(".board-title-circle")){const a=Object.assign(document.createElement("div"),{className:"board-title-circle"});a.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const n=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),r=()=>Qt(s,n.value);["change","blur"].forEach(l=>n.addEventListener(l,r)),a.appendChild(n),o.appendChild(a),te(s)}}else o.classList.add(s<g?"prev":"next")}),document.querySelectorAll(".board-button").forEach(o=>o.classList.toggle("active",parseInt(o.dataset.boardId)===g)),bt(g),Xe(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=D.colors.current),W(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(g),setTimeout(()=>ze(g),300))}let Tt=[];function Do(){jo();const t=de;i(".add-board-button").addEventListener("click",t),Tt.push({element:i(".add-board-button"),event:"click",handler:t}),k(".board-button").forEach(o=>{const[s,a]=[parseInt(o.dataset.boardId),o.cloneNode(!0)],n=()=>U(s);a.addEventListener("click",n);const r=a.querySelector(".delete-board");if(r){const l=c=>{c.stopPropagation(),Ct(s)};r.addEventListener("click",l)}o.parentNode.replaceChild(a,o)});const e=o=>{const[s,a]=[o.target.tagName,o.target.getAttribute("contenteditable")==="true"];if((o.key==="Control"||o.key==="Meta")&&!o.altKey&&!o.shiftKey&&s!=="TEXTAREA"&&!a){o.preventDefault(),i(".note-input textarea").focus();return}if(s==="TEXTAREA"||a){(o.metaKey||o.ctrlKey)&&o.key==="Enter"&&(o.preventDefault(),Ut());return}o.key==="ArrowLeft"&&g>1?U(g-1):o.key==="ArrowRight"&&g<M?U(g+1):o.key==="n"&&o.ctrlKey?(o.preventDefault(),de()):o.key==="d"&&o.ctrlKey&&g>1&&(o.preventDefault(),Ct(g));const n=parseInt(o.key);!isNaN(n)&&n>=1&&n<=9&&n<=M&&U(n)};document.addEventListener("keydown",e),Tt.push({element:document,event:"keydown",handler:e})}function jo(){Tt.forEach(({element:t,event:e,handler:o})=>{t.removeEventListener(e,o)}),Tt=[]}function $t(){const t=i(".add-board-button"),e=M>=gt;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${gt}) reached`:"Add new board",Oo()}function Oo(){const t=i(".shortcut-hint");t&&(t.style.display=M>=2?"block":"none")}let ue=!1;function Ro(){if(ue||M<2)return;const t=i(".shortcut-hint");t&&(ue=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function _o(){const t=i(".board-style-menu"),e=t.classList.contains("visible");e||(Xe(),Ye(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=D.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function Ye(){i(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?Ho(o):qo(o),document.querySelectorAll(`.board-${e}-option`).forEach(s=>s.classList.remove("active")),t.classList.add("active")})})}function Xe(){["color","pattern"].forEach(t=>{k(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===D[`${t}s`].current)})})}function Xt(){return i(".board.active")}function Ho(t){D.colors.current=t;const e=Xt();e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),we(),W(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function Po(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; transition:opacity 0.5s ease; opacity:0;"}),o=i(`.board[data-board-id="${g}"]`);if(t!=="none"){const s={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(s[t])e.style.cssText+=s[t];else if(t==="weekdays"||t==="days"){const a=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((r,l)=>{const c=Object.assign(document.createElement("span"),{textContent:r});(t==="weekdays"&&Pe(l)||t==="days"&&Gt(g)===l)&&c.classList.add("current-day"),a.appendChild(c)}),e.appendChild(a),o==null||o.classList.add("has-header")}}else o==null||o.classList.remove("has-header");return e}function qo(t){const[e,o,s]=[Xt(),Xt().dataset.boardId,D.patterns.current];s==="days"&&t!=="days"&&qe(o),D.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(r=>r.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t==="days"&&Ao(o);const a=Po(t);e.appendChild(a),a.offsetWidth,a.style.opacity="1";let n=null;(t==="weekdays"||t==="days")&&(n=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.5s ease;"}),e.appendChild(n),n.offsetWidth,n.style.opacity="1"),setTimeout(()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),a.style.height="auto",a.style.zIndex="1",a.classList.add("pattern-overlay"),n&&(n.style.zIndex="0",n.classList.add("pattern-overlay"))):(a.remove(),n==null||n.remove(),t!=="none"&&e.classList.add(`board-pattern-${t}`)),W()},500),we()}function Yo(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(n,r)=>`Day ${r+1}`)).forEach((n,r)=>{const l=Object.assign(document.createElement("span"),{textContent:n});(e.pattern==="weekdays"&&Pe(r)||e.pattern==="days"&&Gt(parseInt(t.dataset.boardId))===r)&&l.classList.add("current-day"),o.appendChild(l)}),t.appendChild(o);const a=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(a)}}function bt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=i(`.board[data-board-id="${t}"]`);if(!o)return;let s;e?(s=JSON.parse(e),t===g&&(D.colors.current=s.color,D.patterns.current=s.pattern)):(s={color:D.colors.default,pattern:D.patterns.default},t===g&&(D.colors.current=s.color,D.patterns.current=s.pattern)),Yo(o,s),W()}Xo();document.addEventListener("click",function(t){const e=i(".board-style-menu"),o=i(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function Xo(){document.querySelectorAll(".board").forEach(t=>te(t.dataset.boardId))}function Qt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function Mt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function te(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(o){const a=o.querySelector(".board-title-input");a&&e&&(a.value=e)}const s=document.querySelector(`.board-button[data-board-id="${t}"]`);s&&!s.dataset.originalNumber&&(s.dataset.originalNumber=s.textContent)}function ze(t){const e=i(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function zo(){k(".board-title-circle").forEach(t=>{let e;const[o,s]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((a,n)=>{t.addEventListener(a,()=>{n===0?(o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")):n===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()):o&&o.focus()})}),o){let a;const n=()=>{const r=o.value.trim();if(!r){o.dataset.originalTitle="";return}Qt(s,r),Mt(o)};o.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(n,500)}),Mt(o)}})}const W=()=>{for(let t=1;t<=M;t++){const[e,o]=[i(`.board[data-board-id="${t}"]`),i(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;const s=e.style.backgroundColor||D.colors.default;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),o.style.backgroundColor=s;const a=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],n=a.find(l=>e.classList.contains(l));a.forEach(l=>o.classList.remove(l.replace("board-pattern","button-pattern"))),n&&o.classList.add(n.replace("board-pattern","button-pattern"));const r=Ve(s)||{r:26,g:26,b:26};o.style.color=(r.r*299+r.g*587+r.b*114)/1e3>128?"#000":"#fff"}};function Wo(t){t.forEach(({selector:e,event:o,handler:s})=>{const a=i(e);a&&a.addEventListener(o,s)})}document.addEventListener("DOMContentLoaded",function(){to(),Ge(),Le(),Do(),Ye(),eo(),Me(),zo(),Fo(),setTimeout(()=>ze(g),500),Ko(),Wo([{selector:".board-style-button",event:"click",handler:_o},{selector:".trash-bin",event:"click",handler:ht},{selector:"#trashModal .close-modal-btn",event:"click",handler:ht},{selector:"#trashModal .clear-trash-btn",event:"click",handler:Te}])});function Fo(){const t=a=>{const n=a.selectionStart,r=a.value;if(r.length>0){const l=r.charAt(0).toUpperCase()+r.slice(1);l!==r&&(a.value=l,a.setSelectionRange(n,n))}},e=a=>{["input","keyup"].forEach(n=>a.addEventListener(n,r=>t(r.target))),a.addEventListener("paste",n=>setTimeout(()=>t(n.target),0))};k(".board-title-input, .note-input textarea").forEach(e);const o=new MutationObserver(a=>{a.forEach(n=>{n.addedNodes.forEach(r=>{var l;r.nodeType===1&&((r.querySelectorAll?r.querySelectorAll(".board-title-input"):[]).forEach(e),(l=r.classList)!=null&&l.contains("board-title-input")&&e(r))})})}),s=i(".boards-container");s&&o.observe(s,{childList:!0,subtree:!0})}function Ko(){setTimeout(()=>{k(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>t.style.transform="scale(1)")})},100)}window.toggleBold=$e;window.markAsDone=Wt;window.addNote=Ut;window.restoreNote=fo;window.changeNoteColor=po;window.markAsDone=Wt;window.toggleBold=$e;window.clearTrash=Te;})();
