(()=>{var an=Object.defineProperty;var vt=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,rn=Object.prototype.propertyIsEnumerable;var yt=(e,t,n)=>t in e?an(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bt=(e,t)=>{for(var n in t||(t={}))sn.call(t,n)&&yt(e,n,t[n]);if(vt)for(var n of vt(t))rn.call(t,n)&&yt(e,n,t[n]);return e};const D=new Map;typeof window!="undefined"&&(window.domCache=D);const c=(e,t=!1)=>{const n=[".board.active",".board[data-board-id=",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".board-button"],a=[`.board[data-board-id="${m||1}"]`,".board.active"],r=n.some(s=>e.includes(s)),o=a.some(s=>e===s);if(r||o||t){const s=document.querySelector(e);return o&&!r&&D.set(e,s),s}if(!D.has(e)){const s=document.querySelector(e);return D.set(e,s),s}return D.get(e)},k=(e,t=!1)=>{if([".board",".board-button",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".emoji-item",".sticky-note.selected",".board.active",".board-pattern-option",".board-color-option",".color-option"].some(s=>e.includes(s))||t)return Array.from(document.querySelectorAll(e));const r=`all:${e}`;if(!D.has(r)){const s=Array.from(document.querySelectorAll(e));return D.set(r,s),s}const o=D.get(r);return Array.isArray(o)?[...o]:Array.from(document.querySelectorAll(e))},cn=(e,t)=>{if(!e)return null;const n=`${e.className||"element"}:${t}`;if(!D.has(n)){const a=e.querySelector(t);return D.set(n,a),a}return D.get(n)},ln={get boardsContainer(){return c(".boards-container")},get activeBoard(){return c(".board.active")},get currentBoard(){const e=typeof window!="undefined"&&window.currentBoardId||1;return c(`.board[data-board-id="${e}"]`)},get boardsNavigation(){return c(".boards-navigation")},get addBoardButton(){return c(".add-board-button")},get noteInput(){return c(".note-input textarea")},get textareaContainer(){return c(".textarea-container")},get boardStyleMenu(){return c(".board-style-menu")},get boardStyleButton(){return c(".board-style-button")},get shortcutHint(){return c(".shortcut-hint")},get shortcutIcon(){return c("#shortcutIcon")},get trashBin(){return c(".trash-bin")},get trashModal(){return c("#trashModal")},get trashCount(){return c(".trash-count")},get deletedNotesContainer(){return c(".deleted-notes-container")},get clearTrashBtn(){return c(".clear-trash-btn")},get dragTransferMessage(){return c("#dragTransferMessage")},get noteLimitMessage(){return c("#noteLimitMessage")},get statusBar(){return c(".status-bar")},get emojiPicker(){return c(".emoji-picker")},get allBoards(){return k(".board",!0)},get allBoardButtons(){return k(".board-button",!0)},get activeBoardNotes(){const e=this.currentBoard;return e?Array.from(e.querySelectorAll(".sticky-note")):[]},get selectedNotes(){return k(".sticky-note.selected",!0)},get colorPalettes(){return k(".color-palette",!0)}},dn=(e=null)=>{if(!e){D.clear();return}(Array.isArray(e)?e:[e]).forEach(n=>{D.delete(n),D.delete(`all:${n}`)})},Dt=()=>{[".board",".board-button",".sticky-note",".color-palette",".board-title-input",".board.active"].forEach(t=>{D.delete(t),D.delete(`all:${t}`)});for(let t=1;t<=9;t++)D.delete(`.board[data-board-id="${t}"]`)};typeof window!="undefined"&&(window.$=c,window.$$=k,window.$within=cn,window.DOM=ln,window.clearCache=dn,window.refreshDynamicCache=Dt);let Re=null;const wt=()=>{if(Re)return;Re=new MutationObserver(t=>{let n=!1;t.forEach(a=>{var r,o,s;a.type==="childList"&&((r=a.target.classList)!=null&&r.contains("boards-container")||(o=a.target.classList)!=null&&o.contains("board")||(s=a.target.classList)!=null&&s.contains("boards-navigation"))&&(n=!0)}),n&&Dt()});const e=c(".boards-container");e&&Re.observe(e,{childList:!0,subtree:!0})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",wt):setTimeout(wt,0);const K={mouseX:0,mouseY:0,isDragging:!1,isResizing:!1,isSelecting:!1,isMovingSelection:!1,isDragInProgress:!1,activeNote:null,hoveredBoardButton:null,selectionStartX:0,selectionStartY:0,selectionMoveStartX:0,selectionMoveStartY:0,hoverTimeout:null,holdTimer:null},I={mousemove:new Set,mouseup:new Set,mousedown:new Set,keydown:new Set,click:new Set},un=(e,t,n="default")=>{I[e]||(I[e]=new Set),t._moduleId=n,I[e].add(t)},mn=e=>{Object.values(I).forEach(t=>{t.forEach(n=>{n._moduleId===e&&t.delete(n)})})},Ue=e=>{K.mouseX=e.clientX,K.mouseY=e.clientY,I.mousemove&&I.mousemove.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mousemove handler:",n)}})},ze=e=>{I.mouseup&&I.mouseup.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mouseup handler:",n)}}),K.isDragging=!1,K.isResizing=!1,K.activeNote=null},Fe=e=>{I.mousedown&&I.mousedown.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in mousedown handler:",n)}})},We=e=>{I.keydown&&I.keydown.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in keydown handler:",n)}})},Ke=e=>{I.click&&I.click.forEach(t=>{try{t(e,K)}catch(n){console.error("Error in click handler:",n)}})},$e=()=>{document.removeEventListener("mousemove",Ue),document.removeEventListener("mouseup",ze),document.removeEventListener("mousedown",Fe),document.removeEventListener("keydown",We),document.removeEventListener("click",Ke),document.addEventListener("mousemove",Ue,{passive:!0}),document.addEventListener("mouseup",ze),document.addEventListener("mousedown",Fe),document.addEventListener("keydown",We),document.addEventListener("click",Ke)},gn=()=>{document.removeEventListener("mousemove",Ue),document.removeEventListener("mouseup",ze),document.removeEventListener("mousedown",Fe),document.removeEventListener("keydown",We),document.removeEventListener("click",Ke),Object.keys(I).forEach(e=>{I[e].clear()})};typeof window!="undefined"&&(window.eventManager={registerHandler:un,unregisterModule:mn,initializeEventManager:$e,cleanupEventManager:gn,eventState:K,handlerRegistry:I});$e();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$e):setTimeout($e,0);class fn{constructor(){this.pendingUpdates=new Map,this.rafId=null,this.isProcessing=!1}batchUpdate(t,n,a="normal"){if(!t||!n)return;const r=this.getElementId(t);this.pendingUpdates.has(r)||this.pendingUpdates.set(r,{element:t,styles:{},priority:a,transforms:{}});const o=this.pendingUpdates.get(r);Object.entries(n).forEach(([s,i])=>{s==="transform"||s.startsWith("transform")?o.transforms[s]=i:o.styles[s]=i}),this.getPriorityLevel(a)>this.getPriorityLevel(o.priority)&&(o.priority=a),this.scheduleFlush()}batchTransform(t,n,a,r={}){const o=bt({transform:`translate(${n}px, ${a}px)`},r);this.batchUpdate(t,o,"high")}batchMultiple(t){t.forEach(({element:n,styles:a,priority:r})=>{this.batchUpdate(n,a,r)})}scheduleFlush(){this.rafId||this.isProcessing||(this.rafId=requestAnimationFrame(()=>{this.flush()}))}flush(){if(!this.isProcessing){this.isProcessing=!0,this.rafId=null;try{Array.from(this.pendingUpdates.values()).sort((n,a)=>this.getPriorityLevel(a.priority)-this.getPriorityLevel(n.priority)).forEach(({element:n,styles:a,transforms:r})=>{n.isConnected&&(Object.entries(a).forEach(([o,s])=>{n.style[o]=s}),Object.entries(r).forEach(([o,s])=>{n.style[o]=s}))}),this.pendingUpdates.clear()}catch(t){console.warn("Animation batch flush error:",t)}finally{this.isProcessing=!1}}}forceFlush(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.flush()}clearElement(t){const n=this.getElementId(t);this.pendingUpdates.delete(n)}clearAll(){this.pendingUpdates.clear(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}getElementId(t){return t._batcherId||(t._batcherId=`element_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),t._batcherId}getPriorityLevel(t){switch(t){case"high":return 3;case"normal":return 2;case"low":return 1;default:return 2}}getStats(){return{pendingUpdates:this.pendingUpdates.size,isProcessing:this.isProcessing,hasScheduledFlush:!!this.rafId}}}window.animationBatcher=new fn;const he={updatePosition(e,t,n){window.animationBatcher.batchUpdate(e,{left:`${t}px`,top:`${n}px`},"high")},updateSize(e,t,n){window.animationBatcher.batchUpdate(e,{width:`${t}px`,height:`${n}px`},"high")},updateOpacity(e,t){window.animationBatcher.batchUpdate(e,{opacity:t.toString()},"normal")},updateZIndex(e,t){window.animationBatcher.batchUpdate(e,{zIndex:t.toString()},"low")},updateStyles(e,t,n="normal"){window.animationBatcher.batchUpdate(e,t,n)}};window.AnimationUtils=he;class hn{constructor(){this.pendingSaves=new Map,this.debounceTimers=new Map,this.defaultDelay=300,this.isProcessing=!1}debounceSave(t,n,a=this.defaultDelay,r="normal"){if(r==="immediate"){this.saveImmediately(t,n);return}this.pendingSaves.set(t,{data:n,priority:r,timestamp:Date.now()}),this.debounceTimers.has(t)&&clearTimeout(this.debounceTimers.get(t));const o=setTimeout(()=>{this.executeSave(t)},a);this.debounceTimers.set(t,o)}saveImmediately(t,n){try{const a=typeof n=="string"?n:JSON.stringify(n);localStorage.setItem(t,a),this.pendingSaves.delete(t),this.debounceTimers.has(t)&&(clearTimeout(this.debounceTimers.get(t)),this.debounceTimers.delete(t))}catch(a){console.warn(`Failed to save to localStorage (key: ${t}):`,a)}}executeSave(t){if(!this.pendingSaves.has(t))return;const{data:n}=this.pendingSaves.get(t);this.saveImmediately(t,n)}flushAll(){this.debounceTimers.forEach(t=>clearTimeout(t)),this.debounceTimers.clear(),this.pendingSaves.forEach(({data:t},n)=>{try{const a=typeof t=="string"?t:JSON.stringify(t);localStorage.setItem(n,a)}catch(a){console.warn(`Failed to flush localStorage (key: ${n}):`,a)}}),this.pendingSaves.clear()}cancelSave(t){this.debounceTimers.has(t)&&(clearTimeout(this.debounceTimers.get(t)),this.debounceTimers.delete(t)),this.pendingSaves.delete(t)}getStatus(){return{pendingSaves:Array.from(this.pendingSaves.keys()),activeTimers:this.debounceTimers.size,isProcessing:this.isProcessing}}clear(){this.debounceTimers.forEach(t=>clearTimeout(t)),this.debounceTimers.clear(),this.pendingSaves.clear()}}window.storageDebouncer=new hn;const pn={save(e,t,n=300){window.storageDebouncer.debounceSave(e,t,n,"normal")},saveImmediate(e,t){window.storageDebouncer.saveImmediately(e,t)},saveHigh(e,t){window.storageDebouncer.debounceSave(e,t,100,"high")},saveLow(e,t){window.storageDebouncer.debounceSave(e,t,1e3,"low")},load(e,t=null){try{const n=localStorage.getItem(e);if(n===null)return t;try{return JSON.parse(n)}catch(a){return n}}catch(n){return console.warn(`Failed to load from localStorage (key: ${e}):`,n),t}},remove(e){window.storageDebouncer.cancelSave(e);try{localStorage.removeItem(e)}catch(t){console.warn(`Failed to remove from localStorage (key: ${e}):`,t)}},flush(){window.storageDebouncer.flushAll()}};window.DebouncedStorage=pn;window.addEventListener("beforeunload",()=>{window.storageDebouncer.flushAll()});document.addEventListener("visibilitychange",()=>{document.hidden&&window.storageDebouncer.flushAll()});const we=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],A={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let B=[];let It=null,Nt=null;let ue=null;let M=[],vn=!1;let se=[];const re={},ie={},W={};let le=1e3;re[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};ie[1]=we[0];let m=1,C=1;const Se=9,N="stickyNotes_active",me="stickyNotes_deleted",Je="stickyNotes_boardCount",Ze="stickyNotes_zIndexes",y=e=>parseInt(String(e).replace("px",""))||0,Ye=(e,t,n=150)=>{const a=c(`.board[data-board-id="${m}"]`);if(!a)return!1;const r=a.querySelectorAll(".sticky-note"),o=20;for(const s of r){const i=y(s.style.left),l=y(s.style.top),f=y(s.style.width)||200,d=e<i+f+o&&e+200>i-o,p=t+n,u=l+30,g=t<u&&p>l-o;if(d&&g)return!0}return!1},St=(e,t)=>{const n=Math.random()*10-5;let a=e+n,r=t+70;const o=5,s=window.innerWidth-200,i=window.innerHeight-300,l=20;let f=0;for(;f<l&&Ye(a,r);)r+=40,f++,f>10&&(a=e+250,r=50,f=0);if(r>i){for(r=50,a=e+250;f<l&&Ye(a,r);)r+=40,f++;if(a>s)for(a=o+50,r=50,f=0;f<l&&Ye(a,r);)r+=40,f++}const d=Math.min(Math.max(a,o),s),p=Math.min(Math.max(r,o),window.innerHeight-100);return{x:d,y:p}},yn=e=>{if(e.startsWith("rgba")){const n=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return n?{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])}:null}e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,a,r,o)=>a+a+r+r+o+o);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},nt=(e,t,n=!1)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(a){console.error(`Failed to save to localStorage (${e}):`,a)}},Y=(e=!1)=>{const t=te();window.DebouncedStorage?e?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,t):window.DebouncedStorage.saveLow(`${N}_board_${m}`,t):nt(`${N}_board_${m}`,t,e),typeof J=="function"&&J()},te=()=>{const e=c(`.board[data-board-id="${m}"]`);if(!e)return[];const t=e.querySelectorAll(".sticky-note");return Array.from(t).map(n=>({content:n.querySelector(".sticky-content").textContent,x:y(n.style.left),y:y(n.style.top),color:n.style.backgroundColor||"#ffeb3b",width:n.style.width||"200px",height:n.style.height||"150px",isBold:n.querySelector(".sticky-content").classList.contains("bold"),noteId:n.dataset.noteId,zIndex:n.style.zIndex||1}))},Ae=()=>{window.DebouncedStorage?window.DebouncedStorage.saveLow(me,B):nt(me,B)},Bt=()=>{window.DebouncedStorage?window.DebouncedStorage.save(Je,C.toString()):localStorage.setItem(Je,C.toString())},At=()=>{const e={color:A.colors.current,pattern:A.patterns.current};window.DebouncedStorage?window.DebouncedStorage.saveLow(`boardStyles_board_${m}`,e):nt(`boardStyles_board_${m}`,e)},Ht=()=>{const e=c("#shortcutIcon");if(!e)return;const t=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";e.innerHTML=t,e.className="shortcut-icon focus-hint"},_t=()=>{const e=c(".note-input textarea");if(!e)return;const t=c("#shortcutIcon"),n=()=>{if(!t)return;const a=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",r=e.value.trim();t.innerHTML=r?`${a}+\u21B5`:a,t.classList.toggle("focus-hint",!r),t.classList.toggle("enter-hint",r)};e.addEventListener("focus",()=>{n(),e.style.height="50px",requestAnimationFrame(()=>e.style.height="200px"),e.addEventListener("input",n)}),e.addEventListener("blur",()=>{Ht(),e.style.height="200px",requestAnimationFrame(()=>e.style.height="50px"),e.removeEventListener("input",n)}),document.addEventListener("mousedown",a=>{!a.target.closest(".note-input")&&document.activeElement===e&&e.blur()})},Et=(e,t=null)=>{try{return JSON.parse(e)}catch(n){return console.error("Failed to parse JSON data:",n),t}},bn=()=>{const e="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(e))try{const t=[];for(let n=0;n<localStorage.length;n++){const a=localStorage.key(n);a&&(a.startsWith("stickyNotes_deleted")||a.startsWith("stickyNotes_zIndexes")||a.startsWith("boardColor_")||a.startsWith("boardPattern_")||a.startsWith("boardStyles_")||a.startsWith("emojiStickers_")||a.startsWith("daysPatternStartDate_")||a.startsWith("emojiUsageOrder"))&&t.push(a)}t.forEach(n=>{localStorage.removeItem(n)}),localStorage.setItem(e,"true")}catch(t){console.error("Error during localStorage cleanup:",t),localStorage.setItem(e,"true")}},jt=()=>{try{if(typeof Te!="function"){setTimeout(jt,50);return}window.DebouncedStorage&&window.DebouncedStorage.flush(),bn(),typeof Lt=="function"&&Lt();const e=localStorage.getItem(Je);if(e){const n=parseInt(e);if(!isNaN(n)&&n>0){C=Math.min(n,Se);for(let a=2;a<=C;a++)typeof et=="function"&&et(a)}}typeof Ne=="function"&&Ne();for(let n=1;n<=C;n++){const a=localStorage.getItem(`${N}_board_${n}`);if(a){const r=Et(a,[]);Array.isArray(r)&&r.forEach(o=>{if(o&&typeof o=="object"&&(o.text||o.content)){re[n]={x:y(o.x),y:y(o.y)},ie[n]=o.color||we[0];const s=o.text||o.content,i=Te(s,o.color||we[0],y(o.x),y(o.y),!0,o.width||"200px",o.height||"150px",o.isBold||!1,n);i&&o.noteId&&(i.dataset.noteId=o.noteId,W[o.noteId]?(i.style.zIndex=W[o.noteId],W[o.noteId]>le&&(le=W[o.noteId])):o.zIndex&&!isNaN(parseInt(o.zIndex))&&(i.style.zIndex=o.zIndex,W[o.noteId]=parseInt(o.zIndex),parseInt(o.zIndex)>le&&(le=parseInt(o.zIndex))))}})}typeof ke=="function"&&ke(n)}typeof G=="function"&&G(1);const t=localStorage.getItem(me);if(t){const n=Et(t,[]);Array.isArray(n)&&(B=n,typeof pe=="function"&&pe())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(n=>{typeof window[n]=="function"&&window[n]()}),Ht(),_t()}catch(e){console.error("Critical error loading saved data:",e)}},de=()=>++le,wn=e=>{e.style.zIndex=de();const t=e.dataset.noteId;t&&(W[t]=le,Ot())},Ot=()=>{try{window.DebouncedStorage?window.DebouncedStorage.saveLow(Ze,W):localStorage.setItem(Ze,JSON.stringify(W))}catch(e){console.error("Error saving note z-indexes:",e)}},Sn=()=>{try{const e=localStorage.getItem(Ze);e&&(Object.assign(W,JSON.parse(e)),le=Math.max(1e3,...Object.values(W)))}catch(e){console.error("Error loading note z-indexes:",e)}};const Lt=()=>{ue=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(ue.style,{display:"none"}),document.body.appendChild(ue)};function En(){const e=c(".boards-container"),t=n=>{n.target.closest(".board")&&!n.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&n.preventDefault()};window.EventManager?window.EventManager.registerHandler("mousedown",t):document.addEventListener("mousedown",t),window.EventManager?window.EventManager.registerHandler("mousedown",xt,e):e.addEventListener("mousedown",xt),window.eventManager&&(window.eventManager.registerHandler("mousemove",Ln,"selection"),window.eventManager.registerHandler("mouseup",xn,"selection"))}function xt(e){if(e.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;e.preventDefault();const t=c(".note-input textarea");t&&document.activeElement===t&&t.blur(),!e.shiftKey&&He();const n=window.eventManager?window.eventManager.eventState:{};[n.isSelecting,n.selectionStartX,n.selectionStartY]=[!0,e.clientX,e.clientY],document.body.classList.add("selecting"),ue.style.cssText=`left:${n.selectionStartX}px; top:${n.selectionStartY}px; width:0; height:0; display:block;`}function Ln(e,t){if(!t.isSelecting)return;e.preventDefault();const n=t.selectionStartX,a=t.selectionStartY,r=e.clientX,o=e.clientY;he.updateStyles(ue,{left:`${Math.min(n,r)}px`,top:`${Math.min(a,o)}px`,width:`${Math.abs(r-n)}px`,height:`${Math.abs(o-a)}px`},"high"),kn()}const xn=(e,t)=>{t.isSelecting&&(t.isSelecting=!1,document.body.classList.remove("selecting"),ue.style.display="none")};function kn(){const e=ue.getBoundingClientRect(),t=c(`.board[data-board-id="${m}"]`);if(!t)return;const n=(a,r,o)=>{const s=a.getBoundingClientRect(),i=!(s.right<e.left||s.left>e.right||s.bottom<e.top||s.top>e.bottom),l=r.indexOf(a);i?l===-1&&(r.push(a),a.classList.add(o)):!vn&&l!==-1&&(r.splice(l,1),a.classList.remove(o))};t.querySelectorAll(".sticky-note").forEach(a=>n(a,M,"selected"))}const He=()=>{M.forEach(e=>e.classList.remove("selected")),M=[]};function Mn(e){const t=window.eventManager?window.eventManager.eventState:{};[t.isMovingSelection,t.selectionMoveStartX,t.selectionMoveStartY]=[!0,e.clientX,e.clientY],document.body.classList.add("selecting"),se=M.map(n=>({element:n,x:y(n.style.left),y:y(n.style.top),type:"note"})),window.eventManager&&(window.eventManager.registerHandler("mousemove",Cn,"selection-move"),window.eventManager.registerHandler("mouseup",$n,"selection-move"))}function Cn(e,t){if(!t.isMovingSelection)return;const[n,a]=[e.clientX-t.selectionMoveStartX,e.clientY-t.selectionMoveStartY],[r,o,s]=[5,-5,-5],[i,l]=[window.innerWidth-r,window.innerHeight-r];(d=>d.forEach(p=>{const[u,g]=[Math.min(Math.max(p.x+n,o),i-p.element.offsetWidth/4),Math.min(Math.max(p.y+a,s),l-p.element.offsetHeight/4)];he.updatePosition(p.element,u,g)}))(se),M.length>0&&(qt(e.clientX,e.clientY),M.length>1&&it())}function $n(e,t){if(!t.isMovingSelection)return;if(t.isMovingSelection=!1,document.body.classList.remove("selecting"),window.eventManager&&window.eventManager.unregisterModule("selection-move"),xe(),!zt().moved){Y();for(let a=M.length-1;a>=0;a--)Pt(M[a])&&M.splice(a,1)}ct()}let be=[];const Tn=100,kt=50,Dn="#ffd700",In=()=>{const[e,t]=[c("#trashModal"),c(".clear-trash-btn")];e&&!e.classList.contains("visible")&&(e.style.display="block",e.classList.add("visible"),requestAnimationFrame(()=>_e())),t&&(t.classList.add("shake-animation"),setTimeout(()=>t.classList.remove("shake-animation"),1e3))},ot=e=>{M.includes(e)&&M.length>1?(M.forEach((t,n)=>setTimeout(()=>Ve(t),n*100)),He()):Ve(e)},Ve=e=>{if(B.length>=Tn){!be.includes(e)&&be.push(e),In();return}e._eventCleanup&&e._eventCleanup();const t=e.querySelector(".sticky-content"),n={text:t.innerHTML,color:e.style.backgroundColor,x:e.style.left,y:e.style.top,width:e.style.width,height:e.style.height,timestamp:new Date().toLocaleString(),isBold:t.classList.contains("bold")};Nn(e),B.unshift(n),window.DebouncedStorage?window.DebouncedStorage.saveLow(me,B):Ae(),pe(),Bn(e)},Nn=e=>{if(!window.noteColumns)return;const t=e.closest(".board");if(!t||!t.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[n,a]=[t.getBoundingClientRect(),e.getBoundingClientRect()],r=Math.min(5,Math.max(0,Math.floor((a.left+a.width/2-n.left)/(n.width/6))));window.noteColumns[r]&&(window.noteColumns[r]=window.noteColumns[r].filter(o=>Math.abs(o.x-y(e.style.left))>1||Math.abs(o.y-y(e.style.top))>1))},Bn=e=>{const t=c(".trash-bin"),n=t.getBoundingClientRect(),a=e.getBoundingClientRect(),r=n.left-a.left+n.width/2-a.width/2,o=n.top-a.top;e.style.setProperty("--throwX",`${r}px`),e.style.setProperty("--throwY",`${o}px`),e.style.animation="paperCrumble 0.6s ease-in forwards",t.style.animation="binShake 0.6s ease-in-out",setTimeout(()=>{e.remove(),t.style.animation="",Y(),J()},600)},Pt=e=>{const[t,n]=[c(".trash-bin").getBoundingClientRect(),e.getBoundingClientRect()];return n.right>t.left&&n.left<t.right&&n.bottom>t.top&&n.top<t.bottom?(ot(e),!0):!1},Ee=()=>{const e=document.getElementById("trashModal");e.classList.toggle("visible")?(e.style.display="block",requestAnimationFrame(()=>_e())):setTimeout(()=>e.style.display="none",300)},_e=()=>{const e=c(".deleted-notes-container");e.style.minHeight="200px",e.innerHTML=B.length?B.map((t,n)=>`
            <div class="deleted-note" style="background-color: ${t.color||Dn}">
                <div class="deleted-note-content ${t.isBold?"bold":""}">${t.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${n})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},An=e=>{const t=k(".deleted-note")[e];t==null||t.classList.add("shrinking"),setTimeout(()=>{const[n]=B.splice(e,1);Te(n.text,n.color,y(n.x),y(n.y),!0,n.width,n.height,n.isBold),window.DebouncedStorage?window.DebouncedStorage.saveLow(me,B):Ae(),pe(),_e(),window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(),J()},300)},Rt=()=>{if(B.length===0){Ee();return}const e=[...k(".deleted-note")].slice(0,6);e.forEach((t,n)=>{t.classList.add("note-deleting"),t.style.animationDelay=`${n*kt}ms`}),setTimeout(()=>{B=[],window.DebouncedStorage?window.DebouncedStorage.saveLow(me,B):Ae(),pe(),_e(),setTimeout(()=>{if(Ee(),be.length){const t=[...be];be=[],setTimeout(()=>{t.forEach(n=>{n!=null&&n.parentNode&&Ve(n)})},300)}},200)},(e.length?(e.length-1)*kt+300:0)+100)},pe=()=>{c(".trash-count").textContent=B.length};document.addEventListener("click",e=>{const t=c("#trashModal");t!=null&&t.classList.contains("visible")&&e.target===t&&Ee()});let at=new Set;const st=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Hn=()=>Math.random()*40-20,_n=(e=je())=>e.getDay()===0?0:e.getDay()-1;function Xe(e){const t=document.getElementById("noteLimitMessage"),n=t==null?void 0:t.querySelector(".transfer-text");n&&(n.textContent=e),t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),3e3))}function rt(){const e=c(".note-input textarea"),t=e.value.trim();if(!t)return;const n=c(`.board[data-board-id="${m}"]`),a=Array.from(n.querySelectorAll(".sticky-note")),[r,o,s]=[n.classList.contains("board-pattern-weekdays"),n.classList.contains("board-pattern-days"),a.filter(v=>!v.dataset.transferred).length===0];if(!r&&!o&&a.length>=30){Xe("Maximum notes space reached.");return}const i=a.filter(v=>!v.dataset.transferred),l=i[i.length-1];let{x:f,y:d}=re[m]||{x:0,y:0},p=ie[m]||getRandomColor(),u,g;const E=(v,w,O=null)=>{const $=n.offsetWidth/w,P=v*$+10,Z=(v+1)*$-210,V=Math.max(P,Math.min(Z,P+Hn())),_=Array.from(n.querySelectorAll(".sticky-note")).filter(q=>q.style.display!=="none"&&q!==O),[j,ne]=[v*$,(v+1)*$],R=_.filter(q=>{const[U,oe]=[y(q.style.left),y(q.style.left)+200],[ae,ce]=[Math.max(U,j),Math.min(oe,ne)];return Math.max(0,ce-ae)/200>.5});return{positionX:V,columnNotes:R}},x=(v,w)=>{const O=window.innerHeight-300;for(let $=0;$<w;$++){const P=(v+$)%w,{positionX:Z,columnNotes:V}=E(P,w);let _=0,j=null;V.forEach(R=>{const q=y(R.style.top);q>_&&(_=q,j=R)});const ne=j?_+70:60;if(ne<=O)return u=Z,g=ne,j&&(p=j.style.backgroundColor),!0}return Xe("Maximum notes space reached."),!1},X=v=>{let w;const O=v?6:5;if(l){const $=y(l.style.left),P=n.offsetWidth/O;w=Math.floor($/P),w=Math.max(0,Math.min(w,O-1))}else w=v?_n():dt(m)||0;return x(w,O)};if(s)if(r||o){if(X(r)===!1)return}else{const v=Math.max(150,window.innerWidth/4);({x:u,y:g}=St(v,50-70))}else if(r||o){if(X(r)===!1)return}else if(l&&([f,d,p]=[y(l.style.left),y(l.style.top),l.style.backgroundColor]),{x:u,y:g}=St(f,d),g<=50){const v=a.filter(w=>Math.abs(y(w.style.left)-u)<150);if(v.length>0){const w=v.map(_=>y(_.style.top)),[O,$]=[Math.max(...w),Math.min(...w)],P=window.innerHeight-300,[Z,V]=[O+200,$-200];if(Z<=P)g=Z;else if(V>=50)g=V;else{const _=(ne,R)=>{const q=window.innerWidth-200;for(let U=ne;R>0?U<=q:U>=55;U+=R*250){const oe=a.filter(ye=>Math.abs(y(ye.style.left)-U)<150);if(oe.length===0)return{x:U,y:50};const ae=oe.map(ye=>y(ye.style.top)),[ce,ve]=[Math.max(...ae),Math.min(...ae)],[ge,Me]=[ce+200,ve-200];if(ge<=P)return{x:U,y:ge};if(Me>=50)return{x:U,y:Me}}return null},j=_(u+250,1)||_(u-250,-1);if(j)[u,g]=[j.x,j.y];else{Xe("Maximum notes space reached.");return}}}}Te(t.replace(/\n/g,"<br>"),p,u,g,!1,"200px","150px",!1,m),[re[m],ie[m],e.value]=[{x:u,y:g},p,""],n.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(v=>{delete v.dataset.transferred}),window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(!0),J()}function Te(e,t,n,a,r=!1,o="200px",s="150px",i=!1,l=m,f=!1){const[d,p]=[document.createElement("div"),st()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${i?"bold":""}" contenteditable="true">${e}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${t}">
                <div class="color-palette">${we.map(v=>`<div class="color-option" style="background-color: ${v}" onclick="changeNoteColor(this, '${v}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${i?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let u;const g=c(`.board[data-board-id="${l}"]`),E=g&&(g.classList.contains("board-pattern-weekdays")||g.classList.contains("board-pattern-days"));u=de(),d.style.cssText=`background-color:${t}; left:${n}px; top:${a}px; width:${o}; height:${s}; z-index:${u};`,d.dataset.noteId=p,f&&(d.dataset.repositioned="true",at.add(p)),W[p]=u,Ot();const x=v=>{v.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||wn(d)};d.addEventListener("click",x),d._eventCleanup=()=>{d.removeEventListener("click",x)},Pn(d);const X=c(`.board[data-board-id="${l}"]`);return X?(X.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",r||(window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(!0)),d):(console.error(`Board element with ID ${l} not found.`),null)}function jn(e,t){event.stopPropagation();const n=e.closest(".sticky-note");(n.classList.contains("selected")?k(".sticky-note.selected"):[n]).forEach(r=>{const o=r.querySelector(".color-button");[r,o].forEach(s=>s.classList.add("color-transition")),[r.style.backgroundColor,o.style.backgroundColor]=[t,t],setTimeout(()=>[r,o].forEach(s=>s.classList.remove("color-transition")),300)}),ie[m]=t,window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(!0)}const Yt=e=>{e.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),e.classList.toggle("active"),window.DebouncedStorage?window.DebouncedStorage.saveLow(`${N}_board_${m}`,te()):Y()},On=c("#shortcutIcon")||c(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),Xt=()=>{On.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};Xt();c(".note-input textarea").addEventListener("keydown",e=>{e.key==="Enter"&&(e.shiftKey||e.metaKey||e.ctrlKey)&&(e.preventDefault(),rt())});let T=null,Le=!1,Ge=!1;function Pn(e){let t=!1,n=!1,a=!1,r,o,s,i,l,f,d;const[p,u,g]=[".color-button",".color-palette",".sticky-content"].map(h=>e.querySelector(h)),E=()=>Y(),x=[],X=()=>Y(),v=()=>Y();window.EventManager?(window.EventManager.registerHandler("blur",X,g),window.EventManager.registerHandler("input",v,g)):(g.addEventListener("blur",X),g.addEventListener("input",v)),x.push({element:g,event:"blur",handler:X},{element:g,event:"input",handler:v});const w=h=>{a&&!g.contains(h.target)&&([a,g.contentEditable]=[!1,"false"],g.blur(),window.EventManager?window.EventManager.unregisterHandler("click",w):document.removeEventListener("click",w))},O=h=>{[a,g.contentEditable]=[!0,"true"],setTimeout(()=>{const[L,b]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const S=document.caretRangeFromPoint(h.clientX,h.clientY);S&&(b.removeAllRanges(),b.addRange(S))}else if(document.caretPositionFromPoint){const S=document.caretPositionFromPoint(h.clientX,h.clientY);S&&(L.setStart(S.offsetNode,S.offset),L.collapse(!0),b.removeAllRanges(),b.addRange(L))}g.focus()},0),setTimeout(()=>{window.EventManager?window.EventManager.registerHandler("click",w):document.addEventListener("click",w)},0),h.stopPropagation()};window.EventManager?window.EventManager.registerHandler("dblclick",O,g):g.addEventListener("dblclick",O),x.push({element:g,event:"dblclick",handler:O});let $=null,P=!1;const Z=()=>{!t&&!n&&(P=!0,$=e.style.zIndex||"1",he.updateZIndex(e,de()))},V=()=>{!t&&!n&&$!==null&&(P=!1,he.updateZIndex(e,de()),$=null)};window.EventManager?(window.EventManager.registerHandler("mouseenter",Z,e),window.EventManager.registerHandler("mouseleave",V,e)):(e.addEventListener("mouseenter",Z),e.addEventListener("mouseleave",V)),x.push({element:e,event:"mouseenter",handler:Z},{element:e,event:"mouseleave",handler:V});const _=()=>g.contentEditable="false",j=h=>{if(h.key==="Enter")if(h.preventDefault(),h.shiftKey)g.contentEditable="false",E();else{const[L,b]=[window.getSelection(),window.getSelection().getRangeAt(0)],S=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});b.deleteContents(),b.insertNode(S),b.setStartAfter(S),b.collapse(!0),L.removeAllRanges(),L.addRange(b)}};window.EventManager?(window.EventManager.registerHandler("blur",_,g),window.EventManager.registerHandler("keydown",j,g)):(g.addEventListener("blur",_),g.addEventListener("keydown",j)),x.push({element:g,event:"blur",handler:_},{element:g,event:"keydown",handler:j});const ne=()=>{const h=e.getBoundingClientRect();re[m]={x:h.left,y:h.top}};let R=null;const q=(h,L)=>{const[b,S]=[L.mouseX,L.mouseY];if(!u.classList.contains("visible"))return;const[Q,ee]=[u.getBoundingClientRect(),p.getBoundingClientRect()],[fe,Pe]=[b>=Q.left-20&&b<=Q.right+20&&S>=Q.top-20&&S<=Q.bottom+20,b>=ee.left&&b<=ee.right&&S>=ee.top&&S<=ee.bottom];fe||Pe?clearTimeout(R):oe()};window.eventManager&&window.eventManager.registerHandler("mousemove",q,`palette-${e.dataset.noteId||Date.now()}`);const U=()=>{clearTimeout(R),u.classList.remove("closing"),u.classList.add("visible"),k(".color-palette").forEach(h=>{h!==u&&(h.classList.add("closing"),setTimeout(()=>h.classList.remove("visible","closing"),180))})},oe=()=>{clearTimeout(R),R=setTimeout(()=>{u.classList.add("closing"),setTimeout(()=>u.classList.contains("closing")&&u.classList.remove("visible","closing"),180)},50)},ae=h=>{h.stopPropagation(),u.classList.contains("visible")?oe():U()},ce=h=>{h.target.classList.contains("color-option")&&h.stopPropagation()};window.EventManager?(window.EventManager.registerHandler("click",ae,p),window.EventManager.registerHandler("click",ce,u)):(p.addEventListener("click",ae),u.addEventListener("click",ce)),x.push({element:p,event:"click",handler:ae},{element:u,event:"click",handler:ce});const ve=()=>clearTimeout(R),ge=()=>oe();window.EventManager?(window.EventManager.registerHandler("mouseenter",ve,u),window.EventManager.registerHandler("mouseleave",ge,u)):(u.addEventListener("mouseenter",ve),u.addEventListener("mouseleave",ge)),x.push({element:u,event:"mouseenter",handler:ve},{element:u,event:"mouseleave",handler:ge});const Me=(h,L,b)=>{if(!h.target.closest(".color-palette, .done-button")){if(M.includes(e)&&M.length>1){Mn(h);return}h.shiftKey?M.includes(e)||(M.push(e),e.classList.add("selected")):He(),h.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],P?$=de():he.updateZIndex(e,de()),[r,o]=[L,b],h.target.closest(".resize-handle")?[n,l,f]=[!0,e.offsetWidth,e.offsetHeight]:([s,i]=[y(e.style.left),y(e.style.top)],[e.dataset.originalX,e.dataset.originalY]=[s,i],d=setTimeout(()=>t=!0,150)),window.eventManager?window.eventManager.eventState.activeNote=e:window.activeNote=e}},ye=(h,L)=>{if(!L.activeNote||L.activeNote!==e)return;const[b,S]=[h.clientX,h.clientY];if((Math.abs(b-r)>5||Math.abs(S-o)>5)&&(clearTimeout(d),!t&&!n&&(t=!0)),t){L.isDragInProgress||(L.isDragInProgress=!0,document.body.classList.add("drag-in-progress"));const Q=5;let[ee,fe]=[Math.min(Math.max(s+b-r,-Q),window.innerWidth-e.offsetWidth/4),Math.min(Math.max(i+S-o,-Q),window.innerHeight-e.offsetHeight/4)];window.AnimationBatcher?window.AnimationBatcher.batchStyleUpdate(e,{left:`${ee}px`,top:`${fe}px`}):(e.style.left=`${ee}px`,e.style.top=`${fe}px`),it(),qt(b,S)}if(n){const[Q,ee]=[150,150],[fe,Pe]=[window.innerWidth-y(e.style.left)+50,window.innerHeight-y(e.style.top)+50],ht=Math.min(Math.max(l+b-r,Q),fe),pt=Math.min(Math.max(f+S-o,ee),Pe);window.AnimationBatcher?window.AnimationBatcher.batchStyleUpdate(e,{width:`${ht}px`,height:`${pt}px`}):(e.style.width=`${ht}px`,e.style.height=`${pt}px`)}},on=(h,L)=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(t||n)&&t){if(xe(),!zt().moved){ne(),Pt(e),Yn(e);const S=e.dataset.noteId||st();[e.dataset.noteId,e.dataset.repositioned]=[S,"true"],at.add(S),re[m]={x:y(e.style.left),y:y(e.style.top)},ie[m]=e.style.backgroundColor,J(),ct(),L.activeNote=null,window.activeNote&&(window.activeNote=null)}window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(),[L.isDragInProgress,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[t,n]=[!1,!1],xe()},Oe=h=>Me(h,h.clientX,h.clientY);window.EventManager?window.EventManager.registerHandler("mousedown",Oe,e):e.addEventListener("mousedown",Oe),window.eventManager&&(window.eventManager.registerHandler("mousemove",ye,`note-${e.dataset.noteId||Date.now()}`),window.eventManager.registerHandler("mouseup",on,`note-${e.dataset.noteId||Date.now()}`)),x.push({element:e,event:"mousedown",handler:Oe});const gt=`note-${e.dataset.noteId||Date.now()}`,ft=`palette-${e.dataset.noteId||Date.now()}`;if(e._eventCleanup){const h=e._eventCleanup;e._eventCleanup=()=>{h(),x.forEach(({element:L,event:b,handler:S})=>{L.removeEventListener(b,S)}),window.eventManager&&(window.eventManager.unregisterModule(gt),window.eventManager.unregisterModule(ft))}}else e._eventCleanup=()=>{x.forEach(({element:h,event:L,handler:b})=>{h.removeEventListener(L,b)}),window.eventManager&&(window.eventManager.unregisterModule(gt),window.eventManager.unregisterModule(ft))}}function Rn(){k(".color-palette").forEach(e=>{e.style.display!=="none"&&(e.classList.add("closing"),setTimeout(()=>{e.style.display="none",e.classList.remove("closing")},200))}),Nt=null}const Mt=e=>{Nt&&!e.target.closest(".color-button")&&Rn()};window.EventManager?window.EventManager.registerHandler("click",Mt):document.addEventListener("click",Mt);function Yn(e){if(!e)return;const[t,n,a,r]=[e.getBoundingClientRect(),window.innerHeight,250,150],o=n-r,[s,i]=[t.bottom>o,t.left<a&&t.bottom>o];if(i){const[l,f,d]=[t.bottom-o+20,y(e.style.top),Math.max(60,y(e.style.top)-(t.bottom-o+20))];e.style.transition="top 0.3s ease-out",e.style.top=`${d}px`,setTimeout(()=>e.style.transition="",300)}}function qt(e,t){var u,g;if(Ge)return;const n=c(".status-bar");if(!n)return;const a=n.getBoundingClientRect(),[r,o]=[Math.max(0,Math.max(a.left-e,e-a.right)),Math.max(0,Math.max(a.top-t,t-a.bottom))],[s,i,l,f]=[Math.sqrt(r*r+o*o),120,80,T!==null],d=f?s<=i:s<=l,p=()=>{let[E,x]=[null,1/0];return k(".board-button:not(.disabled)",!0).forEach(X=>{const v=X.getBoundingClientRect(),w=Math.sqrt(Math.pow(e-(v.left+v.width/2),2)+Math.pow(t-(v.top+v.height/2),2));w<x&&([E,x]=[X,w])}),E};if(d!==f)if(d){const E=k(".board-button:not(.disabled)");T=p(),E.forEach(x=>x.classList.add("drag-active","drag-proximity")),T&&T.classList.add("drag-hover"),Xn()}else k(".board-button",!0).forEach(E=>{E.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>E.classList.remove("drag-active"),200)}),T=null,Ut();else if(d&&T){const E=p();E!==T&&(T==null||T.classList.remove("drag-hover"),T=E,E?(E.classList.add("drag-hover"),xe(),(u=c(".shortcut-hint"))==null||u.classList.add("hidden-during-drag")):(it(),Le||(g=c(".shortcut-hint"))==null||g.classList.remove("hidden-during-drag")))}}function Xn(){var a,r;if(!T)return;const e=((r=(a=window.eventManager)==null?void 0:a.eventState)==null?void 0:r.activeNote)||window.activeNote||It,[t,n]=[T.getBoundingClientRect(),M.length>0?M:e?[e]:[]];n.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(d=>{[d.style.userSelect,d.style.pointerEvents]=["none","none"]});const[s,i]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[l,f]=[t.left-i.left+t.width/2-(s.left-i.left)-s.width/2,t.top-i.top+t.height/2-(s.top-i.top)-s.height/2];o.style.setProperty("--suckX",`${l}px`),o.style.setProperty("--suckY",`${f}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function Ut(){k(".hover-animating",!0).forEach(e=>{e.querySelectorAll("textarea, [contenteditable]").forEach(t=>{t.style.removeProperty("user-select"),t.style.removeProperty("pointer-events")}),e.style.animation="noteSuckReverse 0.3s ease-out forwards",e.classList.remove("hover-animating"),e.classList.add("reverse-animating"),setTimeout(()=>{e.classList.contains("reverse-animating")&&([e.style.animation]=["none"],e.style.removeProperty("--suckX"),e.style.removeProperty("--suckY"),e.classList.remove("reverse-animating"))},300)})}function it(){var e;if(C>1&&!Le&&!T){const t=document.getElementById("dragTransferMessage");t&&(t.classList.add("visible"),Le=!0),(e=c(".shortcut-hint"))==null||e.classList.add("hidden-during-drag")}}function xe(){var e;if(Le){const t=document.getElementById("dragTransferMessage");t&&(t.classList.remove("visible"),Le=!1),(e=c(".shortcut-hint"))==null||e.classList.remove("hidden-during-drag")}}function ct(){k(".board-button",!0).forEach(e=>e.classList.remove("drag-hover","drag-proximity")),[T]=[null],Ut(),xe()}function zt(){var r,o;if(!T)return{moved:!1};const e=((o=(r=window.eventManager)==null?void 0:r.eventState)==null?void 0:o.activeNote)||window.activeNote||It,[t,n]=[parseInt(T.dataset.boardId),M.length>0?[...M]:[e]];if(t===m)return n.forEach(s=>{if(s){const i=se==null?void 0:se.find(l=>l.element===s);i?(s.style.left=`${i.x}px`,s.style.top=`${Math.max(60,i.y)}px`):s.style.top=`${parseInt(s.style.top||0)-250}px`}}),{moved:!1};let a=new Map;return n.length>1&&typeof se!="undefined"&&se.length>0&&se.forEach(s=>{s&&n.includes(s.element)&&a.set(s.element,{originalX:s.x,originalY:s.y})}),n.forEach(s=>{s&&qn(s,t,a.size>0?a.get(s):null)}),M.length>0&&He(),{moved:!0}}function qn(e,t,n=null){const a=e.style.left;if(e.classList.contains("hover-animating"))e.style.animation="noteSuckComplete 0.3s ease-in forwards",e.classList.remove("hover-animating");else{const r=c(`.board-button[data-board-id="${t}"]`);if(!r)return;const[o,s,i]=[r.getBoundingClientRect(),e.getBoundingClientRect(),e.closest(".board").getBoundingClientRect()],[l,f]=[o.left-i.left+o.width/2-(s.left-i.left)-s.width/2,o.top-i.top+o.height/2-(s.top-i.top)-s.height/2];e.style.setProperty("--suckX",`${l}px`),e.style.setProperty("--suckY",`${f}px`),e.style.animation="noteSuckHover 0.3s ease-out forwards",e.classList.add("hover-animating")}setTimeout(()=>{e.classList.contains("hover-animating")&&(e.style.animation="noteSuckComplete 0.3s ease-in forwards",e.classList.remove("hover-animating"))},300),setTimeout(()=>{e.querySelectorAll("textarea, [contenteditable]").forEach(o=>{o.style.removeProperty("user-select"),o.style.removeProperty("pointer-events")}),e.remove();const r=c(`.board[data-board-id="${t}"]`);if(r){if(e.style.animation="",e.style.removeProperty("--suckX"),e.style.removeProperty("--suckY"),n)if(n.originalX!==void 0&&n.originalY!==void 0)[e.style.left,e.style.top]=[`${n.originalX}px`,`${Math.max(60,n.originalY)}px`];else{const[i,l]=[100,80];[e.style.left,e.style.top]=[`${i+(n.offsetX||0)}px`,`${Math.max(60,l+(n.offsetY||0))}px`]}else{const[i,l]=[parseFloat(e.dataset.originalX),parseFloat(e.dataset.originalY)];!isNaN(i)&&!isNaN(l)?[e.style.left,e.style.top]=[`${i}px`,`${Math.max(60,l)}px`]:[e.style.left,e.style.top]=[a,"80px"]}const o=e.dataset.noteId||st();[e.dataset.noteId,e.dataset.repositioned,e.dataset.transferred]=[o,"true","true"],at.add(o),r.appendChild(e),e.style.animation="paperPop 0.3s ease-out forwards",J(),ct(),Ge=!0,setTimeout(()=>Ge=!1,500);const s=m;[m]=[t],window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y(),[m]=[s],window.DebouncedStorage?window.DebouncedStorage.saveHigh(`${N}_board_${m}`,te()):Y()}},600)}let H={},z=null,Ce={x:0,y:0},F=[];function Ft(){Wn(),Vt(),zn(),k(".emoji-item").forEach(e=>{window.EventManager?window.EventManager.registerHandler("click",Qe,e):e.addEventListener("click",Qe)})}const Qe=e=>{const t=e.target.dataset.emoji;t&&(Fn(t),Un(t))};function Un(e){const t=c(".board.active");if(!t)return;const n=t.dataset.boardId;if(Jn(n)>=1e3)return Zn();const a=Gn(),r=t.getBoundingClientRect(),[o,s,i]=[r.width-120,r.height*.8-120,20],[l,f]=[Math.random()*o,Math.max(i,Math.random()*s)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:e});d.dataset.stickerId=a,Object.assign(d.style,{left:l+"px",top:f+"px"});const p=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});p.addEventListener("click",u=>[u.stopPropagation(),Kt(a,n)]),d.appendChild(p),Wt(d),t.appendChild(d),(H[n]=H[n]||{})[a]={emoji:e,x:l,y:f,id:a},lt(n),setTimeout(()=>d.classList.remove("new"),400)}function Wt(e){let t=!1;e.addEventListener("mousedown",n);function n(o){if(o.target.classList.contains("delete-button"))return;o.preventDefault(),o.stopPropagation(),[t,z]=[!0,e],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[s,i]=[o.clientX,o.clientY],l=e.getBoundingClientRect();[Ce.x,Ce.y]=[s-l.left,i-l.top],e.classList.add("dragging"),window.eventManager?(window.eventManager.registerHandler("mousemove",a,"emoji-drag"),window.eventManager.registerHandler("mouseup",r,"emoji-drag")):(document.addEventListener("mousemove",a),document.addEventListener("mouseup",r))}function a(o){if(!t||!z)return;o.preventDefault(),o.stopPropagation();const[s,i]=[o.clientX,o.clientY],l=c(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(s-l.left-Ce.x,l.width-120)),Math.max(0,Math.min(i-l.top-Ce.y,l.height-120))];window.AnimationUtils?window.AnimationUtils.updatePosition(z,f,d):Object.assign(z.style,{left:f+"px",top:d+"px"})}function r(){var i;if(!t||!z)return;z.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],Vn(z);const[o,s]=[c(".board.active").dataset.boardId,z.dataset.stickerId];(i=H[o])!=null&&i[s]&&(Object.assign(H[o][s],{x:parseInt(z.style.left),y:parseInt(z.style.top)}),lt(o)),z=null,window.eventManager?(window.eventManager.unregisterHandler("mousemove","emoji-drag"),window.eventManager.unregisterHandler("mouseup","emoji-drag")):(document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r))}}const Kt=(e,t)=>{const n=c(`[data-sticker-id="${e}"]`);n&&(n.classList.add("deleting"),setTimeout(()=>n.remove(),500)),H[t]&&(delete H[t][e],lt(t))},lt=e=>{window.DebouncedStorage?window.DebouncedStorage.save(`emojiStickers_board_${e}`,H[e]||{}):localStorage.setItem(`emojiStickers_board_${e}`,JSON.stringify(H[e]||{}))};function Jt(e){const t=localStorage.getItem(`emojiStickers_board_${e}`);try{H[e]=t?JSON.parse(t):{},t&&Zt(e)}catch(n){console.error("Error loading emoji stickers:",n),H[e]={}}}const zn=()=>Array.from({length:C},(e,t)=>Jt(t+1));function Zt(e){const t=c(`.board[data-board-id="${e}"]`);!t||!H[e]||(t.querySelectorAll(".emoji-sticker").forEach(n=>n.remove()),Object.values(H[e]).forEach(({id:n,emoji:a,x:r,y:o})=>{const s=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:a});s.dataset.stickerId=n,Object.assign(s.style,{left:r+"px",top:o+"px"});const i=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});i.addEventListener("click",l=>[l.stopPropagation(),Kt(n,e)]),s.appendChild(i),Wt(s),t.appendChild(s)}))}function Fn(e){const t=F.indexOf(e);(t<0||t>=12)&&(t>-1&&F.splice(t,1),F.unshift(e),F.length>16&&(F=F.slice(0,16)),Kn(),Vt())}function Wn(){const e=localStorage.getItem("emojiUsageOrder");try{F=e?JSON.parse(e):[]}catch(t){console.error("Error loading emoji usage order:",t),F=[]}}const Kn=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(F));function Vt(){const e=c(".emoji-picker");e&&(e.querySelectorAll(".recent-emoji").forEach(t=>t.remove()),F.length>0&&F.slice(0,12).reverse().forEach(t=>{const n=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:t});n.dataset.emoji=t,n.addEventListener("click",Qe),e.insertBefore(n,e.firstChild)}))}const Jn=e=>H[e]?Object.keys(H[e]).length:0,Zn=()=>{const e=document.getElementById("emojiLimitMessage");e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),1e3))};function Vn(e){if(!e)return;const[t,n]=[e.getBoundingClientRect(),window.innerHeight],[a,r,o]=[250,150,n-150];if(t.left<a&&t.bottom>o){const i=Math.max(60,parseInt(e.style.top)-(t.bottom-o+20));e.style.top=`${i}px`}}const Gn=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),Qn=e=>[localStorage.removeItem(`emojiStickers_board_${e}`),delete H[e]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Ft,100));window.emojiStickers={loadEmojiStickers:Jt,renderEmojiStickers:Zt,cleanupEmojiStickers:Qn,initializeEmojiPicker:Ft};const je=()=>new Date,Gt=e=>{const t=je().getDay(),n=t===0?6:t-1;return e===n},eo=e=>{const t=`daysPatternStartDate_${e}`;localStorage.getItem(t)||localStorage.setItem(t,je().toISOString().split("T")[0])},dt=e=>{const t=localStorage.getItem(`daysPatternStartDate_${e}`);return t?Math.floor((je()-new Date(t))/(1e3*60*60*24))%5:-1},Qt=e=>localStorage.removeItem(`daysPatternStartDate_${e}`),Ct=()=>{if(C>=Se){alert(`Maximum number of boards (${Se}) reached.`);return}et(++C),Bt(),Ne()};function et(e){const t=c(".boards-container"),n=Object.assign(document.createElement("div"),{className:"board"});n.dataset.boardId=e,t.appendChild(n);const a=Object.assign(document.createElement("div"),{className:"board-title-circle"}),r=[],o=()=>{var u;(u=a.querySelector(".board-title-input"))==null||u.focus()};a.addEventListener("click",o),r.push({element:a,event:"click",handler:o});const s=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let i;const l=()=>{const u=s.value.trim();if(!u){s.value=s.dataset.originalTitle||"";return}ut(e,u),Be(s)},f=()=>{clearTimeout(i),i=setTimeout(l,500)};s.addEventListener("input",f),r.push({element:s,event:"input",handler:f}),Be(s),a.appendChild(s),n.appendChild(a);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:e});d.dataset.boardId=e;const p=()=>G(e);if(d.addEventListener("click",p),r.push({element:d,event:"click",handler:p}),e>1){const u=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),g=E=>{E.stopPropagation(),De(e)};u.addEventListener("click",g),r.push({element:u,event:"click",handler:g}),d.appendChild(u)}n._eventCleanup=()=>{r.forEach(({element:u,event:g,handler:E})=>{u.removeEventListener(g,E)}),clearTimeout(i)},c(".boards-navigation").insertBefore(d,c(".add-board-button")),setTimeout(()=>[d.classList.remove("new-button"),d.classList.add("transitions-ready")],500),ke(e),mt(e),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(e)}function De(e){if(!confirm(`Are you sure you want to delete board ${e}?`))return;const t=c(`.board[data-board-id="${e}"]`);if(!t){qe(e);return}const[n,a]=[t.querySelectorAll(".sticky-note"),t.querySelectorAll(".emoji-sticker")];if(n.length||a.length){const r=c(".trash-bin"),o=r.getBoundingClientRect();r.style.animation="binShake 0.5s ease-in-out",n.forEach(s=>{const i=s.querySelector(".sticky-content");B.unshift({text:i.innerHTML,color:s.style.backgroundColor,x:s.style.left,y:s.style.top,width:s.style.width,height:s.style.height,timestamp:new Date().toLocaleString(),isBold:i.classList.contains("bold")});const l=s.getBoundingClientRect(),[f,d]=[o.left-l.left+o.width/2-l.width/2,o.top-l.top];s.style.setProperty("--throwX",`${f}px`),s.style.setProperty("--throwY",`${d}px`),s.style.animation="paperCrumble 0.5s ease-in forwards"}),a.forEach(s=>s.classList.add("deleting")),window.DebouncedStorage?window.DebouncedStorage.saveLow(me,B):Ae(),pe(),console.log("Setting timeout for continueWithBoardDeletion, boardId:",e),setTimeout(()=>{console.log("Timeout fired, calling continueWithBoardDeletion"),qe(e)},600)}else qe(e)}function qe(e){console.log("continueWithBoardDeletion called with boardId:",e);const[t,n]=[c(`.board[data-board-id="${e}"]`),c(`.board-button[data-board-id="${e}"]`)];console.log("Found elements:",{boardElement:t,buttonElement:n}),t!=null&&t._eventCleanup&&t._eventCleanup(),t&&t.remove(),n&&n.classList.add("removing");const a=[];for(let r=e+1;r<=C;r++){const o=c(`.board-button[data-board-id="${r}"]`);o&&(o.classList.add("removing"),a.push(r))}[`${N}_board_${e}`,`stickyNotes_boardTitle_${e}`,`boardColor_${e}`,`boardPattern_${e}`,`boardStyles_board_${e}`].forEach(r=>localStorage.removeItem(r)),Qt(e),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(e);for(let r=e+1;r<=C;r++)["boardColor","boardPattern","boardStyles_board"].forEach(o=>{const[s,i,l]=[`${o}_${r}`,`${o}_${r-1}`,localStorage.getItem(`${o}_${r}`)];l&&localStorage.setItem(i,l),localStorage.removeItem(s)});setTimeout(()=>{n&&n.remove();const[r,o]=[c(".boards-navigation"),c(".add-board-button")];a.forEach(s=>{const[i,l,f]=[c(`.board-button[data-board-id="${s}"]`),c(`.board[data-board-id="${s}"]`),s-1];i&&i.remove(),l&&(l.dataset.boardId=f);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:f});if([d.dataset.boardId,d.dataset.originalNumber]=[f,f],d.addEventListener("click",()=>G(f)),f>1){const p=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});p.addEventListener("click",u=>{u.stopPropagation(),De(f)}),d.appendChild(p)}r.insertBefore(d,o),["","Title","Color","Pattern"].forEach(p=>{const[u,g,E]=[p?`stickyNotes_board${p}`:N,`${p?`stickyNotes_board${p}`:N}_board_${s}`,`${p?`stickyNotes_board${p}`:N}_board_${f}`],x=localStorage.getItem(g);x&&(localStorage.setItem(E,x),localStorage.removeItem(g))}),ke(f)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(s=>[s.classList.remove("new-button"),s.classList.add("transitions-ready")]),500),C--,Bt(),Ne(),m===e?G(e>1?e-1:C>=1?1:null):m>e&&(m--,G(m)),c(".trash-bin").style.animation=""},350)}function G(e){const t=parseInt(e);t===m||t===null||(ao(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),m=t,re[e]||(re[e]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),ie[e]||(ie[e]=we[0]),k(".board").forEach(n=>{const a=parseInt(n.dataset.boardId);if(n.classList.remove("active","prev","next"),n.style.visibility="hidden",a===m){if(n.classList.add("active"),n.style.visibility="visible",n.querySelectorAll(".sticky-note").forEach((r,o)=>r.style.setProperty("--note-index",o)),n.querySelectorAll(".emoji-sticker").forEach((r,o)=>r.style.setProperty("--sticker-index",o)),!n.querySelector(".board-title-circle")){const r=Object.assign(document.createElement("div"),{className:"board-title-circle"});r.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const o=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),s=()=>ut(a,o.value);["change","blur"].forEach(i=>o.addEventListener(i,s)),r.appendChild(o),n.appendChild(r),mt(a)}}else n.classList.add(a<m?"prev":"next")}),document.querySelectorAll(".board-button").forEach(n=>n.classList.toggle("active",parseInt(n.dataset.boardId)===m)),ke(m),tn(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),J(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(m),setTimeout(()=>nn(m),300))}let Ie=[];function to(){no();const e=Ct;c(".add-board-button").addEventListener("click",e),Ie.push({element:c(".add-board-button"),event:"click",handler:e}),k(".board-button").forEach(n=>{const[a,r]=[parseInt(n.dataset.boardId),n.cloneNode(!0)],o=()=>G(a);r.addEventListener("click",o);const s=r.querySelector(".delete-board");if(s){const i=l=>{l.stopPropagation(),De(a)};s.addEventListener("click",i)}n.parentNode.replaceChild(r,n)});const t=(n,a)=>{const[r,o]=[n.target.tagName,n.target.getAttribute("contenteditable")==="true"];if((n.key==="Control"||n.key==="Meta")&&!n.altKey&&!n.shiftKey&&r!=="TEXTAREA"&&!o){n.preventDefault(),c(".note-input textarea").focus();return}if(r==="TEXTAREA"||o){(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),rt());return}n.key==="ArrowLeft"&&m>1?G(m-1):n.key==="ArrowRight"&&m<C?G(m+1):n.key==="n"&&n.ctrlKey?(n.preventDefault(),Ct()):n.key==="d"&&n.ctrlKey&&m>1&&(n.preventDefault(),De(m));const s=parseInt(n.key);!isNaN(s)&&s>=1&&s<=9&&s<=C&&G(s)};window.eventManager&&window.eventManager.registerHandler("keydown",t,"board-navigation"),Ie.push({element:document,event:"keydown",handler:t})}function no(){Ie.forEach(({element:e,event:t,handler:n})=>{e.removeEventListener(t,n)}),Ie=[]}function Ne(){const e=c(".add-board-button"),t=C>=Se;e.classList.toggle("disabled",t),e.title=t?`Maximum number of boards (${Se}) reached`:"Add new board",oo()}function oo(){const e=c(".shortcut-hint");e&&(e.style.display=C>=2?"block":"none")}let $t=!1;function ao(){if($t||C<2)return;const e=c(".shortcut-hint");e&&($t=!0,e.classList.add("auto-show"),setTimeout(()=>{e.classList.remove("auto-show")},4e3))}function so(){const e=c(".board-style-menu"),t=e.classList.contains("visible");t||(tn(),en(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),e.offsetWidth),e.classList.toggle("visible",!t),e.classList.toggle("closing",t),t&&setTimeout(()=>e.classList.remove("closing"),300)}function en(){c(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(e=>{e.classList.add("initialized");const t=e.classList.contains("board-color-option")?"color":"pattern",n=e.getAttribute(`data-${t}`);e.addEventListener("click",()=>{t==="color"?ro(n):co(n),document.querySelectorAll(`.board-${t}-option`).forEach(a=>a.classList.remove("active")),e.classList.add("active")})})}function tn(){["color","pattern"].forEach(e=>{k(`.board-${e}-option`).forEach(t=>{t.classList.toggle("active",t.getAttribute(`data-${e}`)===A[`${e}s`].current)})})}function tt(){return c(".board.active")}function ro(e){A.colors.current=e;const t=tt();t.style.backgroundColor=e,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(n=>{n.style.backgroundColor=e,n.classList.contains("board-pattern-option")&&(n.style.opacity="0.8")}),At(),J(),t.style.transition="background-color 0.5s ease",setTimeout(()=>t.style.transition="",500)}function io(e){const t=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; transition:opacity 0.3s ease-out; opacity:0;"}),n=c(`.board[data-board-id="${m}"]`);if(e!=="none"){const a={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(a[e])t.style.cssText+=a[e];else if(e==="weekdays"||e==="days"){const r=Object.assign(document.createElement("div"),{className:e==="weekdays"?"weekday-header":"day-header"});(e==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((s,i)=>{const l=Object.assign(document.createElement("span"),{textContent:s});(e==="weekdays"&&Gt(i)||e==="days"&&dt(m)===i)&&l.classList.add("current-day"),r.appendChild(l)}),t.appendChild(r),n==null||n.classList.add("has-header")}}else n==null||n.classList.remove("has-header");return t}function co(e){const[t,n,a]=[tt(),tt().dataset.boardId,A.patterns.current];a==="days"&&e!=="days"&&Qt(n),A.patterns.current=e,t.querySelectorAll(".pattern-overlay, .lines-overlay, .weekday-header, .day-header").forEach(s=>s.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),Array.from(t.children).forEach(s=>{s.tagName==="DIV"&&s.style.position==="absolute"&&s.style.pointerEvents==="none"&&(s.style.zIndex==="0"||s.style.zIndex==="1"||s.style.top==="0px"||s.style.left==="0px")&&s.remove()}),e==="days"&&eo(n);const r=io(e);t.appendChild(r);let o=null;(e==="weekdays"||e==="days")&&(o=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${e}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.3s ease;"}),t.appendChild(o)),r.offsetWidth,requestAnimationFrame(()=>{r.style.opacity="1",o&&(o.style.opacity="1")}),r.addEventListener("transitionend",()=>{e==="weekdays"||e==="days"?(t.classList.add(`board-pattern-${e}`),r.classList.add("pattern-overlay"),o&&o.classList.add("pattern-overlay")):e!=="none"&&t.classList.add(`board-pattern-${e}`),J()},{once:!0}),At()}function lo(e,t){if(e.style.backgroundColor=t.color,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(n=>n.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t.pattern!=="none"&&(e.classList.add(`board-pattern-${t.pattern}`),t.pattern==="weekdays"||t.pattern==="days")){const n=Object.assign(document.createElement("div"),{className:`pattern-overlay ${t.pattern==="weekdays"?"weekday-header":"day-header"}`});(t.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(o,s)=>`Day ${s+1}`)).forEach((o,s)=>{const i=Object.assign(document.createElement("span"),{textContent:o});(t.pattern==="weekdays"&&Gt(s)||t.pattern==="days"&&dt(parseInt(e.dataset.boardId))===s)&&i.classList.add("current-day"),n.appendChild(i)}),e.appendChild(n);const r=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${t.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});e.appendChild(r)}}function ke(e){const t=localStorage.getItem(`boardStyles_board_${e}`),n=c(`.board[data-board-id="${e}"]`);if(!n)return;let a;t?(a=JSON.parse(t),e===m&&(A.colors.current=a.color,A.patterns.current=a.pattern)):(a={color:A.colors.default,pattern:A.patterns.default},e===m&&(A.colors.current=a.color,A.patterns.current=a.pattern)),lo(n,a),J()}uo();document.addEventListener("click",function(e){const t=c(".board-style-menu"),n=c(".board-style-button");t&&t.classList.contains("visible")&&n&&!n.contains(e.target)&&!t.contains(e.target)&&(t.classList.add("closing"),t.classList.remove("visible"),setTimeout(()=>t.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",e=>e.stopPropagation());function uo(){document.querySelectorAll(".board").forEach(e=>mt(e.dataset.boardId))}function ut(e,t){localStorage.setItem(`stickyNotes_boardTitle_${e}`,t);const n=document.querySelector(`.board-button[data-board-id="${e}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function Be(e){e.setAttribute("data-counter",`${e.value.length}/${e.maxLength}`)}function mt(e){const t=localStorage.getItem(`stickyNotes_boardTitle_${e}`),n=document.querySelector(`.board[data-board-id="${e}"]`);if(n){const r=n.querySelector(".board-title-input");r&&t&&(r.value=t)}const a=document.querySelector(`.board-button[data-board-id="${e}"]`);a&&!a.dataset.originalNumber&&(a.dataset.originalNumber=a.textContent)}function nn(e){const t=c(`.board[data-board-id="${e}"] .board-title-circle`);t&&(t.classList.add("show-temporary"),setTimeout(()=>t.classList.remove("show-temporary"),3e3))}function mo(){k(".board-title-circle").forEach(e=>{let t;const[n,a]=[e.querySelector(".board-title-input"),e.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((r,o)=>{e.addEventListener(r,()=>{o===0?(n&&n.focus(),clearTimeout(t),e.classList.add("delayed-close")):o===1?(t=setTimeout(()=>e.classList.remove("delayed-close"),2e3),n&&n.blur()):n&&n.focus()})}),n){let r;const o=()=>{const s=n.value.trim();if(!s){n.dataset.originalTitle="";return}ut(a,s),Be(n)};n.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(o,500)}),Be(n)}})}const J=()=>{for(let e=1;e<=C;e++){const[t,n]=[c(`.board[data-board-id="${e}"]`),c(`.board-button[data-board-id="${e}"]`)];if(!t||!n)continue;const a=t.style.backgroundColor||A.colors.default;n.classList.toggle("has-notes",t.querySelectorAll(".sticky-note").length>0),n.style.backgroundColor=a;const r=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],o=r.find(i=>t.classList.contains(i));r.forEach(i=>n.classList.remove(i.replace("board-pattern","button-pattern"))),o&&n.classList.add(o.replace("board-pattern","button-pattern"));const s=yn(a)||{r:26,g:26,b:26};n.style.color=(s.r*299+s.g*587+s.b*114)/1e3>128?"#000":"#fff"}};function go(e){e.forEach(({selector:t,event:n,handler:a})=>{const r=c(t);r&&(window.EventManager?window.EventManager.registerHandler(n,a,r):r.addEventListener(n,a))})}const Tt=function(){Sn(),jt(),_t(),to(),en(),En(),Xt(),mo(),fo(),setTimeout(()=>nn(m),500),ho(),go([{selector:".board-style-button",event:"click",handler:so},{selector:".trash-bin",event:"click",handler:Ee},{selector:"#trashModal .close-modal-btn",event:"click",handler:Ee},{selector:"#trashModal .clear-trash-btn",event:"click",handler:Rt}])};window.EventManager?window.EventManager.registerHandler("DOMContentLoaded",Tt):document.addEventListener("DOMContentLoaded",Tt);function fo(){const e=r=>{const o=r.selectionStart,s=r.value;if(s.length>0){const i=s.charAt(0).toUpperCase()+s.slice(1);i!==s&&(r.value=i,r.setSelectionRange(o,o))}},t=r=>{["input","keyup"].forEach(s=>{window.EventManager?window.EventManager.registerHandler(s,i=>e(i.target),r):r.addEventListener(s,i=>e(i.target))});const o=s=>setTimeout(()=>e(s.target),0);window.EventManager?window.EventManager.registerHandler("paste",o,r):r.addEventListener("paste",o)};k(".board-title-input, .note-input textarea").forEach(t);const n=new MutationObserver(r=>{r.forEach(o=>{o.addedNodes.forEach(s=>{var i;s.nodeType===1&&((s.querySelectorAll?s.querySelectorAll(".board-title-input"):[]).forEach(t),(i=s.classList)!=null&&i.contains("board-title-input")&&t(s))})})}),a=c(".boards-container");a&&n.observe(a,{childList:!0,subtree:!0})}function ho(){setTimeout(()=>{k(".board-button").forEach(e=>{e.classList.add("transitions-ready"),e.offsetHeight,requestAnimationFrame(()=>e.style.transform="scale(1)")})},100)}window.toggleBold=Yt;window.markAsDone=ot;window.addNote=rt;window.restoreNote=An;window.changeNoteColor=jn;window.markAsDone=ot;window.toggleBold=Yt;window.clearTrash=Rt;})();
