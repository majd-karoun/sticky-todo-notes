(()=>{var He=Object.defineProperty;var Vt=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var P=Math.pow,Zt=(t,e,n)=>e in t?He(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ct=(t,e)=>{for(var n in e||(e={}))Pe.call(e,n)&&Zt(t,n,e[n]);if(Vt)for(var n of Vt(e))Re.call(e,n)&&Zt(t,n,e[n]);return t};const F=new Map,Jt=()=>{Object.entries({trashBin:".trash-bin",statusBar:".status-bar",noteInput:".note-input",selectionBox:".selection-box"}).forEach(([e,n])=>{const s=document.querySelector(n);s&&F.set(e,s)})};window.$=t=>{if(F.has(t)){const e=F.get(t);return e.isConnected?e:(F.delete(t),document.querySelector(t))}return document.querySelector(t)};window.$$=(t,e=!1)=>{if(e&&F.has(t)){const n=F.get(t);return n.every(s=>s.isConnected)?n:(F.delete(t),Array.from(document.querySelectorAll(t)))}return Array.from(document.querySelectorAll(t))};window.$within=(t,e)=>t?t.querySelector(e):null;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Jt):Jt();const ht=new Map;let st=null;const re=()=>{ht.forEach(({element:t,styles:e})=>{t.isConnected&&Object.entries(e).forEach(([n,s])=>{n.startsWith("--")?t.style.setProperty(n,s):t.style[n]=s})}),ht.clear(),st=null},qe=()=>{st||(st=requestAnimationFrame(re))};window.AnimationUtils={updateStyles(t,e,n="normal"){var o;if(!t||!e)return;const s=t._batchId||(t._batchId=Math.random().toString(36));ht.set(s,{element:t,styles:Ct(Ct({},(o=ht.get(s))==null?void 0:o.styles),e)}),qe()},updatePosition(t,e,n){this.updateStyles(t,{left:`${e}px`,top:`${n}px`})},updateSize(t,e,n){this.updateStyles(t,{width:`${e}px`,height:`${n}px`})},flush(){st&&(cancelAnimationFrame(st),re())}};const nt=new Map,gt=new Map,Dt=t=>{if(nt.has(t))try{const e=nt.get(t);localStorage.setItem(t,typeof e=="string"?e:JSON.stringify(e)),nt.delete(t),gt.delete(t)}catch(e){}};window.DebouncedStorage={save(t,e,n="normal"){gt.has(t)&&clearTimeout(gt.get(t)),nt.set(t,e);const s=n==="high"?50:n==="low"?1e3:300;gt.set(t,setTimeout(()=>Dt(t),s))},saveHigh(t,e){this.save(t,e,"high")},saveLow(t,e){this.save(t,e,"low")},flush(t){Dt(t)},flushAll(){nt.forEach((t,e)=>Dt(e))}};window.addEventListener("beforeunload",()=>window.DebouncedStorage.flushAll());const at=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],A={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let D=[];let le=null;let R=null;let b=[],ze=!1;let E=[];const W={},q={},N={};let j=1e3;W[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};q[1]=at[0];let u=1,x=1;const it=9,L="stickyNotes_active",dt="stickyNotes_deleted",ce="stickyNotes_boardCount",de="stickyNotes_zIndexes",g=t=>parseInt(String(t).replace("px",""))||0,Tt=(t,e,n=150)=>{const s=$(`.board[data-board-id="${u}"]`);if(!s)return!1;const o=Array.from(s.querySelectorAll(".sticky-note")),a=20;for(const i of o){const r=g(i.style.left),l=g(i.style.top),d=g(i.style.width)||200,c=t<r+d+a&&t+200>r-a,m=e+n,f=l+30,h=e<f&&m>l-a;if(c&&h)return!0}return!1},Qt=(t,e)=>{const n=Math.random()*10-5;let s=t+n,o=e+70;const a=5,i=window.innerWidth-200,r=window.innerHeight-300,l=20;let d=0;for(;d<l&&Tt(s,o);)o+=40,d++,d>10&&(s=t+250,o=50,d=0);if(o>r){for(o=50,s=t+250;d<l&&Tt(s,o);)o+=40,d++;if(s>i)for(s=a+50,o=50,d=0;d<l&&Tt(s,o);)o+=40,d++}const c=Math.min(Math.max(s,a),i),m=Math.min(Math.max(o,a),window.innerHeight-100);return{x:c,y:m}},Fe=t=>{if(t.startsWith("rgba")){const n=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return n?{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(n,s,o,a)=>s+s+o+o+a+a);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};const J=(t=!1)=>{t?(window.DebouncedStorage.flush(`${L}_board_${u}`),window.DebouncedStorage.save(`${L}_board_${u}`,X())):window.DebouncedStorage.save(`${L}_board_${u}`,X()),typeof O=="function"&&O()},X=()=>{const t=$(`.board[data-board-id="${u}"]`);if(!t)return[];const e=Array.from(t.querySelectorAll(".sticky-note"));return Array.from(e).map(n=>({content:$within(n,".sticky-content").innerHTML,x:g(n.style.left),y:g(n.style.top),color:n.style.backgroundColor||"#ffeb3b",width:n.style.width||"200px",height:n.style.height||"150px",isBold:$within(n,".sticky-content").classList.contains("bold"),noteId:n.dataset.noteId,zIndex:n.style.zIndex||1}))};const ue=()=>{window.DebouncedStorage.save(ce,x.toString())},me=()=>{const t={color:A.colors.current,pattern:A.patterns.current};window.DebouncedStorage.saveLow(`boardStyles_board_${u}`,t)},Xt=()=>{const t=$("#shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},fe=()=>{const t=$(".note-input textarea");if(!t)return;const e=$("#shortcutIcon"),n=()=>{if(!e)return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",o=t.value.trim();e.innerHTML=o?`${s}+\u21B5`:s,e.classList.toggle("focus-hint",!o),e.classList.toggle("enter-hint",o)};t.addEventListener("focus",()=>{n(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"50px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"200px"})})):(window.AnimationUtils.updateStyles(t,{height:"50px"}),requestAnimationFrame(()=>window.AnimationUtils.updateStyles(t,{height:"200px"}))),t.addEventListener("input",n)}),t.addEventListener("blur",()=>{Xt(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"200px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"50px"})})):(window.AnimationUtils.updateStyles(t,{height:"200px"}),requestAnimationFrame(()=>window.AnimationUtils.updateStyles(t,{height:"50px"}))),t.removeEventListener("input",n)}),document.addEventListener("mousedown",s=>{!s.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},te=(t,e=null)=>{try{return JSON.parse(t)}catch(n){return e}},We=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{const e=[];for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);s&&(s.startsWith("stickyNotes_deleted")||s.startsWith("stickyNotes_zIndexes")||s.startsWith("boardColor_")||s.startsWith("boardPattern_")||s.startsWith("boardStyles_")||s.startsWith("emojiStickers_")||s.startsWith("daysPatternStartDate_")||s.startsWith("emojiUsageOrder"))&&e.push(s)}e.forEach(n=>{localStorage.removeItem(n)}),window.DebouncedStorage.saveHigh(t,"true")}catch(e){window.DebouncedStorage.saveHigh(t,"true")}},pe=()=>{try{if(typeof wt!="function"){setTimeout(pe,50);return}window.DebouncedStorage.flush(),We(),typeof ee=="function"&&ee();const t=localStorage.getItem(ce);if(t){const n=parseInt(t);if(!isNaN(n)&&n>0){x=Math.min(n,it);for(let s=2;s<=x;s++)typeof jt=="function"&&jt(s)}}typeof St=="function"&&St();for(let n=1;n<=x;n++){const s=localStorage.getItem(`${L}_board_${n}`);if(s){const o=te(s,[]);Array.isArray(o)&&o.forEach(a=>{if(a&&typeof a=="object"&&(a.text||a.content)){W[n]={x:g(a.x),y:g(a.y)},q[n]=a.color||at[0];const i=a.text||a.content,r=wt(i,a.color||at[0],g(a.x),g(a.y),!0,a.width||"200px",a.height||"150px",a.isBold||!1,n);r&&a.noteId&&(r.dataset.noteId=a.noteId,N[a.noteId]?(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:N[a.noteId].toString()}):r.style.zIndex=N[a.noteId],N[a.noteId]>j&&(j=N[a.noteId])):a.zIndex&&!isNaN(parseInt(a.zIndex))&&(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:a.zIndex.toString()}):r.style.zIndex=a.zIndex,N[a.noteId]=parseInt(a.zIndex),parseInt(a.zIndex)>j&&(j=parseInt(a.zIndex))))}})}typeof ct=="function"&&ct(n)}typeof Y=="function"&&Y(1);const e=localStorage.getItem(dt);if(e){const n=te(e,[]);Array.isArray(n)&&(D=n,typeof Q=="function"&&Q())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(n=>{typeof window[n]=="function"&&window[n]()}),Xt(),fe()}catch(t){}},Ut=()=>++j,Ke=t=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{zIndex:Ut().toString()}):t.style.zIndex=Ut();const e=t.dataset.noteId;e&&(N[e]=j,Ot())},Ot=()=>{try{window.DebouncedStorage.saveLow(de,N)}catch(t){}},Ge=()=>{try{const t=localStorage.getItem(de);t&&(Object.assign(N,JSON.parse(t)),j=Math.max(1e3,...Object.values(N)))}catch(t){}};const ee=()=>{R=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(R.style,{display:"none"}),document.body.appendChild(R)};function Ve(){const t=$(".boards-container"),e=n=>{n.target.closest(".board")&&!n.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&n.preventDefault()};document.addEventListener("mousedown",e),t.addEventListener("mousedown",Ze),document.addEventListener("mousemove",Je),document.addEventListener("mouseup",Qe)}function Ze(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=$(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&xt(),window.isSelecting=!0,window.selectionStartX=t.clientX,window.selectionStartY=t.clientY,document.body.classList.add("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(R,{left:`${window.selectionStartX}px`,top:`${window.selectionStartY}px`,width:"0",height:"0",display:"block"}):R.style.cssText=`left:${window.selectionStartX}px; top:${window.selectionStartY}px; width:0; height:0; display:block;`}function Je(t){if(!window.isSelecting)return;t.preventDefault();const e=window.selectionStartX,n=window.selectionStartY,s=t.clientX,o=t.clientY;AnimationUtils.updateStyles(R,{left:`${Math.min(e,s)}px`,top:`${Math.min(n,o)}px`,width:`${Math.abs(s-e)}px`,height:`${Math.abs(o-n)}px`},"high"),tn()}const Qe=t=>{window.isSelecting&&(window.isSelecting=!1,document.body.classList.remove("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(R,{display:"none"}):R.style.display="none")};function tn(){const t=R.getBoundingClientRect(),e=$(`.board[data-board-id="${u}"]`);if(!e)return;const n=(s,o,a)=>{const i=s.getBoundingClientRect(),r=!(i.right<t.left||i.left>t.right||i.bottom<t.top||i.top>t.bottom),l=o.indexOf(s);r?l===-1&&(o.push(s),s.classList.add(a)):!ze&&l!==-1&&(o.splice(l,1),s.classList.remove(a))};Array.from(e.querySelectorAll(".sticky-note")).forEach(s=>n(s,b,"selected"))}const xt=()=>{b.forEach(t=>t.classList.remove("selected")),b=[]};function en(t){window.isMovingSelection=!0,window.selectionMoveStartX=t.clientX,window.selectionMoveStartY=t.clientY,document.body.classList.add("selecting"),E=b.map(e=>{const n=g(e.style.left),s=g(e.style.top);return e.dataset.preDragX=n.toString(),e.dataset.preDragY=s.toString(),{element:e,x:n,y:s,type:"note"}}),document.addEventListener("mousemove",ge),document.addEventListener("mouseup",he)}function ge(t){if(!window.isMovingSelection)return;const[e,n]=[t.clientX-window.selectionMoveStartX,t.clientY-window.selectionMoveStartY],[s,o,a]=[5,-5,-5],[i,r]=[window.innerWidth-s,window.innerHeight-s];(d=>d.forEach(c=>{const[m,f]=[Math.min(Math.max(c.x+e,o),i-c.element.offsetWidth/4),Math.min(Math.max(c.y+n,a),r-c.element.offsetHeight/4)];AnimationUtils.updatePosition(c.element,m,f)}))(E),b.length>0&&(Se(t.clientX,t.clientY),b.length>1&&Le())}function he(t){if(!window.isMovingSelection)return;if(window.isMovingSelection=!1,document.body.classList.remove("selecting"),document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",he),ut(),!Ae().moved){J();for(let n=b.length-1;n>=0;n--)ye(b[n])&&b.splice(n,1)}ke()}let ot=[];const nn=100,ne=50,on="#ffd700",sn=()=>{const[t,e]=[$("#trashModal"),$(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>Et())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},Ht=t=>{b.includes(t)&&b.length>1?(b.forEach((e,n)=>setTimeout(()=>It(e),n*100)),xt()):It(t)},It=t=>{if(D.length>=nn){!ot.includes(t)&&ot.push(t),sn();return}t._eventCleanup&&t._eventCleanup();const e=$within(t,".sticky-content"),n={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};an(t),D.unshift(n),window.DebouncedStorage.saveLow(dt,D),Q(),rn(t)},an=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[n,s]=[e.getBoundingClientRect(),t.getBoundingClientRect()],o=Math.min(5,Math.max(0,Math.floor((s.left+s.width/2-n.left)/(n.width/6))));window.noteColumns[o]&&(window.noteColumns[o]=window.noteColumns[o].filter(a=>Math.abs(a.x-g(t.style.left))>1||Math.abs(a.y-g(t.style.top))>1))},rn=t=>{const e=$(".trash-bin"),n=e.getBoundingClientRect(),s=t.getBoundingClientRect(),o=n.left-s.left+n.width/2-s.width/2,a=n.top-s.top;window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{"--throwX":`${o}px`,"--throwY":`${a}px`,animation:"paperCrumble 0.6s ease-in forwards"},"high"),window.AnimationUtils.updateStyles(e,{animation:"binShake 0.6s ease-in-out"},"high")):(t.style.setProperty("--throwX",`${o}px`),t.style.setProperty("--throwY",`${a}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out"),setTimeout(()=>{t.remove(),window.AnimationUtils?window.AnimationUtils.updateStyles(e,{animation:""},"normal"):e.style.animation="",J(),O()},600)},ye=t=>{const[e,n]=[$(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return n.right>e.left&&n.left<e.right&&n.bottom>e.top&&n.top<e.bottom?(Ht(t),!0):!1},rt=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>Et())):setTimeout(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{display:"none"},"normal"):t.style.display="none"},300)},Et=()=>{const t=$(".deleted-notes-container");window.AnimationUtils?window.AnimationUtils.updateStyles(t,{minHeight:"200px"},"normal"):t.style.minHeight="200px",t.innerHTML=D.length?D.map((e,n)=>`
            <div class="deleted-note" style="background-color: ${e.color||on}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${n})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},ln=t=>{const e=$$(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[n]=D.splice(t,1),s=wt(n.text,n.color,g(n.x),g(n.y),!0,n.width,n.height,n.isBold);window.DebouncedStorage.saveLow(dt,D),Q(),Et(),requestAnimationFrame(()=>{window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X())}),O()},300)},we=()=>{if(D.length===0){rt();return}const t=[...$$(".deleted-note")].slice(0,6);t.forEach((e,n)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${n*ne}ms`}),setTimeout(()=>{D=[],window.DebouncedStorage.saveLow(dt,D),Q(),Et(),setTimeout(()=>{if(rt(),ot.length){const e=[...ot];ot=[],setTimeout(()=>{e.forEach(n=>{n!=null&&n.parentNode&&It(n)})},300)}},200)},(t.length?(t.length-1)*ne+300:0)+100)},Q=()=>{$(".trash-count").textContent=D.length};document.addEventListener("click",t=>{const e=$("#trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&rt()});let Pt=new Set,oe=!1;const yt=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,cn=()=>Math.random()*40-20,dn=(t=Lt())=>t.getDay()===0?0:t.getDay()-1;function Nt(t){const e=document.getElementById("noteLimitMessage");if(!e)return;const n=e.querySelector(".transfer-text");n&&(n.textContent=t),e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3)}function Rt(){const t=$(".note-input textarea"),e=t.value.trim();if(!e)return;const n=$(`.board[data-board-id="${u}"]`),s=Array.from(n.querySelectorAll(".sticky-note")),o=n.classList.contains("board-pattern-weekdays"),a=n.classList.contains("board-pattern-days"),i=s.filter(w=>!w.dataset.transferred).length===0;if(!o&&!a&&s.length>=30){Nt("Maximum notes space reached.");return}const r=s.filter(w=>!w.dataset.transferred),l=r[r.length-1];let{x:d,y:c}=W[u]||{x:0,y:0},m=q[u]||getRandomColor(),f,h;const C=(w,v,p=null)=>{const y=n.offsetWidth/v,S=w*y+10,G=(w+1)*y-210,V=Math.max(S,Math.min(G,S+cn())),U=Array.from(n.querySelectorAll(".sticky-note")).filter(H=>H.style.display!=="none"&&H!==p),I=w*y,Z=(w+1)*y,z=U.filter(H=>{const _=g(H.style.left),mt=_+200,ft=Math.max(_,I),kt=Math.min(mt,Z);return Math.max(0,kt-ft)/200>.5});return{positionX:V,columnNotes:z}},K=(w,v)=>{const p=window.innerHeight-300;for(let y=0;y<v;y++){const S=(w+y)%v,{positionX:G,columnNotes:V}=C(S,v);let U=0,I=null;V.forEach(z=>{const H=g(z.style.top);H>U&&(U=H,I=z)});const Z=I?U+70:60;if(Z<=p)return f=G,h=Z,I&&(m=I.style.backgroundColor),!0}return Nt("Maximum notes space reached."),!1},tt=w=>{let v;const p=w?6:5;if(oe&&l){const y=g(l.style.left),S=n.offsetWidth/p;v=Math.floor(y/S),v=Math.max(0,Math.min(v,p-1))}else v=w?dn():zt(u)||0;return K(v,p)};if(i)if(o||a){if(tt(o)===!1)return}else{const w=Math.max(150,window.innerWidth/4);({x:f,y:h}=Qt(w,50-70))}else if(o||a){if(tt(o)===!1)return}else if(l&&(d=g(l.style.left),c=g(l.style.top),m=l.style.backgroundColor),{x:f,y:h}=Qt(d,c),h<=50){const w=s.filter(v=>Math.abs(g(v.style.left)-f)<150);if(w.length>0){const v=w.map(U=>g(U.style.top)),p=Math.max(...v),y=Math.min(...v),S=window.innerHeight-300,G=p+200,V=y-200;if(G<=S)h=G;else if(V>=50)h=V;else{const U=(Z,z)=>{const H=window.innerWidth-200;for(let _=Z;z>0?_<=H:_>=55;_+=z*250){const mt=s.filter(At=>Math.abs(g(At.style.left)-_)<150);if(mt.length===0)return{x:_,y:50};const ft=mt.map(At=>g(At.style.top)),kt=Math.max(...ft),Oe=Math.min(...ft),Kt=kt+200,Gt=Oe-200;if(Kt<=S)return{x:_,y:Kt};if(Gt>=50)return{x:_,y:Gt}}return null},I=U(f+250,1)||U(f-250,-1);if(I)f=I.x,h=I.y;else{Nt("Maximum notes space reached.");return}}}}wt(e.replace(/\n/g,"<br>"),m,f,h,!1,"200px","150px",!1,u),W[u]={x:f,y:h},q[u]=m,oe=!0,t.value="",n.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(w=>{delete w.dataset.transferred}),window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X()),O()}function wt(t,e,n,s,o=!1,a="200px",i="150px",r=!1,l=u,d=!1){const c=document.createElement("div"),m=yt(),f=Ut();c.className="sticky-note",c.innerHTML=`<div class="sticky-content ${r?"bold":""}" contenteditable="true">${t}</div><div class="note-controls"><div class="color-button" style="background-color: ${e}"><div class="color-palette">${at.map(C=>`<div class="color-option" style="background-color: ${C}" onclick="changeNoteColor(this, '${C}')"></div>`).join("")}</div></div><button class="bold-toggle ${r?"active":""}" onclick="toggleBold(this)">B</button><button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button></div><div class="resize-handle"></div>`,c.style.cssText=`background-color:${e}; width:${a}; height:${i}; z-index:${f};`,window.AnimationUtils.updatePosition(c,n,s),c.dataset.noteId=m,d&&(c.dataset.repositioned="true",Pt.add(m)),N[m]=f,Ot(),c.addEventListener("click",C=>{C.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||Ke(c)}),fn(c);const h=$(`.board[data-board-id="${l}"]`);return h?(h.appendChild(c),c.style.animation="paperPop 0.3s ease-out forwards",o||window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X()),c):null}function un(t,e){event.stopPropagation();const n=t.closest(".sticky-note");(n.classList.contains("selected")?$$(".sticky-note.selected"):[n]).forEach(o=>{o.classList.add("color-transition");const a=o.querySelector(".color-button");a.classList.add("color-transition"),window.AnimationUtils.updateStyles(o,{backgroundColor:e}),window.AnimationUtils.updateStyles(a,{backgroundColor:e}),setTimeout(()=>{o.classList.remove("color-transition"),a.classList.remove("color-transition")},300)}),q[u]=e,window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X())}const be=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),window.DebouncedStorage.saveLow(`${L}_board_${u}`,X())},mn=$("#shortcutIcon")||$(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"}));mn.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";$(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Rt())});let Mt=!1,k=null,et=!1,_t=!1;function fn(t){const e=t.querySelector(".sticky-content"),n=t.querySelector(".color-button"),s=t.querySelector(".color-palette");let o=!1,a=!1,i,r,l,d,c,m;e.addEventListener("input",J),e.addEventListener("blur",J),e.addEventListener("dblclick",p=>{e.contentEditable="true",e.focus();const y=document.createRange(),S=window.getSelection();y.selectNodeContents(e),y.collapse(!1),S.removeAllRanges(),S.addRange(y),p.stopPropagation()}),e.addEventListener("keydown",p=>{p.key==="Enter"&&p.shiftKey&&(e.contentEditable="false",J())});let f=null,h=!1;const C=()=>{!o&&!a&&(h=!0,f=t.style.zIndex||"1",t.style.zIndex="9999")},K=()=>{!o&&!a&&f!==null&&(h=!1,t.style.zIndex=f,f=null)};t.addEventListener("mouseenter",C),t.addEventListener("mouseleave",K),t.addEventListener("click",p=>{if(!p.target.closest(".color-palette, .resize-handle")){p.stopPropagation(),h?(f=++j,t.style.zIndex="9999"):t.style.zIndex=++j;const y=t.dataset.noteId||yt();t.dataset.noteId=y,N[y]=j,Ot()}});let tt;n.addEventListener("click",p=>{p.stopPropagation(),s.classList.contains("visible")?s.classList.remove("visible"):($$(".color-palette").forEach(y=>y.classList.remove("visible")),s.classList.add("visible"))}),s.addEventListener("mouseenter",()=>clearTimeout(tt)),s.addEventListener("mouseleave",()=>{tt=setTimeout(()=>{s.classList.add("closing"),setTimeout(()=>{s.classList.remove("visible","closing")},180)},100)}),t.addEventListener("mousedown",p=>{if(!p.target.closest(".color-palette")){if(b.includes(t)&&b.length>1)return en(p);p.shiftKey?b.includes(t)||(b.push(t),t.classList.add("selected")):xt(),p.preventDefault(),document.body.style.userSelect="none",i=p.clientX,r=p.clientY,p.target.closest(".resize-handle")?(a=!0,c=t.offsetWidth,m=t.offsetHeight):(o=!0,l=g(t.style.left),d=g(t.style.top),window.activeNote=t,E=[{element:t,x:l,y:d}],t.dataset.preDragX=l.toString(),t.dataset.preDragY=d.toString()),document.addEventListener("mousemove",w),document.addEventListener("mouseup",v)}});function w(p){if(o){Mt||(Mt=!0,document.body.classList.add("drag-in-progress"));const y=Math.max(0,l+p.clientX-i),S=Math.max(0,d+p.clientY-r);window.AnimationUtils.updatePosition(t,y,S),Se(p.clientX,p.clientY)}if(a){const y=Math.max(150,c+p.clientX-i),S=Math.max(150,m+p.clientY-r);window.AnimationUtils.updateSize(t,y,S)}}function v(p){if(document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",v),document.body.style.userSelect="",o){if(ut(),!Ae().moved){ye(t),gn(t);const S=t.dataset.noteId||yt();t.dataset.noteId=S,t.dataset.repositioned="true",Pt.add(S),(!t.dataset.preDragX||!t.dataset.preDragY)&&(W[u]={x:g(t.style.left),y:g(t.style.top)}),q[u]=t.style.backgroundColor}Mt=!1,document.body.classList.remove("drag-in-progress")}window.activeNote=null,(o||a)&&window.DebouncedStorage.save(`${L}_board_${u}`,X()),o=!1,a=!1}}function pn(){$$(".color-palette.visible").forEach(t=>{t.classList.add("closing"),setTimeout(()=>{t.classList.remove("visible","closing")},180)})}document.addEventListener("click",t=>{if(t.target.closest(".color-button, .color-palette")||pn(),!t.target.closest(".sticky-note")){const e=document.querySelector('.sticky-content[contenteditable="true"]');e&&(e.contentEditable="false",e.blur(),J())}});function gn(t){if(!t)return;const e=t.getBoundingClientRect();if(e.left<250&&e.bottom>window.innerHeight-150){const n=e.bottom-(window.innerHeight-150),s=Math.max(60,g(t.style.top)-n-20);window.AnimationUtils.updateStyles(t,{top:`${s}px`})}}const hn=(t,e,n,s)=>Math.sqrt(P(t-n,2)+P(e-s,2)),yn=t=>[t.left+t.width/2,t.top+t.height/2],se=(t,e)=>{let n={button:null,distance:1/0};return $$(".board-button:not(.disabled)",!0).forEach(s=>{const[o,a]=yn(s.getBoundingClientRect()),i=hn(t,e,o,a);i<n.distance&&(n={button:s,distance:i})}),n.button},ve=(t,e=null)=>{const n=$$(".board-button",!0);t?(n.forEach(s=>s.classList.add("drag-active","drag-proximity")),e&&e.classList.add("drag-hover"),bn()):(n.forEach(s=>{s.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>s.classList.remove("drag-active"),200)}),xe())};function Se(t,e){var d,c;if(_t)return;const n=$(".status-bar");if(!n)return;const s=n.getBoundingClientRect(),o=Math.max(0,s.left-t,t-s.right),a=Math.max(0,s.top-e,e-s.bottom),i=Math.sqrt(P(o,2)+P(a,2)),r=k!==null,l=r?i<=120:i<=80;if(l!==r)k=l?se(t,e):null,ve(l,k);else if(l){const m=se(t,e);m!==k&&(k==null||k.classList.remove("drag-hover"),k=m,m?(m.classList.add("drag-hover"),ut(),(d=$(".shortcut-hint"))==null||d.classList.add("hidden-during-drag")):(Le(),et||(c=$(".shortcut-hint"))==null||c.classList.remove("hidden-during-drag")))}}const lt=(t,e)=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,e):Object.entries(e).forEach(([n,s])=>{n.startsWith("--")?t.style.setProperty(n,s):s===""?t.style.removeProperty(n.replace(/([A-Z])/g,"-$1").toLowerCase()):t.style[n]=s})},$e=(t,e)=>{const n=e?{userSelect:"none",pointerEvents:"none"}:{userSelect:"",pointerEvents:""};t.querySelectorAll("textarea, [contenteditable]").forEach(s=>lt(s,n))},wn=(t,e,n)=>[t.left-n.left+t.width/2-(e.left-n.left)-e.width/2,t.top-n.top+t.height/2-(e.top-n.top)-e.height/2];function bn(){if(!k)return;const t=window.activeNote||le,e=b.length>0?b:t?[t]:[],n=k.getBoundingClientRect();e.forEach(s=>{if(s&&!s.classList.contains("reverse-animating")&&!s.classList.contains("hover-animating")){$e(s,!0);const[o,a]=wn(n,s.getBoundingClientRect(),s.closest(".board").getBoundingClientRect());lt(s,{"--suckX":`${o}px`,"--suckY":`${a}px`,animation:"noteSuckHover 0.3s ease-out forwards"}),s.classList.add("hover-animating")}})}function xe(){$$(".hover-animating",!0).forEach(t=>{$e(t,!1),lt(t,{animation:"noteSuckReverse 0.3s ease-out forwards"}),t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&(lt(t,{animation:"none","--suckX":"","--suckY":""}),t.classList.remove("reverse-animating"))},300)})}const Ee=t=>{var e,n,s,o;t&&x>1&&!et&&!k?((e=document.getElementById("dragTransferMessage"))==null||e.classList.add("visible"),et=!0,(n=$(".shortcut-hint"))==null||n.classList.add("hidden-during-drag")):!t&&et&&((s=document.getElementById("dragTransferMessage"))==null||s.classList.remove("visible"),et=!1,(o=$(".shortcut-hint"))==null||o.classList.remove("hidden-during-drag"))},Le=()=>Ee(!0),ut=()=>Ee(!1);function ke(){$$(".board-button",!0).forEach(t=>t.classList.remove("drag-hover","drag-proximity")),k=null,xe(),ut()}const vn=t=>{const e=E==null?void 0:E.find(r=>r.element===t),n=parseFloat(t.style.left)||0,s=parseFloat(t.style.top)||0;let o,a;if(e)o=e.x,a=Math.max(60,e.y),console.log(`[DEBUG] Using notesInitialPositions: (${n}, ${s}) -> (${o}, ${a})`);else{const r=t.dataset.preDragX,l=t.dataset.preDragY;if(r&&l)o=parseFloat(r),a=Math.max(60,parseFloat(l)),console.log(`[DEBUG] Using preDrag attributes: (${n}, ${s}) -> (${o}, ${a})`);else{console.error(`[DEBUG] No position data found! Current: (${n}, ${s}), notesInitialPositions length: ${(E==null?void 0:E.length)||0}`);return}}const i=Math.sqrt(P(o-n,2)+P(a-s,2));if(i<5){console.log(`[DEBUG] Note already at target position, distance: ${i}`),delete t.dataset.preDragX,delete t.dataset.preDragY;return}t.classList.contains("hover-animating")&&(t.classList.remove("hover-animating"),lt(t,{"--suckX":"","--suckY":"",animation:"none"})),t.style.transition="left 0.4s ease-out, top 0.4s ease-out, transform 0.4s ease-out",window.AnimationUtils?window.AnimationUtils.updatePosition(t,o,a):(t.style.left=`${o}px`,t.style.top=`${a}px`),t.style.transform="scale(1)",setTimeout(()=>{const r=parseFloat(t.style.left)||0,l=parseFloat(t.style.top)||0;console.log(`[DEBUG] Position after restore: (${r}, ${l}), expected: (${o}, ${a})`)},50),setTimeout(()=>{t.style.transition="",t.style.transform="",delete t.dataset.preDragX,delete t.dataset.preDragY},400)},Sn=t=>{const e=new Map;return t.length>1&&(E==null?void 0:E.length)>0&&E.forEach(n=>{n&&t.includes(n.element)&&e.set(n.element,{originalX:n.x,originalY:n.y})}),e};function Ae(){if(!k)return{moved:!1};const t=window.activeNote||le,e=parseInt(k.dataset.boardId),n=b.length>0?[...b]:[t];if(e===u)return $$(".board-button",!0).forEach(o=>o.classList.remove("drag-hover","drag-proximity")),k=null,ut(),ve(!1),n.forEach(o=>{if(o){o.classList.remove("hover-animating","reverse-animating"),o.style.animation="none",o.style.removeProperty("--suckX"),o.style.removeProperty("--suckY"),o.style.transform="",o.style.transition="",o.offsetHeight;const a=o.dataset.preDragX,i=o.dataset.preDragY;if(a&&i){const r=parseFloat(a),l=Math.max(60,parseFloat(i)),d=parseFloat(o.style.left)||0,c=parseFloat(o.style.top)||0;console.log(`[DEBUG] Same-board transfer: (${d}, ${c}) -> (${r}, ${l})`),Math.sqrt(P(r-d,2)+P(l-c,2))>5?(o.style.transition="left 0.4s ease-out, top 0.4s ease-out, transform 0.4s ease-out",window.AnimationUtils?window.AnimationUtils.updatePosition(o,r,l):(o.style.left=`${r}px`,o.style.top=`${l}px`),o.style.transform="scale(1)",setTimeout(()=>{o.style.transition="",o.style.transform=""},400)):window.AnimationUtils?window.AnimationUtils.updatePosition(o,r,l):(o.style.left=`${r}px`,o.style.top=`${l}px`),setTimeout(()=>{delete o.dataset.preDragX,delete o.dataset.preDragY},350)}else console.error("[DEBUG] No preDrag data for same-board transfer!"),vn(o)}}),{moved:!1};const s=Sn(n);return n.forEach(o=>{o&&$n(o,e,s.get(o)||null)}),b.length>0&&xt(),{moved:!0}}function $n(t,e,n=null){const s=t.style.left;if(t.classList.contains("hover-animating"))window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const o=$(`.board-button[data-board-id="${e}"]`);if(!o)return;const[a,i,r]=[o.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,d]=[a.left-r.left+a.width/2-(i.left-r.left)-i.width/2,a.top-r.top+a.height/2-(i.top-r.top)-i.height/2];window.AnimationUtils?window.AnimationUtils.updateStyles(t,{"--suckX":`${l}px`,"--suckY":`${d}px`,animation:"noteSuckHover 0.3s ease-out forwards"}):(t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${d}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards"),t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(a=>{window.AnimationUtils?window.AnimationUtils.updateStyles(a,{userSelect:"",pointerEvents:""}):(a.style.removeProperty("user-select"),a.style.removeProperty("pointer-events"))}),t.remove();const o=$(`.board[data-board-id="${e}"]`);if(o){if(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"","--suckX":"","--suckY":""}):(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY")),n)if(n.originalX!==void 0&&n.originalY!==void 0)window.AnimationUtils?window.AnimationUtils.updatePosition(t,n.originalX,Math.max(60,n.originalY)):[t.style.left,t.style.top]=[`${n.originalX}px`,`${Math.max(60,n.originalY)}px`];else{const[i,r]=[100,80],l=i+(n.offsetX||0),d=Math.max(60,r+(n.offsetY||0));window.AnimationUtils?window.AnimationUtils.updatePosition(t,l,d):[t.style.left,t.style.top]=[`${l}px`,`${d}px`]}else{const i=E==null?void 0:E.find(r=>r.element===t);if(i)window.AnimationUtils?window.AnimationUtils.updatePosition(t,i.x,Math.max(60,i.y)):[t.style.left,t.style.top]=[`${i.x}px`,`${Math.max(60,i.y)}px`];else{const r=parseFloat(t.style.left)||100,l=parseFloat(t.style.top)||80;window.AnimationUtils?window.AnimationUtils.updatePosition(t,r,Math.max(60,l)):[t.style.left,t.style.top]=[`${r}px`,`${Math.max(60,l)}px`]}}const a=t.dataset.noteId||yt();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[a,"true","true"],Pt.add(a),o.appendChild(t),window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"paperPop 0.3s ease-out forwards"}):t.style.animation="paperPop 0.3s ease-out forwards",O(),ke(),_t=!0,setTimeout(()=>_t=!1,500),setTimeout(()=>{const i=u;[u]=[e],window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X()),[u]=[i],window.DebouncedStorage.saveHigh(`${L}_board_${u}`,X())},100)}},600)}let T={},M=null,pt={x:0,y:0},B=[];function Ce(){kn(),Ue(),En(),$$(".emoji-item").forEach(t=>{t.addEventListener("click",De)})}const De=t=>{const e=t.target.dataset.emoji;e&&(Ln(e),xn(e))};function xn(t){const e=$(".board.active");if(!e)return;const n=e.dataset.boardId;if(Cn(n)>=10)return Dn();const s=Nn(),o=e.getBoundingClientRect(),[a,i,r]=[o.width-120,o.height*.8-120,20],[l,d]=[Math.random()*a,Math.max(r,Math.random()*i)],c=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});c.dataset.stickerId=s,Object.assign(c.style,{left:l+"px",top:d+"px"});const m=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});m.addEventListener("click",f=>[f.stopPropagation(),Ne(s,n)]),c.appendChild(m),Te(c),e.appendChild(c),(T[n]=T[n]||{})[s]={emoji:t,x:l,y:d,id:s},qt(n),setTimeout(()=>c.classList.remove("new"),400)}function Te(t){let e=!1;t.addEventListener("mousedown",n);function n(a){if(a.target.classList.contains("delete-button"))return;a.preventDefault(),a.stopPropagation(),[e,M]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[i,r]=[a.clientX,a.clientY],l=t.getBoundingClientRect();[pt.x,pt.y]=[i-l.left,r-l.top],t.classList.add("dragging"),document.addEventListener("mousemove",s),document.addEventListener("mouseup",o)}function s(a){if(!e||!M)return;a.preventDefault(),a.stopPropagation();const[i,r]=[a.clientX,a.clientY],l=$(".board.active").getBoundingClientRect(),[d,c]=[Math.max(0,Math.min(i-l.left-pt.x,l.width-120)),Math.max(0,Math.min(r-l.top-pt.y,l.height-120))];window.AnimationUtils?window.AnimationUtils.updatePosition(M,d,c):Object.assign(M.style,{left:d+"px",top:c+"px"})}function o(){var r;if(!e||!M)return;M.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],Tn(M);const[a,i]=[$(".board.active").dataset.boardId,M.dataset.stickerId];(r=T[a])!=null&&r[i]&&(Object.assign(T[a][i],{x:parseInt(M.style.left),y:parseInt(M.style.top)}),qt(a)),M=null,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)}}const Ne=(t,e)=>{const n=$(`[data-sticker-id="${t}"]`);n&&(n.classList.add("deleting"),setTimeout(()=>n.remove(),500)),T[e]&&(delete T[e][t],qt(e))},qt=t=>{window.DebouncedStorage.save(`emojiStickers_board_${t}`,T[t]||{})};function Me(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{T[t]=e?JSON.parse(e):{},e&&Be(t)}catch(n){T[t]={}}}const En=()=>Array.from({length:x},(t,e)=>Me(e+1));function Be(t){const e=$(`.board[data-board-id="${t}"]`);!e||!T[t]||(Array.from(e.querySelectorAll(".emoji-sticker")).forEach(n=>n.remove()),Object.values(T[t]).forEach(({id:n,emoji:s,x:o,y:a})=>{const i=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:s});i.dataset.stickerId=n,window.AnimationUtils?window.AnimationUtils.updatePosition(i,o,a):Object.assign(i.style,{left:o+"px",top:a+"px"});const r=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});r.addEventListener("click",l=>[l.stopPropagation(),Ne(n,t)]),i.appendChild(r),Te(i),e.appendChild(i)}))}function Ln(t){const e=B.indexOf(t);(e<0||e>=12)&&(e>-1&&B.splice(e,1),B.unshift(t),B.length>16&&(B=B.slice(0,16)),An(),Ue())}function kn(){const t=localStorage.getItem("emojiUsageOrder");try{B=t?JSON.parse(t):[]}catch(e){B=[]}}const An=()=>window.DebouncedStorage.saveLow("emojiUsageOrder",B);function Ue(){const t=$(".emoji-picker");t&&(Array.from(t.querySelectorAll(".recent-emoji")).forEach(e=>e.remove()),B.length>0&&B.slice(0,12).reverse().forEach(e=>{const n=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});n.dataset.emoji=e,n.addEventListener("click",De),t.insertBefore(n,t.firstChild)}))}const Cn=t=>T[t]?Object.keys(T[t]).length:0,Dn=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function Tn(t){if(!t)return;const[e,n]=[t.getBoundingClientRect(),window.innerHeight],[s,o,a]=[250,150,n-150];if(e.left<s&&e.bottom>a){const r=Math.max(60,parseInt(t.style.top)-(e.bottom-a+20));window.AnimationUtils.updateStyles(t,{top:`${r}px`})}}const Nn=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),Mn=t=>{localStorage.removeItem(`emojiStickers_board_${t}`),delete T[t]};document.addEventListener("DOMContentLoaded",()=>setTimeout(Ce,100));window.emojiStickers={loadEmojiStickers:Me,renderEmojiStickers:Be,cleanupEmojiStickers:Mn,initializeEmojiPicker:Ce};const Lt=()=>new Date,Ie=t=>{const e=Lt().getDay(),n=e===0?6:e-1;return t===n},Bn=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||window.DebouncedStorage.saveHigh(e,Lt().toISOString().split("T")[0])},zt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((Lt()-new Date(e))/(1e3*60*60*24))%5:-1},_e=t=>{localStorage.removeItem(`daysPatternStartDate_${t}`)},ae=()=>{if(x>=it){alert(`Maximum number of boards (${it}) reached.`);return}jt(++x),ue(),St()};function jt(t){const e=$(".boards-container"),n=Object.assign(document.createElement("div"),{className:"board"});n.dataset.boardId=t,e.appendChild(n);const s=Object.assign(document.createElement("div"),{className:"board-title-circle"}),o=[],a=()=>{var f;(f=$within(s,".board-title-input"))==null||f.focus()};s.addEventListener("click",a),o.push({element:s,event:"click",handler:a});const i=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let r;const l=()=>{const f=i.value.trim();if(!f){i.value=i.dataset.originalTitle||"";return}Ft(t,f),$t(i)},d=()=>{clearTimeout(r),r=setTimeout(l,500)};i.addEventListener("input",d),o.push({element:i,event:"input",handler:d}),$t(i),s.appendChild(i),n.appendChild(s);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});c.dataset.boardId=t;const m=()=>Y(t);if(c.addEventListener("click",m),o.push({element:c,event:"click",handler:m}),t>1){const f=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),h=C=>{C.stopPropagation(),bt(t)};f.addEventListener("click",h),o.push({element:f,event:"click",handler:h}),c.appendChild(f)}n._eventCleanup=()=>{o.forEach(({element:f,event:h,handler:C})=>{f.removeEventListener(h,C)}),clearTimeout(r)},$(".boards-navigation").insertBefore(c,$(".add-board-button")),setTimeout(()=>[c.classList.remove("new-button"),c.classList.add("transitions-ready")],500),ct(t),Wt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function bt(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=$(`.board[data-board-id="${t}"]`);if(!e){Bt(t);return}const[n,s]=[Array.from(e.querySelectorAll(".sticky-note")),Array.from(e.querySelectorAll(".emoji-sticker"))];if(n.length||s.length){const o=$(".trash-bin"),a=o.getBoundingClientRect();window.AnimationUtils?window.AnimationUtils.updateStyles(o,{animation:"binShake 0.5s ease-in-out"},"high"):o.style.animation="binShake 0.5s ease-in-out",n.forEach(i=>{const r=$within(i,".sticky-content");D.unshift({text:r.innerHTML,color:i.style.backgroundColor,x:i.style.left,y:i.style.top,width:i.style.width,height:i.style.height,timestamp:new Date().toLocaleString(),isBold:r.classList.contains("bold")});const l=i.getBoundingClientRect(),[d,c]=[a.left-l.left+a.width/2-l.width/2,a.top-l.top];window.AnimationUtils?window.AnimationUtils.updateStyles(i,{"--throwX":`${d}px`,"--throwY":`${c}px`,animation:"paperCrumble 0.5s ease-in forwards"},"high"):(i.style.setProperty("--throwX",`${d}px`),i.style.setProperty("--throwY",`${c}px`),i.style.animation="paperCrumble 0.5s ease-in forwards")}),s.forEach(i=>i.classList.add("deleting")),window.DebouncedStorage.saveLow(dt,D),Q(),setTimeout(()=>{Bt(t)},600)}else Bt(t)}function Bt(t){const[e,n]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];e!=null&&e._eventCleanup&&e._eventCleanup(),e&&e.remove(),n&&n.classList.add("removing");const s=[];for(let o=t+1;o<=x;o++){const a=$(`.board-button[data-board-id="${o}"]`);a&&(a.classList.add("removing"),s.push(o))}[`${L}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(o=>localStorage.removeItem(o)),_e(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let o=t+1;o<=x;o++)["boardColor","boardPattern","boardStyles_board"].forEach(a=>{const[i,r,l]=[`${a}_${o}`,`${a}_${o-1}`,localStorage.getItem(`${a}_${o}`)];l&&window.DebouncedStorage.saveHigh(r,l),localStorage.removeItem(i)});setTimeout(()=>{n&&n.remove();const[o,a]=[$(".boards-navigation"),$(".add-board-button")];s.forEach(i=>{const[r,l,d]=[$(`.board-button[data-board-id="${i}"]`),$(`.board[data-board-id="${i}"]`),i-1];r&&r.remove(),l&&(l.dataset.boardId=d);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:d});if([c.dataset.boardId,c.dataset.originalNumber]=[d,d],c.addEventListener("click",()=>Y(d)),d>1){const m=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});m.addEventListener("click",f=>{f.stopPropagation(),bt(d)}),c.appendChild(m)}o.insertBefore(c,a),["","Title","Color","Pattern"].forEach(m=>{const[f,h,C]=[m?`stickyNotes_board${m}`:L,`${m?`stickyNotes_board${m}`:L}_board_${i}`,`${m?`stickyNotes_board${m}`:L}_board_${d}`],K=localStorage.getItem(h);K&&(window.DebouncedStorage.saveHigh(C,K),localStorage.removeItem(h))}),ct(d)}),setTimeout(()=>$$(".board-button.new-button").forEach(i=>[i.classList.remove("new-button"),i.classList.add("transitions-ready")]),500),x--,ue(),St(),u===t?Y(t>1?t-1:x>=1?1:null):u>t&&(u--,Y(u)),window.AnimationUtils?window.AnimationUtils.updateStyles($(".trash-bin"),{animation:""},"normal"):$(".trash-bin").style.animation=""},350)}function Y(t){const e=parseInt(t);e===u||e===null||(jn(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),u=e,W[t]||(W[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),q[t]||(q[t]=at[0]),$$(".board").forEach(n=>{const s=parseInt(n.dataset.boardId);if(n.classList.remove("active","prev","next"),window.AnimationUtils?window.AnimationUtils.updateStyles(n,{visibility:"hidden"},"high"):n.style.visibility="hidden",s===u){if(n.classList.add("active"),window.AnimationUtils?window.AnimationUtils.updateStyles(n,{visibility:"visible"},"high"):n.style.visibility="visible",Array.from(n.querySelectorAll(".sticky-note")).forEach((o,a)=>window.AnimationUtils?window.AnimationUtils.updateStyles(o,{"--note-index":a.toString()},"low"):o.style.setProperty("--note-index",a)),Array.from(n.querySelectorAll(".emoji-sticker")).forEach((o,a)=>window.AnimationUtils?window.AnimationUtils.updateStyles(o,{"--sticker-index":a.toString()},"low"):o.style.setProperty("--sticker-index",a)),!$within(n,".board-title-circle")){const o=Object.assign(document.createElement("div"),{className:"board-title-circle"});o.setAttribute("onclick","$within(this, '.board-title-input').focus()");const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),i=()=>Ft(s,a.value);["change","blur"].forEach(r=>a.addEventListener(r,i)),o.appendChild(a),n.appendChild(o),Wt(s)}}else n.classList.add(s<u?"prev":"next")}),$$(".board-button").forEach(n=>n.classList.toggle("active",parseInt(n.dataset.boardId)===u)),ct(u),Ye(),$$(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),O(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(u),setTimeout(()=>Xe(u),300))}let vt=[];function Un(){In();const t=ae;$(".add-board-button").addEventListener("click",t),vt.push({element:$(".add-board-button"),event:"click",handler:t}),$$(".board-button").forEach(n=>{const[s,o]=[parseInt(n.dataset.boardId),n.cloneNode(!0)],a=()=>Y(s);o.addEventListener("click",a);const i=$within(o,".delete-board");if(i){const r=l=>{l.stopPropagation(),bt(s)};i.addEventListener("click",r)}n.parentNode.replaceChild(o,n)});const e=n=>{const[s,o]=[n.target.tagName,n.target.getAttribute("contenteditable")==="true"];if((n.key==="Control"||n.key==="Meta")&&!n.altKey&&!n.shiftKey&&s!=="TEXTAREA"&&!o){n.preventDefault(),$(".note-input textarea").focus();return}if(s==="TEXTAREA"||o){(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),Rt());return}n.key==="ArrowLeft"&&u>1?Y(u-1):n.key==="ArrowRight"&&u<x?Y(u+1):n.key==="n"&&n.ctrlKey?(n.preventDefault(),ae()):n.key==="d"&&n.ctrlKey&&u>1&&(n.preventDefault(),bt(u));const a=parseInt(n.key);!isNaN(a)&&a>=1&&a<=9&&a<=x&&Y(a)};document.addEventListener("keydown",e),vt.push({element:document,event:"keydown",handler:e})}function In(){vt.forEach(({element:t,event:e,handler:n})=>{t.removeEventListener(e,n)}),vt=[]}function St(){const t=$(".add-board-button"),e=x>=it;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${it}) reached`:"Add new board",_n()}function _n(){const t=$(".shortcut-hint");t&&(t.style.display=x>=2?"block":"none")}let ie=!1;function jn(){if(ie||x<2)return;const t=$(".shortcut-hint");t&&(ie=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function Yn(){const t=$(".board-style-menu"),e=t.classList.contains("visible");e||(Ye(),je(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function je(){$(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",n=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?Xn(n):Hn(n),document.querySelectorAll(`.board-${e}-option`).forEach(s=>s.classList.remove("active")),t.classList.add("active")})})}function Ye(){["color","pattern"].forEach(t=>{$$(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===A[`${t}s`].current)})})}function Yt(){return $(".board.active")}function Xn(t){A.colors.current=t;const e=Yt();e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(n=>{n.style.backgroundColor=t,n.classList.contains("board-pattern-option")&&(n.style.opacity="0.8")}),me(),O(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function On(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; transition:opacity 0.3s ease-out; opacity:0;"}),n=$(`.board[data-board-id="${u}"]`);if(t!=="none"){const s={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(s[t])e.style.cssText+=s[t];else if(t==="weekdays"||t==="days"){const o=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((i,r)=>{const l=Object.assign(document.createElement("span"),{textContent:i});(t==="weekdays"&&Ie(r)||t==="days"&&zt(u)===r)&&l.classList.add("current-day"),o.appendChild(l)}),e.appendChild(o),n==null||n.classList.add("has-header")}}else n==null||n.classList.remove("has-header");return e}function Hn(t){const[e,n,s]=[Yt(),Yt().dataset.boardId,A.patterns.current];s==="days"&&t!=="days"&&_e(n),A.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay, .weekday-header, .day-header").forEach(i=>i.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),Array.from(e.children).forEach(i=>{i.tagName==="DIV"&&i.style.position==="absolute"&&i.style.pointerEvents==="none"&&(i.style.zIndex==="0"||i.style.zIndex==="1"||i.style.top==="0px"||i.style.left==="0px")&&i.remove()}),t==="days"&&Bn(n);const o=On(t);e.appendChild(o);let a=null;(t==="weekdays"||t==="days")&&(a=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.3s ease;"}),e.appendChild(a)),o.offsetWidth,requestAnimationFrame(()=>{o.style.opacity="1",a&&(a.style.opacity="1")}),o.addEventListener("transitionend",()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),o.classList.add("pattern-overlay"),a&&a.classList.add("pattern-overlay")):t!=="none"&&e.classList.add(`board-pattern-${t}`),O()},{once:!0}),me()}function Pn(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(n=>n.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const n=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(a,i)=>`Day ${i+1}`)).forEach((a,i)=>{const r=Object.assign(document.createElement("span"),{textContent:a});(e.pattern==="weekdays"&&Ie(i)||e.pattern==="days"&&zt(parseInt(t.dataset.boardId))===i)&&r.classList.add("current-day"),n.appendChild(r)}),t.appendChild(n);const o=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(o)}}function ct(t){const e=localStorage.getItem(`boardStyles_board_${t}`),n=$(`.board[data-board-id="${t}"]`);if(!n)return;let s;e?(s=JSON.parse(e),t===u&&(A.colors.current=s.color,A.patterns.current=s.pattern)):(s={color:A.colors.default,pattern:A.patterns.default},t===u&&(A.colors.current=s.color,A.patterns.current=s.pattern)),Pn(n,s),O()}Rn();document.addEventListener("click",function(t){const e=$(".board-style-menu"),n=$(".board-style-button");e&&e.classList.contains("visible")&&n&&!n.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function Rn(){document.querySelectorAll(".board").forEach(t=>Wt(t.dataset.boardId))}function Ft(t,e){window.DebouncedStorage.save(`stickyNotes_boardTitle_${t}`,e);const n=$(`.board-button[data-board-id="${t}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function $t(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function Wt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),n=$(`.board[data-board-id="${t}"]`);if(n){const o=n.querySelector(".board-title-input");o&&e&&(o.value=e)}const s=$(`.board-button[data-board-id="${t}"]`);s&&!s.dataset.originalNumber&&(s.dataset.originalNumber=s.textContent)}function Xe(t){const e=$(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function qn(){$$(".board-title-circle").forEach(t=>{let e;const[n,s]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((o,a)=>{t.addEventListener(o,()=>{a===0?(n&&n.focus(),clearTimeout(e),t.classList.add("delayed-close")):a===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),n&&n.blur()):n&&n.focus()})}),n){let o;const a=()=>{const i=n.value.trim();if(!i){n.dataset.originalTitle="";return}Ft(s,i),$t(n)};n.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(a,500)}),$t(n)}})}const O=()=>{for(let t=1;t<=x;t++){const[e,n]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];if(!e||!n)continue;const s=e.style.backgroundColor||A.colors.default;n.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),n.style.backgroundColor=s;const o=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],a=o.find(r=>e.classList.contains(r));o.forEach(r=>n.classList.remove(r.replace("board-pattern","button-pattern"))),a&&n.classList.add(a.replace("board-pattern","button-pattern"));const i=Fe(s)||{r:26,g:26,b:26};n.style.color=(i.r*299+i.g*587+i.b*114)/1e3>128?"#000":"#fff"}};function zn(t){t.forEach(({selector:e,event:n,handler:s})=>{const o=$(e);o&&o.addEventListener(n,s)})}const Fn=function(){Ge(),pe(),fe(),Un(),je(),Ve(),Xt(),qn(),Wn(),setTimeout(()=>Xe(u),500),Kn(),zn([{selector:".board-style-button",event:"click",handler:Yn},{selector:".trash-bin",event:"click",handler:rt},{selector:"#trashModal .close-modal-btn",event:"click",handler:rt},{selector:"#trashModal .clear-trash-btn",event:"click",handler:we}])};document.addEventListener("DOMContentLoaded",Fn);function Wn(){const t=o=>{const a=o.selectionStart,i=o.value;if(i.length>0){const r=i.charAt(0).toUpperCase()+i.slice(1);r!==i&&(o.value=r,o.setSelectionRange(a,a))}},e=o=>{["input","keyup"].forEach(i=>{o.addEventListener(i,r=>t(r.target))});const a=i=>setTimeout(()=>t(i.target),0);o.addEventListener("paste",a)};$$(".board-title-input, .note-input textarea").forEach(e);const n=new MutationObserver(o=>{o.forEach(a=>{a.addedNodes.forEach(i=>{var r;i.nodeType===1&&((i.querySelectorAll?Array.from(i.querySelectorAll(".board-title-input")):[]).forEach(e),(r=i.classList)!=null&&r.contains("board-title-input")&&e(i))})})}),s=$(".boards-container");s&&n.observe(s,{childList:!0,subtree:!0})}function Kn(){setTimeout(()=>{$$(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{transform:"scale(1)"},"normal"):t.style.transform="scale(1)"})})},100)}window.toggleBold=be;window.markAsDone=Ht;window.addNote=Rt;window.restoreNote=ln;window.changeNoteColor=un;window.markAsDone=Ht;window.toggleBold=be;window.clearTrash=we;})();
