(()=>{var De=Object.defineProperty;var Wt=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var Kt=(t,e,o)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,Lt=(t,e)=>{for(var o in e||(e={}))Ue.call(e,o)&&Kt(t,o,e[o]);if(Wt)for(var o of Wt(e))_e.call(e,o)&&Kt(t,o,e[o]);return t};const W=new Map,Jt=()=>{Object.entries({trashBin:".trash-bin",statusBar:".status-bar",noteInput:".note-input",selectionBox:".selection-box"}).forEach(([e,o])=>{const s=document.querySelector(o);s&&W.set(e,s)})};window.$=t=>{if(W.has(t)){const e=W.get(t);return e.isConnected?e:(W.delete(t),document.querySelector(t))}return document.querySelector(t)};window.$$=(t,e=!1)=>{if(e&&W.has(t)){const o=W.get(t);return o.every(s=>s.isConnected)?o:(W.delete(t),Array.from(document.querySelectorAll(t)))}return Array.from(document.querySelectorAll(t))};window.$within=(t,e)=>t?t.querySelector(e):null;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Jt):Jt();const ft=new Map;let ot=null;const oe=()=>{ft.forEach(({element:t,styles:e})=>{t.isConnected&&Object.entries(e).forEach(([o,s])=>{o.startsWith("--")?t.style.setProperty(o,s):t.style[o]=s})}),ft.clear(),ot=null},je=()=>{ot||(ot=requestAnimationFrame(oe))};window.AnimationUtils={updateStyles(t,e,o="normal"){var n;if(!t||!e)return;const s=t._batchId||(t._batchId=Math.random().toString(36));ft.set(s,{element:t,styles:Lt(Lt({},(n=ft.get(s))==null?void 0:n.styles),e)}),je()},updatePosition(t,e,o){this.updateStyles(t,{left:`${e}px`,top:`${o}px`})},updateSize(t,e,o){this.updateStyles(t,{width:`${e}px`,height:`${o}px`})},flush(){ot&&(cancelAnimationFrame(ot),oe())}};const Q=new Map,mt=new Map,kt=t=>{if(Q.has(t))try{const e=Q.get(t);localStorage.setItem(t,typeof e=="string"?e:JSON.stringify(e)),Q.delete(t),mt.delete(t)}catch(e){console.warn("Storage save failed:",e)}};window.DebouncedStorage={save(t,e,o="normal"){mt.has(t)&&clearTimeout(mt.get(t)),Q.set(t,e);const s=o==="high"?50:o==="low"?1e3:300;mt.set(t,setTimeout(()=>kt(t),s))},saveHigh(t,e){this.save(t,e,"high")},saveLow(t,e){this.save(t,e,"low")},flush(t){kt(t)},flushAll(){Q.forEach((t,e)=>kt(e))}};window.addEventListener("beforeunload",()=>window.DebouncedStorage.flushAll());const nt=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],L={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let k=[];let ne=null;let P=null;let b=[],Oe=!1;let M=[];const K={},q={},I={};let F=1e3;K[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};q[1]=nt[0];let u=1,S=1;const st=9,E="stickyNotes_active",lt="stickyNotes_deleted",se="stickyNotes_boardCount",ie="stickyNotes_zIndexes",g=t=>parseInt(String(t).replace("px",""))||0,At=(t,e,o=150)=>{const s=$(`.board[data-board-id="${u}"]`);if(!s)return!1;const n=Array.from(s.querySelectorAll(".sticky-note")),i=20;for(const a of n){const r=g(a.style.left),l=g(a.style.top),d=g(a.style.width)||200,c=t<r+d+i&&t+200>r-i,f=e+o,m=l+30,y=e<m&&f>l-i;if(c&&y)return!0}return!1},Vt=(t,e)=>{const o=Math.random()*10-5;let s=t+o,n=e+70;const i=5,a=window.innerWidth-200,r=window.innerHeight-300,l=20;let d=0;for(;d<l&&At(s,n);)n+=40,d++,d>10&&(s=t+250,n=50,d=0);if(n>r){for(n=50,s=t+250;d<l&&At(s,n);)n+=40,d++;if(s>a)for(s=i+50,n=50,d=0;d<l&&At(s,n);)n+=40,d++}const c=Math.min(Math.max(s,i),a),f=Math.min(Math.max(n,i),window.innerHeight-100);return{x:c,y:f}},Ye=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,s,n,i)=>s+s+n+n+i+i);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};const tt=(t=!1)=>{t?(window.DebouncedStorage.flush(`${E}_board_${u}`),window.DebouncedStorage.save(`${E}_board_${u}`,O())):window.DebouncedStorage.save(`${E}_board_${u}`,O()),typeof Y=="function"&&Y()},O=()=>{const t=$(`.board[data-board-id="${u}"]`);if(!t)return[];const e=Array.from(t.querySelectorAll(".sticky-note"));return Array.from(e).map(o=>({content:$within(o,".sticky-content").innerHTML,x:g(o.style.left),y:g(o.style.top),color:o.style.backgroundColor||"#ffeb3b",width:o.style.width||"200px",height:o.style.height||"150px",isBold:$within(o,".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}))};const ae=()=>{window.DebouncedStorage.save(se,S.toString())},re=()=>{const t={color:L.colors.current,pattern:L.patterns.current};window.DebouncedStorage.saveLow(`boardStyles_board_${u}`,t)},_t=()=>{const t=$("#shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},le=()=>{const t=$(".note-input textarea");if(!t)return;const e=$("#shortcutIcon"),o=()=>{if(!e)return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",n=t.value.trim();e.innerHTML=n?`${s}+\u21B5`:s,e.classList.toggle("focus-hint",!n),e.classList.toggle("enter-hint",n)};t.addEventListener("focus",()=>{o(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"50px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"200px"})})):(t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px")),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{_t(),window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{height:"200px"}),requestAnimationFrame(()=>{window.AnimationUtils.updateStyles(t,{height:"50px"})})):(t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px")),t.removeEventListener("input",o)}),document.addEventListener("mousedown",s=>{!s.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},Zt=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},Xe=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{const e=[];for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&(s.startsWith("stickyNotes_deleted")||s.startsWith("stickyNotes_zIndexes")||s.startsWith("boardColor_")||s.startsWith("boardPattern_")||s.startsWith("boardStyles_")||s.startsWith("emojiStickers_")||s.startsWith("daysPatternStartDate_")||s.startsWith("emojiUsageOrder"))&&e.push(s)}e.forEach(o=>{localStorage.removeItem(o)}),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},ce=()=>{try{if(typeof pt!="function"){setTimeout(ce,50);return}window.DebouncedStorage.flush(),Xe(),typeof Gt=="function"&&Gt();const t=localStorage.getItem(se);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){S=Math.min(o,st);for(let s=2;s<=S;s++)typeof Dt=="function"&&Dt(s)}}typeof yt=="function"&&yt();for(let o=1;o<=S;o++){const s=localStorage.getItem(`${E}_board_${o}`);if(s){const n=Zt(s,[]);Array.isArray(n)&&n.forEach(i=>{if(i&&typeof i=="object"&&(i.text||i.content)){K[o]={x:g(i.x),y:g(i.y)},q[o]=i.color||nt[0];const a=i.text||i.content,r=pt(a,i.color||nt[0],g(i.x),g(i.y),!0,i.width||"200px",i.height||"150px",i.isBold||!1,o);r&&i.noteId&&(r.dataset.noteId=i.noteId,I[i.noteId]?(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:I[i.noteId].toString()}):r.style.zIndex=I[i.noteId],I[i.noteId]>F&&(F=I[i.noteId])):i.zIndex&&!isNaN(parseInt(i.zIndex))&&(window.AnimationUtils?window.AnimationUtils.updateStyles(r,{zIndex:i.zIndex.toString()}):r.style.zIndex=i.zIndex,I[i.noteId]=parseInt(i.zIndex),parseInt(i.zIndex)>F&&(F=parseInt(i.zIndex))))}})}typeof rt=="function"&&rt(o)}typeof j=="function"&&j(1);const e=localStorage.getItem(lt);if(e){const o=Zt(e,[]);Array.isArray(o)&&(k=o,typeof G=="function"&&G())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),_t(),le()}catch(t){console.error("Critical error loading saved data:",t)}},Nt=()=>++F,He=t=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{zIndex:Nt().toString()}):t.style.zIndex=Nt();const e=t.dataset.noteId;e&&(I[e]=F,de())},de=()=>{try{window.DebouncedStorage.saveLow(ie,I)}catch(t){console.error("Error saving note z-indexes:",t)}},Re=()=>{try{const t=localStorage.getItem(ie);t&&(Object.assign(I,JSON.parse(t)),F=Math.max(1e3,...Object.values(I)))}catch(t){console.error("Error loading note z-indexes:",t)}};const Gt=()=>{P=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(P.style,{display:"none"}),document.body.appendChild(P)};function Pe(){const t=$(".boards-container"),e=o=>{o.target.closest(".board")&&!o.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&o.preventDefault()};document.addEventListener("mousedown",e),t.addEventListener("mousedown",qe),document.addEventListener("mousemove",ze),document.addEventListener("mouseup",Fe)}function qe(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=$(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&bt(),window.isSelecting=!0,window.selectionStartX=t.clientX,window.selectionStartY=t.clientY,document.body.classList.add("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(P,{left:`${window.selectionStartX}px`,top:`${window.selectionStartY}px`,width:"0",height:"0",display:"block"}):P.style.cssText=`left:${window.selectionStartX}px; top:${window.selectionStartY}px; width:0; height:0; display:block;`}function ze(t){if(!window.isSelecting)return;t.preventDefault();const e=window.selectionStartX,o=window.selectionStartY,s=t.clientX,n=t.clientY;AnimationUtils.updateStyles(P,{left:`${Math.min(e,s)}px`,top:`${Math.min(o,n)}px`,width:`${Math.abs(s-e)}px`,height:`${Math.abs(n-o)}px`},"high"),We()}const Fe=t=>{window.isSelecting&&(window.isSelecting=!1,document.body.classList.remove("selecting"),window.AnimationUtils?window.AnimationUtils.updateStyles(P,{display:"none"}):P.style.display="none")};function We(){const t=P.getBoundingClientRect(),e=$(`.board[data-board-id="${u}"]`);if(!e)return;const o=(s,n,i)=>{const a=s.getBoundingClientRect(),r=!(a.right<t.left||a.left>t.right||a.bottom<t.top||a.top>t.bottom),l=n.indexOf(s);r?l===-1&&(n.push(s),s.classList.add(i)):!Oe&&l!==-1&&(n.splice(l,1),s.classList.remove(i))};Array.from(e.querySelectorAll(".sticky-note")).forEach(s=>o(s,b,"selected"))}const bt=()=>{b.forEach(t=>t.classList.remove("selected")),b=[]};function Ke(t){window.isMovingSelection=!0,window.selectionMoveStartX=t.clientX,window.selectionMoveStartY=t.clientY,document.body.classList.add("selecting"),M=b.map(e=>({element:e,x:g(e.style.left),y:g(e.style.top),type:"note"})),document.addEventListener("mousemove",ue),document.addEventListener("mouseup",me)}function ue(t){if(!window.isMovingSelection)return;const[e,o]=[t.clientX-window.selectionMoveStartX,t.clientY-window.selectionMoveStartY],[s,n,i]=[5,-5,-5],[a,r]=[window.innerWidth-s,window.innerHeight-s];(d=>d.forEach(c=>{const[f,m]=[Math.min(Math.max(c.x+e,n),a-c.element.offsetWidth/4),Math.min(Math.max(c.y+o,i),r-c.element.offsetHeight/4)];AnimationUtils.updatePosition(c.element,f,m)}))(M),b.length>0&&(ge(t.clientX,t.clientY),b.length>1&&we())}function me(t){if(!window.isMovingSelection)return;if(window.isMovingSelection=!1,document.body.classList.remove("selecting"),document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",me),St(),!ve().moved){tt();for(let o=b.length-1;o>=0;o--)fe(b[o])&&b.splice(o,1)}be()}let et=[];const Je=100,Qt=50,Ve="#ffd700",Ze=()=>{const[t,e]=[$("#trashModal"),$(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>vt())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},jt=t=>{b.includes(t)&&b.length>1?(b.forEach((e,o)=>setTimeout(()=>It(e),o*100)),bt()):It(t)},It=t=>{if(k.length>=Je){!et.includes(t)&&et.push(t),Ze();return}t._eventCleanup&&t._eventCleanup();const e=$within(t,".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};Ge(t),k.unshift(o),window.DebouncedStorage.saveLow(lt,k),G(),Qe(t)},Ge=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,s]=[e.getBoundingClientRect(),t.getBoundingClientRect()],n=Math.min(5,Math.max(0,Math.floor((s.left+s.width/2-o.left)/(o.width/6))));window.noteColumns[n]&&(window.noteColumns[n]=window.noteColumns[n].filter(i=>Math.abs(i.x-g(t.style.left))>1||Math.abs(i.y-g(t.style.top))>1))},Qe=t=>{const e=$(".trash-bin"),o=e.getBoundingClientRect(),s=t.getBoundingClientRect(),n=o.left-s.left+o.width/2-s.width/2,i=o.top-s.top;window.AnimationUtils?(window.AnimationUtils.updateStyles(t,{"--throwX":`${n}px`,"--throwY":`${i}px`,animation:"paperCrumble 0.6s ease-in forwards"},"high"),window.AnimationUtils.updateStyles(e,{animation:"binShake 0.6s ease-in-out"},"high")):(t.style.setProperty("--throwX",`${n}px`),t.style.setProperty("--throwY",`${i}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out"),setTimeout(()=>{t.remove(),window.AnimationUtils?window.AnimationUtils.updateStyles(e,{animation:""},"normal"):e.style.animation="",tt(),Y()},600)},fe=t=>{const[e,o]=[$(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(jt(t),!0):!1},it=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>vt())):setTimeout(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{display:"none"},"normal"):t.style.display="none"},300)},vt=()=>{const t=$(".deleted-notes-container");window.AnimationUtils?window.AnimationUtils.updateStyles(t,{minHeight:"200px"},"normal"):t.style.minHeight="200px",t.innerHTML=k.length?k.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||Ve}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},to=t=>{const e=$$(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[o]=k.splice(t,1),s=pt(o.text,o.color,g(o.x),g(o.y),!0,o.width,o.height,o.isBold);window.DebouncedStorage.saveLow(lt,k),G(),vt(),requestAnimationFrame(()=>{window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O())}),Y()},300)},pe=()=>{if(k.length===0){it();return}const t=[...$$(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*Qt}ms`}),setTimeout(()=>{k=[],window.DebouncedStorage.saveLow(lt,k),G(),vt(),setTimeout(()=>{if(it(),et.length){const e=[...et];et=[],setTimeout(()=>{e.forEach(o=>{o!=null&&o.parentNode&&It(o)})},300)}},200)},(t.length?(t.length-1)*Qt+300:0)+100)},G=()=>{$(".trash-count").textContent=k.length};document.addEventListener("click",t=>{const e=$("#trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&it()});let Ot=new Set;const Yt=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,eo=()=>Math.random()*40-20,oo=(t=$t())=>t.getDay()===0?0:t.getDay()-1;function Ct(t){const e=document.getElementById("noteLimitMessage");if(!e)return;const o=e.querySelector(".transfer-text");o&&(o.textContent=t),e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3)}function Xt(){const t=$(".note-input textarea"),e=t.value.trim();if(!e)return;const o=$(`.board[data-board-id="${u}"]`),s=Array.from(o.querySelectorAll(".sticky-note")),n=o.classList.contains("board-pattern-weekdays"),i=o.classList.contains("board-pattern-days"),a=s.filter(h=>!h.dataset.transferred).length===0;if(!n&&!i&&s.length>=30){Ct("Maximum notes space reached.");return}const r=s.filter(h=>!h.dataset.transferred),l=r[r.length-1];let{x:d,y:c}=K[u]||{x:0,y:0},f=q[u]||getRandomColor(),m,y;const w=(h,v,X=null)=>{const T=o.offsetWidth/v,H=h*T+10,J=(h+1)*T-210,V=Math.max(H,Math.min(J,H+eo())),D=Array.from(o.querySelectorAll(".sticky-note")).filter(R=>R.style.display!=="none"&&R!==X),U=h*T,Z=(h+1)*T,z=D.filter(R=>{const _=g(R.style.left),ct=_+200,dt=Math.max(_,U),xt=Math.min(ct,Z);return Math.max(0,xt-dt)/200>.5});return{positionX:V,columnNotes:z}},p=(h,v)=>{const X=window.innerHeight-300;for(let T=0;T<v;T++){const H=(h+T)%v,{positionX:J,columnNotes:V}=w(H,v);let D=0,U=null;V.forEach(z=>{const R=g(z.style.top);R>D&&(D=R,U=z)});const Z=U?D+70:60;if(Z<=X)return m=J,y=Z,U&&(f=U.style.backgroundColor),!0}return Ct("Maximum notes space reached."),!1},C=h=>{let v;const X=h?6:5;if(l){const T=g(l.style.left),H=o.offsetWidth/X;v=Math.floor(T/H),v=Math.max(0,Math.min(v,X-1))}else v=h?oo():Rt(u)||0;return p(v,X)};if(a)if(n||i){if(C(n)===!1)return}else{const h=Math.max(150,window.innerWidth/4);({x:m,y}=Vt(h,50-70))}else if(n||i){if(C(n)===!1)return}else if(l&&(d=g(l.style.left),c=g(l.style.top),f=l.style.backgroundColor),{x:m,y}=Vt(d,c),y<=50){const h=s.filter(v=>Math.abs(g(v.style.left)-m)<150);if(h.length>0){const v=h.map(D=>g(D.style.top)),X=Math.max(...v),T=Math.min(...v),H=window.innerHeight-300,J=X+200,V=T-200;if(J<=H)y=J;else if(V>=50)y=V;else{const D=(Z,z)=>{const R=window.innerWidth-200;for(let _=Z;z>0?_<=R:_>=55;_+=z*250){const ct=s.filter(Et=>Math.abs(g(Et.style.left)-_)<150);if(ct.length===0)return{x:_,y:50};const dt=ct.map(Et=>g(Et.style.top)),xt=Math.max(...dt),Be=Math.min(...dt),zt=xt+200,Ft=Be-200;if(zt<=H)return{x:_,y:zt};if(Ft>=50)return{x:_,y:Ft}}return null},U=D(m+250,1)||D(m-250,-1);if(U)m=U.x,y=U.y;else{Ct("Maximum notes space reached.");return}}}}pt(e.replace(/\n/g,"<br>"),f,m,y,!1,"200px","150px",!1,u),K[u]={x:m,y},q[u]=f,t.value="",o.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(h=>{delete h.dataset.transferred}),window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O()),Y()}function pt(t,e,o,s,n=!1,i="200px",a="150px",r=!1,l=u,d=!1){const c=document.createElement("div"),f=Yt(),m=Nt();c.className="sticky-note",c.innerHTML=`<div class="sticky-content ${r?"bold":""}" contenteditable="true">${t}</div><div class="note-controls"><div class="color-button" style="background-color: ${e}"><div class="color-palette">${nt.map(w=>`<div class="color-option" style="background-color: ${w}" onclick="changeNoteColor(this, '${w}')"></div>`).join("")}</div></div><button class="bold-toggle ${r?"active":""}" onclick="toggleBold(this)">B</button><button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button></div><div class="resize-handle"></div>`,c.style.cssText=`background-color:${e}; left:${o}px; top:${s}px; width:${i}; height:${a}; z-index:${m};`,c.dataset.noteId=f,d&&(c.dataset.repositioned="true",Ot.add(f)),I[f]=m,de(),c.addEventListener("click",w=>{w.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||He(c)}),io(c);const y=$(`.board[data-board-id="${l}"]`);return y?(y.appendChild(c),c.style.animation="paperPop 0.3s ease-out forwards",n||window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O()),c):null}function no(t,e){event.stopPropagation();const o=t.closest(".sticky-note");(o.classList.contains("selected")?$$(".sticky-note.selected"):[o]).forEach(n=>{n.style.backgroundColor=e,n.querySelector(".color-button").style.backgroundColor=e}),q[u]=e,window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O())}const he=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),window.DebouncedStorage.saveLow(`${E}_board_${u}`,O())},so=$("#shortcutIcon")||$(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"}));so.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";$(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Xt())});let Tt=!1,x=null,at=!1,Bt=!1;function io(t){const e=t.querySelector(".sticky-content"),o=t.querySelector(".color-button"),s=t.querySelector(".color-palette");let n=!1,i=!1,a,r,l,d,c,f;e.addEventListener("input",tt),e.addEventListener("blur",tt),e.addEventListener("dblclick",p=>{e.contentEditable="true",e.focus(),p.stopPropagation()}),e.addEventListener("keydown",p=>{p.key==="Enter"&&p.shiftKey&&(e.contentEditable="false",tt())});let m;o.addEventListener("click",p=>{p.stopPropagation(),s.classList.contains("visible")?s.classList.remove("visible"):($$(".color-palette").forEach(C=>C.classList.remove("visible")),s.classList.add("visible"))}),s.addEventListener("mouseenter",()=>clearTimeout(m)),s.addEventListener("mouseleave",()=>{m=setTimeout(()=>s.classList.remove("visible"),100)}),t.addEventListener("mousedown",p=>{if(!p.target.closest(".color-palette")){if(b.includes(t)&&b.length>1)return Ke(p);p.shiftKey?b.includes(t)||(b.push(t),t.classList.add("selected")):bt(),p.preventDefault(),document.body.style.userSelect="none",a=p.clientX,r=p.clientY,p.target.closest(".resize-handle")?(i=!0,c=t.offsetWidth,f=t.offsetHeight):(n=!0,l=g(t.style.left),d=g(t.style.top),window.activeNote=t,M=[{element:t,x:l,y:d}]),document.addEventListener("mousemove",y),document.addEventListener("mouseup",w)}});function y(p){if(n){Tt||(Tt=!0,document.body.classList.add("drag-in-progress"));const C=Math.max(0,l+p.clientX-a),h=Math.max(0,d+p.clientY-r);t.style.left=C+"px",t.style.top=h+"px",ge(p.clientX,p.clientY)}if(i){const C=Math.max(150,c+p.clientX-a),h=Math.max(150,f+p.clientY-r);t.style.width=C+"px",t.style.height=h+"px"}}function w(p){if(document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",w),document.body.style.userSelect="",n){if(St(),!ve().moved){fe(t),ro(t);const h=t.dataset.noteId||Yt();t.dataset.noteId=h,t.dataset.repositioned="true",Ot.add(h),K[u]={x:g(t.style.left),y:g(t.style.top)},q[u]=t.style.backgroundColor}Tt=!1,document.body.classList.remove("drag-in-progress")}window.activeNote=null,(n||i)&&window.DebouncedStorage.save(`${E}_board_${u}`,O()),n=!1,i=!1}}function ao(){$$(".color-palette").forEach(t=>t.classList.remove("visible"))}document.addEventListener("click",t=>{t.target.closest(".color-button, .color-palette")||ao()});function ro(t){if(!t)return;const e=t.getBoundingClientRect();if(e.left<250&&e.bottom>window.innerHeight-150){const o=e.bottom-(window.innerHeight-150),s=Math.max(60,g(t.style.top)-o-20);t.style.top=s+"px"}}function ge(t,e){var m,y;if(Bt)return;const o=$(".status-bar");if(!o)return;const s=o.getBoundingClientRect(),[n,i]=[Math.max(0,Math.max(s.left-t,t-s.right)),Math.max(0,Math.max(s.top-e,e-s.bottom))],[a,r,l,d]=[Math.sqrt(n*n+i*i),120,80,x!==null],c=d?a<=r:a<=l,f=()=>{let[w,p]=[null,1/0];return $$(".board-button:not(.disabled)",!0).forEach(C=>{const h=C.getBoundingClientRect(),v=Math.sqrt(Math.pow(t-(h.left+h.width/2),2)+Math.pow(e-(h.top+h.height/2),2));v<p&&([w,p]=[C,v])}),w};if(c!==d)if(c){const w=$$(".board-button:not(.disabled)");x=f(),w.forEach(p=>p.classList.add("drag-active","drag-proximity")),x&&x.classList.add("drag-hover"),lo()}else $$(".board-button",!0).forEach(w=>{w.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>w.classList.remove("drag-active"),200)}),x=null,ye();else if(c&&x){const w=f();w!==x&&(x==null||x.classList.remove("drag-hover"),x=w,w?(w.classList.add("drag-hover"),St(),(m=$(".shortcut-hint"))==null||m.classList.add("hidden-during-drag")):(we(),at||(y=$(".shortcut-hint"))==null||y.classList.remove("hidden-during-drag")))}}function lo(){if(!x)return;const t=window.activeNote||ne,[e,o]=[x.getBoundingClientRect(),b.length>0?b:t?[t]:[]];o.forEach(s=>{if(s&&!s.classList.contains("reverse-animating")&&!s.classList.contains("hover-animating")){s.querySelectorAll("textarea, [contenteditable]").forEach(l=>{window.AnimationUtils?window.AnimationUtils.updateStyles(l,{userSelect:"none",pointerEvents:"none"}):[l.style.userSelect,l.style.pointerEvents]=["none","none"]});const[n,i]=[s.getBoundingClientRect(),s.closest(".board").getBoundingClientRect()],[a,r]=[e.left-i.left+e.width/2-(n.left-i.left)-n.width/2,e.top-i.top+e.height/2-(n.top-i.top)-n.height/2];window.AnimationUtils?window.AnimationUtils.updateStyles(s,{"--suckX":`${a}px`,"--suckY":`${r}px`,animation:"noteSuckHover 0.3s ease-out forwards"}):(s.style.setProperty("--suckX",`${a}px`),s.style.setProperty("--suckY",`${r}px`),s.style.animation="noteSuckHover 0.3s ease-out forwards"),s.classList.add("hover-animating")}})}function ye(){$$(".hover-animating",!0).forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{window.AnimationUtils?window.AnimationUtils.updateStyles(e,{userSelect:"",pointerEvents:""}):(e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events"))}),window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckReverse 0.3s ease-out forwards"}):t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"none","--suckX":"","--suckY":""}):([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY")),t.classList.remove("reverse-animating"))},300)})}function we(){var t;if(S>1&&!at&&!x){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),at=!0),(t=$(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function St(){var t;if(at){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),at=!1),(t=$(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function be(){$$(".board-button",!0).forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[x]=[null],ye(),St()}function ve(){if(!x)return{moved:!1};const t=window.activeNote||ne,[e,o]=[parseInt(x.dataset.boardId),b.length>0?[...b]:[t]];if(e===u)return o.forEach(n=>{if(n){const i=M==null?void 0:M.find(l=>l.element===n),a=i?i.x:parseFloat(n.style.left)||100,r=i?Math.max(60,i.y):parseInt(n.style.top||0)-250;n.classList.contains("hover-animating")&&(n.classList.remove("hover-animating"),n.style.removeProperty("--suckX"),n.style.removeProperty("--suckY"),n.style.animation="none"),n.style.transition="left 0.2s ease-out, top 0.2s ease-out, transform 0.2s ease-out",n.style.left=`${a}px`,n.style.top=`${r}px`,n.style.transform="scale(1)",setTimeout(()=>{n.style.transition="",n.style.transform=""},200)}}),{moved:!1};let s=new Map;return o.length>1&&typeof M!="undefined"&&M.length>0&&M.forEach(n=>{n&&o.includes(n.element)&&s.set(n.element,{originalX:n.x,originalY:n.y})}),o.forEach(n=>{n&&co(n,e,s.size>0?s.get(n):null)}),b.length>0&&bt(),{moved:!0}}function co(t,e,o=null){const s=t.style.left;if(t.classList.contains("hover-animating"))window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const n=$(`.board-button[data-board-id="${e}"]`);if(!n)return;const[i,a,r]=[n.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,d]=[i.left-r.left+i.width/2-(a.left-r.left)-a.width/2,i.top-r.top+i.height/2-(a.top-r.top)-a.height/2];window.AnimationUtils?window.AnimationUtils.updateStyles(t,{"--suckX":`${l}px`,"--suckY":`${d}px`,animation:"noteSuckHover 0.3s ease-out forwards"}):(t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${d}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards"),t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"noteSuckComplete 0.3s ease-in forwards"}):t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(i=>{window.AnimationUtils?window.AnimationUtils.updateStyles(i,{userSelect:"",pointerEvents:""}):(i.style.removeProperty("user-select"),i.style.removeProperty("pointer-events"))}),t.remove();const n=$(`.board[data-board-id="${e}"]`);if(n){if(window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"","--suckX":"","--suckY":""}):(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY")),o)if(o.originalX!==void 0&&o.originalY!==void 0)window.AnimationUtils?window.AnimationUtils.updatePosition(t,o.originalX,Math.max(60,o.originalY)):[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[a,r]=[100,80],l=a+(o.offsetX||0),d=Math.max(60,r+(o.offsetY||0));window.AnimationUtils?window.AnimationUtils.updatePosition(t,l,d):[t.style.left,t.style.top]=[`${l}px`,`${d}px`]}else{const a=M==null?void 0:M.find(r=>r.element===t);if(a)window.AnimationUtils?window.AnimationUtils.updatePosition(t,a.x,Math.max(60,a.y)):[t.style.left,t.style.top]=[`${a.x}px`,`${Math.max(60,a.y)}px`];else{const r=parseFloat(t.style.left)||100,l=parseFloat(t.style.top)||80;window.AnimationUtils?window.AnimationUtils.updatePosition(t,r,Math.max(60,l)):[t.style.left,t.style.top]=[`${r}px`,`${Math.max(60,l)}px`]}}const i=t.dataset.noteId||Yt();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[i,"true","true"],Ot.add(i),n.appendChild(t),window.AnimationUtils?window.AnimationUtils.updateStyles(t,{animation:"paperPop 0.3s ease-out forwards"}):t.style.animation="paperPop 0.3s ease-out forwards",Y(),be(),Bt=!0,setTimeout(()=>Bt=!1,500),setTimeout(()=>{const a=u;[u]=[e],window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O()),[u]=[a],window.DebouncedStorage.saveHigh(`${E}_board_${u}`,O())},100)}},600)}let A={},N=null,ut={x:0,y:0},B=[];function Se(){po(),Ae(),mo(),$$(".emoji-item").forEach(t=>{t.addEventListener("click",$e)})}const $e=t=>{const e=t.target.dataset.emoji;e&&(fo(e),uo(e))};function uo(t){const e=$(".board.active");if(!e)return;const o=e.dataset.boardId;if(go(o)>=10)return yo();const s=bo(),n=e.getBoundingClientRect(),[i,a,r]=[n.width-120,n.height*.8-120,20],[l,d]=[Math.random()*i,Math.max(r,Math.random()*a)],c=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});c.dataset.stickerId=s,Object.assign(c.style,{left:l+"px",top:d+"px"});const f=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});f.addEventListener("click",m=>[m.stopPropagation(),Ee(s,o)]),c.appendChild(f),xe(c),e.appendChild(c),(A[o]=A[o]||{})[s]={emoji:t,x:l,y:d,id:s},Ht(o),setTimeout(()=>c.classList.remove("new"),400)}function xe(t){let e=!1;t.addEventListener("mousedown",o);function o(i){if(i.target.classList.contains("delete-button"))return;i.preventDefault(),i.stopPropagation(),[e,N]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[a,r]=[i.clientX,i.clientY],l=t.getBoundingClientRect();[ut.x,ut.y]=[a-l.left,r-l.top],t.classList.add("dragging"),document.addEventListener("mousemove",s),document.addEventListener("mouseup",n)}function s(i){if(!e||!N)return;i.preventDefault(),i.stopPropagation();const[a,r]=[i.clientX,i.clientY],l=$(".board.active").getBoundingClientRect(),[d,c]=[Math.max(0,Math.min(a-l.left-ut.x,l.width-120)),Math.max(0,Math.min(r-l.top-ut.y,l.height-120))];window.AnimationUtils?window.AnimationUtils.updatePosition(N,d,c):Object.assign(N.style,{left:d+"px",top:c+"px"})}function n(){var r;if(!e||!N)return;N.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],wo(N);const[i,a]=[$(".board.active").dataset.boardId,N.dataset.stickerId];(r=A[i])!=null&&r[a]&&(Object.assign(A[i][a],{x:parseInt(N.style.left),y:parseInt(N.style.top)}),Ht(i)),N=null,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",n)}}const Ee=(t,e)=>{const o=$(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),A[e]&&(delete A[e][t],Ht(e))},Ht=t=>{window.DebouncedStorage.save(`emojiStickers_board_${t}`,A[t]||{})};function Le(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{A[t]=e?JSON.parse(e):{},e&&ke(t)}catch(o){console.error("Error loading emoji stickers:",o),A[t]={}}}const mo=()=>Array.from({length:S},(t,e)=>Le(e+1));function ke(t){const e=$(`.board[data-board-id="${t}"]`);!e||!A[t]||(Array.from(e.querySelectorAll(".emoji-sticker")).forEach(o=>o.remove()),Object.values(A[t]).forEach(({id:o,emoji:s,x:n,y:i})=>{const a=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:s});a.dataset.stickerId=o,window.AnimationUtils?window.AnimationUtils.updatePosition(a,n,i):Object.assign(a.style,{left:n+"px",top:i+"px"});const r=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});r.addEventListener("click",l=>[l.stopPropagation(),Ee(o,t)]),a.appendChild(r),xe(a),e.appendChild(a)}))}function fo(t){const e=B.indexOf(t);(e<0||e>=12)&&(e>-1&&B.splice(e,1),B.unshift(t),B.length>16&&(B=B.slice(0,16)),ho(),Ae())}function po(){const t=localStorage.getItem("emojiUsageOrder");try{B=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),B=[]}}const ho=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(B));function Ae(){const t=$(".emoji-picker");t&&(Array.from(t.querySelectorAll(".recent-emoji")).forEach(e=>e.remove()),B.length>0&&B.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",$e),t.insertBefore(o,t.firstChild)}))}const go=t=>A[t]?Object.keys(A[t]).length:0,yo=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function wo(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[s,n,i]=[250,150,o-150];if(e.left<s&&e.bottom>i){const r=Math.max(60,parseInt(t.style.top)-(e.bottom-i+20));t.style.top=`${r}px`}}const bo=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),vo=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete A[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Se,100));window.emojiStickers={loadEmojiStickers:Le,renderEmojiStickers:ke,cleanupEmojiStickers:vo,initializeEmojiPicker:Se};const $t=()=>new Date,Ce=t=>{const e=$t().getDay(),o=e===0?6:e-1;return t===o},So=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,$t().toISOString().split("T")[0])},Rt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor(($t()-new Date(e))/(1e3*60*60*24))%5:-1},Te=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),te=()=>{if(S>=st){alert(`Maximum number of boards (${st}) reached.`);return}Dt(++S),ae(),yt()};function Dt(t){const e=$(".boards-container"),o=Object.assign(document.createElement("div"),{className:"board"});o.dataset.boardId=t,e.appendChild(o);const s=Object.assign(document.createElement("div"),{className:"board-title-circle"}),n=[],i=()=>{var m;(m=$within(s,".board-title-input"))==null||m.focus()};s.addEventListener("click",i),n.push({element:s,event:"click",handler:i});const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let r;const l=()=>{const m=a.value.trim();if(!m){a.value=a.dataset.originalTitle||"";return}Pt(t,m),wt(a)},d=()=>{clearTimeout(r),r=setTimeout(l,500)};a.addEventListener("input",d),n.push({element:a,event:"input",handler:d}),wt(a),s.appendChild(a),o.appendChild(s);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});c.dataset.boardId=t;const f=()=>j(t);if(c.addEventListener("click",f),n.push({element:c,event:"click",handler:f}),t>1){const m=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"}),y=w=>{w.stopPropagation(),ht(t)};m.addEventListener("click",y),n.push({element:m,event:"click",handler:y}),c.appendChild(m)}o._eventCleanup=()=>{n.forEach(({element:m,event:y,handler:w})=>{m.removeEventListener(y,w)}),clearTimeout(r)},$(".boards-navigation").insertBefore(c,$(".add-board-button")),setTimeout(()=>[c.classList.remove("new-button"),c.classList.add("transitions-ready")],500),rt(t),qt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function ht(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=$(`.board[data-board-id="${t}"]`);if(!e){Mt(t);return}const[o,s]=[Array.from(e.querySelectorAll(".sticky-note")),Array.from(e.querySelectorAll(".emoji-sticker"))];if(o.length||s.length){const n=$(".trash-bin"),i=n.getBoundingClientRect();window.AnimationUtils?window.AnimationUtils.updateStyles(n,{animation:"binShake 0.5s ease-in-out"},"high"):n.style.animation="binShake 0.5s ease-in-out",o.forEach(a=>{const r=$within(a,".sticky-content");k.unshift({text:r.innerHTML,color:a.style.backgroundColor,x:a.style.left,y:a.style.top,width:a.style.width,height:a.style.height,timestamp:new Date().toLocaleString(),isBold:r.classList.contains("bold")});const l=a.getBoundingClientRect(),[d,c]=[i.left-l.left+i.width/2-l.width/2,i.top-l.top];window.AnimationUtils?window.AnimationUtils.updateStyles(a,{"--throwX":`${d}px`,"--throwY":`${c}px`,animation:"paperCrumble 0.5s ease-in forwards"},"high"):(a.style.setProperty("--throwX",`${d}px`),a.style.setProperty("--throwY",`${c}px`),a.style.animation="paperCrumble 0.5s ease-in forwards")}),s.forEach(a=>a.classList.add("deleting")),window.DebouncedStorage.saveLow(lt,k),G(),console.log("Setting timeout for continueWithBoardDeletion, boardId:",t),setTimeout(()=>{console.log("Timeout fired, calling continueWithBoardDeletion"),Mt(t)},600)}else Mt(t)}function Mt(t){console.log("continueWithBoardDeletion called with boardId:",t);const[e,o]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];console.log("Found elements:",{boardElement:e,buttonElement:o}),e!=null&&e._eventCleanup&&e._eventCleanup(),e&&e.remove(),o&&o.classList.add("removing");const s=[];for(let n=t+1;n<=S;n++){const i=$(`.board-button[data-board-id="${n}"]`);i&&(i.classList.add("removing"),s.push(n))}[`${E}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(n=>localStorage.removeItem(n)),Te(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let n=t+1;n<=S;n++)["boardColor","boardPattern","boardStyles_board"].forEach(i=>{const[a,r,l]=[`${i}_${n}`,`${i}_${n-1}`,localStorage.getItem(`${i}_${n}`)];l&&localStorage.setItem(r,l),localStorage.removeItem(a)});setTimeout(()=>{o&&o.remove();const[n,i]=[$(".boards-navigation"),$(".add-board-button")];s.forEach(a=>{const[r,l,d]=[$(`.board-button[data-board-id="${a}"]`),$(`.board[data-board-id="${a}"]`),a-1];r&&r.remove(),l&&(l.dataset.boardId=d);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:d});if([c.dataset.boardId,c.dataset.originalNumber]=[d,d],c.addEventListener("click",()=>j(d)),d>1){const f=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});f.addEventListener("click",m=>{m.stopPropagation(),ht(d)}),c.appendChild(f)}n.insertBefore(c,i),["","Title","Color","Pattern"].forEach(f=>{const[m,y,w]=[f?`stickyNotes_board${f}`:E,`${f?`stickyNotes_board${f}`:E}_board_${a}`,`${f?`stickyNotes_board${f}`:E}_board_${d}`],p=localStorage.getItem(y);p&&(localStorage.setItem(w,p),localStorage.removeItem(y))}),rt(d)}),setTimeout(()=>$$(".board-button.new-button").forEach(a=>[a.classList.remove("new-button"),a.classList.add("transitions-ready")]),500),S--,ae(),yt(),u===t?j(t>1?t-1:S>=1?1:null):u>t&&(u--,j(u)),window.AnimationUtils?window.AnimationUtils.updateStyles($(".trash-bin"),{animation:""},"normal"):$(".trash-bin").style.animation=""},350)}function j(t){const e=parseInt(t);e===u||e===null||(Lo(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),u=e,K[t]||(K[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),q[t]||(q[t]=nt[0]),$$(".board").forEach(o=>{const s=parseInt(o.dataset.boardId);if(o.classList.remove("active","prev","next"),window.AnimationUtils?window.AnimationUtils.updateStyles(o,{visibility:"hidden"},"high"):o.style.visibility="hidden",s===u){if(o.classList.add("active"),window.AnimationUtils?window.AnimationUtils.updateStyles(o,{visibility:"visible"},"high"):o.style.visibility="visible",Array.from(o.querySelectorAll(".sticky-note")).forEach((n,i)=>window.AnimationUtils?window.AnimationUtils.updateStyles(n,{"--note-index":i.toString()},"low"):n.style.setProperty("--note-index",i)),Array.from(o.querySelectorAll(".emoji-sticker")).forEach((n,i)=>window.AnimationUtils?window.AnimationUtils.updateStyles(n,{"--sticker-index":i.toString()},"low"):n.style.setProperty("--sticker-index",i)),!$within(o,".board-title-circle")){const n=Object.assign(document.createElement("div"),{className:"board-title-circle"});n.setAttribute("onclick","$within(this, '.board-title-input').focus()");const i=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),a=()=>Pt(s,i.value);["change","blur"].forEach(r=>i.addEventListener(r,a)),n.appendChild(i),o.appendChild(n),qt(s)}}else o.classList.add(s<u?"prev":"next")}),$$(".board-button").forEach(o=>o.classList.toggle("active",parseInt(o.dataset.boardId)===u)),rt(u),Ne(),$$(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=L.colors.current),Y(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(u),setTimeout(()=>Ie(u),300))}let gt=[];function $o(){xo();const t=te;$(".add-board-button").addEventListener("click",t),gt.push({element:$(".add-board-button"),event:"click",handler:t}),$$(".board-button").forEach(o=>{const[s,n]=[parseInt(o.dataset.boardId),o.cloneNode(!0)],i=()=>j(s);n.addEventListener("click",i);const a=$within(n,".delete-board");if(a){const r=l=>{l.stopPropagation(),ht(s)};a.addEventListener("click",r)}o.parentNode.replaceChild(n,o)});const e=o=>{const[s,n]=[o.target.tagName,o.target.getAttribute("contenteditable")==="true"];if((o.key==="Control"||o.key==="Meta")&&!o.altKey&&!o.shiftKey&&s!=="TEXTAREA"&&!n){o.preventDefault(),$(".note-input textarea").focus();return}if(s==="TEXTAREA"||n){(o.metaKey||o.ctrlKey)&&o.key==="Enter"&&(o.preventDefault(),Xt());return}o.key==="ArrowLeft"&&u>1?j(u-1):o.key==="ArrowRight"&&u<S?j(u+1):o.key==="n"&&o.ctrlKey?(o.preventDefault(),te()):o.key==="d"&&o.ctrlKey&&u>1&&(o.preventDefault(),ht(u));const i=parseInt(o.key);!isNaN(i)&&i>=1&&i<=9&&i<=S&&j(i)};document.addEventListener("keydown",e),gt.push({element:document,event:"keydown",handler:e})}function xo(){gt.forEach(({element:t,event:e,handler:o})=>{t.removeEventListener(e,o)}),gt=[]}function yt(){const t=$(".add-board-button"),e=S>=st;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${st}) reached`:"Add new board",Eo()}function Eo(){const t=$(".shortcut-hint");t&&(t.style.display=S>=2?"block":"none")}let ee=!1;function Lo(){if(ee||S<2)return;const t=$(".shortcut-hint");t&&(ee=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function ko(){const t=$(".board-style-menu"),e=t.classList.contains("visible");e||(Ne(),Me(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=L.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function Me(){$(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?Ao(o):To(o),document.querySelectorAll(`.board-${e}-option`).forEach(s=>s.classList.remove("active")),t.classList.add("active")})})}function Ne(){["color","pattern"].forEach(t=>{$$(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===L[`${t}s`].current)})})}function Ut(){return $(".board.active")}function Ao(t){L.colors.current=t;const e=Ut();e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),re(),Y(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function Co(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; transition:opacity 0.3s ease-out; opacity:0;"}),o=$(`.board[data-board-id="${u}"]`);if(t!=="none"){const s={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(s[t])e.style.cssText+=s[t];else if(t==="weekdays"||t==="days"){const n=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((a,r)=>{const l=Object.assign(document.createElement("span"),{textContent:a});(t==="weekdays"&&Ce(r)||t==="days"&&Rt(u)===r)&&l.classList.add("current-day"),n.appendChild(l)}),e.appendChild(n),o==null||o.classList.add("has-header")}}else o==null||o.classList.remove("has-header");return e}function To(t){const[e,o,s]=[Ut(),Ut().dataset.boardId,L.patterns.current];s==="days"&&t!=="days"&&Te(o),L.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay, .weekday-header, .day-header").forEach(a=>a.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),Array.from(e.children).forEach(a=>{a.tagName==="DIV"&&a.style.position==="absolute"&&a.style.pointerEvents==="none"&&(a.style.zIndex==="0"||a.style.zIndex==="1"||a.style.top==="0px"||a.style.left==="0px")&&a.remove()}),t==="days"&&So(o);const n=Co(t);e.appendChild(n);let i=null;(t==="weekdays"||t==="days")&&(i=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.3s ease;"}),e.appendChild(i)),n.offsetWidth,requestAnimationFrame(()=>{n.style.opacity="1",i&&(i.style.opacity="1")}),n.addEventListener("transitionend",()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),n.classList.add("pattern-overlay"),i&&i.classList.add("pattern-overlay")):t!=="none"&&e.classList.add(`board-pattern-${t}`),Y()},{once:!0}),re()}function Mo(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(i,a)=>`Day ${a+1}`)).forEach((i,a)=>{const r=Object.assign(document.createElement("span"),{textContent:i});(e.pattern==="weekdays"&&Ce(a)||e.pattern==="days"&&Rt(parseInt(t.dataset.boardId))===a)&&r.classList.add("current-day"),o.appendChild(r)}),t.appendChild(o);const n=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(n)}}function rt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=$(`.board[data-board-id="${t}"]`);if(!o)return;let s;e?(s=JSON.parse(e),t===u&&(L.colors.current=s.color,L.patterns.current=s.pattern)):(s={color:L.colors.default,pattern:L.patterns.default},t===u&&(L.colors.current=s.color,L.patterns.current=s.pattern)),Mo(o,s),Y()}No();document.addEventListener("click",function(t){const e=$(".board-style-menu"),o=$(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function No(){document.querySelectorAll(".board").forEach(t=>qt(t.dataset.boardId))}function Pt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=$(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function wt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function qt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=$(`.board[data-board-id="${t}"]`);if(o){const n=o.querySelector(".board-title-input");n&&e&&(n.value=e)}const s=$(`.board-button[data-board-id="${t}"]`);s&&!s.dataset.originalNumber&&(s.dataset.originalNumber=s.textContent)}function Ie(t){const e=$(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function Io(){$$(".board-title-circle").forEach(t=>{let e;const[o,s]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((n,i)=>{t.addEventListener(n,()=>{i===0?(o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")):i===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()):o&&o.focus()})}),o){let n;const i=()=>{const a=o.value.trim();if(!a){o.dataset.originalTitle="";return}Pt(s,a),wt(o)};o.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(i,500)}),wt(o)}})}const Y=()=>{for(let t=1;t<=S;t++){const[e,o]=[$(`.board[data-board-id="${t}"]`),$(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;const s=e.style.backgroundColor||L.colors.default;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),o.style.backgroundColor=s;const n=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],i=n.find(r=>e.classList.contains(r));n.forEach(r=>o.classList.remove(r.replace("board-pattern","button-pattern"))),i&&o.classList.add(i.replace("board-pattern","button-pattern"));const a=Ye(s)||{r:26,g:26,b:26};o.style.color=(a.r*299+a.g*587+a.b*114)/1e3>128?"#000":"#fff"}};function Bo(t){t.forEach(({selector:e,event:o,handler:s})=>{const n=$(e);n&&n.addEventListener(o,s)})}const Do=function(){Re(),ce(),le(),$o(),Me(),Pe(),_t(),Io(),Uo(),setTimeout(()=>Ie(u),500),_o(),Bo([{selector:".board-style-button",event:"click",handler:ko},{selector:".trash-bin",event:"click",handler:it},{selector:"#trashModal .close-modal-btn",event:"click",handler:it},{selector:"#trashModal .clear-trash-btn",event:"click",handler:pe}])};document.addEventListener("DOMContentLoaded",Do);function Uo(){const t=n=>{const i=n.selectionStart,a=n.value;if(a.length>0){const r=a.charAt(0).toUpperCase()+a.slice(1);r!==a&&(n.value=r,n.setSelectionRange(i,i))}},e=n=>{["input","keyup"].forEach(a=>{n.addEventListener(a,r=>t(r.target))});const i=a=>setTimeout(()=>t(a.target),0);n.addEventListener("paste",i)};$$(".board-title-input, .note-input textarea").forEach(e);const o=new MutationObserver(n=>{n.forEach(i=>{i.addedNodes.forEach(a=>{var r;a.nodeType===1&&((a.querySelectorAll?Array.from(a.querySelectorAll(".board-title-input")):[]).forEach(e),(r=a.classList)!=null&&r.contains("board-title-input")&&e(a))})})}),s=$(".boards-container");s&&o.observe(s,{childList:!0,subtree:!0})}function _o(){setTimeout(()=>{$$(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>{window.AnimationUtils?window.AnimationUtils.updateStyles(t,{transform:"scale(1)"},"normal"):t.style.transform="scale(1)"})})},100)}window.toggleBold=he;window.markAsDone=jt;window.addNote=Xt;window.restoreNote=to;window.changeNoteColor=no;window.markAsDone=jt;window.toggleBold=he;window.clearTrash=pe;})();
