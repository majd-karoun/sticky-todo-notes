(()=>{const nt=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],A={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let U=[];let V=null,Ut=null,dt=!1,Z=null,ut=0,mt=0,w=[],st=!1,Kt=0,Jt=0,F=[];const J={},Q={},X={};let H=1e3;J[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};Q[1]=nt[0];let m=1,T=1,G=!1;const et=9,ft="stickyNotes_active",Vt="stickyNotes_deleted",Zt="stickyNotes_boardCount",Gt="stickyNotes_zIndexes",Qt=()=>{G=window.innerWidth<=768,G&&m!==1&&typeof Y=="function"&&Y(1)},S=t=>parseInt(String(t).replace("px",""))||0,Ot=(t,e)=>{const o=Math.random()*10-5;let n=t+o,a=e+70;const s=5,r=window.innerWidth-200,i=window.innerHeight-300;a>i&&(a=50,n=t+250,n>r&&(n=s+50,a=50));const l=Math.min(Math.max(n,s),r),f=Math.min(Math.max(a,s),window.innerHeight-100);return{x:l,y:f}},ke=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,n,a,s)=>n+n+a+a+s+s);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},qt=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(o){console.error(`Failed to save to localStorage (${t}):`,o)}},K=()=>{const t=document.querySelector(`.board[data-board-id="${m}"]`);if(!t)return;const e=Array.from(t.querySelectorAll(".sticky-note")).map(o=>({text:o.querySelector(".sticky-content").innerHTML,color:o.style.backgroundColor,x:o.style.left,y:o.style.top,width:o.style.width||"200px",height:o.style.height||"150px",isBold:o.querySelector(".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}));qt(`${ft}_board_${m}`,e),typeof z=="function"&&z()},Nt=()=>qt(Vt,U),te=()=>localStorage.setItem(Zt,T.toString()),ee=()=>qt(`boardStyles_board_${m}`,{color:A.colors.current,pattern:A.patterns.current}),oe=()=>{const t=document.getElementById("shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},ne=()=>{const t=document.querySelector(".note-input textarea");if(!t)return;const e=document.getElementById("shortcutIcon"),o=()=>{if(!e)return;const n=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",a=t.value.trim();e.innerHTML=a?`${n}+\u21B5`:n,e.classList.toggle("focus-hint",!a),e.classList.toggle("enter-hint",a)};t.addEventListener("focus",()=>{o(),t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px"),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{oe(),t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px"),t.removeEventListener("input",o)}),document.addEventListener("mousedown",n=>{!n.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},Pt=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},Ce=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{console.log("Performing one-time localStorage cleanup...");const e=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&(n.startsWith("stickyNotes_")||n.startsWith("boardColor_")||n.startsWith("boardPattern_")||n.startsWith("boardStyles_")||n.startsWith("emojiStickers_")||n.startsWith("daysPatternStartDate_")||n.startsWith("emojiUsageOrder"))&&e.push(n)}e.forEach(o=>{localStorage.removeItem(o)}),console.log(`Cleaned up ${e.length} localStorage items`),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},Te=()=>{try{Ce(),Qt(),typeof _t=="function"&&_t();const t=localStorage.getItem(Zt);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){T=Math.min(o,et);for(let n=2;n<=T;n++)typeof Bt=="function"&&Bt(n)}}typeof bt=="function"&&bt();for(let o=1;o<=T;o++){const n=localStorage.getItem(`${ft}_board_${o}`);if(n){const a=Pt(n,[]);Array.isArray(a)&&a.forEach(s=>{if(s&&typeof s=="object"&&s.text&&(J[o]={x:S(s.x),y:S(s.y)},Q[o]=s.color||nt[0],typeof Ct=="function")){const r=Ct(s.text,s.color||nt[0],S(s.x),S(s.y),!0,s.width||"200px",s.height||"150px",s.isBold||!1,o);r&&s.noteId&&(r.dataset.noteId=s.noteId,X[s.noteId]?(r.style.zIndex=X[s.noteId],X[s.noteId]>H&&(H=X[s.noteId])):s.zIndex&&!isNaN(parseInt(s.zIndex))&&(r.style.zIndex=s.zIndex,X[s.noteId]=parseInt(s.zIndex),parseInt(s.zIndex)>H&&(H=parseInt(s.zIndex))))}})}typeof ct=="function"&&ct(o)}typeof Y=="function"&&Y(1);const e=localStorage.getItem(Vt);if(e){const o=Pt(e,[]);Array.isArray(o)&&(U=o,typeof at=="function"&&at())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),oe(),ne()}catch(t){console.error("Critical error loading saved data:",t)}},$e=t=>{t.style.zIndex=++H;const e=t.dataset.noteId;e&&(X[e]=H,se())},se=()=>{try{localStorage.setItem(Gt,JSON.stringify(X))}catch(t){console.error("Error saving note z-indexes:",t)}},Be=()=>{try{const t=localStorage.getItem(Gt);t&&(Object.assign(X,JSON.parse(t)),H=Math.max(1e3,...Object.values(X)))}catch(t){console.error("Error loading note z-indexes:",t)}};const _t=()=>{Z=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(Z.style,{display:"none"}),document.body.appendChild(Z)};function qe(){const t=document.querySelector(".boards-container");document.addEventListener("mousedown",e=>{e.target.closest(".board")&&!e.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&e.preventDefault()}),[["mousedown",Ne],["mousemove",Me],["mouseup",Ie]].forEach(([e,o])=>(e==="mousedown"?t:document).addEventListener(e,o))}function Ne(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=document.querySelector(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&St(),[dt,ut,mt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),Z.style.cssText=`left:${ut}px; top:${mt}px; width:0; height:0; display:block;`}function Me(t){if(!dt)return;t.preventDefault();const[e,o]=[Math.abs(t.clientX-ut),Math.abs(t.clientY-mt)],[n,a]=[Math.min(t.clientX,ut),Math.min(t.clientY,mt)];Z.style.cssText=`left:${n}px; top:${a}px; width:${e}px; height:${o}px; display:block;`,Ae()}const Ie=()=>{dt&&(dt=!1,document.body.classList.remove("selecting"),Z.style.display="none")};function Ae(){const t=Z.getBoundingClientRect(),e=document.querySelector(`.board[data-board-id="${m}"]`);if(!e)return;const o=(n,a,s)=>{const r=n.getBoundingClientRect(),i=!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom),l=a.indexOf(n);i?l===-1&&(a.push(n),n.classList.add(s)):!st&&l!==-1&&(a.splice(l,1),n.classList.remove(s))};e.querySelectorAll(".sticky-note").forEach(n=>o(n,w,"selected"))}const St=()=>{w.forEach(t=>t.classList.remove("selected")),w=[]};function De(t){[st,Kt,Jt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),F=w.map(e=>({element:e,x:S(e.style.left),y:S(e.style.top),type:"note"})),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,e==="mousemove"?ae:re))}function ae(t){if(!st)return;const[e,o]=[t.clientX-Kt,t.clientY-Jt],[n,a,s]=[5,-5,-5],[r,i]=[window.innerWidth-n,window.innerHeight-n];(f=>f.forEach(d=>{const[g,h]=[Math.min(Math.max(d.x+e,a),r-d.element.offsetWidth/4),Math.min(Math.max(d.y+o,s),i-d.element.offsetHeight/4)];Object.assign(d.element.style,{left:`${g}px`,top:`${h}px`})}))(F),w.length>0&&(de(t.clientX,t.clientY),w.length>1&&At())}function re(){if(!st)return;if(st=!1,document.body.classList.remove("selecting"),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,e==="mousemove"?ae:re)),it(),!me().moved){K();for(let e=w.length-1;e>=0;e--)ce(w[e])&&w.splice(e,1)}Dt()}let ot=[];const Re=100,Xt=50,Ye="#ffd700",ie=t=>{w.includes(t)&&w.length>1?(w.forEach((e,o)=>setTimeout(()=>kt(e),o*100)),St()):kt(t)},kt=t=>{if(U.length>Re)return!ot.includes(t)&&ot.push(t),Xe();const e=t.querySelector(".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};je(t),U.unshift(o),Nt(),at(),Oe(t)},je=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,n]=[e.getBoundingClientRect(),t.getBoundingClientRect()],a=Math.min(5,Math.max(0,Math.floor((n.left+n.width/2-o.left)/(o.width/6))));window.noteColumns[a]&&(window.noteColumns[a]=window.noteColumns[a].filter(s=>Math.abs(s.x-S(t.style.left))>1||Math.abs(s.y-S(t.style.top))>1))},Oe=t=>{const e=document.querySelector(".trash-bin"),o=e.getBoundingClientRect(),n=t.getBoundingClientRect(),a=o.left-n.left+o.width/2-n.width/2,s=o.top-n.top;t.style.setProperty("--throwX",`${a}px`),t.style.setProperty("--throwY",`${s}px`),t.style.animation="paperCrumble 0.5s ease-in forwards",e.style.animation="binShake 0.5s ease-in-out",setTimeout(()=>{t.remove(),e.style.animation="",K(),z()},500)},ce=t=>{const[e,o]=[document.querySelector(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(ie(t),!0):!1},yt=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>ht())):setTimeout(()=>t.style.display="none",300)},ht=()=>{const t=document.querySelector(".deleted-notes-container");t.innerHTML=U.length?U.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||Ye}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'};const Pe=()=>{const t=[...document.querySelectorAll(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*Xt}ms`}),setTimeout(()=>{const e=()=>{if(ot.length){const o=[...ot];ot=[],setTimeout(()=>o.forEach(n=>(n==null?void 0:n.parentNode)&&kt(n)),100)}};U=[],Nt(),at(),ht(),setTimeout(()=>[yt(),e()],200)},350+(t.length?(t.length-1)*Xt:0)+100)},at=()=>{document.querySelector(".trash-count").textContent=U.length};document.addEventListener("click",t=>{const e=document.getElementById("trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&yt()});let Mt=new Set;const It=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,_e=()=>Math.random()*40-20,Ht=(t=Et())=>t.getDay()===0?0:t.getDay()-1;function Lt(t){const e=document.getElementById("noteLimitMessage"),o=e==null?void 0:e.querySelector(".transfer-text");o&&(o.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function Xe(){const[t,e]=[document.getElementById("trashModal"),document.querySelector(".clear-trash-btn")];t&&!t.classList.contains("visible")&&([t.style.display,t.classList]=["block",t.classList.add("visible")],typeof ht=="function"&&ht()),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))}function le(){const t=document.querySelector(".note-input textarea"),e=t.value.trim();if(!e)return;const o=document.querySelector(`.board[data-board-id="${m}"]`),n=Array.from(o.querySelectorAll(".sticky-note")),[a,s,r]=[o.classList.contains("board-pattern-weekdays"),o.classList.contains("board-pattern-days"),n.length===0];if(!a&&!s&&n.length>=30){Lt("Maximum notes space reached.");return}const i=n[n.length-1];let{x:l,y:f}=J[m]||{x:0,y:0},d=Q[m]||getRandomColor(),g,h;const L=(p,v)=>{const C=o.offsetWidth/v,N=p*C+10,M=(p+1)*C-210;return Math.max(N,Math.min(M,N+_e()))},k=(p,v,C=null)=>{const N=[".note",".sticky-note",'[class*="note"]','div[draggable="true"]'];let M=[];for(const c of N){const u=Array.from(o.querySelectorAll(c));if(u.length>0){M=u.filter(y=>y.style.display!=="none"&&y!==C);break}}const D=o.offsetWidth/v,[$,E]=[p*D,(p+1)*D];return M.filter(c=>{const[u,y,b]=[S(c.style.left),200,S(c.style.left)+200],[x,B]=[Math.max(u,$),Math.min(b,E)];return Math.max(0,B-x)/y>.5})},I=(p,v)=>{const C=k(p,v);console.log(`setColumnNotePosition: Column ${p} has ${C.length} notes`);let N=60,M=null;C.forEach(E=>{const c=S(E.style.top);console.log(`Note Y position: ${c}, current lastY: ${N}`),c>=N&&(N=c,M=E,console.log(`Updated lastY to: ${N}`))});const D=window.innerHeight-300;let $=M?N+70:60;if(g=L(p,v),$>D)h=60;else return h=$,M&&(d=M.style.backgroundColor,console.log(`Inheriting color from last note: ${d}`)),!0;if($>D){console.log(`Column ${p} is full (position ${$} > threshold ${D}), looking for next column...`);let E=(p+1)%v,c=0,u=!1;for(;c<v;){console.log(`Checking column ${E} (attempt ${c+1})`);const y=k(E,v,null);let b=60;y.forEach(B=>{const R=S(B.style.top);R>=b&&(b=R)});const x=y.length>0?b+70:60;if(console.log(`Column ${E} next position would be ${x}, threshold is ${D}`),x<=D){if(console.log(`Using column ${E} with space`),p=E,g=L(E,v),y.length===0)$=60,h=$;else{let B=60,R=null;y.forEach(W=>{const O=S(W.style.top);O>=B&&(B=O,R=W)}),$=B+70,h=$,R&&(d=R.style.backgroundColor,console.log(`Inheriting color from last note in next column: ${d}`))}u=!0;break}else console.log(`Column ${E} is full (position threshold exceeded), trying next...`),E=(E+1)%v,c++}if(!u)return console.log("No available columns found, showing limit message"),Lt("Maximum notes space reached."),!1}},tt=p=>{if(p)return I(Ht(),6);{const v=gt(m);return I(v===-1?0:v,5)}};if(r)if(a||s){if(tt(a)===!1)return}else g=Math.max(150,window.innerWidth/4),h=50;else if(a||s){if(a){if(I(Ht(),6)===!1)return}else if(s){const p=gt(m);if(I(p===-1?0:p,5)===!1)return}}else if(i?([l,f,d]=[S(i.style.left),S(i.style.top),i.style.backgroundColor],{x:g,y:h}=Ot(l,f)):{x:g,y:h}=Ot(l,f),h<=50){const p=n.filter(v=>{const C=S(v.style.left);return Math.abs(C-g)<150});if(p.length>0){let v=0,C=window.innerHeight;p.forEach($=>{const E=S($.style.top);E>v&&(v=E),E<C&&(C=E)});const N=window.innerHeight-300,M=v+200,D=C-200;if(M>N)if(D>=50)h=D;else{const $=window.innerWidth-200,E=250;let c=!1,u=g+E;for(;u<=$&&!c;){const y=n.filter(b=>{const x=S(b.style.left);return Math.abs(x-u)<150});if(y.length===0)g=u,h=50,c=!0;else{let b=0,x=window.innerHeight;y.forEach(W=>{const O=S(W.style.top);O>b&&(b=O),O<x&&(x=O)});const B=b+200,R=x-200;B<=N?(g=u,h=B,c=!0):R>=50&&(g=u,h=R,c=!0)}c||(u+=E)}if(!c)for(u=55;u<g&&!c;){const y=n.filter(b=>{const x=S(b.style.left);return Math.abs(x-u)<150});if(y.length===0)g=u,h=50,c=!0;else{let b=0,x=window.innerHeight;y.forEach(W=>{const O=S(W.style.top);O>b&&(b=O),O<x&&(x=O)});const B=b+200,R=x-200;B<=N?(g=u,h=B,c=!0):R>=50&&(g=u,h=R,c=!0)}c||(u+=E)}if(!c){Lt("Maximum notes space reached.");return}}else h=M}}Ct(e.replace(/\n/g,"<br>"),d,g,h,!1,"200px","150px",!1,m),[J[m],Q[m],t.value]=[{x:g,y:h},d,""],K(),z()}function Ct(t,e,o,n,a=!1,s="200px",r="150px",i=!1,l=m,f=!1){const[d,g]=[document.createElement("div"),It()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${i?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${nt.map(L=>`<div class="color-option" style="background-color: ${L}" onclick="changeNoteColor(this, '${L}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${i?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`}),d.style.cssText=`background-color:${e}; left:${o}px; top:${n}px; width:${s}; height:${r}; z-index:${++H};`,d.dataset.noteId=g,f&&(d.dataset.repositioned="true",Mt.add(g)),X[g]=H,se(),d.addEventListener("click",L=>{L.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||$e(d)}),ze(d);const h=document.querySelector(`.board[data-board-id="${l}"]`);return h?(h.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",a||K(),d):(console.error(`Board element with ID ${l} not found.`),null)}const He=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),K()},zt=document.getElementById("shortcutIcon")||document.querySelector(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),Tt=()=>{const t=window.innerWidth<=1024;[zt.style.display,zt.textContent]=[t?"none":"block",t?"":navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"]};window.addEventListener("resize",Tt),Tt();document.querySelector(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),le())});let q=null,rt=!1,$t=!1,xt=!1;function ze(t){let e=!1,o=!1,n=!1,a,s,r,i,l,f,d;const[g,h,L]=[".color-button",".color-palette",".sticky-content"].map(c=>t.querySelector(c)),k=()=>K();["blur","input"].forEach(c=>L.addEventListener(c,k));const I=c=>{n&&!L.contains(c.target)&&([n,L.contentEditable]=[!1,"false"],L.blur(),document.removeEventListener("click",I))};L.addEventListener("dblclick",c=>{[n,L.contentEditable]=[!0,"true"],setTimeout(()=>{const[u,y]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const b=document.caretRangeFromPoint(c.clientX,c.clientY);b&&(y.removeAllRanges(),y.addRange(b))}else if(document.caretPositionFromPoint){const b=document.caretPositionFromPoint(c.clientX,c.clientY);b&&(u.setStart(b.offsetNode,b.offset),u.collapse(!0),y.removeAllRanges(),y.addRange(u))}L.focus()},0),setTimeout(()=>document.addEventListener("click",I),0),c.stopPropagation()}),L.addEventListener("blur",()=>L.contentEditable="false"),L.addEventListener("keydown",c=>{if(c.key==="Enter")if(c.preventDefault(),c.shiftKey)L.contentEditable="false",k();else{const[u,y]=[window.getSelection(),window.getSelection().getRangeAt(0)],b=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});y.deleteContents(),y.insertNode(b),y.setStartAfter(b),y.collapse(!0),u.removeAllRanges(),u.addRange(y)}});const tt=()=>{const c=t.getBoundingClientRect();J[m]={x:c.left,y:c.top}};let p=0,v=0,C=null;document.addEventListener("mousemove",c=>{[p,v]=[c.clientX,c.clientY],document.querySelectorAll(".color-palette.visible").forEach(u=>{var W;const[y,b]=[u.getBoundingClientRect(),(W=u.closest(".note-controls"))==null?void 0:W.querySelector(".color-button")];if(!b)return;const x=b.getBoundingClientRect(),[B,R]=[p>=y.left-10&&p<=y.right+10&&v>=y.top-10&&v<=y.bottom+10,p>=x.left&&p<=x.right&&v>=x.top&&v<=x.bottom];B||R?clearTimeout(C):u.classList.contains("visible")&&M()})});const N=()=>{clearTimeout(C),h.classList.remove("closing"),h.classList.add("visible"),document.querySelectorAll(".color-palette").forEach(c=>{c!==h&&(c.classList.add("closing"),setTimeout(()=>c.classList.remove("visible","closing"),180))})},M=()=>{clearTimeout(C),C=setTimeout(()=>{const[c,u]=[h.getBoundingClientRect(),g.getBoundingClientRect()],[y,b]=[p<c.left-10||p>c.right+10||v<c.top-10||v>c.bottom+10,p>=u.left&&p<=u.right&&v>=u.top&&v<=u.bottom];y&&!b&&(h.classList.add("closing"),setTimeout(()=>h.classList.contains("closing")&&h.classList.remove("visible","closing"),180))},50)};g.addEventListener("click",c=>{c.stopPropagation(),h.classList.contains("visible")?M():N()}),["mouseenter","mouseleave"].forEach((c,u)=>h.addEventListener(c,u?M:()=>clearTimeout(C)));const D=(c,u,y)=>{if(!c.target.closest(".color-palette, .done-button")){if(w.includes(t)&&w.length>1){De(c);return}c.shiftKey?w.includes(t)||(w.push(t),t.classList.add("selected")):St(),c.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect,t.style.zIndex]=["none","none",++H],[a,s]=[u,y],c.target.closest(".resize-handle")?[o,l,f]=[!0,t.offsetWidth,t.offsetHeight]:([r,i]=[S(t.style.left),S(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[r,i],d=setTimeout(()=>e=!0,150)),V=t}},$=(c,u)=>{if(!(!V||V!==t)){if((Math.abs(c-a)>5||Math.abs(u-s)>5)&&clearTimeout(d),e){xt||(xt=!0,document.body.classList.add("drag-in-progress"));const y=5;let[b,x]=[Math.min(Math.max(r+c-a,-y),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(i+u-s,-y),window.innerHeight-t.offsetHeight/4)];[t.style.left,t.style.top]=[`${b}px`,`${x}px`],At(),de(c,u)}if(o){const[y,b]=[150,150],[x,B]=[window.innerWidth-S(t.style.left)+50,window.innerHeight-S(t.style.top)+50];t.style.width=`${Math.min(Math.max(l+c-a,y),x)}px`,t.style.height=`${Math.min(Math.max(f+u-s,b),B)}px`}}},E=()=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(e||o)&&e){if(it(),!me().moved){tt(),ce(t),Fe(t);const u=t.dataset.noteId||It();[t.dataset.noteId,t.dataset.repositioned]=[u,"true"],Mt.add(u),J[m]={x:S(t.style.left),y:S(t.style.top)},Q[m]=t.style.backgroundColor,z(),Dt(),V=null}K(),[xt,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[e,o]=[!1,!1],it()};[["mousedown",c=>D(c,c.clientX,c.clientY)],["touchstart",c=>D(c,c.touches[0].clientX,c.touches[0].clientY),{passive:!1}]].forEach(([c,u,y])=>t.addEventListener(c,u,y)),[["mousemove",c=>$(c.clientX,c.clientY)],["mouseup",E],["touchmove",c=>$(c.touches[0].clientX,c.touches[0].clientY),{passive:!1}],["touchend",E]].forEach(([c,u,y])=>document.addEventListener(c,u,y))}function We(){document.querySelectorAll(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),Ut=null}document.addEventListener("click",t=>{Ut&&!t.target.closest(".color-button")&&We()});function Fe(t){if(!t)return;const[e,o,n,a]=[t.getBoundingClientRect(),window.innerHeight,250,150],s=o-a,[r,i]=[e.bottom>s,e.left<n&&e.bottom>s];if(i){const[l,f,d]=[e.bottom-s+20,S(t.style.top),Math.max(60,S(t.style.top)-(e.bottom-s+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${d}px`,setTimeout(()=>t.style.transition="",300)}}function de(t,e){var h,L;if($t)return;const o=document.querySelector(".status-bar");if(!o)return;const n=o.getBoundingClientRect(),[a,s]=[Math.max(0,Math.max(n.left-t,t-n.right)),Math.max(0,Math.max(n.top-e,e-n.bottom))],[r,i,l,f]=[Math.sqrt(a*a+s*s),120,80,q!==null],d=f?r<=i:r<=l,g=()=>{let[k,I]=[null,1/0];return document.querySelectorAll(".board-button:not(.disabled)").forEach(tt=>{const p=tt.getBoundingClientRect(),v=Math.sqrt(Math.pow(t-(p.left+p.width/2),2)+Math.pow(e-(p.top+p.height/2),2));v<I&&([k,I]=[tt,v])}),k};if(d!==f)if(d){const k=document.querySelectorAll(".board-button:not(.disabled)");q=g(),k.forEach(I=>I.classList.add("drag-active","drag-proximity")),q&&q.classList.add("drag-hover"),Ue()}else document.querySelectorAll(".board-button").forEach(k=>{k.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>k.classList.remove("drag-active"),200)}),q=null,ue();else if(d&&q){const k=g();k!==q&&(q==null||q.classList.remove("drag-hover"),q=k,k?(k.classList.add("drag-hover"),it(),(h=document.querySelector(".shortcut-hint"))==null||h.classList.add("hidden-during-drag")):(At(),rt||(L=document.querySelector(".shortcut-hint"))==null||L.classList.remove("hidden-during-drag")))}}function Ue(){if(!q)return;const[t,e]=[q.getBoundingClientRect(),w.length>0?w:V?[V]:[]];e.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(i=>{[i.style.userSelect,i.style.pointerEvents]=["none","none"]});const[n,a]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[s,r]=[t.left-a.left+t.width/2-(n.left-a.left)-n.width/2,t.top-a.top+t.height/2-(n.top-a.top)-n.height/2];o.style.setProperty("--suckX",`${s}px`),o.style.setProperty("--suckY",`${r}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function ue(){document.querySelectorAll(".hover-animating").forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events")}),t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),t.classList.remove("reverse-animating"))},300)})}function At(){var t;if(T>1&&!rt&&!q){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),rt=!0),(t=document.querySelector(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function it(){var t;if(rt){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),rt=!1),(t=document.querySelector(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Dt(){document.querySelectorAll(".board-button").forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[q]=[null],ue(),it()}function me(){if(!q)return{moved:!1};const[t,e]=[parseInt(q.dataset.boardId),w.length>0?[...w]:[V]];if(t===m)return e.forEach(n=>{if(n){const a=F==null?void 0:F.find(s=>s.element===n);a?(n.style.left=`${a.x}px`,n.style.top=`${Math.max(60,a.y)}px`):n.style.top=`${parseInt(n.style.top||0)-250}px`}}),{moved:!1};let o=new Map;if(e.length>1&&typeof F!="undefined"&&F.length>0){let[n,a]=[1/0,1/0];F.forEach(s=>{s&&e.includes(s.element)&&([n,a]=[Math.min(n,s.x),Math.min(a,s.y)])}),F.forEach(s=>{s&&e.includes(s.element)&&o.set(s.element,{offsetX:s.x-n,offsetY:s.y-a})})}return e.forEach(n=>{n&&Ke(n,t,o.size>0?o.get(n):null)}),w.length>0&&St(),{moved:!0}}function Ke(t,e,o=null){const n=t.style.left;if(t.classList.contains("hover-animating"))t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const a=document.querySelector(`.board-button[data-board-id="${e}"]`);if(!a)return;const[s,r,i]=[a.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,f]=[s.left-i.left+s.width/2-(r.left-i.left)-r.width/2,s.top-i.top+s.height/2-(r.top-i.top)-r.height/2];t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${f}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards",t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(s=>{s.style.removeProperty("user-select"),s.style.removeProperty("pointer-events")}),t.remove();const a=document.querySelector(`.board[data-board-id="${e}"]`);if(a){if(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),o)if(o.originalX!==void 0&&o.originalY!==void 0)[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[i,l]=[100,80];[t.style.left,t.style.top]=[`${i+o.offsetX}px`,`${Math.max(60,l+o.offsetY)}px`]}else{const[i,l]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];!isNaN(i)&&!isNaN(l)?[t.style.left,t.style.top]=[`${i}px`,`${Math.max(60,l)}px`]:[t.style.left,t.style.top]=[n,"80px"]}const s=t.dataset.noteId||It();[t.dataset.noteId,t.dataset.repositioned]=[s,"true"],Mt.add(s),a.appendChild(t),t.style.animation="paperPop 0.3s ease-out forwards",z(),Dt(),$t=!0,setTimeout(()=>$t=!1,500);const r=m;[m]=[e],K(),[m]=[r],K()}},600)}let j={},_=null,lt={x:0,y:0},P=[];function fe(){Ge(),ve(),Ve(),document.querySelectorAll(".emoji-item").forEach(t=>t.addEventListener("click",ye))}const ye=t=>{const e=t.target.dataset.emoji;e&&(Ze(e),Je(e))};function Je(t){const e=document.querySelector(".board.active");if(!e)return;const o=e.dataset.boardId;if(to(o)>=10)return eo();const n=no(),a=e.getBoundingClientRect(),[s,r,i]=[a.width-120,a.height*.8-120,20],[l,f]=[Math.random()*s,Math.max(i,Math.random()*r)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});d.dataset.stickerId=n,Object.assign(d.style,{left:l+"px",top:f+"px"});const g=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});g.addEventListener("click",h=>[h.stopPropagation(),ge(n,o)]),d.appendChild(g),he(d),e.appendChild(d),(j[o]=j[o]||{})[n]={emoji:t,x:l,y:f,id:n},Rt(o),setTimeout(()=>d.classList.remove("new"),400)}function he(t){let e=!1;["mousedown","touchstart"].forEach(s=>t.addEventListener(s,o,s==="touchstart"?{passive:!1}:!1));function o(s){if(s.target.classList.contains("delete-button"))return;s.preventDefault(),s.stopPropagation(),[e,_]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[r,i]=[s.type==="touchstart"?s.touches[0].clientX:s.clientX,s.type==="touchstart"?s.touches[0].clientY:s.clientY],l=t.getBoundingClientRect();[lt.x,lt.y]=[r-l.left,i-l.top],t.classList.add("dragging"),["mousemove","touchmove","mouseup","touchend"].forEach(f=>document.addEventListener(f,f.includes("move")?n:a,f==="touchmove"?{passive:!1}:!1))}function n(s){if(!e||!_)return;s.preventDefault(),s.stopPropagation();const[r,i]=[s.type==="touchmove"?s.touches[0].clientX:s.clientX,s.type==="touchmove"?s.touches[0].clientY:s.clientY],l=document.querySelector(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(r-l.left-lt.x,l.width-120)),Math.max(0,Math.min(i-l.top-lt.y,l.height-120))];Object.assign(_.style,{left:f+"px",top:d+"px"})}function a(){var i;if(!e||!_)return;_.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],oo(_);const[s,r]=[document.querySelector(".board.active").dataset.boardId,_.dataset.stickerId];(i=j[s])!=null&&i[r]&&(Object.assign(j[s][r],{x:parseInt(_.style.left),y:parseInt(_.style.top)}),Rt(s)),_=null,["mousemove","touchmove","mouseup","touchend"].forEach(l=>document.removeEventListener(l,l.includes("move")?n:a))}}const ge=(t,e)=>{const o=document.querySelector(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),j[e]&&(delete j[e][t],Rt(e))},Rt=t=>localStorage.setItem(`emojiStickers_board_${t}`,JSON.stringify(j[t]||{}));function pe(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{j[t]=e?JSON.parse(e):{},e&&be(t)}catch(o){console.error("Error loading emoji stickers:",o),j[t]={}}}const Ve=()=>Array.from({length:T},(t,e)=>pe(e+1));function be(t){const e=document.querySelector(`.board[data-board-id="${t}"]`);!e||!j[t]||(e.querySelectorAll(".emoji-sticker").forEach(o=>o.remove()),Object.values(j[t]).forEach(({id:o,emoji:n,x:a,y:s})=>{const r=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:n});r.dataset.stickerId=o,Object.assign(r.style,{left:a+"px",top:s+"px"});const i=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});i.addEventListener("click",l=>[l.stopPropagation(),ge(o,t)]),r.appendChild(i),he(r),e.appendChild(r)}))}function Ze(t){const e=P.indexOf(t);(e<0||e>=12)&&(e>-1&&P.splice(e,1),P.unshift(t),P.length>16&&(P=P.slice(0,16)),Qe(),ve())}function Ge(){const t=localStorage.getItem("emojiUsageOrder");try{P=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),P=[]}}const Qe=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(P));function ve(){const t=document.querySelector(".emoji-picker");t&&(t.querySelectorAll(".recent-emoji").forEach(e=>e.remove()),P.length>0&&P.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",ye),t.insertBefore(o,t.firstChild)}))}const to=t=>j[t]?Object.keys(j[t]).length:0,eo=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function oo(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[n,a,s]=[250,150,o-150];if(e.left<n&&e.bottom>s){const i=Math.max(60,parseInt(t.style.top)-(e.bottom-s+20));t.style.top=`${i}px`}}const no=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),so=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete j[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(fe,100));window.emojiStickers={loadEmojiStickers:pe,renderEmojiStickers:be,cleanupEmojiStickers:so,initializeEmojiPicker:fe};const Et=()=>new Date,Se=t=>{const e=Et().getDay(),o=e===0?5:e-1;return t===o},ao=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,Et().toISOString().split("T")[0])},gt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((Et()-new Date(e))/(1e3*60*60*24))%5:-1},Ee=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),Wt=()=>{if(G||T>=et){T>=et&&alert(`Maximum number of boards (${et}) reached.`);return}Bt(++T),te(),bt()};function Bt(t){const e=document.querySelector(".boards-container"),o=document.createElement("div");o.className="board",o.dataset.boardId=t,e.appendChild(o);const n=document.createElement("div");n.className="board-title-circle",n.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const a=document.createElement("input");a.type="text",a.className="board-title-input",a.placeholder="Title...",a.maxLength=30;let s;const r=()=>{const f=a.value.trim();if(f.length===0){a.value=a.dataset.originalTitle||"";return}Yt(t,f),vt(a)};a.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(r,500)}),vt(a),n.appendChild(a),o.appendChild(n);const i=document.createElement("div");if(i.className="board-button new-button",i.dataset.boardId=t,i.textContent=t,i.addEventListener("click",()=>Y(t)),t>1){const f=document.createElement("div");f.className="delete-board",f.textContent="\xD7",f.addEventListener("click",d=>{d.stopPropagation(),pt(t)}),i.appendChild(f)}const l=document.querySelector(".add-board-button");document.querySelector(".boards-navigation").insertBefore(i,l),setTimeout(()=>{i.classList.remove("new-button"),i.classList.add("transitions-ready")},500),ct(t),jt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function pt(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=document.querySelector(`.board[data-board-id="${t}"]`);if(!e){wt(t);return}const o=e.querySelectorAll(".sticky-note"),n=e.querySelectorAll(".emoji-sticker");if(o.length>0||n.length>0){const a=document.querySelector(".trash-bin"),s=a.getBoundingClientRect();a.style.animation="binShake 0.5s ease-in-out",o.forEach(r=>{const i=r.querySelector(".sticky-content"),l={text:i.innerHTML,color:r.style.backgroundColor,x:r.style.left,y:r.style.top,width:r.style.width,height:r.style.height,timestamp:new Date().toLocaleString(),isBold:i.classList.contains("bold")};U.unshift(l);const f=r.getBoundingClientRect(),d=s.left-f.left+s.width/2-f.width/2,g=s.top-f.top;r.style.setProperty("--throwX",`${d}px`),r.style.setProperty("--throwY",`${g}px`),r.style.animation="paperCrumble 0.5s ease-in forwards"}),n.forEach(r=>{r.classList.add("deleting")}),Nt(),at(),setTimeout(()=>wt(t),600)}else wt(t)}function wt(t){const e=document.querySelector(`.board[data-board-id="${t}"]`);e&&e.remove();const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&o.classList.add("removing");const n=[];for(let a=t+1;a<=T;a++){const s=document.querySelector(`.board-button[data-board-id="${a}"]`);s&&(s.classList.add("removing"),n.push(a))}localStorage.removeItem(`${ft}_board_${t}`),localStorage.removeItem(`stickyNotes_boardTitle_${t}`),localStorage.removeItem(`boardColor_${t}`),localStorage.removeItem(`boardPattern_${t}`),localStorage.removeItem(`boardStyles_board_${t}`),Ee(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let a=t+1;a<=T;a++)["boardColor","boardPattern","boardStyles_board"].forEach(s=>{const r=`${s}_${a}`,i=`${s}_${a-1}`,l=localStorage.getItem(r);l&&localStorage.setItem(i,l),localStorage.removeItem(r)});setTimeout(()=>{o&&o.remove(),n.forEach(a=>{const s=document.querySelector(`.board-button[data-board-id="${a}"]`);s&&s.remove();const r=document.querySelector(`.board[data-board-id="${a}"]`),i=a-1;r&&(r.dataset.boardId=i);const l=document.querySelector(".boards-navigation"),f=document.querySelector(".add-board-button"),d=document.createElement("div");if(d.className="board-button new-button",d.dataset.boardId=i,d.textContent=i,d.dataset.originalNumber=i,d.addEventListener("click",()=>Y(i)),i>1){const g=document.createElement("div");g.className="delete-board",g.textContent="\xD7",g.addEventListener("click",h=>{h.stopPropagation(),pt(i)}),d.appendChild(g)}l.insertBefore(d,f),["","Title","Color","Pattern"].forEach(g=>{const h=g?`stickyNotes_board${g}`:ft,L=`${h}_board_${a}`,k=`${h}_board_${i}`,I=localStorage.getItem(L);I&&(localStorage.setItem(k,I),localStorage.removeItem(L))}),ct(i)}),setTimeout(()=>{document.querySelectorAll(".board-button.new-button").forEach(a=>{a.classList.remove("new-button"),a.classList.add("transitions-ready")})},500),T--,te(),bt(),m===t?Y(t>1?t-1:T>=1?1:null):m>t&&(m--,Y(m)),document.querySelector(".trash-bin").style.animation=""},350)}function Y(t){if(G&&t!==1)return;const e=parseInt(t);if(e===m||e===null)return;co(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300);const o=m;m=e,J[t]||(J[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),Q[t]||(Q[t]=nt[0]),document.querySelectorAll(".board").forEach(n=>{const a=parseInt(n.dataset.boardId);if(n.classList.remove("active","prev","next"),n.style.visibility="hidden",a===m){if(n.classList.add("active"),n.style.visibility="visible",n.querySelectorAll(".sticky-note").forEach((s,r)=>s.style.setProperty("--note-index",r)),n.querySelectorAll(".emoji-sticker").forEach((s,r)=>s.style.setProperty("--sticker-index",r)),!n.querySelector(".board-title-circle")){const s=document.createElement("div");s.className="board-title-circle",s.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const r=document.createElement("input");r.type="text",r.className="board-title-input",r.placeholder="Title...",r.maxLength=30;const i=()=>Yt(a,r.value);r.addEventListener("change",i),r.addEventListener("blur",i),s.appendChild(r),n.appendChild(s),jt(a)}}else a<m?n.classList.add("prev"):n.classList.add("next")}),document.querySelectorAll(".board-button").forEach(n=>{n.classList.toggle("active",parseInt(n.dataset.boardId)===m)}),ct(m),xe(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(n=>n.style.backgroundColor=A.colors.current),z(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(m),setTimeout(()=>we(m),300)}function ro(){document.querySelector(".add-board-button").addEventListener("click",Wt),document.querySelectorAll(".board-button").forEach(n=>{const a=parseInt(n.dataset.boardId),s=n.cloneNode(!0);s.addEventListener("click",()=>Y(a));const r=s.querySelector(".delete-board");r&&r.addEventListener("click",i=>{i.stopPropagation(),pt(a)}),n.parentNode.replaceChild(s,n)});let t,e;const o=document.querySelector(".boards-container");o.addEventListener("touchstart",n=>{G||(t=n.touches[0].clientX,e=n.touches[0].clientY)}),o.addEventListener("touchend",n=>{if(G||!t)return;const a=n.changedTouches[0].clientX,s=n.changedTouches[0].clientY,r=t-a;Math.abs(r)>Math.abs(e-s)&&Math.abs(r)>50&&(r>0&&m<T?Y(m+1):r<0&&m>1&&Y(m-1)),t=null}),document.addEventListener("keydown",n=>{if(G)return;const a=n.target.tagName,s=n.target.getAttribute("contenteditable")==="true";if((n.key==="Control"||n.key==="Meta")&&!n.altKey&&!n.shiftKey&&a!=="TEXTAREA"&&!s){n.preventDefault(),document.querySelector(".note-input textarea").focus();return}if(a==="TEXTAREA"||s){(n.metaKey||n.ctrlKey)&&n.key==="Enter"&&(n.preventDefault(),le());return}n.key==="Delete"||n.key,n.key==="ArrowLeft"&&m>1?Y(m-1):n.key==="ArrowRight"&&m<T?Y(m+1):n.key==="n"&&n.ctrlKey?(n.preventDefault(),Wt()):n.key==="d"&&n.ctrlKey&&m>1&&(n.preventDefault(),pt(m));const r=parseInt(n.key);!isNaN(r)&&r>=1&&r<=9&&r<=T&&Y(r)}),window.addEventListener("resize",Qt)}function bt(){const t=document.querySelector(".add-board-button"),e=T>=et;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${et}) reached`:"Add new board",io()}function io(){const t=document.querySelector(".shortcut-hint");t&&(t.style.display=T>=2?"block":"none")}let Ft=!1;function co(){if(Ft||T<2)return;const t=document.querySelector(".shortcut-hint");t&&(Ft=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function lo(){const t=document.querySelector(".board-style-menu"),e=t.classList.contains("visible");e||(xe(),Le(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=A.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function Le(){document.querySelector(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?uo(o):fo(o),document.querySelectorAll(`.board-${e}-option`).forEach(n=>n.classList.remove("active")),t.classList.add("active")})})}function xe(){["color","pattern"].forEach(t=>{document.querySelectorAll(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===A[`${t}s`].current)})})}function uo(t){A.colors.current=t;const e=document.querySelector(".board.active");e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),ee(),z(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function mo(t){const e=document.createElement("div");if(e.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; transition:opacity 0.5s ease; opacity:0;",t!=="none"){if(t==="dots")e.style.cssText+="background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;";else if(t==="grid")e.style.cssText+="background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;";else if(t==="lines")e.style.cssText+="background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;";else if(t==="weekdays"||t==="days"){const o=document.createElement("div");o.className=t==="weekdays"?"weekday-header":"day-header",(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((s,r)=>{const i=document.createElement("span");i.textContent=s,(t==="weekdays"&&Se(r)||t==="days"&&gt(m)===r)&&i.classList.add("current-day"),o.appendChild(i)}),e.appendChild(o);const a=document.querySelector(`.board[data-board-id="${m}"]`);a&&a.classList.add("has-header")}}else{const o=document.querySelector(`.board[data-board-id="${m}"]`);o&&o.classList.remove("has-header")}return e}function fo(t){const e=document.querySelector(".board.active"),o=e.dataset.boardId;A.patterns.current==="days"&&t!=="days"&&Ee(o),A.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(r=>r.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t==="days"&&ao(o);const a=mo(t);e.appendChild(a),a.offsetWidth,a.style.opacity="1";let s=null;(t==="weekdays"||t==="days")&&(s=document.createElement("div"),s.className=`lines-overlay lines-overlay-${t}`,s.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.5s ease;",e.appendChild(s),s.offsetWidth,s.style.opacity="1"),setTimeout(()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),a.style.height="auto",a.style.zIndex="1",a.classList.add("pattern-overlay"),s&&(s.style.zIndex="0",s.classList.add("pattern-overlay"))):(a.remove(),s&&s.remove(),t!=="none"&&e.classList.add(`board-pattern-${t}`)),z()},500),ee()}function yo(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=document.createElement("div");o.className=`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`,(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(s,r)=>`Day ${r+1}`)).forEach((s,r)=>{const i=document.createElement("span");i.textContent=s,(e.pattern==="weekdays"&&Se(r)||e.pattern==="days"&&gt(parseInt(t.dataset.boardId))===r)&&i.classList.add("current-day"),o.appendChild(i)}),t.appendChild(o);const a=document.createElement("div");a.className=`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,a.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;",t.appendChild(a)}}function ct(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(!o)return;let n;e?(n=JSON.parse(e),t===m&&(A.colors.current=n.color,A.patterns.current=n.pattern)):(n={color:A.colors.default,pattern:A.patterns.default},t===m&&(A.colors.current=n.color,A.patterns.current=n.pattern)),yo(o,n),z()}ho();document.addEventListener("click",function(t){const e=document.querySelector(".board-style-menu"),o=document.querySelector(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function ho(){document.querySelectorAll(".board").forEach(t=>jt(t.dataset.boardId))}function Yt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function vt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function jt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(o){const a=o.querySelector(".board-title-input");a&&e&&(a.value=e)}const n=document.querySelector(`.board-button[data-board-id="${t}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function we(t){const e=document.querySelector(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function go(){document.querySelectorAll(".board-title-circle").forEach(t=>{let e;const o=t.querySelector(".board-title-input"),n=t.closest(".board").dataset.boardId;if(t.addEventListener("mouseenter",()=>{o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")}),t.addEventListener("mouseleave",()=>{e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()}),t.addEventListener("click",()=>{o&&o.focus()}),o){let a;const s=()=>{const r=o.value.trim();if(r.length===0){o.dataset.originalTitle="";return}Yt(n,r),vt(o)};o.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(s,500)}),vt(o)}})}const z=()=>{for(let t=1;t<=T;t++){const[e,o]=[document.querySelector(`.board[data-board-id="${t}"]`),document.querySelector(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0);const n=e.style.backgroundColor||A.colors.default;o.style.backgroundColor=n;const a=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],s=a.find(i=>e.classList.contains(i));a.forEach(i=>o.classList.remove(i.replace("board-pattern","button-pattern"))),s&&o.classList.add(s.replace("board-pattern","button-pattern"));const r=ke(n)||{r:26,g:26,b:26};o.style.color=(r.r*299+r.g*587+r.b*114)/1e3>128?"#000":"#fff"}};document.addEventListener("DOMContentLoaded",function(){Be(),Te(),ne(),ro(),Le(),qe(),Tt(),go(),setTimeout(()=>we(m),500),bo();const t=document.querySelector(".board-style-button");t&&t.addEventListener("click",lo);const e=document.querySelector(".trash-bin");e&&e.addEventListener("click",yt);const o=document.querySelector("#trashModal .close-modal-btn");o&&o.addEventListener("click",yt);const n=document.querySelector("#trashModal .restore-all-btn");n&&n.addEventListener("click",restoreAllNotes);const a=document.querySelector("#trashModal .clear-trash-btn");a&&a.addEventListener("click",Pe),po()});function po(){function t(r){const i=r.selectionStart,l=r.value;if(l.length>0){const f=l.charAt(0).toUpperCase()+l.slice(1);f!==l&&(r.value=f,r.setSelectionRange(i,i))}}function e(r){r.addEventListener("input",function(i){t(i.target)}),r.addEventListener("keyup",function(i){t(i.target)}),r.addEventListener("paste",function(i){setTimeout(()=>t(i.target),0)})}document.querySelectorAll(".board-title-input").forEach(r=>{e(r)});const n=new MutationObserver(function(r){r.forEach(function(i){i.addedNodes.forEach(function(l){l.nodeType===1&&((l.querySelectorAll?l.querySelectorAll(".board-title-input"):[]).forEach(d=>{e(d)}),l.classList&&l.classList.contains("board-title-input")&&e(l))})})}),a=document.querySelector(".boards-container");a&&n.observe(a,{childList:!0,subtree:!0});const s=document.querySelector(".note-input textarea");s&&(s.addEventListener("input",function(r){t(r.target)}),s.addEventListener("keyup",function(r){t(r.target)}),s.addEventListener("paste",function(r){setTimeout(()=>t(r.target),0)}))}function bo(){setTimeout(()=>{document.querySelectorAll(".board-button").forEach(e=>{e.classList.add("transitions-ready"),e.offsetHeight,requestAnimationFrame(()=>{e.style.transform="scale(1)"})})},100)}window.toggleBold=He;window.markAsDone=ie;})();
