(()=>{const M=new Map;typeof window!="undefined"&&(window.domCache=M);const i=(t,e=!1)=>{const o=[".board.active",".board[data-board-id=",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".board-button"],n=[`.board[data-board-id="${f||1}"]`,".board.active"],a=o.some(r=>t.includes(r)),s=n.some(r=>t===r);if(a||s||e){const r=document.querySelector(t);return s&&!a&&M.set(t,r),r}if(!M.has(t)){const r=document.querySelector(t);return M.set(t,r),r}return M.get(t)},x=(t,e=!1)=>{if([".board",".board-button",".sticky-note",".board-title-circle",".emoji-sticker",".color-palette",".deleted-note",".emoji-item",".sticky-note.selected",".board.active",".board-pattern-option",".board-color-option",".color-option"].some(r=>t.includes(r))||e)return Array.from(document.querySelectorAll(t));const a=`all:${t}`;if(!M.has(a)){const r=Array.from(document.querySelectorAll(t));return M.set(a,r),r}const s=M.get(a);return Array.isArray(s)?[...s]:Array.from(document.querySelectorAll(t))},Ae=(t,e)=>{if(!t)return null;const o=`${t.className||"element"}:${e}`;if(!M.has(o)){const n=t.querySelector(e);return M.set(o,n),n}return M.get(o)},je={get boardsContainer(){return i(".boards-container")},get activeBoard(){return i(".board.active")},get currentBoard(){const t=typeof window!="undefined"&&window.currentBoardId||1;return i(`.board[data-board-id="${t}"]`)},get boardsNavigation(){return i(".boards-navigation")},get addBoardButton(){return i(".add-board-button")},get noteInput(){return i(".note-input textarea")},get textareaContainer(){return i(".textarea-container")},get boardStyleMenu(){return i(".board-style-menu")},get boardStyleButton(){return i(".board-style-button")},get shortcutHint(){return i(".shortcut-hint")},get shortcutIcon(){return i("#shortcutIcon")},get trashBin(){return i(".trash-bin")},get trashModal(){return i("#trashModal")},get trashCount(){return i(".trash-count")},get deletedNotesContainer(){return i(".deleted-notes-container")},get clearTrashBtn(){return i(".clear-trash-btn")},get dragTransferMessage(){return i("#dragTransferMessage")},get noteLimitMessage(){return i("#noteLimitMessage")},get statusBar(){return i(".status-bar")},get emojiPicker(){return i(".emoji-picker")},get allBoards(){return x(".board",!0)},get allBoardButtons(){return x(".board-button",!0)},get activeBoardNotes(){const t=this.currentBoard;return t?Array.from(t.querySelectorAll(".sticky-note")):[]},get selectedNotes(){return x(".sticky-note.selected",!0)},get colorPalettes(){return x(".color-palette",!0)}},De=(t=null)=>{if(!t){M.clear();return}(Array.isArray(t)?t:[t]).forEach(o=>{M.delete(o),M.delete(`all:${o}`)})},te=()=>{[".board",".board-button",".sticky-note",".color-palette",".board-title-input",".board.active"].forEach(e=>{M.delete(e),M.delete(`all:${e}`)});for(let e=1;e<=9;e++)M.delete(`.board[data-board-id="${e}"]`)};typeof window!="undefined"&&(window.$=i,window.$$=x,window.$within=Ae,window.DOM=je,window.clearCache=De,window.refreshDynamicCache=te);let Tt=null;const Kt=()=>{if(Tt)return;Tt=new MutationObserver(e=>{let o=!1;e.forEach(n=>{var a,s,r;n.type==="childList"&&((a=n.target.classList)!=null&&a.contains("boards-container")||(s=n.target.classList)!=null&&s.contains("board")||(r=n.target.classList)!=null&&r.contains("boards-navigation"))&&(o=!0)}),o&&te()});const t=i(".boards-container");t&&Tt.observe(t,{childList:!0,subtree:!0})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Kt):setTimeout(Kt,0);const rt=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],j={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let Y=[];let tt=null,ee=null,gt=!1,et=null,ht=0,yt=0,k=[],it=!1,oe=0,ne=0,V=[];const Z={},G={},F={};let q=1e3;Z[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};G[1]=rt[0];let f=1,$=1;const ct=9,ot="stickyNotes_active",se="stickyNotes_deleted",ae="stickyNotes_boardCount",re="stickyNotes_zIndexes",v=t=>parseInt(String(t).replace("px",""))||0,$t=(t,e,o=150)=>{const n=i(`.board[data-board-id="${f}"]`);if(!n)return!1;const a=n.querySelectorAll(".sticky-note"),s=20;for(const r of a){const c=v(r.style.left),l=v(r.style.top),m=v(r.style.width)||200,u=t<c+m+s&&t+200>c-s,p=e+o,h=l+30,b=e<h&&p>l-s;if(u&&b)return!0}return!1},Ut=(t,e)=>{const o=Math.random()*10-5;let n=t+o,a=e+70;const s=5,r=window.innerWidth-200,c=window.innerHeight-300,l=20;let m=0;for(;m<l&&$t(n,a);)a+=40,m++,m>10&&(n=t+250,a=50,m=0);if(a>c){for(a=50,n=t+250;m<l&&$t(n,a);)a+=40,m++;if(n>r)for(n=s+50,a=50,m=0;m<l&&$t(n,a);)a+=40,m++}const u=Math.min(Math.max(n,s),r),p=Math.min(Math.max(a,s),window.innerHeight-100);return{x:u,y:p}},Oe=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,n,a,s)=>n+n+a+a+s+s);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},Dt=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(o){console.error(`Failed to save to localStorage (${t}):`,o)}},X=()=>{const t=i(`.board[data-board-id="${f}"]`);if(!t)return;const e=Array.from(t.querySelectorAll(".sticky-note")).map(o=>({text:o.querySelector(".sticky-content").innerHTML,color:o.style.backgroundColor,x:o.style.left,y:o.style.top,width:o.style.width||"200px",height:o.style.height||"150px",isBold:o.querySelector(".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}));Dt(`${ot}_board_${f}`,e),typeof H=="function"&&H()},Et=()=>Dt(se,Y),ie=()=>localStorage.setItem(ae,$.toString()),ce=()=>Dt(`boardStyles_board_${f}`,{color:j.colors.current,pattern:j.patterns.current}),le=()=>{const t=i("#shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},de=()=>{const t=i(".note-input textarea");if(!t)return;const e=i("#shortcutIcon"),o=()=>{if(!e)return;const n=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",a=t.value.trim();e.innerHTML=a?`${n}+\u21B5`:n,e.classList.toggle("focus-hint",!a),e.classList.toggle("enter-hint",a)};t.addEventListener("focus",()=>{o(),t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px"),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{le(),t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px"),t.removeEventListener("input",o)}),document.addEventListener("mousedown",n=>{!n.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},Jt=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},Re=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{console.log("Performing one-time localStorage cleanup...");const e=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&(n.startsWith("stickyNotes_")||n.startsWith("boardColor_")||n.startsWith("boardPattern_")||n.startsWith("boardStyles_")||n.startsWith("emojiStickers_")||n.startsWith("daysPatternStartDate_")||n.startsWith("emojiUsageOrder"))&&e.push(n)}e.forEach(o=>{localStorage.removeItem(o)}),console.log(`Cleaned up ${e.length} localStorage items`),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},_e=()=>{try{Re(),typeof Vt=="function"&&Vt();const t=localStorage.getItem(ae);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){$=Math.min(o,ct);for(let n=2;n<=$;n++)typeof jt=="function"&&jt(n)}}typeof vt=="function"&&vt();for(let o=1;o<=$;o++){const n=localStorage.getItem(`${ot}_board_${o}`);if(n){const a=Jt(n,[]);Array.isArray(a)&&a.forEach(s=>{if(s&&typeof s=="object"&&s.text&&(Z[o]={x:v(s.x),y:v(s.y)},G[o]=s.color||rt[0],typeof pt=="function")){const r=pt(s.text,s.color||rt[0],v(s.x),v(s.y),!0,s.width||"200px",s.height||"150px",s.isBold||!1,o);r&&s.noteId&&(r.dataset.noteId=s.noteId,F[s.noteId]?(r.style.zIndex=F[s.noteId],F[s.noteId]>q&&(q=F[s.noteId])):s.zIndex&&!isNaN(parseInt(s.zIndex))&&(r.style.zIndex=s.zIndex,F[s.noteId]=parseInt(s.zIndex),parseInt(s.zIndex)>q&&(q=parseInt(s.zIndex))))}})}typeof mt=="function"&&mt(o)}typeof K=="function"&&K(1);const e=localStorage.getItem(se);if(e){const o=Jt(e,[]);Array.isArray(o)&&(Y=o,typeof nt=="function"&&nt())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),le(),de()}catch(t){console.error("Critical error loading saved data:",t)}},Pe=t=>{t.style.zIndex=++q;const e=t.dataset.noteId;e&&(F[e]=q,ue())},ue=()=>{try{localStorage.setItem(re,JSON.stringify(F))}catch(t){console.error("Error saving note z-indexes:",t)}},qe=()=>{try{const t=localStorage.getItem(re);t&&(Object.assign(F,JSON.parse(t)),q=Math.max(1e3,...Object.values(F)))}catch(t){console.error("Error loading note z-indexes:",t)}};const Vt=()=>{et=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(et.style,{display:"none"}),document.body.appendChild(et)};function Ye(){const t=i(".boards-container");document.addEventListener("mousedown",e=>{e.target.closest(".board")&&!e.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&e.preventDefault()}),[["mousedown",Xe],["mousemove",He],["mouseup",ze]].forEach(([e,o])=>(e==="mousedown"?t:document).addEventListener(e,o))}function Xe(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=i(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&xt(),[gt,ht,yt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),et.style.cssText=`left:${ht}px; top:${yt}px; width:0; height:0; display:block;`}function He(t){if(!gt)return;t.preventDefault();const[e,o]=[Math.abs(t.clientX-ht),Math.abs(t.clientY-yt)],[n,a]=[Math.min(t.clientX,ht),Math.min(t.clientY,yt)];et.style.cssText=`left:${n}px; top:${a}px; width:${e}px; height:${o}px; display:block;`,We()}const ze=()=>{gt&&(gt=!1,document.body.classList.remove("selecting"),et.style.display="none")};function We(){const t=et.getBoundingClientRect(),e=i(`.board[data-board-id="${f}"]`);if(!e)return;const o=(n,a,s)=>{const r=n.getBoundingClientRect(),c=!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom),l=a.indexOf(n);c?l===-1&&(a.push(n),n.classList.add(s)):!it&&l!==-1&&(a.splice(l,1),n.classList.remove(s))};e.querySelectorAll(".sticky-note").forEach(n=>o(n,k,"selected"))}const xt=()=>{k.forEach(t=>t.classList.remove("selected")),k=[]};function Fe(t){[it,oe,ne]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),V=k.map(e=>({element:e,x:v(e.style.left),y:v(e.style.top),type:"note"})),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,e==="mousemove"?me:fe))}function me(t){if(!it)return;const[e,o]=[t.clientX-oe,t.clientY-ne],[n,a,s]=[5,-5,-5],[r,c]=[window.innerWidth-n,window.innerHeight-n];(m=>m.forEach(u=>{const[p,h]=[Math.min(Math.max(u.x+e,a),r-u.element.offsetWidth/4),Math.min(Math.max(u.y+o,s),c-u.element.offsetHeight/4)];Object.assign(u.element.style,{left:`${p}px`,top:`${h}px`})}))(V),k.length>0&&(be(t.clientX,t.clientY),k.length>1&&qt())}function fe(){if(!it)return;if(it=!1,document.body.classList.remove("selecting"),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,e==="mousemove"?me:fe)),ut(),!we().moved){X();for(let e=k.length-1;e>=0;e--)ge(k[e])&&k.splice(e,1)}Yt()}let at=[];const Ke=100,Zt=50,Ue="#ffd700",Je=()=>{const[t,e]=[i("#trashModal"),i(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>Lt())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},Ot=t=>{k.includes(t)&&k.length>1?(k.forEach((e,o)=>setTimeout(()=>It(e),o*100)),xt()):It(t)},It=t=>{if(Y.length>=Ke){!at.includes(t)&&at.push(t),Je();return}const e=t.querySelector(".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};Ve(t),Y.unshift(o),Et(),nt(),Ze(t)},Ve=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,n]=[e.getBoundingClientRect(),t.getBoundingClientRect()],a=Math.min(5,Math.max(0,Math.floor((n.left+n.width/2-o.left)/(o.width/6))));window.noteColumns[a]&&(window.noteColumns[a]=window.noteColumns[a].filter(s=>Math.abs(s.x-v(t.style.left))>1||Math.abs(s.y-v(t.style.top))>1))},Ze=t=>{const e=i(".trash-bin"),o=e.getBoundingClientRect(),n=t.getBoundingClientRect(),a=o.left-n.left+o.width/2-n.width/2,s=o.top-n.top;t.style.setProperty("--throwX",`${a}px`),t.style.setProperty("--throwY",`${s}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out",setTimeout(()=>{t.remove(),e.style.animation="",X(),H()},600)},ge=t=>{const[e,o]=[i(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(Ot(t),!0):!1},lt=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>Lt())):setTimeout(()=>t.style.display="none",300)},Lt=()=>{const t=i(".deleted-notes-container");t.style.minHeight="200px",t.innerHTML=Y.length?Y.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||Ue}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},Ge=t=>{const e=x(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[o]=Y.splice(t,1);pt(o.text,o.color,v(o.x),v(o.y),!0,o.width,o.height,o.isBold),Et(),nt(),Lt(),X(),H()},300)},he=()=>{if(Y.length===0){lt();return}const t=[...x(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*Zt}ms`}),setTimeout(()=>{Y=[],Et(),nt(),Lt(),setTimeout(()=>{if(lt(),at.length){const e=[...at];at=[],setTimeout(()=>{e.forEach(o=>{o!=null&&o.parentNode&&It(o)})},300)}},200)},(t.length?(t.length-1)*Zt+300:0)+100)},nt=()=>{i(".trash-count").textContent=Y.length};document.addEventListener("click",t=>{const e=i("#trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&lt()});let Rt=new Set;const _t=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,Qe=()=>Math.random()*40-20,to=(t=St())=>t.getDay()===0?0:t.getDay()-1;function Bt(t){const e=document.getElementById("noteLimitMessage"),o=e==null?void 0:e.querySelector(".transfer-text");o&&(o.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function Pt(){const t=i(".note-input textarea"),e=t.value.trim();if(!e)return;const o=i(`.board[data-board-id="${f}"]`),n=Array.from(o.querySelectorAll(".sticky-note")),[a,s,r]=[o.classList.contains("board-pattern-weekdays"),o.classList.contains("board-pattern-days"),n.filter(w=>!w.dataset.transferred).length===0];if(!a&&!s&&n.length>=30){Bt("Maximum notes space reached.");return}const c=n.filter(w=>!w.dataset.transferred),l=c[c.length-1];let{x:m,y:u}=Z[f]||{x:0,y:0},p=G[f]||getRandomColor(),h,b;const C=(w,L,T=null)=>{const S=o.offsetWidth/L,A=w*S+10,U=(w+1)*S-210,z=Math.max(A,Math.min(U,A+Qe())),R=Array.from(o.querySelectorAll(".sticky-note")).filter(g=>g.style.display!=="none"&&g!==T),[_,J]=[w*S,(w+1)*S],d=R.filter(g=>{const[y,E]=[v(g.style.left),v(g.style.left)+200],[O,Q]=[Math.max(y,_),Math.min(E,J)];return Math.max(0,Q-O)/200>.5});return{positionX:z,columnNotes:d}},I=(w,L)=>{const T=window.innerHeight-300;for(let S=0;S<L;S++){const A=(w+S)%L,{positionX:U,columnNotes:z}=C(A,L);let R=60,_=null;z.forEach(d=>{const g=v(d.style.top);g>=R&&(R=g,_=d)});const J=_?R+70:60;if(J<=T)return h=U,b=J,_&&(p=_.style.backgroundColor),!0}return Bt("Maximum notes space reached."),!1},N=w=>{let L;const T=w?6:5;if(l){const S=v(l.style.left),A=o.offsetWidth/T;L=Math.floor(S/A),L=Math.max(0,Math.min(L,T-1))}else L=w?to():Ht(f)||0;return I(L,T)};if(r)if(a||s){if(N(a)===!1)return}else{const w=Math.max(150,window.innerWidth/4);({x:h,y:b}=Ut(w,50-70))}else if(a||s){if(N(a)===!1)return}else if(l&&([m,u,p]=[v(l.style.left),v(l.style.top),l.style.backgroundColor]),{x:h,y:b}=Ut(m,u),b<=50){const w=n.filter(L=>Math.abs(v(L.style.left)-h)<150);if(w.length>0){const L=w.map(R=>v(R.style.top)),[T,S]=[Math.max(...L),Math.min(...L)],A=window.innerHeight-300,[U,z]=[T+200,S-200];if(U<=A)b=U;else if(z>=50)b=z;else{const R=(J,d)=>{const g=window.innerWidth-200;for(let y=J;d>0?y<=g:y>=55;y+=d*250){const E=n.filter(Ct=>Math.abs(v(Ct.style.left)-y)<150);if(E.length===0)return{x:y,y:50};const O=E.map(Ct=>v(Ct.style.top)),[Q,kt]=[Math.max(...O),Math.min(...O)],[st,Ft]=[Q+200,kt-200];if(st<=A)return{x:y,y:st};if(Ft>=50)return{x:y,y:Ft}}return null},_=R(h+250,1)||R(h-250,-1);if(_)[h,b]=[_.x,_.y];else{Bt("Maximum notes space reached.");return}}}}pt(e.replace(/\n/g,"<br>"),p,h,b,!1,"200px","150px",!1,f),[Z[f],G[f],t.value]=[{x:h,y:b},p,""],o.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(w=>{delete w.dataset.transferred}),X(),H()}function pt(t,e,o,n,a=!1,s="200px",r="150px",c=!1,l=f,m=!1){const[u,p]=[document.createElement("div"),_t()];Object.assign(u,{className:"sticky-note",innerHTML:`<div class="sticky-content ${c?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${rt.map(N=>`<div class="color-option" style="background-color: ${N}" onclick="changeNoteColor(this, '${N}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${c?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let h;const b=i(`.board[data-board-id="${l}"]`),C=b&&(b.classList.contains("board-pattern-weekdays")||b.classList.contains("board-pattern-days"));h=++q,u.style.cssText=`background-color:${e}; left:${o}px; top:${n}px; width:${s}; height:${r}; z-index:${h};`,u.dataset.noteId=p,m&&(u.dataset.repositioned="true",Rt.add(p)),F[p]=h,ue(),u.addEventListener("click",N=>{N.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||Pe(u)}),no(u);const I=i(`.board[data-board-id="${l}"]`);return I?(I.appendChild(u),u.style.animation="paperPop 0.3s ease-out forwards",a||X(),u):(console.error(`Board element with ID ${l} not found.`),null)}function eo(t,e){const o=t.closest(".sticky-note");(o.classList.contains("selected")?x(".sticky-note.selected"):[o]).forEach(a=>{const s=a.querySelector(".color-button");[a,s].forEach(r=>r.classList.add("color-transition")),[a.style.backgroundColor,s.style.backgroundColor]=[e,e],setTimeout(()=>[a,s].forEach(r=>r.classList.remove("color-transition")),300)}),G[f]=e,X()}const ye=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),X()},oo=i("#shortcutIcon")||i(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),pe=()=>{oo.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};pe();i(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Pt())});let B=null,dt=!1,At=!1,Mt=!1;function no(t){let e=!1,o=!1,n=!1,a,s,r,c,l,m,u;const[p,h,b]=[".color-button",".color-palette",".sticky-content"].map(d=>t.querySelector(d)),C=()=>X();["blur","input"].forEach(d=>b.addEventListener(d,C));const I=d=>{n&&!b.contains(d.target)&&([n,b.contentEditable]=[!1,"false"],b.blur(),document.removeEventListener("click",I))};b.addEventListener("dblclick",d=>{[n,b.contentEditable]=[!0,"true"],setTimeout(()=>{const[g,y]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const E=document.caretRangeFromPoint(d.clientX,d.clientY);E&&(y.removeAllRanges(),y.addRange(E))}else if(document.caretPositionFromPoint){const E=document.caretPositionFromPoint(d.clientX,d.clientY);E&&(g.setStart(E.offsetNode,E.offset),g.collapse(!0),y.removeAllRanges(),y.addRange(g))}b.focus()},0),setTimeout(()=>document.addEventListener("click",I),0),d.stopPropagation()});let N=null,w=!1;t.addEventListener("mouseenter",()=>{!e&&!o&&(w=!0,N=t.style.zIndex||"1",t.style.zIndex="9999")}),t.addEventListener("mouseleave",()=>{!e&&!o&&N!==null&&(w=!1,t.style.zIndex=N,N=null)}),b.addEventListener("blur",()=>b.contentEditable="false"),b.addEventListener("keydown",d=>{if(d.key==="Enter")if(d.preventDefault(),d.shiftKey)b.contentEditable="false",C();else{const[g,y]=[window.getSelection(),window.getSelection().getRangeAt(0)],E=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});y.deleteContents(),y.insertNode(E),y.setStartAfter(E),y.collapse(!0),g.removeAllRanges(),g.addRange(y)}});const L=()=>{const d=t.getBoundingClientRect();Z[f]={x:d.left,y:d.top}};let T=0,S=0,A=null;document.addEventListener("mousemove",d=>{[T,S]=[d.clientX,d.clientY],x(".color-palette.visible").forEach(g=>{var st;const[y,E]=[g.getBoundingClientRect(),(st=g.closest(".note-controls"))==null?void 0:st.querySelector(".color-button")];if(!E)return;const O=E.getBoundingClientRect(),[Q,kt]=[T>=y.left-10&&T<=y.right+10&&S>=y.top-10&&S<=y.bottom+10,T>=O.left&&T<=O.right&&S>=O.top&&S<=O.bottom];Q||kt?clearTimeout(A):g.classList.contains("visible")&&z()})});const U=()=>{clearTimeout(A),h.classList.remove("closing"),h.classList.add("visible"),x(".color-palette").forEach(d=>{d!==h&&(d.classList.add("closing"),setTimeout(()=>d.classList.remove("visible","closing"),180))})},z=()=>{clearTimeout(A),A=setTimeout(()=>{const[d,g]=[h.getBoundingClientRect(),p.getBoundingClientRect()],[y,E]=[T<d.left-10||T>d.right+10||S<d.top-10||S>d.bottom+10,T>=g.left&&T<=g.right&&S>=g.top&&S<=g.bottom];y&&!E&&(h.classList.add("closing"),setTimeout(()=>h.classList.contains("closing")&&h.classList.remove("visible","closing"),180))},50)};p.addEventListener("click",d=>{d.stopPropagation(),h.classList.contains("visible")?z():U()}),["mouseenter","mouseleave"].forEach((d,g)=>h.addEventListener(d,g?z:()=>clearTimeout(A)));const R=(d,g,y)=>{if(!d.target.closest(".color-palette, .done-button")){if(k.includes(t)&&k.length>1){Fe(d);return}d.shiftKey?k.includes(t)||(k.push(t),t.classList.add("selected")):xt(),d.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],w?N=++q:t.style.zIndex=++q,[a,s]=[g,y],d.target.closest(".resize-handle")?[o,l,m]=[!0,t.offsetWidth,t.offsetHeight]:([r,c]=[v(t.style.left),v(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[r,c],u=setTimeout(()=>e=!0,150)),tt=t}},_=(d,g)=>{if(!(!tt||tt!==t)){if((Math.abs(d-a)>5||Math.abs(g-s)>5)&&clearTimeout(u),e){Mt||(Mt=!0,document.body.classList.add("drag-in-progress"));const y=5;let[E,O]=[Math.min(Math.max(r+d-a,-y),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(c+g-s,-y),window.innerHeight-t.offsetHeight/4)];[t.style.left,t.style.top]=[`${E}px`,`${O}px`],qt(),be(d,g)}if(o){const[y,E]=[150,150],[O,Q]=[window.innerWidth-v(t.style.left)+50,window.innerHeight-v(t.style.top)+50];t.style.width=`${Math.min(Math.max(l+d-a,y),O)}px`,t.style.height=`${Math.min(Math.max(m+g-s,E),Q)}px`}}},J=()=>{if(clearTimeout(u),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(e||o)&&e){if(ut(),!we().moved){L(),ge(t),ao(t);const g=t.dataset.noteId||_t();[t.dataset.noteId,t.dataset.repositioned]=[g,"true"],Rt.add(g),Z[f]={x:v(t.style.left),y:v(t.style.top)},G[f]=t.style.backgroundColor,H(),Yt(),tt=null}X(),[Mt,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[e,o]=[!1,!1],ut()};t.addEventListener("mousedown",d=>R(d,d.clientX,d.clientY)),document.addEventListener("mousemove",d=>_(d.clientX,d.clientY)),document.addEventListener("mouseup",J)}function so(){x(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),ee=null}document.addEventListener("click",t=>{ee&&!t.target.closest(".color-button")&&so()});function ao(t){if(!t)return;const[e,o,n,a]=[t.getBoundingClientRect(),window.innerHeight,250,150],s=o-a,[r,c]=[e.bottom>s,e.left<n&&e.bottom>s];if(c){const[l,m,u]=[e.bottom-s+20,v(t.style.top),Math.max(60,v(t.style.top)-(e.bottom-s+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${u}px`,setTimeout(()=>t.style.transition="",300)}}function be(t,e){var h,b;if(At)return;const o=i(".status-bar");if(!o)return;const n=o.getBoundingClientRect(),[a,s]=[Math.max(0,Math.max(n.left-t,t-n.right)),Math.max(0,Math.max(n.top-e,e-n.bottom))],[r,c,l,m]=[Math.sqrt(a*a+s*s),120,80,B!==null],u=m?r<=c:r<=l,p=()=>{let[C,I]=[null,1/0];return x(".board-button:not(.disabled)").forEach(N=>{const w=N.getBoundingClientRect(),L=Math.sqrt(Math.pow(t-(w.left+w.width/2),2)+Math.pow(e-(w.top+w.height/2),2));L<I&&([C,I]=[N,L])}),C};if(u!==m)if(u){const C=x(".board-button:not(.disabled)");B=p(),C.forEach(I=>I.classList.add("drag-active","drag-proximity")),B&&B.classList.add("drag-hover"),ro()}else x(".board-button").forEach(C=>{C.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>C.classList.remove("drag-active"),200)}),B=null,ve();else if(u&&B){const C=p();C!==B&&(B==null||B.classList.remove("drag-hover"),B=C,C?(C.classList.add("drag-hover"),ut(),(h=i(".shortcut-hint"))==null||h.classList.add("hidden-during-drag")):(qt(),dt||(b=i(".shortcut-hint"))==null||b.classList.remove("hidden-during-drag")))}}function ro(){if(!B)return;const[t,e]=[B.getBoundingClientRect(),k.length>0?k:tt?[tt]:[]];e.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(c=>{[c.style.userSelect,c.style.pointerEvents]=["none","none"]});const[n,a]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[s,r]=[t.left-a.left+t.width/2-(n.left-a.left)-n.width/2,t.top-a.top+t.height/2-(n.top-a.top)-n.height/2];o.style.setProperty("--suckX",`${s}px`),o.style.setProperty("--suckY",`${r}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function ve(){x(".hover-animating").forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events")}),t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),t.classList.remove("reverse-animating"))},300)})}function qt(){var t;if($>1&&!dt&&!B){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),dt=!0),(t=i(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function ut(){var t;if(dt){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),dt=!1),(t=i(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Yt(){x(".board-button").forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[B]=[null],ve(),ut()}function we(){if(!B)return{moved:!1};const[t,e]=[parseInt(B.dataset.boardId),k.length>0?[...k]:[tt]];if(t===f)return e.forEach(n=>{if(n){const a=V==null?void 0:V.find(s=>s.element===n);a?(n.style.left=`${a.x}px`,n.style.top=`${Math.max(60,a.y)}px`):n.style.top=`${parseInt(n.style.top||0)-250}px`}}),{moved:!1};let o=new Map;return e.length>1&&typeof V!="undefined"&&V.length>0&&V.forEach(n=>{n&&e.includes(n.element)&&o.set(n.element,{originalX:n.x,originalY:n.y})}),e.forEach(n=>{n&&io(n,t,o.size>0?o.get(n):null)}),k.length>0&&xt(),{moved:!0}}function io(t,e,o=null){const n=t.style.left;if(t.classList.contains("hover-animating"))t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const a=i(`.board-button[data-board-id="${e}"]`);if(!a)return;const[s,r,c]=[a.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,m]=[s.left-c.left+s.width/2-(r.left-c.left)-r.width/2,s.top-c.top+s.height/2-(r.top-c.top)-r.height/2];t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${m}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards",t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(s=>{s.style.removeProperty("user-select"),s.style.removeProperty("pointer-events")}),t.remove();const a=i(`.board[data-board-id="${e}"]`);if(a){if(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),o)if(o.originalX!==void 0&&o.originalY!==void 0)[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[c,l]=[100,80];[t.style.left,t.style.top]=[`${c+(o.offsetX||0)}px`,`${Math.max(60,l+(o.offsetY||0))}px`]}else{const[c,l]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];!isNaN(c)&&!isNaN(l)?[t.style.left,t.style.top]=[`${c}px`,`${Math.max(60,l)}px`]:[t.style.left,t.style.top]=[n,"80px"]}const s=t.dataset.noteId||_t();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[s,"true","true"],Rt.add(s),a.appendChild(t),t.style.animation="paperPop 0.3s ease-out forwards",H(),Yt(),At=!0,setTimeout(()=>At=!1,500);const r=f;[f]=[e],X(),[f]=[r],X()}},600)}let D={},W=null,ft={x:0,y:0},P=[];function Ee(){mo(),Te(),lo(),x(".emoji-item").forEach(t=>t.addEventListener("click",xe))}const xe=t=>{const e=t.target.dataset.emoji;e&&(uo(e),co(e))};function co(t){const e=i(".board.active");if(!e)return;const o=e.dataset.boardId;if(go(o)>=10)return ho();const n=po(),a=e.getBoundingClientRect(),[s,r,c]=[a.width-120,a.height*.8-120,20],[l,m]=[Math.random()*s,Math.max(c,Math.random()*r)],u=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});u.dataset.stickerId=n,Object.assign(u.style,{left:l+"px",top:m+"px"});const p=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});p.addEventListener("click",h=>[h.stopPropagation(),Se(n,o)]),u.appendChild(p),Le(u),e.appendChild(u),(D[o]=D[o]||{})[n]={emoji:t,x:l,y:m,id:n},Xt(o),setTimeout(()=>u.classList.remove("new"),400)}function Le(t){let e=!1;t.addEventListener("mousedown",o);function o(s){if(s.target.classList.contains("delete-button"))return;s.preventDefault(),s.stopPropagation(),[e,W]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[r,c]=[s.clientX,s.clientY],l=t.getBoundingClientRect();[ft.x,ft.y]=[r-l.left,c-l.top],t.classList.add("dragging"),document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)}function n(s){if(!e||!W)return;s.preventDefault(),s.stopPropagation();const[r,c]=[s.clientX,s.clientY],l=i(".board.active").getBoundingClientRect(),[m,u]=[Math.max(0,Math.min(r-l.left-ft.x,l.width-120)),Math.max(0,Math.min(c-l.top-ft.y,l.height-120))];Object.assign(W.style,{left:m+"px",top:u+"px"})}function a(){var c;if(!e||!W)return;W.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],yo(W);const[s,r]=[i(".board.active").dataset.boardId,W.dataset.stickerId];(c=D[s])!=null&&c[r]&&(Object.assign(D[s][r],{x:parseInt(W.style.left),y:parseInt(W.style.top)}),Xt(s)),W=null,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a)}}const Se=(t,e)=>{const o=i(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),D[e]&&(delete D[e][t],Xt(e))},Xt=t=>localStorage.setItem(`emojiStickers_board_${t}`,JSON.stringify(D[t]||{}));function ke(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{D[t]=e?JSON.parse(e):{},e&&Ce(t)}catch(o){console.error("Error loading emoji stickers:",o),D[t]={}}}const lo=()=>Array.from({length:$},(t,e)=>ke(e+1));function Ce(t){const e=i(`.board[data-board-id="${t}"]`);!e||!D[t]||(e.querySelectorAll(".emoji-sticker").forEach(o=>o.remove()),Object.values(D[t]).forEach(({id:o,emoji:n,x:a,y:s})=>{const r=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:n});r.dataset.stickerId=o,Object.assign(r.style,{left:a+"px",top:s+"px"});const c=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});c.addEventListener("click",l=>[l.stopPropagation(),Se(o,t)]),r.appendChild(c),Le(r),e.appendChild(r)}))}function uo(t){const e=P.indexOf(t);(e<0||e>=12)&&(e>-1&&P.splice(e,1),P.unshift(t),P.length>16&&(P=P.slice(0,16)),fo(),Te())}function mo(){const t=localStorage.getItem("emojiUsageOrder");try{P=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),P=[]}}const fo=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(P));function Te(){const t=i(".emoji-picker");t&&(t.querySelectorAll(".recent-emoji").forEach(e=>e.remove()),P.length>0&&P.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",xe),t.insertBefore(o,t.firstChild)}))}const go=t=>D[t]?Object.keys(D[t]).length:0,ho=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function yo(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[n,a,s]=[250,150,o-150];if(e.left<n&&e.bottom>s){const c=Math.max(60,parseInt(t.style.top)-(e.bottom-s+20));t.style.top=`${c}px`}}const po=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),bo=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete D[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(Ee,100));window.emojiStickers={loadEmojiStickers:ke,renderEmojiStickers:Ce,cleanupEmojiStickers:bo,initializeEmojiPicker:Ee};const St=()=>new Date,$e=t=>{const e=St().getDay(),o=e===0?6:e-1;return t===o},vo=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,St().toISOString().split("T")[0])},Ht=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((St()-new Date(e))/(1e3*60*60*24))%5:-1},Be=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),Gt=()=>{if($>=ct){alert(`Maximum number of boards (${ct}) reached.`);return}jt(++$),ie(),vt()};function jt(t){const e=i(".boards-container"),o=Object.assign(document.createElement("div"),{className:"board"});o.dataset.boardId=t,e.appendChild(o);const n=Object.assign(document.createElement("div"),{className:"board-title-circle"});n.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let s;const r=()=>{const l=a.value.trim();if(!l){a.value=a.dataset.originalTitle||"";return}zt(t,l),wt(a)};a.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(r,500)}),wt(a),n.appendChild(a),o.appendChild(n);const c=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});if(c.dataset.boardId=t,c.addEventListener("click",()=>K(t)),t>1){const l=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});l.addEventListener("click",m=>{m.stopPropagation(),bt(t)}),c.appendChild(l)}i(".boards-navigation").insertBefore(c,i(".add-board-button")),setTimeout(()=>[c.classList.remove("new-button"),c.classList.add("transitions-ready")],500),mt(t),Wt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function bt(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=i(`.board[data-board-id="${t}"]`);if(!e){Nt(t);return}const[o,n]=[e.querySelectorAll(".sticky-note"),e.querySelectorAll(".emoji-sticker")];if(o.length||n.length){const a=i(".trash-bin"),s=a.getBoundingClientRect();setAnimation(a,"binShake 0.5s ease-in-out"),o.forEach(r=>{const c=r.querySelector(".sticky-content");Y.unshift({text:c.innerHTML,color:r.style.backgroundColor,x:r.style.left,y:r.style.top,width:r.style.width,height:r.style.height,timestamp:new Date().toLocaleString(),isBold:c.classList.contains("bold")});const l=r.getBoundingClientRect(),[m,u]=[s.left-l.left+s.width/2-l.width/2,s.top-l.top];r.style.setProperty("--throwX",`${m}px`),r.style.setProperty("--throwY",`${u}px`),setAnimation(r,"paperCrumble 0.5s ease-in forwards")}),n.forEach(r=>r.classList.add("deleting")),Et(),nt(),setTimeout(()=>Nt(t),600)}else Nt(t)}function Nt(t){const[e,o]=[i(`.board[data-board-id="${t}"]`),i(`.board-button[data-board-id="${t}"]`)];e&&e.remove(),o&&o.classList.add("removing");const n=[];for(let a=t+1;a<=$;a++){const s=i(`.board-button[data-board-id="${a}"]`);s&&(s.classList.add("removing"),n.push(a))}[`${ot}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(a=>localStorage.removeItem(a)),Be(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let a=t+1;a<=$;a++)["boardColor","boardPattern","boardStyles_board"].forEach(s=>{const[r,c,l]=[`${s}_${a}`,`${s}_${a-1}`,localStorage.getItem(`${s}_${a}`)];l&&localStorage.setItem(c,l),localStorage.removeItem(r)});setTimeout(()=>{o&&o.remove();const[a,s]=[i(".boards-navigation"),i(".add-board-button")];n.forEach(r=>{const[c,l,m]=[i(`.board-button[data-board-id="${r}"]`),i(`.board[data-board-id="${r}"]`),r-1];c&&c.remove(),l&&(l.dataset.boardId=m);const u=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:m});if([u.dataset.boardId,u.dataset.originalNumber]=[m,m],u.addEventListener("click",()=>K(m)),m>1){const p=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});p.addEventListener("click",h=>{h.stopPropagation(),bt(m)}),u.appendChild(p)}a.insertBefore(u,s),["","Title","Color","Pattern"].forEach(p=>{const[h,b,C]=[p?`stickyNotes_board${p}`:ot,`${p?`stickyNotes_board${p}`:ot}_board_${r}`,`${p?`stickyNotes_board${p}`:ot}_board_${m}`],I=localStorage.getItem(b);I&&(localStorage.setItem(C,I),localStorage.removeItem(b))}),mt(m)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(r=>[r.classList.remove("new-button"),r.classList.add("transitions-ready")]),500),$--,ie(),vt(),f===t?K(t>1?t-1:$>=1?1:null):f>t&&(f--,K(f)),i(".trash-bin").style.animation=""},350)}function K(t){const e=parseInt(t);e===f||e===null||(xo(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),f=e,Z[t]||(Z[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),G[t]||(G[t]=rt[0]),x(".board").forEach(o=>{const n=parseInt(o.dataset.boardId);if(o.classList.remove("active","prev","next"),o.style.visibility="hidden",n===f){if(o.classList.add("active"),o.style.visibility="visible",o.querySelectorAll(".sticky-note").forEach((a,s)=>a.style.setProperty("--note-index",s)),o.querySelectorAll(".emoji-sticker").forEach((a,s)=>a.style.setProperty("--sticker-index",s)),!o.querySelector(".board-title-circle")){const a=Object.assign(document.createElement("div"),{className:"board-title-circle"});a.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const s=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),r=()=>zt(n,s.value);["change","blur"].forEach(c=>s.addEventListener(c,r)),a.appendChild(s),o.appendChild(a),Wt(n)}}else o.classList.add(n<f?"prev":"next")}),document.querySelectorAll(".board-button").forEach(o=>o.classList.toggle("active",parseInt(o.dataset.boardId)===f)),mt(f),Ne(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=j.colors.current),H(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(f),setTimeout(()=>Ie(f),300))}function wo(){i(".add-board-button").addEventListener("click",Gt),x(".board-button").forEach(t=>{const[e,o]=[parseInt(t.dataset.boardId),t.cloneNode(!0)];o.addEventListener("click",()=>K(e));const n=o.querySelector(".delete-board");n&&n.addEventListener("click",a=>{a.stopPropagation(),bt(e)}),t.parentNode.replaceChild(o,t)}),document.addEventListener("keydown",t=>{const[e,o]=[t.target.tagName,t.target.getAttribute("contenteditable")==="true"];if((t.key==="Control"||t.key==="Meta")&&!t.altKey&&!t.shiftKey&&e!=="TEXTAREA"&&!o){t.preventDefault(),i(".note-input textarea").focus();return}if(e==="TEXTAREA"||o){(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),Pt());return}t.key==="ArrowLeft"&&f>1?K(f-1):t.key==="ArrowRight"&&f<$?K(f+1):t.key==="n"&&t.ctrlKey?(t.preventDefault(),Gt()):t.key==="d"&&t.ctrlKey&&f>1&&(t.preventDefault(),bt(f));const n=parseInt(t.key);!isNaN(n)&&n>=1&&n<=9&&n<=$&&K(n)})}function vt(){const t=i(".add-board-button"),e=$>=ct;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${ct}) reached`:"Add new board",Eo()}function Eo(){const t=i(".shortcut-hint");t&&(t.style.display=$>=2?"block":"none")}let Qt=!1;function xo(){if(Qt||$<2)return;const t=i(".shortcut-hint");t&&(Qt=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function Lo(){const t=i(".board-style-menu"),e=t.classList.contains("visible");e||(Ne(),Me(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=j.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function Me(){i(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?So(o):Co(o),document.querySelectorAll(`.board-${e}-option`).forEach(n=>n.classList.remove("active")),t.classList.add("active")})})}function Ne(){["color","pattern"].forEach(t=>{x(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===j[`${t}s`].current)})})}function So(t){j.colors.current=t;const e=getActiveBoard();e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),ce(),H(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function ko(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; transition:opacity 0.5s ease; opacity:0;"}),o=i(`.board[data-board-id="${f}"]`);if(t!=="none"){const n={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(n[t])e.style.cssText+=n[t];else if(t==="weekdays"||t==="days"){const a=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((r,c)=>{const l=Object.assign(document.createElement("span"),{textContent:r});(t==="weekdays"&&$e(c)||t==="days"&&Ht(f)===c)&&l.classList.add("current-day"),a.appendChild(l)}),e.appendChild(a),o==null||o.classList.add("has-header")}}else o==null||o.classList.remove("has-header");return e}function Co(t){const[e,o,n]=[getActiveBoard(),getActiveBoard().dataset.boardId,j.patterns.current];n==="days"&&t!=="days"&&Be(o),j.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(r=>r.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t==="days"&&vo(o);const a=ko(t);e.appendChild(a),a.offsetWidth,a.style.opacity="1";let s=null;(t==="weekdays"||t==="days")&&(s=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.5s ease;"}),e.appendChild(s),s.offsetWidth,s.style.opacity="1"),setTimeout(()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),a.style.height="auto",a.style.zIndex="1",a.classList.add("pattern-overlay"),s&&(s.style.zIndex="0",s.classList.add("pattern-overlay"))):(a.remove(),s==null||s.remove(),t!=="none"&&e.classList.add(`board-pattern-${t}`)),H()},500),ce()}function To(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(s,r)=>`Day ${r+1}`)).forEach((s,r)=>{const c=Object.assign(document.createElement("span"),{textContent:s});(e.pattern==="weekdays"&&$e(r)||e.pattern==="days"&&Ht(parseInt(t.dataset.boardId))===r)&&c.classList.add("current-day"),o.appendChild(c)}),t.appendChild(o);const a=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(a)}}function mt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=i(`.board[data-board-id="${t}"]`);if(!o)return;let n;e?(n=JSON.parse(e),t===f&&(j.colors.current=n.color,j.patterns.current=n.pattern)):(n={color:j.colors.default,pattern:j.patterns.default},t===f&&(j.colors.current=n.color,j.patterns.current=n.pattern)),To(o,n),H()}$o();document.addEventListener("click",function(t){const e=i(".board-style-menu"),o=i(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function $o(){document.querySelectorAll(".board").forEach(t=>Wt(t.dataset.boardId))}function zt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function wt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function Wt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(o){const a=o.querySelector(".board-title-input");a&&e&&(a.value=e)}const n=document.querySelector(`.board-button[data-board-id="${t}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function Ie(t){const e=i(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function Bo(){x(".board-title-circle").forEach(t=>{let e;const[o,n]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((a,s)=>{t.addEventListener(a,()=>{s===0?(o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")):s===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()):o&&o.focus()})}),o){let a;const s=()=>{const r=o.value.trim();if(!r){o.dataset.originalTitle="";return}zt(n,r),wt(o)};o.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(s,500)}),wt(o)}})}const H=()=>{for(let t=1;t<=$;t++){const[e,o]=[i(`.board[data-board-id="${t}"]`),i(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;const n=e.style.backgroundColor||j.colors.default;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),o.style.backgroundColor=n;const a=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],s=a.find(c=>e.classList.contains(c));a.forEach(c=>o.classList.remove(c.replace("board-pattern","button-pattern"))),s&&o.classList.add(s.replace("board-pattern","button-pattern"));const r=Oe(n)||{r:26,g:26,b:26};o.style.color=(r.r*299+r.g*587+r.b*114)/1e3>128?"#000":"#fff"}};function Mo(t){t.forEach(({selector:e,event:o,handler:n})=>{const a=i(e);a&&a.addEventListener(o,n)})}document.addEventListener("DOMContentLoaded",function(){qe(),_e(),de(),wo(),Me(),Ye(),pe(),Bo(),No(),setTimeout(()=>Ie(f),500),Io(),Mo([{selector:".board-style-button",event:"click",handler:Lo},{selector:".trash-bin",event:"click",handler:lt},{selector:"#trashModal .close-modal-btn",event:"click",handler:lt},{selector:"#trashModal .clear-trash-btn",event:"click",handler:he}])});function No(){const t=a=>{const s=a.selectionStart,r=a.value;if(r.length>0){const c=r.charAt(0).toUpperCase()+r.slice(1);c!==r&&(a.value=c,a.setSelectionRange(s,s))}},e=a=>{["input","keyup"].forEach(s=>a.addEventListener(s,r=>t(r.target))),a.addEventListener("paste",s=>setTimeout(()=>t(s.target),0))};x(".board-title-input, .note-input textarea").forEach(e);const o=new MutationObserver(a=>{a.forEach(s=>{s.addedNodes.forEach(r=>{var c;r.nodeType===1&&((r.querySelectorAll?r.querySelectorAll(".board-title-input"):[]).forEach(e),(c=r.classList)!=null&&c.contains("board-title-input")&&e(r))})})}),n=i(".boards-container");n&&o.observe(n,{childList:!0,subtree:!0})}function Io(){setTimeout(()=>{x(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>t.style.transform="scale(1)")})},100)}window.toggleBold=ye;window.markAsDone=Ot;window.addNote=Pt;window.restoreNote=Ge;window.changeNoteColor=eo;window.markAsDone=Ot;window.toggleBold=ye;window.clearTrash=he;})();
