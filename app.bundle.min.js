(()=>{const nt=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],N={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let _=[];let Z=null,Ut=null,ut=!1,G=null,mt=0,ft=0,L=[],st=!1,Kt=0,Jt=0,U=[];const K={},J={},O={};let R=1e3;K[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};J[1]=nt[0];let u=1,T=1;const at=9,Q="stickyNotes_active",Vt="stickyNotes_deleted",Zt="stickyNotes_boardCount",Gt="stickyNotes_zIndexes",v=t=>parseInt(String(t).replace("px",""))||0,ke=(t,e)=>{const o=Math.random()*10-5;let n=t+o,a=e+70;const s=5,r=window.innerWidth-200,i=window.innerHeight-300;a>i&&(a=50,n=t+250,n>r&&(n=s+50,a=50));const c=Math.min(Math.max(n,s),r),f=Math.min(Math.max(a,s),window.innerHeight-100);return{x:c,y:f}},Ce=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,n,a,s)=>n+n+a+a+s+s);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},$t=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(o){console.error(`Failed to save to localStorage (${t}):`,o)}},P=()=>{const t=document.querySelector(`.board[data-board-id="${u}"]`);if(!t)return;const e=Array.from(t.querySelectorAll(".sticky-note")).map(o=>({text:o.querySelector(".sticky-content").innerHTML,color:o.style.backgroundColor,x:o.style.left,y:o.style.top,width:o.style.width||"200px",height:o.style.height||"150px",isBold:o.querySelector(".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}));$t(`${Q}_board_${u}`,e),typeof Y=="function"&&Y()},bt=()=>$t(Vt,_),Qt=()=>localStorage.setItem(Zt,T.toString()),te=()=>$t(`boardStyles_board_${u}`,{color:N.colors.current,pattern:N.patterns.current}),ee=()=>{const t=document.getElementById("shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},oe=()=>{const t=document.querySelector(".note-input textarea");if(!t)return;const e=document.getElementById("shortcutIcon"),o=()=>{if(!e)return;const n=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",a=t.value.trim();e.innerHTML=a?`${n}+\u21B5`:n,e.classList.toggle("focus-hint",!a),e.classList.toggle("enter-hint",a)};t.addEventListener("focus",()=>{o(),t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px"),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{ee(),t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px"),t.removeEventListener("input",o)}),document.addEventListener("mousedown",n=>{!n.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},Xt=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},Te=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{console.log("Performing one-time localStorage cleanup...");const e=[];for(let o=0;o<localStorage.length;o++){const n=localStorage.key(o);n&&(n.startsWith("stickyNotes_")||n.startsWith("boardColor_")||n.startsWith("boardPattern_")||n.startsWith("boardStyles_")||n.startsWith("emojiStickers_")||n.startsWith("daysPatternStartDate_")||n.startsWith("emojiUsageOrder"))&&e.push(n)}e.forEach(o=>{localStorage.removeItem(o)}),console.log(`Cleaned up ${e.length} localStorage items`),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},qe=()=>{try{Te(),typeof Ht=="function"&&Ht();const t=localStorage.getItem(Zt);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){T=Math.min(o,at);for(let n=2;n<=T;n++)typeof Mt=="function"&&Mt(n)}}typeof ht=="function"&&ht();for(let o=1;o<=T;o++){const n=localStorage.getItem(`${Q}_board_${o}`);if(n){const a=Xt(n,[]);Array.isArray(a)&&a.forEach(s=>{if(s&&typeof s=="object"&&s.text&&(K[o]={x:v(s.x),y:v(s.y)},J[o]=s.color||nt[0],typeof yt=="function")){const r=yt(s.text,s.color||nt[0],v(s.x),v(s.y),!0,s.width||"200px",s.height||"150px",s.isBold||!1,o);r&&s.noteId&&(r.dataset.noteId=s.noteId,O[s.noteId]?(r.style.zIndex=O[s.noteId],O[s.noteId]>R&&(R=O[s.noteId])):s.zIndex&&!isNaN(parseInt(s.zIndex))&&(r.style.zIndex=s.zIndex,O[s.noteId]=parseInt(s.zIndex),parseInt(s.zIndex)>R&&(R=parseInt(s.zIndex))))}})}typeof lt=="function"&&lt(o)}typeof z=="function"&&z(1);const e=localStorage.getItem(Vt);if(e){const o=Xt(e,[]);Array.isArray(o)&&(_=o,typeof tt=="function"&&tt())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),ee(),oe()}catch(t){console.error("Critical error loading saved data:",t)}},Me=t=>{t.style.zIndex=++R;const e=t.dataset.noteId;e&&(O[e]=R,ne())},ne=()=>{try{localStorage.setItem(Gt,JSON.stringify(O))}catch(t){console.error("Error saving note z-indexes:",t)}},$e=()=>{try{const t=localStorage.getItem(Gt);t&&(Object.assign(O,JSON.parse(t)),R=Math.max(1e3,...Object.values(O)))}catch(t){console.error("Error loading note z-indexes:",t)}};const Ht=()=>{G=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(G.style,{display:"none"}),document.body.appendChild(G)};function Ne(){const t=document.querySelector(".boards-container");document.addEventListener("mousedown",e=>{e.target.closest(".board")&&!e.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&e.preventDefault()}),[["mousedown",Be],["mousemove",Ie],["mouseup",Ae]].forEach(([e,o])=>(e==="mousedown"?t:document).addEventListener(e,o))}function Be(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=document.querySelector(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&vt(),[ut,mt,ft]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),G.style.cssText=`left:${mt}px; top:${ft}px; width:0; height:0; display:block;`}function Ie(t){if(!ut)return;t.preventDefault();const[e,o]=[Math.abs(t.clientX-mt),Math.abs(t.clientY-ft)],[n,a]=[Math.min(t.clientX,mt),Math.min(t.clientY,ft)];G.style.cssText=`left:${n}px; top:${a}px; width:${e}px; height:${o}px; display:block;`,je()}const Ae=()=>{ut&&(ut=!1,document.body.classList.remove("selecting"),G.style.display="none")};function je(){const t=G.getBoundingClientRect(),e=document.querySelector(`.board[data-board-id="${u}"]`);if(!e)return;const o=(n,a,s)=>{const r=n.getBoundingClientRect(),i=!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom),c=a.indexOf(n);i?c===-1&&(a.push(n),n.classList.add(s)):!st&&c!==-1&&(a.splice(c,1),n.classList.remove(s))};e.querySelectorAll(".sticky-note").forEach(n=>o(n,L,"selected"))}const vt=()=>{L.forEach(t=>t.classList.remove("selected")),L=[]};function De(t){[st,Kt,Jt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),U=L.map(e=>({element:e,x:v(e.style.left),y:v(e.style.top),type:"note"})),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,e==="mousemove"?se:ae))}function se(t){if(!st)return;const[e,o]=[t.clientX-Kt,t.clientY-Jt],[n,a,s]=[5,-5,-5],[r,i]=[window.innerWidth-n,window.innerHeight-n];(f=>f.forEach(d=>{const[p,y]=[Math.min(Math.max(d.x+e,a),r-d.element.offsetWidth/4),Math.min(Math.max(d.y+o,s),i-d.element.offsetHeight/4)];Object.assign(d.element.style,{left:`${p}px`,top:`${y}px`})}))(U),L.length>0&&(de(t.clientX,t.clientY),L.length>1&&jt())}function ae(){if(!st)return;if(st=!1,document.body.classList.remove("selecting"),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,e==="mousemove"?se:ae)),ct(),!me().moved){P();for(let e=L.length-1;e>=0;e--)re(L[e])&&L.splice(e,1)}Dt()}let ot=[];const Oe=100,zt=50,Re="#ffd700",_e=()=>{const[t,e]=[document.getElementById("trashModal"),document.querySelector(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>St())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},Nt=t=>{L.includes(t)&&L.length>1?(L.forEach((e,o)=>setTimeout(()=>Tt(e),o*100)),vt()):Tt(t)},Tt=t=>{if(_.length>=Oe){!ot.includes(t)&&ot.push(t),_e();return}const e=t.querySelector(".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};Pe(t),_.unshift(o),bt(),tt(),Ye(t)},Pe=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,n]=[e.getBoundingClientRect(),t.getBoundingClientRect()],a=Math.min(5,Math.max(0,Math.floor((n.left+n.width/2-o.left)/(o.width/6))));window.noteColumns[a]&&(window.noteColumns[a]=window.noteColumns[a].filter(s=>Math.abs(s.x-v(t.style.left))>1||Math.abs(s.y-v(t.style.top))>1))},Ye=t=>{const e=document.querySelector(".trash-bin"),o=e.getBoundingClientRect(),n=t.getBoundingClientRect(),a=o.left-n.left+o.width/2-n.width/2,s=o.top-n.top;t.style.setProperty("--throwX",`${a}px`),t.style.setProperty("--throwY",`${s}px`),t.style.animation="paperCrumble 0.6s ease-in forwards",e.style.animation="binShake 0.6s ease-in-out",setTimeout(()=>{t.remove(),e.style.animation="",P(),Y()},600)},re=t=>{const[e,o]=[document.querySelector(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(Nt(t),!0):!1},rt=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>St())):setTimeout(()=>t.style.display="none",300)},St=()=>{const t=document.querySelector(".deleted-notes-container");t.style.minHeight="200px",t.innerHTML=_.length?_.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||Re}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},Xe=t=>{const e=document.querySelectorAll(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[o]=_.splice(t,1);yt(o.text,o.color,v(o.x),v(o.y),!0,o.width,o.height,o.isBold),bt(),tt(),St(),P(),Y()},300)},ie=()=>{if(_.length===0){rt();return}const t=[...document.querySelectorAll(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*zt}ms`}),setTimeout(()=>{_=[],bt(),tt(),St(),setTimeout(()=>{if(rt(),ot.length){const e=[...ot];ot=[],setTimeout(()=>{e.forEach(o=>{o!=null&&o.parentNode&&Tt(o)})},300)}},200)},(t.length?(t.length-1)*zt+300:0)+100)},tt=()=>{document.querySelector(".trash-count").textContent=_.length};document.addEventListener("click",t=>{const e=document.getElementById("trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&rt()});let Bt=new Set;const It=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,He=()=>Math.random()*40-20,ze=(t=Et())=>t.getDay()===0?0:t.getDay()-1;function Lt(t){const e=document.getElementById("noteLimitMessage"),o=e==null?void 0:e.querySelector(".transfer-text");o&&(o.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function At(){const t=document.querySelector(".note-input textarea"),e=t.value.trim();if(!e)return;const o=document.querySelector(`.board[data-board-id="${u}"]`),n=Array.from(o.querySelectorAll(".sticky-note")),[a,s,r]=[o.classList.contains("board-pattern-weekdays"),o.classList.contains("board-pattern-days"),n.filter(b=>!b.dataset.transferred).length===0];if(!a&&!s&&n.length>=30){Lt("Maximum notes space reached.");return}const i=n.filter(b=>!b.dataset.transferred),c=i[i.length-1];let{x:f,y:d}=K[u]||{x:0,y:0},p=J[u]||getRandomColor(),y,h;const x=(b,w,C=null)=>{const E=o.offsetWidth/w,$=b*E+10,W=(b+1)*E-210,X=Math.max($,Math.min(W,$+He())),A=Array.from(o.querySelectorAll(".sticky-note")).filter(m=>m.style.display!=="none"&&m!==C),[j,F]=[b*E,(b+1)*E],l=A.filter(m=>{const[g,S]=[v(m.style.left),v(m.style.left)+200],[I,V]=[Math.max(g,j),Math.min(S,F)];return Math.max(0,V-I)/200>.5});return{positionX:X,columnNotes:l}},M=(b,w)=>{const C=window.innerHeight-300;for(let E=0;E<w;E++){const $=(b+E)%w,{positionX:W,columnNotes:X}=x($,w);let A=60,j=null;X.forEach(l=>{const m=v(l.style.top);m>=A&&(A=m,j=l)});const F=j?A+70:60;if(F<=C)return y=W,h=F,j&&(p=j.style.backgroundColor),!0}return Lt("Maximum notes space reached."),!1},k=b=>{let w;const C=b?6:5;if(c){const E=v(c.style.left),$=o.offsetWidth/C;w=Math.floor(E/$),w=Math.max(0,Math.min(w,C-1))}else w=b?ze():Rt(u)||0;return M(w,C)};if(r)if(a||s){if(k(a)===!1)return}else[y,h]=[Math.max(150,window.innerWidth/4),50];else if(a||s){if(k(a)===!1)return}else if(c&&([f,d,p]=[v(c.style.left),v(c.style.top),c.style.backgroundColor]),{x:y,y:h}=ke(f,d),h<=50){const b=n.filter(w=>Math.abs(v(w.style.left)-y)<150);if(b.length>0){const w=b.map(A=>v(A.style.top)),[C,E]=[Math.max(...w),Math.min(...w)],$=window.innerHeight-300,[W,X]=[C+200,E-200];if(W<=$)h=W;else if(X>=50)h=X;else{const A=(F,l)=>{const m=window.innerWidth-200;for(let g=F;l>0?g<=m:g>=55;g+=l*250){const S=n.filter(wt=>Math.abs(v(wt.style.left)-g)<150);if(S.length===0)return{x:g,y:50};const I=S.map(wt=>v(wt.style.top)),[V,xt]=[Math.max(...I),Math.min(...I)],[et,Yt]=[V+200,xt-200];if(et<=$)return{x:g,y:et};if(Yt>=50)return{x:g,y:Yt}}return null},j=A(y+250,1)||A(y-250,-1);if(j)[y,h]=[j.x,j.y];else{Lt("Maximum notes space reached.");return}}}}yt(e.replace(/\n/g,"<br>"),p,y,h,!1,"200px","150px",!1,u),[K[u],J[u],t.value]=[{x:y,y:h},p,""],o.querySelectorAll('.sticky-note[data-transferred="true"]').forEach(b=>{delete b.dataset.transferred}),P(),Y()}function yt(t,e,o,n,a=!1,s="200px",r="150px",i=!1,c=u,f=!1){const[d,p]=[document.createElement("div"),It()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${i?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${nt.map(k=>`<div class="color-option" style="background-color: ${k}" onclick="changeNoteColor(this, '${k}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${i?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`});let y;const h=document.querySelector(`.board[data-board-id="${c}"]`),x=h&&(h.classList.contains("board-pattern-weekdays")||h.classList.contains("board-pattern-days"));if(f)y=++R;else if(x&&!a){const k=Object.values(O).filter(b=>b>1e3);y=k.length>0?Math.min(...k)-1:1e3}else y=++R;d.style.cssText=`background-color:${e}; left:${o}px; top:${n}px; width:${s}; height:${r}; z-index:${y};`,d.dataset.noteId=p,f&&(d.dataset.repositioned="true",Bt.add(p)),O[p]=y,ne(),d.addEventListener("click",k=>{k.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||Me(d)}),Ue(d);const M=document.querySelector(`.board[data-board-id="${c}"]`);return M?(M.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",a||P(),d):(console.error(`Board element with ID ${c} not found.`),null)}function We(t,e){const o=t.closest(".sticky-note");(o.classList.contains("selected")?document.querySelectorAll(".sticky-note.selected"):[o]).forEach(a=>{const s=a.querySelector(".color-button");[a,s].forEach(r=>r.classList.add("color-transition")),[a.style.backgroundColor,s.style.backgroundColor]=[e,e],setTimeout(()=>[a,s].forEach(r=>r.classList.remove("color-transition")),300)}),J[u]=e,P()}const ce=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),P()},Fe=document.getElementById("shortcutIcon")||document.querySelector(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),le=()=>{Fe.textContent=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"};le();document.querySelector(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),At())});let q=null,it=!1,qt=!1,kt=!1;function Ue(t){let e=!1,o=!1,n=!1,a,s,r,i,c,f,d;const[p,y,h]=[".color-button",".color-palette",".sticky-content"].map(l=>t.querySelector(l)),x=()=>P();["blur","input"].forEach(l=>h.addEventListener(l,x));const M=l=>{n&&!h.contains(l.target)&&([n,h.contentEditable]=[!1,"false"],h.blur(),document.removeEventListener("click",M))};h.addEventListener("dblclick",l=>{[n,h.contentEditable]=[!0,"true"],setTimeout(()=>{const[m,g]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const S=document.caretRangeFromPoint(l.clientX,l.clientY);S&&(g.removeAllRanges(),g.addRange(S))}else if(document.caretPositionFromPoint){const S=document.caretPositionFromPoint(l.clientX,l.clientY);S&&(m.setStart(S.offsetNode,S.offset),m.collapse(!0),g.removeAllRanges(),g.addRange(m))}h.focus()},0),setTimeout(()=>document.addEventListener("click",M),0),l.stopPropagation()});let k=null,b=!1;t.addEventListener("mouseenter",()=>{!e&&!o&&(b=!0,k=t.style.zIndex||"1",t.style.zIndex="9999")}),t.addEventListener("mouseleave",()=>{!e&&!o&&k!==null&&(b=!1,t.style.zIndex=k,k=null)}),h.addEventListener("blur",()=>h.contentEditable="false"),h.addEventListener("keydown",l=>{if(l.key==="Enter")if(l.preventDefault(),l.shiftKey)h.contentEditable="false",x();else{const[m,g]=[window.getSelection(),window.getSelection().getRangeAt(0)],S=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});g.deleteContents(),g.insertNode(S),g.setStartAfter(S),g.collapse(!0),m.removeAllRanges(),m.addRange(g)}});const w=()=>{const l=t.getBoundingClientRect();K[u]={x:l.left,y:l.top}};let C=0,E=0,$=null;document.addEventListener("mousemove",l=>{[C,E]=[l.clientX,l.clientY],document.querySelectorAll(".color-palette.visible").forEach(m=>{var et;const[g,S]=[m.getBoundingClientRect(),(et=m.closest(".note-controls"))==null?void 0:et.querySelector(".color-button")];if(!S)return;const I=S.getBoundingClientRect(),[V,xt]=[C>=g.left-10&&C<=g.right+10&&E>=g.top-10&&E<=g.bottom+10,C>=I.left&&C<=I.right&&E>=I.top&&E<=I.bottom];V||xt?clearTimeout($):m.classList.contains("visible")&&X()})});const W=()=>{clearTimeout($),y.classList.remove("closing"),y.classList.add("visible"),document.querySelectorAll(".color-palette").forEach(l=>{l!==y&&(l.classList.add("closing"),setTimeout(()=>l.classList.remove("visible","closing"),180))})},X=()=>{clearTimeout($),$=setTimeout(()=>{const[l,m]=[y.getBoundingClientRect(),p.getBoundingClientRect()],[g,S]=[C<l.left-10||C>l.right+10||E<l.top-10||E>l.bottom+10,C>=m.left&&C<=m.right&&E>=m.top&&E<=m.bottom];g&&!S&&(y.classList.add("closing"),setTimeout(()=>y.classList.contains("closing")&&y.classList.remove("visible","closing"),180))},50)};p.addEventListener("click",l=>{l.stopPropagation(),y.classList.contains("visible")?X():W()}),["mouseenter","mouseleave"].forEach((l,m)=>y.addEventListener(l,m?X:()=>clearTimeout($)));const A=(l,m,g)=>{if(!l.target.closest(".color-palette, .done-button")){if(L.includes(t)&&L.length>1){De(l);return}l.shiftKey?L.includes(t)||(L.push(t),t.classList.add("selected")):vt(),l.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],b?k=++R:t.style.zIndex=++R,[a,s]=[m,g],l.target.closest(".resize-handle")?[o,c,f]=[!0,t.offsetWidth,t.offsetHeight]:([r,i]=[v(t.style.left),v(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[r,i],d=setTimeout(()=>e=!0,150)),Z=t}},j=(l,m)=>{if(!(!Z||Z!==t)){if((Math.abs(l-a)>5||Math.abs(m-s)>5)&&clearTimeout(d),e){kt||(kt=!0,document.body.classList.add("drag-in-progress"));const g=5;let[S,I]=[Math.min(Math.max(r+l-a,-g),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(i+m-s,-g),window.innerHeight-t.offsetHeight/4)];[t.style.left,t.style.top]=[`${S}px`,`${I}px`],jt(),de(l,m)}if(o){const[g,S]=[150,150],[I,V]=[window.innerWidth-v(t.style.left)+50,window.innerHeight-v(t.style.top)+50];t.style.width=`${Math.min(Math.max(c+l-a,g),I)}px`,t.style.height=`${Math.min(Math.max(f+m-s,S),V)}px`}}},F=()=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(e||o)&&e){if(ct(),!me().moved){w(),re(t),Je(t);const m=t.dataset.noteId||It();[t.dataset.noteId,t.dataset.repositioned]=[m,"true"],Bt.add(m),K[u]={x:v(t.style.left),y:v(t.style.top)},J[u]=t.style.backgroundColor,Y(),Dt(),Z=null}P(),[kt,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[e,o]=[!1,!1],ct()};t.addEventListener("mousedown",l=>A(l,l.clientX,l.clientY)),document.addEventListener("mousemove",l=>j(l.clientX,l.clientY)),document.addEventListener("mouseup",F)}function Ke(){document.querySelectorAll(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),Ut=null}document.addEventListener("click",t=>{Ut&&!t.target.closest(".color-button")&&Ke()});function Je(t){if(!t)return;const[e,o,n,a]=[t.getBoundingClientRect(),window.innerHeight,250,150],s=o-a,[r,i]=[e.bottom>s,e.left<n&&e.bottom>s];if(i){const[c,f,d]=[e.bottom-s+20,v(t.style.top),Math.max(60,v(t.style.top)-(e.bottom-s+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${d}px`,setTimeout(()=>t.style.transition="",300)}}function de(t,e){var y,h;if(qt)return;const o=document.querySelector(".status-bar");if(!o)return;const n=o.getBoundingClientRect(),[a,s]=[Math.max(0,Math.max(n.left-t,t-n.right)),Math.max(0,Math.max(n.top-e,e-n.bottom))],[r,i,c,f]=[Math.sqrt(a*a+s*s),120,80,q!==null],d=f?r<=i:r<=c,p=()=>{let[x,M]=[null,1/0];return document.querySelectorAll(".board-button:not(.disabled)").forEach(k=>{const b=k.getBoundingClientRect(),w=Math.sqrt(Math.pow(t-(b.left+b.width/2),2)+Math.pow(e-(b.top+b.height/2),2));w<M&&([x,M]=[k,w])}),x};if(d!==f)if(d){const x=document.querySelectorAll(".board-button:not(.disabled)");q=p(),x.forEach(M=>M.classList.add("drag-active","drag-proximity")),q&&q.classList.add("drag-hover"),Ve()}else document.querySelectorAll(".board-button").forEach(x=>{x.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>x.classList.remove("drag-active"),200)}),q=null,ue();else if(d&&q){const x=p();x!==q&&(q==null||q.classList.remove("drag-hover"),q=x,x?(x.classList.add("drag-hover"),ct(),(y=document.querySelector(".shortcut-hint"))==null||y.classList.add("hidden-during-drag")):(jt(),it||(h=document.querySelector(".shortcut-hint"))==null||h.classList.remove("hidden-during-drag")))}}function Ve(){if(!q)return;const[t,e]=[q.getBoundingClientRect(),L.length>0?L:Z?[Z]:[]];e.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(i=>{[i.style.userSelect,i.style.pointerEvents]=["none","none"]});const[n,a]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[s,r]=[t.left-a.left+t.width/2-(n.left-a.left)-n.width/2,t.top-a.top+t.height/2-(n.top-a.top)-n.height/2];o.style.setProperty("--suckX",`${s}px`),o.style.setProperty("--suckY",`${r}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function ue(){document.querySelectorAll(".hover-animating").forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events")}),t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),t.classList.remove("reverse-animating"))},300)})}function jt(){var t;if(T>1&&!it&&!q){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),it=!0),(t=document.querySelector(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function ct(){var t;if(it){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),it=!1),(t=document.querySelector(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Dt(){document.querySelectorAll(".board-button").forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[q]=[null],ue(),ct()}function me(){if(!q)return{moved:!1};const[t,e]=[parseInt(q.dataset.boardId),L.length>0?[...L]:[Z]];if(t===u)return e.forEach(n=>{if(n){const a=U==null?void 0:U.find(s=>s.element===n);a?(n.style.left=`${a.x}px`,n.style.top=`${Math.max(60,a.y)}px`):n.style.top=`${parseInt(n.style.top||0)-250}px`}}),{moved:!1};let o=new Map;return e.length>1&&typeof U!="undefined"&&U.length>0&&U.forEach(n=>{n&&e.includes(n.element)&&o.set(n.element,{originalX:n.x,originalY:n.y})}),e.forEach(n=>{n&&Ze(n,t,o.size>0?o.get(n):null)}),L.length>0&&vt(),{moved:!0}}function Ze(t,e,o=null){const n=t.style.left;if(t.classList.contains("hover-animating"))t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const a=document.querySelector(`.board-button[data-board-id="${e}"]`);if(!a)return;const[s,r,i]=[a.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[c,f]=[s.left-i.left+s.width/2-(r.left-i.left)-r.width/2,s.top-i.top+s.height/2-(r.top-i.top)-r.height/2];t.style.setProperty("--suckX",`${c}px`),t.style.setProperty("--suckY",`${f}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards",t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(s=>{s.style.removeProperty("user-select"),s.style.removeProperty("pointer-events")}),t.remove();const a=document.querySelector(`.board[data-board-id="${e}"]`);if(a){if(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),o)if(o.originalX!==void 0&&o.originalY!==void 0)[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[i,c]=[100,80];[t.style.left,t.style.top]=[`${i+(o.offsetX||0)}px`,`${Math.max(60,c+(o.offsetY||0))}px`]}else{const[i,c]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];!isNaN(i)&&!isNaN(c)?[t.style.left,t.style.top]=[`${i}px`,`${Math.max(60,c)}px`]:[t.style.left,t.style.top]=[n,"80px"]}const s=t.dataset.noteId||It();[t.dataset.noteId,t.dataset.repositioned,t.dataset.transferred]=[s,"true","true"],Bt.add(s),a.appendChild(t),t.style.animation="paperPop 0.3s ease-out forwards",Y(),Dt(),qt=!0,setTimeout(()=>qt=!1,500);const r=u;[u]=[e],P(),[u]=[r],P()}},600)}let B={},H=null,dt={x:0,y:0},D=[];function fe(){eo(),ve(),Qe(),document.querySelectorAll(".emoji-item").forEach(t=>t.addEventListener("click",ye))}const ye=t=>{const e=t.target.dataset.emoji;e&&(to(e),Ge(e))};function Ge(t){const e=document.querySelector(".board.active");if(!e)return;const o=e.dataset.boardId;if(no(o)>=10)return so();const n=ro(),a=e.getBoundingClientRect(),[s,r,i]=[a.width-120,a.height*.8-120,20],[c,f]=[Math.random()*s,Math.max(i,Math.random()*r)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});d.dataset.stickerId=n,Object.assign(d.style,{left:c+"px",top:f+"px"});const p=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});p.addEventListener("click",y=>[y.stopPropagation(),he(n,o)]),d.appendChild(p),ge(d),e.appendChild(d),(B[o]=B[o]||{})[n]={emoji:t,x:c,y:f,id:n},Ot(o),setTimeout(()=>d.classList.remove("new"),400)}function ge(t){let e=!1;t.addEventListener("mousedown",o);function o(s){if(s.target.classList.contains("delete-button"))return;s.preventDefault(),s.stopPropagation(),[e,H]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[r,i]=[s.clientX,s.clientY],c=t.getBoundingClientRect();[dt.x,dt.y]=[r-c.left,i-c.top],t.classList.add("dragging"),document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)}function n(s){if(!e||!H)return;s.preventDefault(),s.stopPropagation();const[r,i]=[s.clientX,s.clientY],c=document.querySelector(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(r-c.left-dt.x,c.width-120)),Math.max(0,Math.min(i-c.top-dt.y,c.height-120))];Object.assign(H.style,{left:f+"px",top:d+"px"})}function a(){var i;if(!e||!H)return;H.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],ao(H);const[s,r]=[document.querySelector(".board.active").dataset.boardId,H.dataset.stickerId];(i=B[s])!=null&&i[r]&&(Object.assign(B[s][r],{x:parseInt(H.style.left),y:parseInt(H.style.top)}),Ot(s)),H=null,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a)}}const he=(t,e)=>{const o=document.querySelector(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),B[e]&&(delete B[e][t],Ot(e))},Ot=t=>localStorage.setItem(`emojiStickers_board_${t}`,JSON.stringify(B[t]||{}));function pe(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{B[t]=e?JSON.parse(e):{},e&&be(t)}catch(o){console.error("Error loading emoji stickers:",o),B[t]={}}}const Qe=()=>Array.from({length:T},(t,e)=>pe(e+1));function be(t){const e=document.querySelector(`.board[data-board-id="${t}"]`);!e||!B[t]||(e.querySelectorAll(".emoji-sticker").forEach(o=>o.remove()),Object.values(B[t]).forEach(({id:o,emoji:n,x:a,y:s})=>{const r=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:n});r.dataset.stickerId=o,Object.assign(r.style,{left:a+"px",top:s+"px"});const i=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});i.addEventListener("click",c=>[c.stopPropagation(),he(o,t)]),r.appendChild(i),ge(r),e.appendChild(r)}))}function to(t){const e=D.indexOf(t);(e<0||e>=12)&&(e>-1&&D.splice(e,1),D.unshift(t),D.length>16&&(D=D.slice(0,16)),oo(),ve())}function eo(){const t=localStorage.getItem("emojiUsageOrder");try{D=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),D=[]}}const oo=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(D));function ve(){const t=document.querySelector(".emoji-picker");t&&(t.querySelectorAll(".recent-emoji").forEach(e=>e.remove()),D.length>0&&D.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",ye),t.insertBefore(o,t.firstChild)}))}const no=t=>B[t]?Object.keys(B[t]).length:0,so=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function ao(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[n,a,s]=[250,150,o-150];if(e.left<n&&e.bottom>s){const i=Math.max(60,parseInt(t.style.top)-(e.bottom-s+20));t.style.top=`${i}px`}}const ro=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),io=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete B[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(fe,100));window.emojiStickers={loadEmojiStickers:pe,renderEmojiStickers:be,cleanupEmojiStickers:io,initializeEmojiPicker:fe};const Et=()=>new Date,Se=t=>{const e=Et().getDay(),o=e===0?6:e-1;return t===o},co=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,Et().toISOString().split("T")[0])},Rt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((Et()-new Date(e))/(1e3*60*60*24))%5:-1},Ee=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),Wt=()=>{if(T>=at){alert(`Maximum number of boards (${at}) reached.`);return}Mt(++T),Qt(),ht()};function Mt(t){const e=document.querySelector(".boards-container"),o=Object.assign(document.createElement("div"),{className:"board"});o.dataset.boardId=t,e.appendChild(o);const n=Object.assign(document.createElement("div"),{className:"board-title-circle"});n.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let s;const r=()=>{const c=a.value.trim();if(!c){a.value=a.dataset.originalTitle||"";return}_t(t,c),pt(a)};a.addEventListener("input",()=>{clearTimeout(s),s=setTimeout(r,500)}),pt(a),n.appendChild(a),o.appendChild(n);const i=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});if(i.dataset.boardId=t,i.addEventListener("click",()=>z(t)),t>1){const c=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});c.addEventListener("click",f=>{f.stopPropagation(),gt(t)}),i.appendChild(c)}document.querySelector(".boards-navigation").insertBefore(i,document.querySelector(".add-board-button")),setTimeout(()=>[i.classList.remove("new-button"),i.classList.add("transitions-ready")],500),lt(t),Pt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function gt(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=document.querySelector(`.board[data-board-id="${t}"]`);if(!e){Ct(t);return}const[o,n]=[e.querySelectorAll(".sticky-note"),e.querySelectorAll(".emoji-sticker")];if(o.length||n.length){const[a,s]=[document.querySelector(".trash-bin"),document.querySelector(".trash-bin").getBoundingClientRect()];a.style.animation="binShake 0.5s ease-in-out",o.forEach(r=>{const i=r.querySelector(".sticky-content");_.unshift({text:i.innerHTML,color:r.style.backgroundColor,x:r.style.left,y:r.style.top,width:r.style.width,height:r.style.height,timestamp:new Date().toLocaleString(),isBold:i.classList.contains("bold")});const c=r.getBoundingClientRect(),[f,d]=[s.left-c.left+s.width/2-c.width/2,s.top-c.top];r.style.setProperty("--throwX",`${f}px`),r.style.setProperty("--throwY",`${d}px`),r.style.animation="paperCrumble 0.5s ease-in forwards"}),n.forEach(r=>r.classList.add("deleting")),bt(),tt(),setTimeout(()=>Ct(t),600)}else Ct(t)}function Ct(t){const[e,o]=[document.querySelector(`.board[data-board-id="${t}"]`),document.querySelector(`.board-button[data-board-id="${t}"]`)];e&&e.remove(),o&&o.classList.add("removing");const n=[];for(let a=t+1;a<=T;a++){const s=document.querySelector(`.board-button[data-board-id="${a}"]`);s&&(s.classList.add("removing"),n.push(a))}[`${Q}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(a=>localStorage.removeItem(a)),Ee(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let a=t+1;a<=T;a++)["boardColor","boardPattern","boardStyles_board"].forEach(s=>{const[r,i,c]=[`${s}_${a}`,`${s}_${a-1}`,localStorage.getItem(`${s}_${a}`)];c&&localStorage.setItem(i,c),localStorage.removeItem(r)});setTimeout(()=>{o&&o.remove();const[a,s]=[document.querySelector(".boards-navigation"),document.querySelector(".add-board-button")];n.forEach(r=>{const[i,c,f]=[document.querySelector(`.board-button[data-board-id="${r}"]`),document.querySelector(`.board[data-board-id="${r}"]`),r-1];i&&i.remove(),c&&(c.dataset.boardId=f);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:f});if([d.dataset.boardId,d.dataset.originalNumber]=[f,f],d.addEventListener("click",()=>z(f)),f>1){const p=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});p.addEventListener("click",y=>{y.stopPropagation(),gt(f)}),d.appendChild(p)}a.insertBefore(d,s),["","Title","Color","Pattern"].forEach(p=>{const[y,h,x]=[p?`stickyNotes_board${p}`:Q,`${p?`stickyNotes_board${p}`:Q}_board_${r}`,`${p?`stickyNotes_board${p}`:Q}_board_${f}`],M=localStorage.getItem(h);M&&(localStorage.setItem(x,M),localStorage.removeItem(h))}),lt(f)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(r=>[r.classList.remove("new-button"),r.classList.add("transitions-ready")]),500),T--,Qt(),ht(),u===t?z(t>1?t-1:T>=1?1:null):u>t&&(u--,z(u)),document.querySelector(".trash-bin").style.animation=""},350)}function z(t){const e=parseInt(t);e===u||e===null||(mo(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),u=e,K[t]||(K[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),J[t]||(J[t]=nt[0]),document.querySelectorAll(".board").forEach(o=>{const n=parseInt(o.dataset.boardId);if(o.classList.remove("active","prev","next"),o.style.visibility="hidden",n===u){if(o.classList.add("active"),o.style.visibility="visible",o.querySelectorAll(".sticky-note").forEach((a,s)=>a.style.setProperty("--note-index",s)),o.querySelectorAll(".emoji-sticker").forEach((a,s)=>a.style.setProperty("--sticker-index",s)),!o.querySelector(".board-title-circle")){const a=Object.assign(document.createElement("div"),{className:"board-title-circle"});a.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const s=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),r=()=>_t(n,s.value);["change","blur"].forEach(i=>s.addEventListener(i,r)),a.appendChild(s),o.appendChild(a),Pt(n)}}else o.classList.add(n<u?"prev":"next")}),document.querySelectorAll(".board-button").forEach(o=>o.classList.toggle("active",parseInt(o.dataset.boardId)===u)),lt(u),we(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=N.colors.current),Y(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(u),setTimeout(()=>Le(u),300))}function lo(){document.querySelector(".add-board-button").addEventListener("click",Wt),document.querySelectorAll(".board-button").forEach(t=>{const[e,o]=[parseInt(t.dataset.boardId),t.cloneNode(!0)];o.addEventListener("click",()=>z(e));const n=o.querySelector(".delete-board");n&&n.addEventListener("click",a=>{a.stopPropagation(),gt(e)}),t.parentNode.replaceChild(o,t)}),document.addEventListener("keydown",t=>{const[e,o]=[t.target.tagName,t.target.getAttribute("contenteditable")==="true"];if((t.key==="Control"||t.key==="Meta")&&!t.altKey&&!t.shiftKey&&e!=="TEXTAREA"&&!o){t.preventDefault(),document.querySelector(".note-input textarea").focus();return}if(e==="TEXTAREA"||o){(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),At());return}t.key==="ArrowLeft"&&u>1?z(u-1):t.key==="ArrowRight"&&u<T?z(u+1):t.key==="n"&&t.ctrlKey?(t.preventDefault(),Wt()):t.key==="d"&&t.ctrlKey&&u>1&&(t.preventDefault(),gt(u));const n=parseInt(t.key);!isNaN(n)&&n>=1&&n<=9&&n<=T&&z(n)})}function ht(){const t=document.querySelector(".add-board-button"),e=T>=at;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${at}) reached`:"Add new board",uo()}function uo(){const t=document.querySelector(".shortcut-hint");t&&(t.style.display=T>=2?"block":"none")}let Ft=!1;function mo(){if(Ft||T<2)return;const t=document.querySelector(".shortcut-hint");t&&(Ft=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function fo(){const t=document.querySelector(".board-style-menu"),e=t.classList.contains("visible");e||(we(),xe(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=N.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function xe(){document.querySelector(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?yo(o):ho(o),document.querySelectorAll(`.board-${e}-option`).forEach(n=>n.classList.remove("active")),t.classList.add("active")})})}function we(){["color","pattern"].forEach(t=>{document.querySelectorAll(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===N[`${t}s`].current)})})}function yo(t){N.colors.current=t;const e=document.querySelector(".board.active");e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),te(),Y(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function go(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; transition:opacity 0.5s ease; opacity:0;"}),o=document.querySelector(`.board[data-board-id="${u}"]`);if(t!=="none"){const n={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(n[t])e.style.cssText+=n[t];else if(t==="weekdays"||t==="days"){const a=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((r,i)=>{const c=Object.assign(document.createElement("span"),{textContent:r});(t==="weekdays"&&Se(i)||t==="days"&&Rt(u)===i)&&c.classList.add("current-day"),a.appendChild(c)}),e.appendChild(a),o==null||o.classList.add("has-header")}}else o==null||o.classList.remove("has-header");return e}function ho(t){const[e,o,n]=[document.querySelector(".board.active"),document.querySelector(".board.active").dataset.boardId,N.patterns.current];n==="days"&&t!=="days"&&Ee(o),N.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(r=>r.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t==="days"&&co(o);const a=go(t);e.appendChild(a),a.offsetWidth,a.style.opacity="1";let s=null;(t==="weekdays"||t==="days")&&(s=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.5s ease;"}),e.appendChild(s),s.offsetWidth,s.style.opacity="1"),setTimeout(()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),a.style.height="auto",a.style.zIndex="1",a.classList.add("pattern-overlay"),s&&(s.style.zIndex="0",s.classList.add("pattern-overlay"))):(a.remove(),s==null||s.remove(),t!=="none"&&e.classList.add(`board-pattern-${t}`)),Y()},500),te()}function po(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(s,r)=>`Day ${r+1}`)).forEach((s,r)=>{const i=Object.assign(document.createElement("span"),{textContent:s});(e.pattern==="weekdays"&&Se(r)||e.pattern==="days"&&Rt(parseInt(t.dataset.boardId))===r)&&i.classList.add("current-day"),o.appendChild(i)}),t.appendChild(o);const a=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(a)}}function lt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(!o)return;let n;e?(n=JSON.parse(e),t===u&&(N.colors.current=n.color,N.patterns.current=n.pattern)):(n={color:N.colors.default,pattern:N.patterns.default},t===u&&(N.colors.current=n.color,N.patterns.current=n.pattern)),po(o,n),Y()}bo();document.addEventListener("click",function(t){const e=document.querySelector(".board-style-menu"),o=document.querySelector(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function bo(){document.querySelectorAll(".board").forEach(t=>Pt(t.dataset.boardId))}function _t(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function pt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function Pt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(o){const a=o.querySelector(".board-title-input");a&&e&&(a.value=e)}const n=document.querySelector(`.board-button[data-board-id="${t}"]`);n&&!n.dataset.originalNumber&&(n.dataset.originalNumber=n.textContent)}function Le(t){const e=document.querySelector(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function vo(){document.querySelectorAll(".board-title-circle").forEach(t=>{let e;const[o,n]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((a,s)=>{t.addEventListener(a,()=>{s===0?(o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")):s===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()):o&&o.focus()})}),o){let a;const s=()=>{const r=o.value.trim();if(!r){o.dataset.originalTitle="";return}_t(n,r),pt(o)};o.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(s,500)}),pt(o)}})}const Y=()=>{for(let t=1;t<=T;t++){const[e,o]=[document.querySelector(`.board[data-board-id="${t}"]`),document.querySelector(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;const n=e.style.backgroundColor||N.colors.default;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),o.style.backgroundColor=n;const a=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],s=a.find(i=>e.classList.contains(i));a.forEach(i=>o.classList.remove(i.replace("board-pattern","button-pattern"))),s&&o.classList.add(s.replace("board-pattern","button-pattern"));const r=Ce(n)||{r:26,g:26,b:26};o.style.color=(r.r*299+r.g*587+r.b*114)/1e3>128?"#000":"#fff"}};function So(t){t.forEach(({selector:e,event:o,handler:n})=>{const a=document.querySelector(e);a&&a.addEventListener(o,n)})}document.addEventListener("DOMContentLoaded",function(){$e(),qe(),oe(),lo(),xe(),Ne(),le(),vo(),Eo(),setTimeout(()=>Le(u),500),xo(),So([{selector:".board-style-button",event:"click",handler:fo},{selector:".trash-bin",event:"click",handler:rt},{selector:"#trashModal .close-modal-btn",event:"click",handler:rt},{selector:"#trashModal .clear-trash-btn",event:"click",handler:ie}])});function Eo(){const t=a=>{const s=a.selectionStart,r=a.value;if(r.length>0){const i=r.charAt(0).toUpperCase()+r.slice(1);i!==r&&(a.value=i,a.setSelectionRange(s,s))}},e=a=>{["input","keyup"].forEach(s=>a.addEventListener(s,r=>t(r.target))),a.addEventListener("paste",s=>setTimeout(()=>t(s.target),0))};document.querySelectorAll(".board-title-input, .note-input textarea").forEach(e);const o=new MutationObserver(a=>{a.forEach(s=>{s.addedNodes.forEach(r=>{var i;r.nodeType===1&&((r.querySelectorAll?r.querySelectorAll(".board-title-input"):[]).forEach(e),(i=r.classList)!=null&&i.contains("board-title-input")&&e(r))})})}),n=document.querySelector(".boards-container");n&&o.observe(n,{childList:!0,subtree:!0})}function xo(){setTimeout(()=>{document.querySelectorAll(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>t.style.transform="scale(1)")})},100)}window.toggleBold=ce;window.markAsDone=Nt;window.addNote=At;window.restoreNote=Xe;window.changeNoteColor=We;window.markAsDone=Nt;window.toggleBold=ce;window.duplicateNote=duplicateNote;window.clearTrash=ie;window.closeModal=closeModal;window.openTrash=openTrash;})();
