(()=>{const at=["#f0e68c","#98ff98","#ff7eb9","#7afcff","#FE8801","#ec0c39","#AF65EF","#ffd700","#C1C1C1","#FFFFFF"],M={colors:{default:"#1a1a1a",current:"#1a1a1a",available:["#1a1a1a","#500000","#004000","#000050","#10253F","#400040"]},patterns:{default:"none",current:"none"}};let z=[];let V=null,Jt=null,mt=!1,Z=null,ft=0,yt=0,w=[],rt=!1,Vt=0,Zt=0,F=[];const K={},J={},H={};let R=1e3;K[1]={x:window.innerWidth/2-100,y:window.innerHeight/2-75};J[1]=at[0];let u=1,L=1,G=!1;const tt=9,Q="stickyNotes_active",Gt="stickyNotes_deleted",Qt="stickyNotes_boardCount",te="stickyNotes_zIndexes",ee=()=>{G=window.innerWidth<=768,G&&u!==1&&typeof $=="function"&&$(1)},p=t=>parseInt(String(t).replace("px",""))||0,Te=(t,e)=>{const o=Math.random()*10-5;let s=t+o,a=e+70;const n=5,r=window.innerWidth-200,i=window.innerHeight-300;a>i&&(a=50,s=t+250,s>r&&(s=n+50,a=50));const l=Math.min(Math.max(s,n),r),f=Math.min(Math.max(a,n),window.innerHeight-100);return{x:l,y:f}},Me=t=>{if(t.startsWith("rgba")){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3])}:null}t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(o,s,a,n)=>s+s+a+a+n+n);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},Bt=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(o){console.error(`Failed to save to localStorage (${t}):`,o)}},_=()=>{const t=document.querySelector(`.board[data-board-id="${u}"]`);if(!t)return;const e=Array.from(t.querySelectorAll(".sticky-note")).map(o=>({text:o.querySelector(".sticky-content").innerHTML,color:o.style.backgroundColor,x:o.style.left,y:o.style.top,width:o.style.width||"200px",height:o.style.height||"150px",isBold:o.querySelector(".sticky-content").classList.contains("bold"),noteId:o.dataset.noteId,zIndex:o.style.zIndex||1}));Bt(`${Q}_board_${u}`,e),typeof Y=="function"&&Y()},St=()=>Bt(Gt,z),oe=()=>localStorage.setItem(Qt,L.toString()),ne=()=>Bt(`boardStyles_board_${u}`,{color:M.colors.current,pattern:M.patterns.current}),se=()=>{const t=document.getElementById("shortcutIcon");if(!t)return;const e=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl";t.innerHTML=e,t.className="shortcut-icon focus-hint"},ae=()=>{const t=document.querySelector(".note-input textarea");if(!t)return;const e=document.getElementById("shortcutIcon"),o=()=>{if(!e)return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl",a=t.value.trim();e.innerHTML=a?`${s}+\u21B5`:s,e.classList.toggle("focus-hint",!a),e.classList.toggle("enter-hint",a)};t.addEventListener("focus",()=>{o(),t.style.height="50px",requestAnimationFrame(()=>t.style.height="200px"),t.addEventListener("input",o)}),t.addEventListener("blur",()=>{se(),t.style.height="200px",requestAnimationFrame(()=>t.style.height="50px"),t.removeEventListener("input",o)}),document.addEventListener("mousedown",s=>{!s.target.closest(".note-input")&&document.activeElement===t&&t.blur()})},Ht=(t,e=null)=>{try{return JSON.parse(t)}catch(o){return console.error("Failed to parse JSON data:",o),e}},qe=()=>{const t="stickyNotes_storageCleanupPerformed";if(!localStorage.getItem(t))try{console.log("Performing one-time localStorage cleanup...");const e=[];for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&(s.startsWith("stickyNotes_")||s.startsWith("boardColor_")||s.startsWith("boardPattern_")||s.startsWith("boardStyles_")||s.startsWith("emojiStickers_")||s.startsWith("daysPatternStartDate_")||s.startsWith("emojiUsageOrder"))&&e.push(s)}e.forEach(o=>{localStorage.removeItem(o)}),console.log(`Cleaned up ${e.length} localStorage items`),localStorage.setItem(t,"true")}catch(e){console.error("Error during localStorage cleanup:",e),localStorage.setItem(t,"true")}},$e=()=>{try{qe(),ee(),typeof zt=="function"&&zt();const t=localStorage.getItem(Qt);if(t){const o=parseInt(t);if(!isNaN(o)&&o>0){L=Math.min(o,tt);for(let s=2;s<=L;s++)typeof Nt=="function"&&Nt(s)}}typeof bt=="function"&&bt();for(let o=1;o<=L;o++){const s=localStorage.getItem(`${Q}_board_${o}`);if(s){const a=Ht(s,[]);Array.isArray(a)&&a.forEach(n=>{if(n&&typeof n=="object"&&n.text&&(K[o]={x:p(n.x),y:p(n.y)},J[o]=n.color||at[0],typeof gt=="function")){const r=gt(n.text,n.color||at[0],p(n.x),p(n.y),!0,n.width||"200px",n.height||"150px",n.isBold||!1,o);r&&n.noteId&&(r.dataset.noteId=n.noteId,H[n.noteId]?(r.style.zIndex=H[n.noteId],H[n.noteId]>R&&(R=H[n.noteId])):n.zIndex&&!isNaN(parseInt(n.zIndex))&&(r.style.zIndex=n.zIndex,H[n.noteId]=parseInt(n.zIndex),parseInt(n.zIndex)>R&&(R=parseInt(n.zIndex))))}})}typeof lt=="function"&&lt(o)}typeof $=="function"&&$(1);const e=localStorage.getItem(Gt);if(e){const o=Ht(e,[]);Array.isArray(o)&&(z=o,typeof et=="function"&&et())}["updateBoardIndicators","updateShortcutHintVisibility"].forEach(o=>{typeof window[o]=="function"&&window[o]()}),se(),ae()}catch(t){console.error("Critical error loading saved data:",t)}},Ne=t=>{t.style.zIndex=++R;const e=t.dataset.noteId;e&&(H[e]=R,re())},re=()=>{try{localStorage.setItem(te,JSON.stringify(H))}catch(t){console.error("Error saving note z-indexes:",t)}},Be=()=>{try{const t=localStorage.getItem(te);t&&(Object.assign(H,JSON.parse(t)),R=Math.max(1e3,...Object.values(H)))}catch(t){console.error("Error loading note z-indexes:",t)}};const zt=()=>{Z=Object.assign(document.createElement("div"),{className:"selection-box"}),Object.assign(Z.style,{display:"none"}),document.body.appendChild(Z)};function Ie(){const t=document.querySelector(".boards-container");document.addEventListener("mousedown",e=>{e.target.closest(".board")&&!e.target.closest(".sticky-note, .note-input, .boards-navigation, .trash-bin, .board-style-button")&&e.preventDefault()}),[["mousedown",Ae],["mousemove",je],["mouseup",De]].forEach(([e,o])=>(e==="mousedown"?t:document).addEventListener(e,o))}function Ae(t){if(t.target.closest(".sticky-note, .note-input, .trash-bin, .boards-navigation, .board-style-button, .emoji-sticker"))return;t.preventDefault();const e=document.querySelector(".note-input textarea");e&&document.activeElement===e&&e.blur(),!t.shiftKey&&Et(),[mt,ft,yt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),Z.style.cssText=`left:${ft}px; top:${yt}px; width:0; height:0; display:block;`}function je(t){if(!mt)return;t.preventDefault();const[e,o]=[Math.abs(t.clientX-ft),Math.abs(t.clientY-yt)],[s,a]=[Math.min(t.clientX,ft),Math.min(t.clientY,yt)];Z.style.cssText=`left:${s}px; top:${a}px; width:${e}px; height:${o}px; display:block;`,Oe()}const De=()=>{mt&&(mt=!1,document.body.classList.remove("selecting"),Z.style.display="none")};function Oe(){const t=Z.getBoundingClientRect(),e=document.querySelector(`.board[data-board-id="${u}"]`);if(!e)return;const o=(s,a,n)=>{const r=s.getBoundingClientRect(),i=!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom),l=a.indexOf(s);i?l===-1&&(a.push(s),s.classList.add(n)):!rt&&l!==-1&&(a.splice(l,1),s.classList.remove(n))};e.querySelectorAll(".sticky-note").forEach(s=>o(s,w,"selected"))}const Et=()=>{w.forEach(t=>t.classList.remove("selected")),w=[]};function Re(t){[rt,Vt,Zt]=[!0,t.clientX,t.clientY],document.body.classList.add("selecting"),F=w.map(e=>({element:e,x:p(e.style.left),y:p(e.style.top),type:"note"})),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,e==="mousemove"?ie:ce))}function ie(t){if(!rt)return;const[e,o]=[t.clientX-Vt,t.clientY-Zt],[s,a,n]=[5,-5,-5],[r,i]=[window.innerWidth-s,window.innerHeight-s];(f=>f.forEach(d=>{const[y,g]=[Math.min(Math.max(d.x+e,a),r-d.element.offsetWidth/4),Math.min(Math.max(d.y+o,n),i-d.element.offsetHeight/4)];Object.assign(d.element.style,{left:`${y}px`,top:`${g}px`})}))(F),w.length>0&&(me(t.clientX,t.clientY),w.length>1&&Ot())}function ce(){if(!rt)return;if(rt=!1,document.body.classList.remove("selecting"),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,e==="mousemove"?ie:ce)),ct(),!ye().moved){_();for(let e=w.length-1;e>=0;e--)le(w[e])&&w.splice(e,1)}Rt()}let st=[];const _e=100,Wt=50,Ye="#ffd700",Xe=()=>{const[t,e]=[document.getElementById("trashModal"),document.querySelector(".clear-trash-btn")];t&&!t.classList.contains("visible")&&(t.style.display="block",t.classList.add("visible"),requestAnimationFrame(()=>wt())),e&&(e.classList.add("shake-animation"),setTimeout(()=>e.classList.remove("shake-animation"),1e3))},It=t=>{w.includes(t)&&w.length>1?(w.forEach((e,o)=>setTimeout(()=>Mt(e),o*100)),Et()):Mt(t)},Mt=t=>{if(z.length>=_e){!st.includes(t)&&st.push(t),Xe();return}const e=t.querySelector(".sticky-content"),o={text:e.innerHTML,color:t.style.backgroundColor,x:t.style.left,y:t.style.top,width:t.style.width,height:t.style.height,timestamp:new Date().toLocaleString(),isBold:e.classList.contains("bold")};Pe(t),z.unshift(o),St(),et(),He(t)},Pe=t=>{if(!window.noteColumns)return;const e=t.closest(".board");if(!e||!e.matches(".board-pattern-weekdays, .board-pattern-days"))return;const[o,s]=[e.getBoundingClientRect(),t.getBoundingClientRect()],a=Math.min(5,Math.max(0,Math.floor((s.left+s.width/2-o.left)/(o.width/6))));window.noteColumns[a]&&(window.noteColumns[a]=window.noteColumns[a].filter(n=>Math.abs(n.x-p(t.style.left))>1||Math.abs(n.y-p(t.style.top))>1))},He=t=>{const e=document.querySelector(".trash-bin"),o=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=o.left-s.left+o.width/2-s.width/2,n=o.top-s.top;t.style.setProperty("--throwX",`${a}px`),t.style.setProperty("--throwY",`${n}px`),t.style.animation="paperCrumble 0.5s ease-in forwards",e.style.animation="binShake 0.5s ease-in-out",setTimeout(()=>{t.remove(),e.style.animation="",_(),Y()},500)},le=t=>{const[e,o]=[document.querySelector(".trash-bin").getBoundingClientRect(),t.getBoundingClientRect()];return o.right>e.left&&o.left<e.right&&o.bottom>e.top&&o.top<e.bottom?(It(t),!0):!1},ht=()=>{const t=document.getElementById("trashModal");t.classList.toggle("visible")?(t.style.display="block",requestAnimationFrame(()=>wt())):setTimeout(()=>t.style.display="none",300)},wt=()=>{const t=document.querySelector(".deleted-notes-container");t.style.minHeight="200px",t.innerHTML=z.length?z.map((e,o)=>`
            <div class="deleted-note" style="background-color: ${e.color||Ye}">
                <div class="deleted-note-content ${e.isBold?"bold":""}">${e.text}</div>
                <div class="deleted-note-actions">
                    <button class="restore-btn" onclick="restoreNote(${o})">Restore</button>
                </div>
            </div>`).join(""):'<div class="empty-state">(Empty)</div>'},ze=t=>{const e=document.querySelectorAll(".deleted-note")[t];e==null||e.classList.add("shrinking"),setTimeout(()=>{const[o]=z.splice(t,1);gt(o.text,o.color,p(o.x),p(o.y),!0,o.width,o.height,o.isBold),St(),et(),wt(),_(),Y()},300)},de=()=>{const t=[...document.querySelectorAll(".deleted-note")].slice(0,6);t.forEach((e,o)=>{e.classList.add("note-deleting"),e.style.animationDelay=`${o*Wt}ms`}),setTimeout(()=>{z=[],St(),et(),wt(),setTimeout(()=>{if(ht(),st.length){const e=[...st];st=[],setTimeout(()=>{e.forEach(o=>{o!=null&&o.parentNode&&Mt(o)})},300)}},200)},350+(t.length?(t.length-1)*Wt:0)+100)},et=()=>{document.querySelector(".trash-count").textContent=z.length};document.addEventListener("click",t=>{const e=document.getElementById("trashModal");e!=null&&e.classList.contains("visible")&&t.target===e&&ht()});let At=new Set;const jt=()=>`note_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,We=()=>Math.random()*40-20,Fe=(t=xt())=>t.getDay()===0?0:t.getDay()-1;function kt(t){const e=document.getElementById("noteLimitMessage"),o=e==null?void 0:e.querySelector(".transfer-text");o&&(o.textContent=t),e&&(e.classList.add("visible"),setTimeout(()=>e.classList.remove("visible"),3e3))}function Dt(){const t=document.querySelector(".note-input textarea"),e=t.value.trim();if(!e)return;const o=document.querySelector(`.board[data-board-id="${u}"]`),s=Array.from(o.querySelectorAll(".sticky-note")),[a,n,r]=[o.classList.contains("board-pattern-weekdays"),o.classList.contains("board-pattern-days"),s.length===0];if(!a&&!n&&s.length>=30){kt("Maximum notes space reached.");return}const i=s[s.length-1];let{x:l,y:f}=K[u]||{x:0,y:0},d=J[u]||getRandomColor(),y,g;const b=(S,E,D=null)=>{const x=o.offsetWidth/E,C=S*x+10,A=(S+1)*x-210,U=Math.max(C,Math.min(A,C+We())),q=Array.from(o.querySelectorAll(".sticky-note")).filter(c=>c.style.display!=="none"&&c!==D),[I,W]=[S*x,(S+1)*x],X=q.filter(c=>{const[m,h]=[p(c.style.left),p(c.style.left)+200],[v,j]=[Math.max(m,I),Math.min(h,W)];return Math.max(0,j-v)/200>.5});return{positionX:U,columnNotes:X}},k=(S,E)=>{const D=window.innerHeight-300;for(let x=0;x<E;x++){const C=(S+x)%E,{positionX:A,columnNotes:U}=b(C,E);let q=60,I=null;U.forEach(X=>{const c=p(X.style.top);c>=q&&(q=c,I=X)});const W=I?q+70:60;if(W<=D)return y=A,g=W,I&&(d=I.style.backgroundColor),!0}return kt("Maximum notes space reached."),!1},B=S=>{const E=S?Fe():Yt(u)||0;return k(E,S?6:5)};if(r)if(a||n){if(B(a)===!1)return}else[y,g]=[Math.max(150,window.innerWidth/4),50];else if(a||n){if(B(a)===!1)return}else if(i&&([l,f,d]=[p(i.style.left),p(i.style.top),i.style.backgroundColor]),{x:y,y:g}=Te(l,f),g<=50){const S=s.filter(E=>Math.abs(p(E.style.left)-y)<150);if(S.length>0){const E=S.map(q=>p(q.style.top)),[D,x]=[Math.max(...E),Math.min(...E)],C=window.innerHeight-300,[A,U]=[D+200,x-200];if(A<=C)g=A;else if(U>=50)g=U;else{const q=(W,X)=>{const c=window.innerWidth-200;for(let m=W;X>0?m<=c:m>=55;m+=X*250){const h=s.filter(Lt=>Math.abs(p(Lt.style.left)-m)<150);if(h.length===0)return{x:m,y:50};const v=h.map(Lt=>p(Lt.style.top)),[j,ot]=[Math.max(...v),Math.min(...v)],[dt,nt]=[j+200,ot-200];if(dt<=C)return{x:m,y:dt};if(nt>=50)return{x:m,y:nt}}return null},I=q(y+250,1)||q(y-250,-1);if(I)[y,g]=[I.x,I.y];else{kt("Maximum notes space reached.");return}}}}gt(e.replace(/\n/g,"<br>"),d,y,g,!1,"200px","150px",!1,u),[K[u],J[u],t.value]=[{x:y,y:g},d,""],_(),Y()}function gt(t,e,o,s,a=!1,n="200px",r="150px",i=!1,l=u,f=!1){const[d,y]=[document.createElement("div"),jt()];Object.assign(d,{className:"sticky-note",innerHTML:`<div class="sticky-content ${i?"bold":""}" contenteditable="true">${t}</div>
        <div class="note-controls">
            <div class="color-button" style="background-color: ${e}">
                <div class="color-palette">${at.map(b=>`<div class="color-option" style="background-color: ${b}" onclick="changeNoteColor(this, '${b}')"></div>`).join("")}</div>
            </div>
            <button class="bold-toggle ${i?"active":""}" onclick="toggleBold(this)">B</button>
            <button class="done-button" onclick="markAsDone(this.closest('.sticky-note'))">\u2713</button>
        </div>
        <div class="resize-handle"></div>`}),d.style.cssText=`background-color:${e}; left:${o}px; top:${s}px; width:${n}; height:${r}; z-index:${++R};`,d.dataset.noteId=y,f&&(d.dataset.repositioned="true",At.add(y)),H[y]=R,re(),d.addEventListener("click",b=>{b.target.closest('.note-controls, .sticky-content[contenteditable="true"]')||Ne(d)}),Ke(d);const g=document.querySelector(`.board[data-board-id="${l}"]`);return g?(g.appendChild(d),d.style.animation="paperPop 0.3s ease-out forwards",a||_(),d):(console.error(`Board element with ID ${l} not found.`),null)}function Ue(t,e){const o=t.closest(".sticky-note");(o.classList.contains("selected")?document.querySelectorAll(".sticky-note.selected"):[o]).forEach(a=>{const n=a.querySelector(".color-button");[a,n].forEach(r=>r.classList.add("color-transition")),[a.style.backgroundColor,n.style.backgroundColor]=[e,e],setTimeout(()=>[a,n].forEach(r=>r.classList.remove("color-transition")),300)}),J[u]=e,_()}const ue=t=>{t.closest(".sticky-note").querySelector(".sticky-content").classList.toggle("bold"),t.classList.toggle("active"),_()},Ft=document.getElementById("shortcutIcon")||document.querySelector(".textarea-container").appendChild(Object.assign(document.createElement("div"),{className:"shortcut-icon",id:"shortcutIcon"})),qt=()=>{const t=window.innerWidth<=1024;[Ft.style.display,Ft.textContent]=[t?"none":"block",t?"":navigator.platform.toUpperCase().indexOf("MAC")>=0?"\u2318":"Ctrl"]};window.addEventListener("resize",qt),qt();document.querySelector(".note-input textarea").addEventListener("keydown",t=>{t.key==="Enter"&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(t.preventDefault(),Dt())});let T=null,it=!1,$t=!1,Ct=!1;function Ke(t){let e=!1,o=!1,s=!1,a,n,r,i,l,f,d;const[y,g,b]=[".color-button",".color-palette",".sticky-content"].map(c=>t.querySelector(c)),k=()=>_();["blur","input"].forEach(c=>b.addEventListener(c,k));const B=c=>{s&&!b.contains(c.target)&&([s,b.contentEditable]=[!1,"false"],b.blur(),document.removeEventListener("click",B))};b.addEventListener("dblclick",c=>{[s,b.contentEditable]=[!0,"true"],setTimeout(()=>{const[m,h]=[document.createRange(),window.getSelection()];if(document.caretRangeFromPoint){const v=document.caretRangeFromPoint(c.clientX,c.clientY);v&&(h.removeAllRanges(),h.addRange(v))}else if(document.caretPositionFromPoint){const v=document.caretPositionFromPoint(c.clientX,c.clientY);v&&(m.setStart(v.offsetNode,v.offset),m.collapse(!0),h.removeAllRanges(),h.addRange(m))}b.focus()},0),setTimeout(()=>document.addEventListener("click",B),0),c.stopPropagation()});let S=null,E=!1;t.addEventListener("mouseenter",()=>{!e&&!o&&(E=!0,S=t.style.zIndex||"1",t.style.zIndex="9999")}),t.addEventListener("mouseleave",()=>{!e&&!o&&S!==null&&(E=!1,t.style.zIndex=S,S=null)}),b.addEventListener("blur",()=>b.contentEditable="false"),b.addEventListener("keydown",c=>{if(c.key==="Enter")if(c.preventDefault(),c.shiftKey)b.contentEditable="false",k();else{const[m,h]=[window.getSelection(),window.getSelection().getRangeAt(0)],v=Object.assign(document.createElement("span"),{innerHTML:"<br>",style:{fontFamily:"'Comic Neue', cursive"}});h.deleteContents(),h.insertNode(v),h.setStartAfter(v),h.collapse(!0),m.removeAllRanges(),m.addRange(h)}});const D=()=>{const c=t.getBoundingClientRect();K[u]={x:c.left,y:c.top}};let x=0,C=0,A=null;document.addEventListener("mousemove",c=>{[x,C]=[c.clientX,c.clientY],document.querySelectorAll(".color-palette.visible").forEach(m=>{var nt;const[h,v]=[m.getBoundingClientRect(),(nt=m.closest(".note-controls"))==null?void 0:nt.querySelector(".color-button")];if(!v)return;const j=v.getBoundingClientRect(),[ot,dt]=[x>=h.left-10&&x<=h.right+10&&C>=h.top-10&&C<=h.bottom+10,x>=j.left&&x<=j.right&&C>=j.top&&C<=j.bottom];ot||dt?clearTimeout(A):m.classList.contains("visible")&&q()})});const U=()=>{clearTimeout(A),g.classList.remove("closing"),g.classList.add("visible"),document.querySelectorAll(".color-palette").forEach(c=>{c!==g&&(c.classList.add("closing"),setTimeout(()=>c.classList.remove("visible","closing"),180))})},q=()=>{clearTimeout(A),A=setTimeout(()=>{const[c,m]=[g.getBoundingClientRect(),y.getBoundingClientRect()],[h,v]=[x<c.left-10||x>c.right+10||C<c.top-10||C>c.bottom+10,x>=m.left&&x<=m.right&&C>=m.top&&C<=m.bottom];h&&!v&&(g.classList.add("closing"),setTimeout(()=>g.classList.contains("closing")&&g.classList.remove("visible","closing"),180))},50)};y.addEventListener("click",c=>{c.stopPropagation(),g.classList.contains("visible")?q():U()}),["mouseenter","mouseleave"].forEach((c,m)=>g.addEventListener(c,m?q:()=>clearTimeout(A)));const I=(c,m,h)=>{if(!c.target.closest(".color-palette, .done-button")){if(w.includes(t)&&w.length>1){Re(c);return}c.shiftKey?w.includes(t)||(w.push(t),t.classList.add("selected")):Et(),c.preventDefault(),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["none","none"],E?S=++R:t.style.zIndex=++R,[a,n]=[m,h],c.target.closest(".resize-handle")?[o,l,f]=[!0,t.offsetWidth,t.offsetHeight]:([r,i]=[p(t.style.left),p(t.style.top)],[t.dataset.originalX,t.dataset.originalY]=[r,i],d=setTimeout(()=>e=!0,150)),V=t}},W=(c,m)=>{if(!(!V||V!==t)){if((Math.abs(c-a)>5||Math.abs(m-n)>5)&&clearTimeout(d),e){Ct||(Ct=!0,document.body.classList.add("drag-in-progress"));const h=5;let[v,j]=[Math.min(Math.max(r+c-a,-h),window.innerWidth-t.offsetWidth/4),Math.min(Math.max(i+m-n,-h),window.innerHeight-t.offsetHeight/4)];[t.style.left,t.style.top]=[`${v}px`,`${j}px`],Ot(),me(c,m)}if(o){const[h,v]=[150,150],[j,ot]=[window.innerWidth-p(t.style.left)+50,window.innerHeight-p(t.style.top)+50];t.style.width=`${Math.min(Math.max(l+c-a,h),j)}px`,t.style.height=`${Math.min(Math.max(f+m-n,v),ot)}px`}}},X=()=>{if(clearTimeout(d),[document.body.style.userSelect,document.body.style.webkitUserSelect]=["",""],(e||o)&&e){if(ct(),!ye().moved){D(),le(t),Ve(t);const m=t.dataset.noteId||jt();[t.dataset.noteId,t.dataset.repositioned]=[m,"true"],At.add(m),K[u]={x:p(t.style.left),y:p(t.style.top)},J[u]=t.style.backgroundColor,Y(),Rt(),V=null}_(),[Ct,document.body.classList]=[!1,document.body.classList.remove("drag-in-progress")]}[e,o]=[!1,!1],ct()};[["mousedown",c=>I(c,c.clientX,c.clientY)],["touchstart",c=>I(c,c.touches[0].clientX,c.touches[0].clientY),{passive:!1}]].forEach(([c,m,h])=>t.addEventListener(c,m,h)),[["mousemove",c=>W(c.clientX,c.clientY)],["mouseup",X],["touchmove",c=>W(c.touches[0].clientX,c.touches[0].clientY),{passive:!1}],["touchend",X]].forEach(([c,m,h])=>document.addEventListener(c,m,h))}function Je(){document.querySelectorAll(".color-palette").forEach(t=>{t.style.display!=="none"&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},200))}),Jt=null}document.addEventListener("click",t=>{Jt&&!t.target.closest(".color-button")&&Je()});function Ve(t){if(!t)return;const[e,o,s,a]=[t.getBoundingClientRect(),window.innerHeight,250,150],n=o-a,[r,i]=[e.bottom>n,e.left<s&&e.bottom>n];if(i){const[l,f,d]=[e.bottom-n+20,p(t.style.top),Math.max(60,p(t.style.top)-(e.bottom-n+20))];t.style.transition="top 0.3s ease-out",t.style.top=`${d}px`,setTimeout(()=>t.style.transition="",300)}}function me(t,e){var g,b;if($t)return;const o=document.querySelector(".status-bar");if(!o)return;const s=o.getBoundingClientRect(),[a,n]=[Math.max(0,Math.max(s.left-t,t-s.right)),Math.max(0,Math.max(s.top-e,e-s.bottom))],[r,i,l,f]=[Math.sqrt(a*a+n*n),120,80,T!==null],d=f?r<=i:r<=l,y=()=>{let[k,B]=[null,1/0];return document.querySelectorAll(".board-button:not(.disabled)").forEach(S=>{const E=S.getBoundingClientRect(),D=Math.sqrt(Math.pow(t-(E.left+E.width/2),2)+Math.pow(e-(E.top+E.height/2),2));D<B&&([k,B]=[S,D])}),k};if(d!==f)if(d){const k=document.querySelectorAll(".board-button:not(.disabled)");T=y(),k.forEach(B=>B.classList.add("drag-active","drag-proximity")),T&&T.classList.add("drag-hover"),Ze()}else document.querySelectorAll(".board-button").forEach(k=>{k.classList.remove("drag-hover","drag-proximity"),setTimeout(()=>k.classList.remove("drag-active"),200)}),T=null,fe();else if(d&&T){const k=y();k!==T&&(T==null||T.classList.remove("drag-hover"),T=k,k?(k.classList.add("drag-hover"),ct(),(g=document.querySelector(".shortcut-hint"))==null||g.classList.add("hidden-during-drag")):(Ot(),it||(b=document.querySelector(".shortcut-hint"))==null||b.classList.remove("hidden-during-drag")))}}function Ze(){if(!T)return;const[t,e]=[T.getBoundingClientRect(),w.length>0?w:V?[V]:[]];e.forEach(o=>{if(o&&!o.classList.contains("reverse-animating")&&!o.classList.contains("hover-animating")){o.querySelectorAll("textarea, [contenteditable]").forEach(i=>{[i.style.userSelect,i.style.pointerEvents]=["none","none"]});const[s,a]=[o.getBoundingClientRect(),o.closest(".board").getBoundingClientRect()],[n,r]=[t.left-a.left+t.width/2-(s.left-a.left)-s.width/2,t.top-a.top+t.height/2-(s.top-a.top)-s.height/2];o.style.setProperty("--suckX",`${n}px`),o.style.setProperty("--suckY",`${r}px`),o.style.animation="noteSuckHover 0.3s ease-out forwards",o.classList.add("hover-animating")}})}function fe(){document.querySelectorAll(".hover-animating").forEach(t=>{t.querySelectorAll("textarea, [contenteditable]").forEach(e=>{e.style.removeProperty("user-select"),e.style.removeProperty("pointer-events")}),t.style.animation="noteSuckReverse 0.3s ease-out forwards",t.classList.remove("hover-animating"),t.classList.add("reverse-animating"),setTimeout(()=>{t.classList.contains("reverse-animating")&&([t.style.animation]=["none"],t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),t.classList.remove("reverse-animating"))},300)})}function Ot(){var t;if(L>1&&!it&&!T){const e=document.getElementById("dragTransferMessage");e&&(e.classList.add("visible"),it=!0),(t=document.querySelector(".shortcut-hint"))==null||t.classList.add("hidden-during-drag")}}function ct(){var t;if(it){const e=document.getElementById("dragTransferMessage");e&&(e.classList.remove("visible"),it=!1),(t=document.querySelector(".shortcut-hint"))==null||t.classList.remove("hidden-during-drag")}}function Rt(){document.querySelectorAll(".board-button").forEach(t=>t.classList.remove("drag-hover","drag-proximity")),[T]=[null],fe(),ct()}function ye(){if(!T)return{moved:!1};const[t,e]=[parseInt(T.dataset.boardId),w.length>0?[...w]:[V]];if(t===u)return e.forEach(s=>{if(s){const a=F==null?void 0:F.find(n=>n.element===s);a?(s.style.left=`${a.x}px`,s.style.top=`${Math.max(60,a.y)}px`):s.style.top=`${parseInt(s.style.top||0)-250}px`}}),{moved:!1};let o=new Map;if(e.length>1&&typeof F!="undefined"&&F.length>0){let[s,a]=[1/0,1/0];F.forEach(n=>{n&&e.includes(n.element)&&([s,a]=[Math.min(s,n.x),Math.min(a,n.y)])}),F.forEach(n=>{n&&e.includes(n.element)&&o.set(n.element,{offsetX:n.x-s,offsetY:n.y-a})})}return e.forEach(s=>{s&&Ge(s,t,o.size>0?o.get(s):null)}),w.length>0&&Et(),{moved:!0}}function Ge(t,e,o=null){const s=t.style.left;if(t.classList.contains("hover-animating"))t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating");else{const a=document.querySelector(`.board-button[data-board-id="${e}"]`);if(!a)return;const[n,r,i]=[a.getBoundingClientRect(),t.getBoundingClientRect(),t.closest(".board").getBoundingClientRect()],[l,f]=[n.left-i.left+n.width/2-(r.left-i.left)-r.width/2,n.top-i.top+n.height/2-(r.top-i.top)-r.height/2];t.style.setProperty("--suckX",`${l}px`),t.style.setProperty("--suckY",`${f}px`),t.style.animation="noteSuckHover 0.3s ease-out forwards",t.classList.add("hover-animating")}setTimeout(()=>{t.classList.contains("hover-animating")&&(t.style.animation="noteSuckComplete 0.3s ease-in forwards",t.classList.remove("hover-animating"))},300),setTimeout(()=>{t.querySelectorAll("textarea, [contenteditable]").forEach(n=>{n.style.removeProperty("user-select"),n.style.removeProperty("pointer-events")}),t.remove();const a=document.querySelector(`.board[data-board-id="${e}"]`);if(a){if(t.style.animation="",t.style.removeProperty("--suckX"),t.style.removeProperty("--suckY"),o)if(o.originalX!==void 0&&o.originalY!==void 0)[t.style.left,t.style.top]=[`${o.originalX}px`,`${Math.max(60,o.originalY)}px`];else{const[i,l]=[100,80];[t.style.left,t.style.top]=[`${i+o.offsetX}px`,`${Math.max(60,l+o.offsetY)}px`]}else{const[i,l]=[parseFloat(t.dataset.originalX),parseFloat(t.dataset.originalY)];!isNaN(i)&&!isNaN(l)?[t.style.left,t.style.top]=[`${i}px`,`${Math.max(60,l)}px`]:[t.style.left,t.style.top]=[s,"80px"]}const n=t.dataset.noteId||jt();[t.dataset.noteId,t.dataset.repositioned]=[n,"true"],At.add(n),a.appendChild(t),t.style.animation="paperPop 0.3s ease-out forwards",Y(),Rt(),$t=!0,setTimeout(()=>$t=!1,500);const r=u;[u]=[e],_(),[u]=[r],_()}},600)}let N={},P=null,ut={x:0,y:0},O=[];function he(){oo(),Ee(),to(),document.querySelectorAll(".emoji-item").forEach(t=>t.addEventListener("click",ge))}const ge=t=>{const e=t.target.dataset.emoji;e&&(eo(e),Qe(e))};function Qe(t){const e=document.querySelector(".board.active");if(!e)return;const o=e.dataset.boardId;if(so(o)>=10)return ao();const s=io(),a=e.getBoundingClientRect(),[n,r,i]=[a.width-120,a.height*.8-120,20],[l,f]=[Math.random()*n,Math.max(i,Math.random()*r)],d=Object.assign(document.createElement("div"),{className:"emoji-sticker new",textContent:t});d.dataset.stickerId=s,Object.assign(d.style,{left:l+"px",top:f+"px"});const y=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});y.addEventListener("click",g=>[g.stopPropagation(),be(s,o)]),d.appendChild(y),pe(d),e.appendChild(d),(N[o]=N[o]||{})[s]={emoji:t,x:l,y:f,id:s},_t(o),setTimeout(()=>d.classList.remove("new"),400)}function pe(t){let e=!1;["mousedown","touchstart"].forEach(n=>t.addEventListener(n,o,n==="touchstart"?{passive:!1}:!1));function o(n){if(n.target.classList.contains("delete-button"))return;n.preventDefault(),n.stopPropagation(),[e,P]=[!0,t],Object.assign(document.body.style,{userSelect:"none",webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none"}),[document.onselectstart,document.ondragstart]=[()=>!1,()=>!1];const[r,i]=[n.type==="touchstart"?n.touches[0].clientX:n.clientX,n.type==="touchstart"?n.touches[0].clientY:n.clientY],l=t.getBoundingClientRect();[ut.x,ut.y]=[r-l.left,i-l.top],t.classList.add("dragging"),["mousemove","touchmove","mouseup","touchend"].forEach(f=>document.addEventListener(f,f.includes("move")?s:a,f==="touchmove"?{passive:!1}:!1))}function s(n){if(!e||!P)return;n.preventDefault(),n.stopPropagation();const[r,i]=[n.type==="touchmove"?n.touches[0].clientX:n.clientX,n.type==="touchmove"?n.touches[0].clientY:n.clientY],l=document.querySelector(".board.active").getBoundingClientRect(),[f,d]=[Math.max(0,Math.min(r-l.left-ut.x,l.width-120)),Math.max(0,Math.min(i-l.top-ut.y,l.height-120))];Object.assign(P.style,{left:f+"px",top:d+"px"})}function a(){var i;if(!e||!P)return;P.classList.remove("dragging"),Object.assign(document.body.style,{userSelect:"",webkitUserSelect:"",mozUserSelect:"",msUserSelect:""}),[document.onselectstart,document.ondragstart]=[null,null],ro(P);const[n,r]=[document.querySelector(".board.active").dataset.boardId,P.dataset.stickerId];(i=N[n])!=null&&i[r]&&(Object.assign(N[n][r],{x:parseInt(P.style.left),y:parseInt(P.style.top)}),_t(n)),P=null,["mousemove","touchmove","mouseup","touchend"].forEach(l=>document.removeEventListener(l,l.includes("move")?s:a))}}const be=(t,e)=>{const o=document.querySelector(`[data-sticker-id="${t}"]`);o&&(o.classList.add("deleting"),setTimeout(()=>o.remove(),500)),N[e]&&(delete N[e][t],_t(e))},_t=t=>localStorage.setItem(`emojiStickers_board_${t}`,JSON.stringify(N[t]||{}));function ve(t){const e=localStorage.getItem(`emojiStickers_board_${t}`);try{N[t]=e?JSON.parse(e):{},e&&Se(t)}catch(o){console.error("Error loading emoji stickers:",o),N[t]={}}}const to=()=>Array.from({length:L},(t,e)=>ve(e+1));function Se(t){const e=document.querySelector(`.board[data-board-id="${t}"]`);!e||!N[t]||(e.querySelectorAll(".emoji-sticker").forEach(o=>o.remove()),Object.values(N[t]).forEach(({id:o,emoji:s,x:a,y:n})=>{const r=Object.assign(document.createElement("div"),{className:"emoji-sticker",textContent:s});r.dataset.stickerId=o,Object.assign(r.style,{left:a+"px",top:n+"px"});const i=Object.assign(document.createElement("button"),{className:"delete-button",textContent:"\xD7"});i.addEventListener("click",l=>[l.stopPropagation(),be(o,t)]),r.appendChild(i),pe(r),e.appendChild(r)}))}function eo(t){const e=O.indexOf(t);(e<0||e>=12)&&(e>-1&&O.splice(e,1),O.unshift(t),O.length>16&&(O=O.slice(0,16)),no(),Ee())}function oo(){const t=localStorage.getItem("emojiUsageOrder");try{O=t?JSON.parse(t):[]}catch(e){console.error("Error loading emoji usage order:",e),O=[]}}const no=()=>localStorage.setItem("emojiUsageOrder",JSON.stringify(O));function Ee(){const t=document.querySelector(".emoji-picker");t&&(t.querySelectorAll(".recent-emoji").forEach(e=>e.remove()),O.length>0&&O.slice(0,12).reverse().forEach(e=>{const o=Object.assign(document.createElement("div"),{className:"emoji-item recent-emoji",textContent:e});o.dataset.emoji=e,o.addEventListener("click",ge),t.insertBefore(o,t.firstChild)}))}const so=t=>N[t]?Object.keys(N[t]).length:0,ao=()=>{const t=document.getElementById("emojiLimitMessage");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1e3))};function ro(t){if(!t)return;const[e,o]=[t.getBoundingClientRect(),window.innerHeight],[s,a,n]=[250,150,o-150];if(e.left<s&&e.bottom>n){const i=Math.max(60,parseInt(t.style.top)-(e.bottom-n+20));t.style.top=`${i}px`}}const io=()=>"emoji_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),co=t=>[localStorage.removeItem(`emojiStickers_board_${t}`),delete N[t]];document.addEventListener("DOMContentLoaded",()=>setTimeout(he,100));window.emojiStickers={loadEmojiStickers:ve,renderEmojiStickers:Se,cleanupEmojiStickers:co,initializeEmojiPicker:he};const xt=()=>new Date,we=t=>{const e=xt().getDay(),o=e===0?6:e-1;return t===o},lo=t=>{const e=`daysPatternStartDate_${t}`;localStorage.getItem(e)||localStorage.setItem(e,xt().toISOString().split("T")[0])},Yt=t=>{const e=localStorage.getItem(`daysPatternStartDate_${t}`);return e?Math.floor((xt()-new Date(e))/(1e3*60*60*24))%5:-1},xe=t=>localStorage.removeItem(`daysPatternStartDate_${t}`),Ut=()=>{if(G||L>=tt){L>=tt&&alert(`Maximum number of boards (${tt}) reached.`);return}Nt(++L),oe(),bt()};function Nt(t){const e=document.querySelector(".boards-container"),o=Object.assign(document.createElement("div"),{className:"board"});o.dataset.boardId=t,e.appendChild(o);const s=Object.assign(document.createElement("div"),{className:"board-title-circle"});s.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const a=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30});let n;const r=()=>{const l=a.value.trim();if(!l){a.value=a.dataset.originalTitle||"";return}Xt(t,l),vt(a)};a.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(r,500)}),vt(a),s.appendChild(a),o.appendChild(s);const i=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:t});if(i.dataset.boardId=t,i.addEventListener("click",()=>$(t)),t>1){const l=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});l.addEventListener("click",f=>{f.stopPropagation(),pt(t)}),i.appendChild(l)}document.querySelector(".boards-navigation").insertBefore(i,document.querySelector(".add-board-button")),setTimeout(()=>[i.classList.remove("new-button"),i.classList.add("transitions-ready")],500),lt(t),Pt(t),window.emojiStickers&&window.emojiStickers.loadEmojiStickers(t)}function pt(t){if(!confirm(`Are you sure you want to delete board ${t}?`))return;const e=document.querySelector(`.board[data-board-id="${t}"]`);if(!e){Tt(t);return}const[o,s]=[e.querySelectorAll(".sticky-note"),e.querySelectorAll(".emoji-sticker")];if(o.length||s.length){const[a,n]=[document.querySelector(".trash-bin"),document.querySelector(".trash-bin").getBoundingClientRect()];a.style.animation="binShake 0.5s ease-in-out",o.forEach(r=>{const i=r.querySelector(".sticky-content");z.unshift({text:i.innerHTML,color:r.style.backgroundColor,x:r.style.left,y:r.style.top,width:r.style.width,height:r.style.height,timestamp:new Date().toLocaleString(),isBold:i.classList.contains("bold")});const l=r.getBoundingClientRect(),[f,d]=[n.left-l.left+n.width/2-l.width/2,n.top-l.top];r.style.setProperty("--throwX",`${f}px`),r.style.setProperty("--throwY",`${d}px`),r.style.animation="paperCrumble 0.5s ease-in forwards"}),s.forEach(r=>r.classList.add("deleting")),St(),et(),setTimeout(()=>Tt(t),600)}else Tt(t)}function Tt(t){const[e,o]=[document.querySelector(`.board[data-board-id="${t}"]`),document.querySelector(`.board-button[data-board-id="${t}"]`)];e&&e.remove(),o&&o.classList.add("removing");const s=[];for(let a=t+1;a<=L;a++){const n=document.querySelector(`.board-button[data-board-id="${a}"]`);n&&(n.classList.add("removing"),s.push(a))}[`${Q}_board_${t}`,`stickyNotes_boardTitle_${t}`,`boardColor_${t}`,`boardPattern_${t}`,`boardStyles_board_${t}`].forEach(a=>localStorage.removeItem(a)),xe(t),window.emojiStickers&&window.emojiStickers.cleanupEmojiStickers(t);for(let a=t+1;a<=L;a++)["boardColor","boardPattern","boardStyles_board"].forEach(n=>{const[r,i,l]=[`${n}_${a}`,`${n}_${a-1}`,localStorage.getItem(`${n}_${a}`)];l&&localStorage.setItem(i,l),localStorage.removeItem(r)});setTimeout(()=>{o&&o.remove();const[a,n]=[document.querySelector(".boards-navigation"),document.querySelector(".add-board-button")];s.forEach(r=>{const[i,l,f]=[document.querySelector(`.board-button[data-board-id="${r}"]`),document.querySelector(`.board[data-board-id="${r}"]`),r-1];i&&i.remove(),l&&(l.dataset.boardId=f);const d=Object.assign(document.createElement("div"),{className:"board-button new-button",textContent:f});if([d.dataset.boardId,d.dataset.originalNumber]=[f,f],d.addEventListener("click",()=>$(f)),f>1){const y=Object.assign(document.createElement("div"),{className:"delete-board",textContent:"\xD7"});y.addEventListener("click",g=>{g.stopPropagation(),pt(f)}),d.appendChild(y)}a.insertBefore(d,n),["","Title","Color","Pattern"].forEach(y=>{const[g,b,k]=[y?`stickyNotes_board${y}`:Q,`${y?`stickyNotes_board${y}`:Q}_board_${r}`,`${y?`stickyNotes_board${y}`:Q}_board_${f}`],B=localStorage.getItem(b);B&&(localStorage.setItem(k,B),localStorage.removeItem(b))}),lt(f)}),setTimeout(()=>document.querySelectorAll(".board-button.new-button").forEach(r=>[r.classList.remove("new-button"),r.classList.add("transitions-ready")]),500),L--,oe(),bt(),u===t?$(t>1?t-1:L>=1?1:null):u>t&&(u--,$(u)),document.querySelector(".trash-bin").style.animation=""},350)}function $(t){if(G&&t!==1)return;const e=parseInt(t);e===u||e===null||(fo(),document.body.classList.add("board-switching"),setTimeout(()=>document.body.classList.remove("board-switching"),300),u=e,K[t]||(K[t]={x:window.innerWidth/2-100,y:window.innerHeight/2-75}),J[t]||(J[t]=at[0]),document.querySelectorAll(".board").forEach(o=>{const s=parseInt(o.dataset.boardId);if(o.classList.remove("active","prev","next"),o.style.visibility="hidden",s===u){if(o.classList.add("active"),o.style.visibility="visible",o.querySelectorAll(".sticky-note").forEach((a,n)=>a.style.setProperty("--note-index",n)),o.querySelectorAll(".emoji-sticker").forEach((a,n)=>a.style.setProperty("--sticker-index",n)),!o.querySelector(".board-title-circle")){const a=Object.assign(document.createElement("div"),{className:"board-title-circle"});a.setAttribute("onclick","this.querySelector('.board-title-input').focus()");const n=Object.assign(document.createElement("input"),{type:"text",className:"board-title-input",placeholder:"Title...",maxLength:30}),r=()=>Xt(s,n.value);["change","blur"].forEach(i=>n.addEventListener(i,r)),a.appendChild(n),o.appendChild(a),Pt(s)}}else o.classList.add(s<u?"prev":"next")}),document.querySelectorAll(".board-button").forEach(o=>o.classList.toggle("active",parseInt(o.dataset.boardId)===u)),lt(u),ke(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=M.colors.current),Y(),window.emojiStickers&&window.emojiStickers.renderEmojiStickers(u),setTimeout(()=>Ce(u),300))}function uo(){document.querySelector(".add-board-button").addEventListener("click",Ut),document.querySelectorAll(".board-button").forEach(s=>{const[a,n]=[parseInt(s.dataset.boardId),s.cloneNode(!0)];n.addEventListener("click",()=>$(a));const r=n.querySelector(".delete-board");r&&r.addEventListener("click",i=>{i.stopPropagation(),pt(a)}),s.parentNode.replaceChild(n,s)});let t,e;const o=document.querySelector(".boards-container");o.addEventListener("touchstart",s=>{G||([t,e]=[s.touches[0].clientX,s.touches[0].clientY])}),o.addEventListener("touchend",s=>{if(G||!t)return;const[a,n,r]=[s.changedTouches[0].clientX,s.changedTouches[0].clientY,t-s.changedTouches[0].clientX];Math.abs(r)>Math.abs(e-n)&&Math.abs(r)>50&&(r>0&&u<L?$(u+1):r<0&&u>1&&$(u-1)),t=null}),document.addEventListener("keydown",s=>{if(G)return;const[a,n]=[s.target.tagName,s.target.getAttribute("contenteditable")==="true"];if((s.key==="Control"||s.key==="Meta")&&!s.altKey&&!s.shiftKey&&a!=="TEXTAREA"&&!n){s.preventDefault(),document.querySelector(".note-input textarea").focus();return}if(a==="TEXTAREA"||n){(s.metaKey||s.ctrlKey)&&s.key==="Enter"&&(s.preventDefault(),Dt());return}s.key==="ArrowLeft"&&u>1?$(u-1):s.key==="ArrowRight"&&u<L?$(u+1):s.key==="n"&&s.ctrlKey?(s.preventDefault(),Ut()):s.key==="d"&&s.ctrlKey&&u>1&&(s.preventDefault(),pt(u));const r=parseInt(s.key);!isNaN(r)&&r>=1&&r<=9&&r<=L&&$(r)}),window.addEventListener("resize",ee)}function bt(){const t=document.querySelector(".add-board-button"),e=L>=tt;t.classList.toggle("disabled",e),t.title=e?`Maximum number of boards (${tt}) reached`:"Add new board",mo()}function mo(){const t=document.querySelector(".shortcut-hint");t&&(t.style.display=L>=2?"block":"none")}let Kt=!1;function fo(){if(Kt||L<2)return;const t=document.querySelector(".shortcut-hint");t&&(Kt=!0,t.classList.add("auto-show"),setTimeout(()=>{t.classList.remove("auto-show")},4e3))}function yo(){const t=document.querySelector(".board-style-menu"),e=t.classList.contains("visible");e||(ke(),Le(),document.querySelectorAll(".board-pattern-option, .pattern-preview").forEach(o=>o.style.backgroundColor=M.colors.current),t.offsetWidth),t.classList.toggle("visible",!e),t.classList.toggle("closing",e),e&&setTimeout(()=>t.classList.remove("closing"),300)}function Le(){document.querySelector(".board-color-option.initialized")||document.querySelectorAll(".board-color-option, .board-pattern-option").forEach(t=>{t.classList.add("initialized");const e=t.classList.contains("board-color-option")?"color":"pattern",o=t.getAttribute(`data-${e}`);t.addEventListener("click",()=>{e==="color"?ho(o):po(o),document.querySelectorAll(`.board-${e}-option`).forEach(s=>s.classList.remove("active")),t.classList.add("active")})})}function ke(){["color","pattern"].forEach(t=>{document.querySelectorAll(`.board-${t}-option`).forEach(e=>{e.classList.toggle("active",e.getAttribute(`data-${t}`)===M[`${t}s`].current)})})}function ho(t){M.colors.current=t;const e=document.querySelector(".board.active");e.style.backgroundColor=t,document.querySelectorAll(".pattern-preview, .board-pattern-option").forEach(o=>{o.style.backgroundColor=t,o.classList.contains("board-pattern-option")&&(o.style.opacity="0.8")}),ne(),Y(),e.style.transition="background-color 0.5s ease",setTimeout(()=>e.style.transition="",500)}function go(t){const e=Object.assign(document.createElement("div"),{style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; transition:opacity 0.5s ease; opacity:0;"}),o=document.querySelector(`.board[data-board-id="${u}"]`);if(t!=="none"){const s={dots:"background-image:radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",grid:"background-image:linear-gradient(rgba(255,255,255,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.4) 1px, transparent 1px); background-size:20px 20px;",lines:"background-image:linear-gradient(0deg, transparent 19px, rgba(255,255,255,0.4) 20px); background-size:20px 20px;"};if(s[t])e.style.cssText+=s[t];else if(t==="weekdays"||t==="days"){const a=Object.assign(document.createElement("div"),{className:t==="weekdays"?"weekday-header":"day-header"});(t==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:["Day 1","Day 2","Day 3","Day 4","Day 5"]).forEach((r,i)=>{const l=Object.assign(document.createElement("span"),{textContent:r});(t==="weekdays"&&we(i)||t==="days"&&Yt(u)===i)&&l.classList.add("current-day"),a.appendChild(l)}),e.appendChild(a),o==null||o.classList.add("has-header")}}else o==null||o.classList.remove("has-header");return e}function po(t){const[e,o,s]=[document.querySelector(".board.active"),document.querySelector(".board.active").dataset.boardId,M.patterns.current];s==="days"&&t!=="days"&&xe(o),M.patterns.current=t,e.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(r=>r.remove()),e.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),t==="days"&&lo(o);const a=go(t);e.appendChild(a),a.offsetWidth,a.style.opacity="1";let n=null;(t==="weekdays"||t==="days")&&(n=Object.assign(document.createElement("div"),{className:`lines-overlay lines-overlay-${t}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0; transition:opacity 0.5s ease;"}),e.appendChild(n),n.offsetWidth,n.style.opacity="1"),setTimeout(()=>{t==="weekdays"||t==="days"?(e.classList.add(`board-pattern-${t}`),a.style.height="auto",a.style.zIndex="1",a.classList.add("pattern-overlay"),n&&(n.style.zIndex="0",n.classList.add("pattern-overlay"))):(a.remove(),n==null||n.remove(),t!=="none"&&e.classList.add(`board-pattern-${t}`)),Y()},500),ne()}function bo(t,e){if(t.style.backgroundColor=e.color,t.querySelectorAll(".pattern-overlay, .lines-overlay").forEach(o=>o.remove()),t.classList.remove("board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"),e.pattern!=="none"&&(t.classList.add(`board-pattern-${e.pattern}`),e.pattern==="weekdays"||e.pattern==="days")){const o=Object.assign(document.createElement("div"),{className:`pattern-overlay ${e.pattern==="weekdays"?"weekday-header":"day-header"}`});(e.pattern==="weekdays"?["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]:Array.from({length:5},(n,r)=>`Day ${r+1}`)).forEach((n,r)=>{const i=Object.assign(document.createElement("span"),{textContent:n});(e.pattern==="weekdays"&&we(r)||e.pattern==="days"&&Yt(parseInt(t.dataset.boardId))===r)&&i.classList.add("current-day"),o.appendChild(i)}),t.appendChild(o);const a=Object.assign(document.createElement("div"),{className:`pattern-overlay lines-overlay lines-overlay-${e.pattern}`,style:"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0;"});t.appendChild(a)}}function lt(t){const e=localStorage.getItem(`boardStyles_board_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(!o)return;let s;e?(s=JSON.parse(e),t===u&&(M.colors.current=s.color,M.patterns.current=s.pattern)):(s={color:M.colors.default,pattern:M.patterns.default},t===u&&(M.colors.current=s.color,M.patterns.current=s.pattern)),bo(o,s),Y()}vo();document.addEventListener("click",function(t){const e=document.querySelector(".board-style-menu"),o=document.querySelector(".board-style-button");e&&e.classList.contains("visible")&&o&&!o.contains(t.target)&&!e.contains(t.target)&&(e.classList.add("closing"),e.classList.remove("visible"),setTimeout(()=>e.classList.remove("closing"),300))});document.querySelector(".board-style-menu").addEventListener("click",t=>t.stopPropagation());function vo(){document.querySelectorAll(".board").forEach(t=>Pt(t.dataset.boardId))}function Xt(t,e){localStorage.setItem(`stickyNotes_boardTitle_${t}`,e);const o=document.querySelector(`.board-button[data-board-id="${t}"]`);o&&!o.dataset.originalNumber&&(o.dataset.originalNumber=o.textContent)}function vt(t){t.setAttribute("data-counter",`${t.value.length}/${t.maxLength}`)}function Pt(t){const e=localStorage.getItem(`stickyNotes_boardTitle_${t}`),o=document.querySelector(`.board[data-board-id="${t}"]`);if(o){const a=o.querySelector(".board-title-input");a&&e&&(a.value=e)}const s=document.querySelector(`.board-button[data-board-id="${t}"]`);s&&!s.dataset.originalNumber&&(s.dataset.originalNumber=s.textContent)}function Ce(t){const e=document.querySelector(`.board[data-board-id="${t}"] .board-title-circle`);e&&(e.classList.add("show-temporary"),setTimeout(()=>e.classList.remove("show-temporary"),3e3))}function So(){document.querySelectorAll(".board-title-circle").forEach(t=>{let e;const[o,s]=[t.querySelector(".board-title-input"),t.closest(".board").dataset.boardId];if(["mouseenter","mouseleave","click"].forEach((a,n)=>{t.addEventListener(a,()=>{n===0?(o&&o.focus(),clearTimeout(e),t.classList.add("delayed-close")):n===1?(e=setTimeout(()=>t.classList.remove("delayed-close"),2e3),o&&o.blur()):o&&o.focus()})}),o){let a;const n=()=>{const r=o.value.trim();if(!r){o.dataset.originalTitle="";return}Xt(s,r),vt(o)};o.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(n,500)}),vt(o)}})}const Y=()=>{for(let t=1;t<=L;t++){const[e,o]=[document.querySelector(`.board[data-board-id="${t}"]`),document.querySelector(`.board-button[data-board-id="${t}"]`)];if(!e||!o)continue;const s=e.style.backgroundColor||M.colors.default;o.classList.toggle("has-notes",e.querySelectorAll(".sticky-note").length>0),o.style.backgroundColor=s;const a=["board-pattern-dots","board-pattern-grid","board-pattern-lines","board-pattern-weekdays","board-pattern-days"],n=a.find(i=>e.classList.contains(i));a.forEach(i=>o.classList.remove(i.replace("board-pattern","button-pattern"))),n&&o.classList.add(n.replace("board-pattern","button-pattern"));const r=Me(s)||{r:26,g:26,b:26};o.style.color=(r.r*299+r.g*587+r.b*114)/1e3>128?"#000":"#fff"}};function Eo(t){t.forEach(({selector:e,event:o,handler:s})=>{const a=document.querySelector(e);a&&a.addEventListener(o,s)})}document.addEventListener("DOMContentLoaded",function(){Be(),$e(),ae(),uo(),Le(),Ie(),qt(),So(),wo(),setTimeout(()=>Ce(u),500),xo(),Eo([{selector:".board-style-button",event:"click",handler:yo},{selector:".trash-bin",event:"click",handler:ht},{selector:"#trashModal .close-modal-btn",event:"click",handler:ht},{selector:"#trashModal .clear-trash-btn",event:"click",handler:de}])});function wo(){const t=a=>{const n=a.selectionStart,r=a.value;if(r.length>0){const i=r.charAt(0).toUpperCase()+r.slice(1);i!==r&&(a.value=i,a.setSelectionRange(n,n))}},e=a=>{["input","keyup"].forEach(n=>a.addEventListener(n,r=>t(r.target))),a.addEventListener("paste",n=>setTimeout(()=>t(n.target),0))};document.querySelectorAll(".board-title-input, .note-input textarea").forEach(e);const o=new MutationObserver(a=>{a.forEach(n=>{n.addedNodes.forEach(r=>{var i;r.nodeType===1&&((r.querySelectorAll?r.querySelectorAll(".board-title-input"):[]).forEach(e),(i=r.classList)!=null&&i.contains("board-title-input")&&e(r))})})}),s=document.querySelector(".boards-container");s&&o.observe(s,{childList:!0,subtree:!0})}function xo(){setTimeout(()=>{document.querySelectorAll(".board-button").forEach(t=>{t.classList.add("transitions-ready"),t.offsetHeight,requestAnimationFrame(()=>t.style.transform="scale(1)")})},100)}window.toggleBold=ue;window.markAsDone=It;window.addNote=Dt;window.restoreNote=ze;window.changeNoteColor=Ue;window.markAsDone=It;window.toggleBold=ue;window.duplicateNote=duplicateNote;window.clearTrash=de;window.closeModal=closeModal;window.openTrash=openTrash;})();
